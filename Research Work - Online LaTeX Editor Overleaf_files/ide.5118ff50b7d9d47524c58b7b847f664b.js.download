function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();return"area"===nodeName?(map=element.parentNode,mapName=map.name,element.href&&mapName&&"map"===map.nodeName.toLowerCase()?(img=$("img[usemap='#"+mapName+"']")[0],!!img&&visible(img)):!1):(/^(input|select|textarea|button|object)$/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element)}function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return"hidden"===$.css(this,"visibility")}).length}(function(){angular.module("RecursionHelper",[]).factory("RecursionHelper",["$compile",function($compile){return{compile:function(element,link){var compiledContents,contents;return angular.isFunction(link)&&(link={post:link}),contents=element.contents().remove(),compiledContents=void 0,{pre:link&&link.pre?link.pre:null,post:function(scope,element){compiledContents||(compiledContents=$compile(contents)),compiledContents(scope,function(clone){element.append(clone)}),link&&link.post&&link.post.apply(null,arguments)}}}}}])}).call(this),define("modules/recursionHelper",function(){}),function(){var app;app=angular.module("ErrorCatcher",[]),app.config(["$provide",function($provide){return $provide.decorator("$exceptionHandler",["$log","$delegate",function($log,$delegate){return function(exception,cause){return null!=("undefined"!=typeof Raven&&null!==Raven?Raven.captureException:void 0)&&Raven.captureException(exception),$delegate(exception,cause)}}])}]),app.factory("unAuthHttpResponseInterceptor",["$q","$location",function($q,$location){return{responseError:function(response){var ref,ref1;return 401!==(ref=response.status)&&403!==ref||(null!=(ref1=response.config)?ref1.disableAutoLoginRedirect:void 0)||(window.location.pathname.match(/^\/project/)?window.location="/login?redir="+encodeURI(window.location.pathname):window.location="/login"),$q.reject(response)}}}]),app.config(["$httpProvider",function($httpProvider){return $httpProvider.interceptors.push("unAuthHttpResponseInterceptor")}])}.call(this),define("modules/errorCatcher",function(){}),function(){var slice=[].slice;angular.module("localStorage",[]).value("localStorage",function(){var args,e;args=1<=arguments.length?slice.call(arguments,0):[];try{return $.localStorage.apply($,args)}catch(error){return e=error,console.error("localStorage exception",e),null}})}.call(this),define("modules/localStorage",function(){}),function(){define("utils/underscore",["libraries"],function(){return angular.module("underscore",[]).factory("_",function(){return window._})})}.call(this),function(){var slice=[].slice;define("base",["libraries","modules/recursionHelper","modules/errorCatcher","modules/localStorage","utils/underscore"],function(){var App,ref,ref1,sl_debugging;return App=angular.module("SharelatexApp",["ui.bootstrap","autocomplete","RecursionHelper","ng-context-menu","underscore","ngSanitize","ipCookie","mvdSixpack","ErrorCatcher","localStorage","ngTagsInput","ui.select"]).config(function($qProvider,sixpackProvider,$httpProvider,uiSelectConfig){var ref;return $qProvider.errorOnUnhandledRejections(!1),uiSelectConfig.spinnerClass="fa fa-refresh ui-select-spin",sixpackProvider.setOptions({debug:!1,baseUrl:window.sharelatex.sixpackDomain,client_id:window.user_id}),"undefined"!=typeof MathJax&&null!==MathJax&&null!=(ref=MathJax.Hub)?ref.Config({messageStyle:"none",imageFont:null,"HTML-CSS":{availableFonts:["TeX"],scale:110,matchFontHeight:!1},TeX:{equationNumbers:{autoNumber:"AMS"},useLabelIDs:!1},skipStartupTypeset:!0,tex2jax:{processEscapes:!0,inlineMath:[["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]}}):void 0}),App.run(function($templateCache){return $templateCache.put("bootstrap/match.tpl.html",'<div class="ui-select-match" ng-hide="$select.open && $select.searchEnabled" ng-disabled="$select.disabled" ng-class="{\'btn-default-focus\':$select.focus}"><span tabindex="-1" class="btn btn-default form-control ui-select-toggle" aria-label="{{ $select.baseTitle }} activate" ng-disabled="$select.disabled" ng-click="$select.activate()" style="outline: 0;"><span ng-show="$select.isEmpty()" class="ui-select-placeholder text-muted">{{$select.placeholder}}</span> <span ng-hide="$select.isEmpty()" class="ui-select-match-text pull-left" ng-class="{\'ui-select-allow-clear\': $select.allowClear && !$select.isEmpty()}" ng-transclude=""></span> <i class="caret pull-right" ng-click="$select.toggle($event)"></i> <a ng-show="$select.allowClear && !$select.isEmpty() && ($select.disabled !== true)" aria-label="{{ $select.baseTitle }} clear" style="margin-right: 10px" ng-click="$select.clear($event)" class="btn btn-xs btn-link pull-right"><i class="fa fa-times" aria-hidden="true"></i></a></span></div>')}),sl_debugging=null!=(null!=(ref=window.location)&&null!=(ref1=ref.search)?ref1.match(/debug=true/):void 0),window.sl_console={log:function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],sl_debugging?console.log.apply(console,args):void 0}},App})}.call(this),function(){define("ide/file-tree/directives/fileEntity",["base"],function(App){return App.directive("fileEntity",["RecursionHelper",function(RecursionHelper){return{restrict:"E",scope:{entity:"=",permissions:"="},templateUrl:"entityListItemTemplate",compile:function(element){return RecursionHelper.compile(element,function(scope,element,attrs,ctrl){return scope.$originalApply=scope.$apply,scope.$apply=function(fn){var phase;return null==fn&&(fn=function(){}),phase=this.$root.$$phase,"$apply"===phase||"$digest"===phase?fn():this.$originalApply(fn)}})}}}])})}.call(this),function(){define("ide/file-tree/directives/draggable",["base"],function(App){return App.directive("draggable",function(){return{link:function(scope,element,attrs){return scope.$watch(attrs.draggable,function(draggable){return draggable?element.draggable({delay:250,opacity:.7,scroll:!0,helper:scope.$eval(attrs.draggableHelper)}):void 0})}}})})}.call(this),function(){define("ide/file-tree/directives/droppable",["base"],function(App){return App.directive("droppable",function(){return{link:function(scope,element,attrs){return scope.$watch(attrs.droppable,function(droppable){return droppable?element.droppable({greedy:!0,hoverClass:"droppable-hover",tolerance:"pointer",accept:attrs.accept,drop:scope.$eval(attrs.onDropCallback)}):void 0})}}})})}.call(this),function(){define("ide/file-tree/controllers/FileTreeController",["base"],function(App){return App.controller("FileTreeController",["$scope","$modal","ide","$rootScope",function($scope,$modal,ide,$rootScope){return $scope.openNewDocModal=function(){return $modal.open({templateUrl:"newFileModalTemplate",controller:"NewFileModalController",size:"lg",resolve:{parent_folder:function(){return ide.fileTreeManager.getCurrentFolder()},type:function(){return"doc"}}})},$scope.openNewFolderModal=function(){return $modal.open({templateUrl:"newFolderModalTemplate",controller:"NewFolderModalController",resolve:{parent_folder:function(){return ide.fileTreeManager.getCurrentFolder()}}})},$scope.openUploadFileModal=function(){return $modal.open({templateUrl:"newFileModalTemplate",controller:"NewFileModalController",size:"lg",resolve:{parent_folder:function(){return ide.fileTreeManager.getCurrentFolder()},type:function(){return"upload"}}})},$scope.orderByFoldersFirst=function(entity){return"folder"===(null!=entity?entity.type:void 0)?"0":"1"},$scope.startRenamingSelected=function(){return $scope.$broadcast("rename:selected")},$scope.openDeleteModalForSelected=function(){return $scope.$broadcast("delete:selected")}}]),App.controller("NewFolderModalController",["$scope","ide","$modalInstance","$timeout","parent_folder",function($scope,ide,$modalInstance,$timeout,parent_folder){return $scope.inputs={name:"name"},$scope.state={inflight:!1},$modalInstance.opened.then(function(){return $timeout(function(){return $scope.$broadcast("open")},200)}),$scope.create=function(){var name;return name=$scope.inputs.name,null!=name&&0!==name.length?($scope.state.inflight=!0,ide.fileTreeManager.createFolder(name,$scope.parent_folder).then(function(){return $scope.state.inflight=!1,$modalInstance.dismiss("done")})["catch"](function(response){var data;return data=response.data,$scope.error=data,$scope.state.inflight=!1})):void 0},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}]),App.controller("NewFileModalController",["$scope","type","parent_folder","$modalInstance",function($scope,type,parent_folder,$modalInstance){return $scope.type=type,$scope.parent_folder=parent_folder,$scope.state={inflight:!1,valid:!0},$scope.cancel=function(){return $modalInstance.dismiss("cancel")},$scope.create=function(){return $scope.$broadcast("create")},$scope.$on("done",function(){return $modalInstance.dismiss("done")})}]),App.controller("NewDocModalController",["$scope","ide","$timeout",function($scope,ide,$timeout){var validate;return $scope.inputs={name:"name.tex"},validate=function(){var name;return name=$scope.inputs.name,$scope.state.valid=null!=name&&name.length>0},$scope.$watch("inputs.name",validate),$timeout(function(){return $scope.$broadcast("open")},200),$scope.$on("create",function(){var name;return name=$scope.inputs.name,null!=name&&0!==name.length?($scope.state.inflight=!0,ide.fileTreeManager.createDoc(name,$scope.parent_folder).then(function(){return $scope.state.inflight=!1,$scope.$emit("done")})["catch"](function(response){var data;return data=response.data,$scope.error=data,$scope.state.inflight=!1})):void 0})}]),App.controller("UploadFileModalController",["$scope","$rootScope","ide","$timeout","$window",function($scope,$rootScope,ide,$timeout,$window){var _uploadTimer,needToLogBackIn,ref,uploadCount,uploadIfNoConflicts;return $scope.parent_folder_id=null!=(ref=$scope.parent_folder)?ref.id:void 0,$scope.project_id=ide.project_id,$scope.tooManyFiles=!1,$scope.rateLimitHit=!1,$scope.secondsToRedirect=10,$scope.notLoggedIn=!1,$scope.conflicts=[],$scope.control={},needToLogBackIn=function(){var decreseTimeout;return $scope.notLoggedIn=!0,(decreseTimeout=function(){return $timeout(function(){return 0===$scope.secondsToRedirect?$window.location.href="/login?redir=/project/"+ide.project_id:(decreseTimeout(),$scope.secondsToRedirect=$scope.secondsToRedirect-1)},1e3)})()},$scope.max_files=40,$scope.onComplete=function(error,name,response){return $timeout(function(){return uploadCount--,response.success&&$rootScope.$broadcast("file:upload:complete",response),0===uploadCount&&null!=response&&response.success?$scope.$emit("done"):void 0},250)},$scope.onValidateBatch=function(files){return files.length>$scope.max_files?($timeout(function(){return $scope.tooManyFiles=!0},1),!1):!0},$scope.onError=function(id,name,reason){return console.log(id,name,reason),-1!==reason.indexOf("429")?$scope.rateLimitHit=!0:-1!==reason.indexOf("403")?needToLogBackIn():void 0},_uploadTimer=null,uploadIfNoConflicts=function(){return 0===$scope.conflicts.length?$scope.doUpload():void 0},uploadCount=0,$scope.onSubmit=function(id,name){return uploadCount++,ide.fileTreeManager.existsInFolder($scope.parent_folder_id,name)&&($scope.conflicts.push(name),$scope.$apply()),null==_uploadTimer&&(_uploadTimer=setTimeout(function(){return _uploadTimer=null,uploadIfNoConflicts()},0)),!0},$scope.onCancel=function(id,name){var index;return uploadCount--,index=$scope.conflicts.indexOf(name),index>-1&&$scope.conflicts.splice(index,1),$scope.$apply(),uploadIfNoConflicts()},$scope.doUpload=function(){var ref1,ref2;return null!=(ref1=$scope.control)&&null!=(ref2=ref1.q)?ref2.uploadStoredFiles():void 0}}]),App.controller("ProjectLinkedFileModalController",["$scope","ide","$timeout",function($scope,ide,$timeout){var _reset,_setInFlight,validate;return $scope.data={projects:null,selectedProjectId:null,projectEntities:null,projectOutputFiles:null,selectedProjectEntity:null,selectedProjectOutputFile:null,buildId:null,name:null},$scope.state.inFlight={projects:!1,entities:!1,compile:!1},$scope.state.isOutputFilesMode=!1,$scope.state.error=!1,$scope.$watch("data.selectedProjectId",function(newVal,oldVal){return newVal?($scope.data.selectedProjectEntity=null,$scope.data.selectedProjectOutputFile=null,$scope.state.isOutputFilesMode?$scope.compileProjectAndGetOutputFiles($scope.data.selectedProjectId):$scope.getProjectEntities($scope.data.selectedProjectId)):void 0}),$scope.$watch("state.isOutputFilesMode",function(newVal,oldVal){return newVal||oldVal?($scope.data.selectedProjectOutputFile=null,newVal===!0?$scope.compileProjectAndGetOutputFiles($scope.data.selectedProjectId):$scope.getProjectEntities($scope.data.selectedProjectId)):void 0}),$scope.$watch("data.selectedProjectEntity",function(newVal,oldVal){var fileName;if(newVal)return fileName=newVal.split("/").reverse()[0],fileName?$scope.data.name=fileName:void 0}),$scope.$watch("data.selectedProjectOutputFile",function(newVal,oldVal){var fileName,project;if(newVal)return"output.pdf"===newVal?(project=_.find($scope.data.projects,function(p){return p._id===$scope.data.selectedProjectId}),$scope.data.name=null!=(null!=project?project.name:void 0)?project.name+".pdf":"output.pdf"):(fileName=newVal.split("/").reverse()[0])?$scope.data.name=fileName:void 0}),_setInFlight=function(type){return $scope.state.inFlight[type]=!0},_reset=function(opts){var inFlight,isError;return isError=opts.err===!0,inFlight=$scope.state.inFlight,inFlight.projects=inFlight.entities=inFlight.compile=!1,$scope.state.inflight=!1,$scope.state.error=isError},$scope.toggleOutputFilesMode=function(){return $scope.data.selectedProjectId?$scope.state.isOutputFilesMode=!$scope.state.isOutputFilesMode:void 0},$scope.shouldEnableProjectSelect=function(){var data,state;return state=$scope.state,data=$scope.data,!state.inFlight.projects&&data.projects},$scope.hasNoProjects=function(){var data,state;return state=$scope.state,data=$scope.data,!state.inFlight.projects&&(0===data.projects.length||null==data.projects)},$scope.shouldEnableProjectEntitySelect=function(){var data,state;return state=$scope.state,data=$scope.data,!state.inFlight.projects&&!state.inFlight.entities&&data.projects&&data.selectedProjectId},$scope.shouldEnableProjectOutputFileSelect=function(){var data,state;return state=$scope.state,data=$scope.data,!state.inFlight.projects&&!state.inFlight.compile&&data.projects&&data.selectedProjectId},validate=function(){var data,state;return state=$scope.state,data=$scope.data,$scope.state.valid=!state.inFlight.projects&&!state.inFlight.entities&&data.projects&&data.selectedProjectId&&(!$scope.state.isOutputFilesMode&&data.projectEntities&&data.selectedProjectEntity||$scope.state.isOutputFilesMode&&data.projectOutputFiles&&data.selectedProjectOutputFile)&&data.name},$scope.$watch("state",validate,!0),$scope.$watch("data",validate,!0),$scope.getUserProjects=function(){return _setInFlight("projects"),ide.$http.get("/user/projects",{_csrf:window.csrfToken}).then(function(resp){return $scope.data.projectEntities=null,$scope.data.projects=resp.data.projects.filter(function(p){return p._id!==ide.project_id}),_reset({err:!1})})["catch"](function(err){return _reset({err:!0})})},$scope.getProjectEntities=function(_this){return function(project_id){return _setInFlight("entities"),ide.$http.get("/project/"+project_id+"/entities",{_csrf:window.csrfToken}).then(function(resp){return $scope.data.selectedProjectId===resp.data.project_id?($scope.data.projectEntities=resp.data.entities,_reset({err:!1})):void 0})["catch"](function(err){return _reset({err:!0})})}}(this),$scope.compileProjectAndGetOutputFiles=function(_this){return function(project_id){return _setInFlight("compile"),ide.$http.post("/project/"+project_id+"/compile",{check:"silent",draft:!1,incrementalCompilesEnabled:!1,_csrf:window.csrfToken}).then(function(resp){var filteredFiles,ref;return"success"===resp.data.status?(filteredFiles=resp.data.outputFiles.filter(function(f){return f.path.match(/.*\.(pdf|png|jpeg|jpg|gif)/)}),$scope.data.projectOutputFiles=filteredFiles,$scope.data.buildId=null!=filteredFiles&&null!=(ref=filteredFiles[0])?ref.build:void 0,console.log(">> build_id",$scope.data.buildId),_reset({err:!1})):($scope.data.projectOutputFiles=null,_reset({err:!0}))})["catch"](function(err){return console.error(err),_reset({err:!0})})}}(this),$scope.init=function(){return $scope.getUserProjects()},$timeout($scope.init,0),$scope.$on("create",function(){var name,payload,projectId,provider;return projectId=$scope.data.selectedProjectId,name=$scope.data.name,$scope.state.isOutputFilesMode?(provider="project_output_file",payload={source_project_id:projectId,source_output_file_path:$scope.data.selectedProjectOutputFile,build_id:$scope.data.buildId}):(provider="project_file",payload={source_project_id:projectId,source_entity_path:$scope.data.selectedProjectEntity}),_setInFlight("create"),ide.fileTreeManager.createLinkedFile(name,$scope.parent_folder,provider,payload).then(function(){return _reset({err:!1}),$scope.$emit("done")})["catch"](function(response){var data;return data=response.data,_reset({err:!0})})})}]),App.controller("UrlLinkedFileModalController",["$scope","ide","$timeout",function($scope,ide,$timeout){var validate;return $scope.inputs={name:"",url:""},$scope.nameChangedByUser=!1,$timeout(function(){return $scope.$broadcast("open")},200),validate=function(){var name,ref,url;return ref=$scope.inputs,name=ref.name,url=ref.url,null==name||0===name.length?$scope.state.valid=!1:null==url||0===url.length?$scope.state.valid=!1:$scope.state.valid=!0},$scope.$watch("inputs.name",validate),$scope.$watch("inputs.url",validate),$scope.$watch("inputs.url",function(url){var parts;return null!=url&&""!==url&&!$scope.nameChangedByUser&&(url=url.replace("://",""),parts=url.split("/").reverse(),parts.length>1)?$scope.inputs.name=parts[0]:void 0}),$scope.$on("create",function(){var name,ref,url;return ref=$scope.inputs,name=ref.name,url=ref.url,null!=name&&0!==name.length&&null!=url&&0!==url.length?($scope.state.inflight=!0,ide.fileTreeManager.createLinkedFile(name,$scope.parent_folder,"url",{url:url}).then(function(){return $scope.state.inflight=!1,$scope.$emit("done")})["catch"](function(response){var data;return data=response.data,$scope.error=data,$scope.state.inflight=!1})):void 0})}])})}.call(this),function(){define("ide/file-tree/util/iconTypeFromName",[],function(){var iconTypeFromName;return iconTypeFromName=function(name){var ext,ref;return ext=null!=(ref=name.split(".").pop())?ref.toLowerCase():void 0,"png"===ext||"pdf"===ext||"jpg"===ext||"jpeg"===ext||"gif"===ext?"image":"csv"===ext||"xls"===ext||"xlsx"===ext?"table":"py"===ext||"r"===ext?"file-text":"bib"===ext?"book":"file"}})}.call(this),function(){define("ide/file-tree/controllers/FileTreeEntityController",["base","ide/file-tree/util/iconTypeFromName"],function(App,iconTypeFromName){return App.controller("FileTreeEntityController",["$scope","ide","$modal",function($scope,ide,$modal){var invalidModalShowing;return $scope.select=function(e){var initialMultiSelectCount;return e.ctrlKey||e.metaKey?(e.stopPropagation(),initialMultiSelectCount=ide.fileTreeManager.multiSelectedCount(),0===ide.fileTreeManager.toggleMultiSelectEntity($scope.entity),0===initialMultiSelectCount?ide.fileTreeManager.multiSelectSelectedEntity():void 0):(ide.fileTreeManager.selectEntity($scope.entity),$scope.$emit("entity:selected",$scope.entity))},$scope.draggableHelper=function(){return ide.fileTreeManager.multiSelectedCount()>0?$("<strong style='z-index:100'>"+ide.fileTreeManager.multiSelectedCount()+" Files</strong>"):$("<strong style='z-index:100'>"+$scope.entity.name+"</strong>")},$scope.inputs={name:$scope.entity.name},$scope.startRenaming=function(){return $scope.entity.renaming=!0},invalidModalShowing=!1,$scope.finishRenaming=function(){var modal,name;if($scope.entity.renaming){if(name=$scope.inputs.name,null==name){if(invalidModalShowing)return;return invalidModalShowing=!0,modal=$modal.open({templateUrl:"invalidFileNameModalTemplate"}),void modal.result.then(function(){return invalidModalShowing=!1})}return delete $scope.entity.renaming,null==name||0===name.length?void($scope.inputs.name=$scope.entity.name):ide.fileTreeManager.renameEntity($scope.entity,name)}},$scope.$on("rename:selected",function(){return $scope.entity.selected?$scope.startRenaming():void 0}),$scope.openDeleteModal=function(){var entities;return entities=ide.fileTreeManager.multiSelectedCount()>0?ide.fileTreeManager.getMultiSelectedEntityChildNodes():[$scope.entity],$modal.open({templateUrl:"deleteEntityModalTemplate",controller:"DeleteEntityModalController",resolve:{entities:function(){return entities}}})},$scope.$on("delete:selected",function(){return $scope.entity.selected?$scope.openDeleteModal():void 0}),$scope.iconTypeFromName=iconTypeFromName}]),App.controller("DeleteEntityModalController",["$scope","ide","$modalInstance","entities",function($scope,ide,$modalInstance,entities){return $scope.state={inflight:!1},$scope.entities=entities,$scope["delete"]=function(){var entity,i,len,ref;for($scope.state.inflight=!0,ref=$scope.entities,i=0,len=ref.length;len>i;i++)entity=ref[i],ide.fileTreeManager.deleteEntity(entity);return $modalInstance.close()},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}])})}.call(this),function(){define("ide/file-tree/controllers/FileTreeFolderController",["base"],function(App){return App.controller("FileTreeFolderController",function($scope,ide,$modal,localStorage){return $scope.expanded=localStorage("folder."+$scope.entity.id+".expanded")||!1,$scope.toggleExpanded=function(){return $scope.expanded=!$scope.expanded,localStorage("folder."+$scope.entity.id+".expanded",$scope.expanded)},$scope.onDrop=function(events,ui){var dropped_entity,entities,i,len;for(entities=ide.fileTreeManager.multiSelectedCount()?ide.fileTreeManager.getMultiSelectedEntityChildNodes():[$(ui.draggable).scope().entity],i=0,len=entities.length;len>i;i++)dropped_entity=entities[i],ide.fileTreeManager.moveEntity(dropped_entity,$scope.entity);return $scope.$digest(),$(".file-tree-inner .droppable-hover").removeClass("droppable-hover")},$scope.orderByFoldersFirst=function(entity){return"folder"===(null!=entity?entity.type:void 0)?"0":"1"},$scope.openNewDocModal=function(){return $modal.open({templateUrl:"newFileModalTemplate",controller:"NewFileModalController",size:"lg",resolve:{parent_folder:function(){return $scope.entity},type:function(){return"doc"}}})},$scope.openNewFolderModal=function(){return $modal.open({templateUrl:"newFolderModalTemplate",controller:"NewFolderModalController",resolve:{parent_folder:function(){return $scope.entity}}})},$scope.openUploadFileModal=function(){return $modal.open({templateUrl:"newFileModalTemplate",controller:"NewFileModalController",size:"lg",resolve:{parent_folder:function(){return $scope.entity},type:function(){return"upload"}}})}})})}.call(this),function(){define("ide/file-tree/controllers/FileTreeRootFolderController",["base"],function(App){return App.controller("FileTreeRootFolderController",["$scope","ide",function($scope,ide){var rootFolder;return rootFolder=$scope.rootFolder,$scope.onDrop=function(events,ui){var dropped_entity,entities,i,len;for(entities=ide.fileTreeManager.multiSelectedCount()?ide.fileTreeManager.getMultiSelectedEntityChildNodes():[$(ui.draggable).scope().entity],i=0,len=entities.length;len>i;i++)dropped_entity=entities[i],ide.fileTreeManager.moveEntity(dropped_entity,rootFolder);return $scope.$digest(),$(".file-tree-inner .droppable-hover").removeClass("droppable-hover")}}])})}.call(this),function(){var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};define("ide/file-tree/FileTreeManager",["ide/file-tree/directives/fileEntity","ide/file-tree/directives/draggable","ide/file-tree/directives/droppable","ide/file-tree/controllers/FileTreeController","ide/file-tree/controllers/FileTreeEntityController","ide/file-tree/controllers/FileTreeFolderController","ide/file-tree/controllers/FileTreeRootFolderController"],function(){var FileTreeManager;return FileTreeManager=function(){function FileTreeManager(ide,$scope){this.ide=ide,this.$scope=$scope,this.$scope.$on("project:joined",function(_this){return function(){return _this.loadRootFolder(),_this.loadDeletedDocs(),_this.$scope.$emit("file-tree:initialized")}}(this)),this.$scope.$watch("rootFolder",function(_this){return function(rootFolder){return null!=rootFolder?_this.recalculateDocList():void 0}}(this)),this._bindToSocketEvents(),this.$scope.multiSelectedCount=0,$(document).on("click",function(_this){return function(){return _this.clearMultiSelectedEntities(),_this.$scope.$digest()}}(this))}return FileTreeManager.prototype._bindToSocketEvents=function(){return this.ide.socket.on("reciveNewDoc",function(_this){return function(parent_folder_id,doc){var parent_folder;return parent_folder=_this.findEntityById(parent_folder_id)||_this.$scope.rootFolder,_this.$scope.$apply(function(){return parent_folder.children.push({name:doc.name,id:doc._id,type:"doc"}),_this.recalculateDocList()})}}(this)),this.ide.socket.on("reciveNewFile",function(_this){return function(parent_folder_id,file,source,linkedFileData){var parent_folder;return parent_folder=_this.findEntityById(parent_folder_id)||_this.$scope.rootFolder,_this.$scope.$apply(function(){return parent_folder.children.push({name:file.name,id:file._id,type:"file",linkedFileData:linkedFileData}),_this.recalculateDocList()})}}(this)),this.ide.socket.on("reciveNewFolder",function(_this){return function(parent_folder_id,folder){var parent_folder;return parent_folder=_this.findEntityById(parent_folder_id)||_this.$scope.rootFolder,_this.$scope.$apply(function(){return parent_folder.children.push({name:folder.name,id:folder._id,type:"folder",children:[]}),_this.recalculateDocList()})}}(this)),this.ide.socket.on("reciveEntityRename",function(_this){return function(entity_id,name){var entity;return entity=_this.findEntityById(entity_id),null!=entity?_this.$scope.$apply(function(){return entity.name=name,_this.recalculateDocList()}):void 0}}(this)),this.ide.socket.on("removeEntity",function(_this){return function(entity_id){var entity;return entity=_this.findEntityById(entity_id),null!=entity?(_this.$scope.$apply(function(){return _this._deleteEntityFromScope(entity),_this.recalculateDocList()}),_this.$scope.$broadcast("entity:deleted",entity)):void 0}}(this)),this.ide.socket.on("reciveEntityMove",function(_this){return function(entity_id,folder_id){var entity,folder;return entity=_this.findEntityById(entity_id),folder=_this.findEntityById(folder_id),_this.$scope.$apply(function(){return _this._moveEntityInScope(entity,folder),_this.recalculateDocList()})}}(this))},FileTreeManager.prototype.selectEntity=function(entity){return this.selected_entity_id=entity.id,this.ide.fileTreeManager.forEachEntity(function(entity){return entity.selected=!1}),entity.selected=!0},FileTreeManager.prototype.toggleMultiSelectEntity=function(entity){return entity.multiSelected=!entity.multiSelected,this.$scope.multiSelectedCount=this.multiSelectedCount()},FileTreeManager.prototype.multiSelectedCount=function(){var count;return count=0,this.forEachEntity(function(entity){return entity.multiSelected?count++:void 0}),count},FileTreeManager.prototype.getMultiSelectedEntities=function(){var entities;return entities=[],this.forEachEntity(function(e){return e.multiSelected?entities.push(e):void 0}),entities},FileTreeManager.prototype.getMultiSelectedEntityChildNodes=function(){var child_entities,entities,entity,i,j,k,len,parts,path,paths,prefixes,ref;for(entities=this.getMultiSelectedEntities(),paths={},j=0,len=entities.length;len>j;j++)entity=entities[j],paths[this.getEntityPath(entity)]=entity;prefixes={};for(path in paths)if(entity=paths[path],parts=path.split("/"),!(parts.length<=1))for(i=k=1,ref=parts.length-1;ref>=1?ref>=k:k>=ref;i=ref>=1?++k:--k)prefixes[parts.slice(0,i).join("/")]=!0;child_entities=[];for(path in paths)entity=paths[path],null==prefixes[path]&&child_entities.push(entity);return child_entities},FileTreeManager.prototype.clearMultiSelectedEntities=function(){return 0!==this.$scope.multiSelectedCount?(this.forEachEntity(function(entity){return entity.multiSelected=!1}),this.$scope.multiSelectedCount=0):void 0},FileTreeManager.prototype.multiSelectSelectedEntity=function(){var ref;return null!=(ref=this.findSelectedEntity())?ref.multiSelected=!0:void 0},FileTreeManager.prototype.existsInFolder=function(folder_id,name){var entity,folder;return folder=this.findEntityById(folder_id),null==folder?!1:(entity=this._findEntityByPathInFolder(folder,name),null!=entity)},FileTreeManager.prototype.findSelectedEntity=function(){var selected;return selected=null,this.forEachEntity(function(entity){return entity.selected?selected=entity:void 0}),selected},FileTreeManager.prototype.findEntityById=function(id,options){var entity,j,len,ref;if(null==options&&(options={}),this.$scope.rootFolder.id===id)return this.$scope.rootFolder;if(entity=this._findEntityByIdInFolder(this.$scope.rootFolder,id),null!=entity)return entity;if(options.includeDeleted)for(ref=this.$scope.deletedDocs,j=0,len=ref.length;len>j;j++)if(entity=ref[j],entity.id===id)return entity;return null},FileTreeManager.prototype._findEntityByIdInFolder=function(folder,id){var entity,j,len,ref,result;for(ref=folder.children||[],j=0,len=ref.length;len>j;j++){if(entity=ref[j],entity.id===id)return entity;if(null!=entity.children&&(result=this._findEntityByIdInFolder(entity,id),null!=result))return result}return null},FileTreeManager.prototype.findEntityByPath=function(path){return this._findEntityByPathInFolder(this.$scope.rootFolder,path)},FileTreeManager.prototype._findEntityByPathInFolder=function(folder,path){var entity,j,len,name,parts,ref,rest;if(null==path||null==folder)return null;if(""===path)return folder;if(parts=path.split("/"),name=parts.shift(),rest=parts.join("/"),"."===name)return this._findEntityByPathInFolder(folder,rest);for(ref=folder.children,j=0,len=ref.length;len>j;j++)if(entity=ref[j],entity.name===name){if(""===rest)return entity;if("folder"===entity.type)return this._findEntityByPathInFolder(entity,rest)}return null},FileTreeManager.prototype.forEachEntity=function(callback){var entity,j,len,ref,results;for(null==callback&&(callback=function(entity,parent_folder,path){}),this._forEachEntityInFolder(this.$scope.rootFolder,null,callback),ref=this.$scope.deletedDocs||[],results=[],j=0,len=ref.length;len>j;j++)entity=ref[j],results.push(callback(entity));return results},FileTreeManager.prototype._forEachEntityInFolder=function(folder,path,callback){var childPath,entity,j,len,ref,results;for(ref=folder.children||[],results=[],j=0,len=ref.length;len>j;j++)entity=ref[j],childPath=null!=path?path+"/"+entity.name:entity.name,callback(entity,folder,childPath),null!=entity.children?results.push(this._forEachEntityInFolder(entity,childPath,callback)):results.push(void 0);return results},FileTreeManager.prototype.getEntityPath=function(entity){return this._getEntityPathInFolder(this.$scope.rootFolder,entity)},FileTreeManager.prototype._getEntityPathInFolder=function(folder,entity){var child,j,len,path,ref;for(ref=folder.children||[],j=0,len=ref.length;len>j;j++){if(child=ref[j],child===entity)return entity.name;if("folder"===child.type&&(path=this._getEntityPathInFolder(child,entity),null!=path))return child.name+"/"+path}return null},FileTreeManager.prototype.getRootDocDirname=function(){var rootDoc;return rootDoc=this.findEntityById(this.$scope.project.rootDoc_id),null!=rootDoc?this._getEntityDirname(rootDoc):void 0},FileTreeManager.prototype._getEntityDirname=function(entity){var path;return path=this.getEntityPath(entity),null!=path?path.split("/").slice(0,-1).join("/"):void 0},FileTreeManager.prototype._findParentFolder=function(entity){var dirname;return dirname=this._getEntityDirname(entity),null!=dirname?this.findEntityByPath(dirname):void 0;
},FileTreeManager.prototype.loadRootFolder=function(){var ref,ref1;return this.$scope.rootFolder=this._parseFolder(null!=(ref=this.$scope)&&null!=(ref1=ref.project)?ref1.rootFolder[0]:void 0)},FileTreeManager.prototype._parseFolder=function(rawFolder){var childFolder,doc,file,folder,j,k,l,len,len1,len2,ref,ref1,ref2;for(folder={name:rawFolder.name,id:rawFolder._id,type:"folder",children:[],selected:rawFolder._id===this.selected_entity_id},ref=rawFolder.docs||[],j=0,len=ref.length;len>j;j++)doc=ref[j],folder.children.push({name:doc.name,id:doc._id,type:"doc",selected:doc._id===this.selected_entity_id});for(ref1=rawFolder.fileRefs||[],k=0,len1=ref1.length;len1>k;k++)file=ref1[k],folder.children.push({name:file.name,id:file._id,type:"file",selected:file._id===this.selected_entity_id,linkedFileData:file.linkedFileData,created:file.created});for(ref2=rawFolder.folders||[],l=0,len2=ref2.length;len2>l;l++)childFolder=ref2[l],folder.children.push(this._parseFolder(childFolder));return folder},FileTreeManager.prototype.loadDeletedDocs=function(){var doc,j,len,ref,results;for(this.$scope.deletedDocs=[],ref=this.$scope.project.deletedDocs||[],results=[],j=0,len=ref.length;len>j;j++)doc=ref[j],results.push(this.$scope.deletedDocs.push({name:doc.name,id:doc._id,type:"doc",deleted:!0}));return results},FileTreeManager.prototype.recalculateDocList=function(){return this.$scope.docs=[],this.forEachEntity(function(_this){return function(entity,parentFolder,path){return"doc"!==entity.type||entity.deleted?void 0:_this.$scope.docs.push({doc:entity,path:path})}}(this)),this.$scope.docs.sort(function(a,b){var aDepth,bDepth;return aDepth=(a.path.match(/\//g)||[]).length,bDepth=(b.path.match(/\//g)||[]).length,aDepth-bDepth!==0?-(aDepth-bDepth):a.path<b.path?-1:1})},FileTreeManager.prototype.getEntityPath=function(entity){return this._getEntityPathInFolder(this.$scope.rootFolder,entity)},FileTreeManager.prototype._getEntityPathInFolder=function(folder,entity){var child,j,len,path,ref;for(ref=folder.children||[],j=0,len=ref.length;len>j;j++){if(child=ref[j],child===entity)return entity.name;if("folder"===child.type&&(path=this._getEntityPathInFolder(child,entity),null!=path))return child.name+"/"+path}return null},FileTreeManager.prototype.getCurrentFolder=function(){return this._getCurrentFolder(this.$scope.rootFolder)||this.$scope.rootFolder},FileTreeManager.prototype._getCurrentFolder=function(startFolder){var entity,j,len,ref,result;for(null==startFolder&&(startFolder=this.$scope.rootFolder),ref=startFolder.children||[],j=0,len=ref.length;len>j;j++){if(entity=ref[j],entity.selected)return"folder"===entity.type?entity:startFolder;if("folder"===entity.type&&(result=this._getCurrentFolder(entity),null!=result))return result}return null},FileTreeManager.prototype.projectContainsFolder=function(){var entity,j,len,ref;for(ref=this.$scope.rootFolder.children,j=0,len=ref.length;len>j;j++)if(entity=ref[j],"folder"===entity.type)return!0;return!1},FileTreeManager.prototype.existsInThisFolder=function(folder,name){var entity,j,len,ref;for(ref=(null!=folder?folder.children:void 0)||[],j=0,len=ref.length;len>j;j++)if(entity=ref[j],entity.name===name)return!0;return!1},FileTreeManager.prototype.nameExistsError=function(message){var nameExists;return null==message&&(message="already exists"),nameExists=this.ide.$q.defer(),nameExists.reject({data:message}),nameExists.promise},FileTreeManager.prototype.createDoc=function(name,parent_folder){return null==parent_folder&&(parent_folder=this.getCurrentFolder()),this.existsInThisFolder(parent_folder,name)?this.nameExistsError():this.ide.$http.post("/project/"+this.ide.project_id+"/doc",{name:name,parent_folder_id:null!=parent_folder?parent_folder.id:void 0,_csrf:window.csrfToken})},FileTreeManager.prototype.createFolder=function(name,parent_folder){return null==parent_folder&&(parent_folder=this.getCurrentFolder()),this.existsInThisFolder(parent_folder,name)?this.nameExistsError():this.ide.$http.post("/project/"+this.ide.project_id+"/folder",{name:name,parent_folder_id:null!=parent_folder?parent_folder.id:void 0,_csrf:window.csrfToken})},FileTreeManager.prototype.createLinkedFile=function(name,parent_folder,provider,data){return null==parent_folder&&(parent_folder=this.getCurrentFolder()),this.existsInThisFolder(parent_folder,name)?this.nameExistsError():this.ide.$http.post("/project/"+this.ide.project_id+"/linked_file",{name:name,parent_folder_id:null!=parent_folder?parent_folder.id:void 0,provider:provider,data:data,_csrf:window.csrfToken},{disableAutoLoginRedirect:!0})},FileTreeManager.prototype.refreshLinkedFile=function(file){var parent_folder,provider,ref;return parent_folder=this._findParentFolder(file),provider=null!=(ref=file.linkedFileData)?ref.provider:void 0,null==provider?void console.warn(">> no provider for "+file.name,file):this.ide.$http.post("/project/"+this.ide.project_id+"/linked_file/"+file.id+"/refresh",{_csrf:window.csrfToken},{disableAutoLoginRedirect:!0})},FileTreeManager.prototype.renameEntity=function(entity,name,callback){var parent_folder;return null==callback&&(callback=function(error){}),entity.name===name||name.length>=150?void 0:(parent_folder=this.getCurrentFolder(),this.existsInThisFolder(parent_folder,name)?this.nameExistsError():(entity.renamingToName=name,this.ide.$http.post("/project/"+this.ide.project_id+"/"+entity.type+"/"+entity.id+"/rename",{name:name,_csrf:window.csrfToken}).then(function(){return entity.name=name})["finally"](function(){return entity.renamingToName=null})))},FileTreeManager.prototype.deleteEntity=function(entity,callback){return null==callback&&(callback=function(error){}),this.ide.queuedHttp({method:"DELETE",url:"/project/"+this.ide.project_id+"/"+entity.type+"/"+entity.id,headers:{"X-Csrf-Token":window.csrfToken}})},FileTreeManager.prototype.moveEntity=function(entity,parent_folder,callback){return null==callback&&(callback=function(error){}),this._isChildFolder(entity,parent_folder)?void 0:this.existsInThisFolder(parent_folder,entity.name)?this.nameExistsError():this.ide.queuedHttp.post("/project/"+this.ide.project_id+"/"+entity.type+"/"+entity.id+"/move",{folder_id:parent_folder.id,_csrf:window.csrfToken}).then(function(_this){return function(){return _this._moveEntityInScope(entity,parent_folder)}}(this))},FileTreeManager.prototype._isChildFolder=function(parent_folder,child_folder){var child_path,parent_path;return parent_path=this.getEntityPath(parent_folder)||"",child_path=this.getEntityPath(child_folder)||"",child_path.slice(0,parent_path.length)===parent_path},FileTreeManager.prototype._deleteEntityFromScope=function(entity,options){var index,parent_folder;return null==options&&(options={moveToDeleted:!0}),null!=entity?(parent_folder=null,this.forEachEntity(function(possible_entity,folder){return possible_entity===entity?parent_folder=folder:void 0}),null!=parent_folder&&(index=parent_folder.children.indexOf(entity),index>-1&&parent_folder.children.splice(index,1)),"doc"===entity.type&&options.moveToDeleted?(entity.deleted=!0,this.$scope.deletedDocs.push(entity)):void 0):void 0},FileTreeManager.prototype._moveEntityInScope=function(entity,parent_folder){return indexOf.call(parent_folder.children,entity)>=0?void 0:(this._deleteEntityFromScope(entity,{moveToDeleted:!1}),parent_folder.children.push(entity))},FileTreeManager}()})}.call(this),function(){define("ide/connection/ConnectionManager",[],function(){var ConnectionManager,ONEHOUR;return ONEHOUR=36e5,ConnectionManager=function(){function ConnectionManager(ide,$scope){return this.ide=ide,this.$scope=$scope,"undefined"==typeof io||null===io?(console.error("Socket.io javascript not loaded. Please check that the real-time service is running and accessible."),this.ide.socket={on:function(){}},void this.$scope.$apply(function(_this){return function(){return _this.$scope.state.error="Could not connect to websocket server :("}}(this))):(setInterval(function(_this){return function(){return _this.disconnectIfInactive()}}(this),ONEHOUR),window.addEventListener("online",function(_this){return function(){return sl_console.log("[online] browser notified online"),_this.connected?void 0:_this.tryReconnectWithRateLimit({force:!0})}}(this)),this.userIsLeavingPage=!1,window.addEventListener("beforeunload",function(_this){return function(){_this.userIsLeavingPage=!0}}(this)),this.connected=!1,this.userIsInactive=!1,this.gracefullyReconnecting=!1,this.$scope.connection={reconnecting:!1,forced_disconnect:!1,inactive_disconnect:!1},this.$scope.tryReconnectNow=function(_this){return function(){return _this.tryReconnectWithRateLimit({force:!0})}}(this),this.$scope.$on("cursor:editor:update",function(_this){return function(){return _this.lastUserAction=new Date,_this.connected?void 0:_this.tryReconnectWithRateLimit()}}(this)),document.querySelector("body").addEventListener("click",function(_this){return function(e){return _this.connected||"try-reconnect-now-button"===e.target.id?void 0:_this.tryReconnectWithRateLimit()}}(this)),this.ide.socket=io.connect(null,{reconnect:!1,"connect timeout":3e4,"force new connection":!0}),this.ide.socket.on("connect",function(_this){return function(){return sl_console.log("[socket.io connect] Connected")}}(this)),this.ide.socket.on("connectionAccepted",function(_this){return function(message){return sl_console.log("[socket.io connectionAccepted] allowed to connect"),_this.connected=!0,_this.gracefullyReconnecting=!1,_this.ide.pushEvent("connected"),_this.$scope.$apply(function(){return _this.$scope.connection.reconnecting=!1,_this.$scope.connection.inactive_disconnect=!1,_this.$scope.state.loading?_this.$scope.state.load_progress=70:void 0}),setTimeout(function(){return _this.joinProject()},100)}}(this)),this.ide.socket.on("connectionRejected",function(_this){return function(err){return sl_console.log("[socket.io connectionRejected] session not valid or other connection error"),_this.reportConnectionError(err)}}(this)),this.ide.socket.on("connect_failed",function(_this){return function(){return _this.connected=!1,_this.$scope.$apply(function(){return _this.$scope.state.error="Unable to connect, please view the <u><a href='/learn/Kb/Connection_problems'>connection problems guide</a></u> to fix the issue."})}}(this)),this.ide.socket.on("disconnect",function(_this){return function(){return sl_console.log("[socket.io disconnect] Disconnected"),_this.connected=!1,_this.ide.pushEvent("disconnected"),_this.$scope.$apply(function(){return _this.$scope.connection.reconnecting=!1}),_this.$scope.connection.forced_disconnect||_this.userIsInactive||_this.gracefullyReconnecting?void 0:_this.startAutoReconnectCountdown()}}(this)),this.ide.socket.on("forceDisconnect",function(_this){return function(message){return _this.$scope.$apply(function(){return _this.$scope.permissions.write=!1,_this.$scope.connection.forced_disconnect=!0}),_this.ide.socket.disconnect(),_this.ide.showGenericMessageModal("Please Refresh","We're performing maintenance on ShareLaTeX and you need to refresh the editor.\nSorry for any inconvenience.\nThe editor will refresh in automatically in 10 seconds."),setTimeout(function(){return location.reload()},1e4)}}(this)),void this.ide.socket.on("reconnectGracefully",function(_this){return function(){return sl_console.log("Reconnect gracefully"),_this.reconnectGracefully()}}(this)))}return ConnectionManager.prototype.disconnectAfterMs=24*ONEHOUR,ConnectionManager.prototype.lastUserAction=new Date,ConnectionManager.prototype.reportConnectionError=function(err){return sl_console.log("[socket.io] reporting connection error"),"not authorized"===(null!=err?err.message:void 0)||"invalid session"===(null!=err?err.message:void 0)?window.location="/login?redir="+encodeURI(window.location.pathname):(this.ide.socket.disconnect(),this.ide.showGenericMessageModal("Something went wrong connecting","Something went wrong connecting to your project. Please refresh if this continues to happen."))},ConnectionManager.prototype.joinProject=function(){var data;return sl_console.log("[joinProject] joining..."),data={project_id:this.ide.project_id},window.anonymousAccessToken&&(data.anonymousAccessToken=window.anonymousAccessToken),this.ide.socket.emit("joinProject",data,function(_this){return function(err,project,permissionsLevel,protocolVersion){return null!=err||null==project?_this.reportConnectionError(err):(null!=_this.$scope.protocolVersion&&_this.$scope.protocolVersion!==protocolVersion&&location.reload(!0),_this.$scope.$apply(function(){return _this.$scope.protocolVersion=protocolVersion,_this.$scope.project=project,_this.$scope.permissionsLevel=permissionsLevel,_this.$scope.state.load_progress=100,_this.$scope.state.loading=!1,_this.$scope.$broadcast("project:joined")}))}}(this))},ConnectionManager.prototype.reconnectImmediately=function(){return this.disconnect(),this.tryReconnect()},ConnectionManager.prototype.disconnect=function(){return sl_console.log("[socket.io] disconnecting client"),this.ide.socket.disconnect()},ConnectionManager.prototype.startAutoReconnectCountdown=function(){var countdown,twoMinutes;return sl_console.log("[ConnectionManager] starting autoreconnect countdown"),twoMinutes=12e4,countdown=null!=this.lastUserAction&&new Date-this.lastUserAction>twoMinutes?60+Math.floor(120*Math.random()):3+Math.floor(7*Math.random()),this.userIsLeavingPage?void 0:(this.$scope.$apply(function(_this){return function(){return _this.$scope.connection.reconnecting=!1,_this.$scope.connection.reconnection_countdown=countdown}}(this)),setTimeout(function(_this){return function(){return _this.connected?void 0:_this.timeoutId=setTimeout(function(){return _this.decreaseCountdown()},1e3)}}(this),200))},ConnectionManager.prototype.cancelReconnect=function(){return null!=this.timeoutId?(sl_console.log("[ConnectionManager] cancelling existing reconnect timer"),clearTimeout(this.timeoutId),this.timeoutId=null):void 0},ConnectionManager.prototype.decreaseCountdown=function(){return this.timeoutId=null,null!=this.$scope.connection.reconnection_countdown?(sl_console.log("[ConnectionManager] decreasing countdown",this.$scope.connection.reconnection_countdown),this.$scope.$apply(function(_this){return function(){return _this.$scope.connection.reconnection_countdown--}}(this)),this.$scope.connection.reconnection_countdown<=0?this.$scope.$apply(function(_this){return function(){return _this.tryReconnect()}}(this)):this.timeoutId=setTimeout(function(_this){return function(){return _this.decreaseCountdown()}}(this),1e3)):void 0},ConnectionManager.prototype.tryReconnect=function(){return sl_console.log("[ConnectionManager] tryReconnect"),this.cancelReconnect(),delete this.$scope.connection.reconnection_countdown,this.connected?void 0:(this.$scope.connection.reconnecting=!0,this.ide.socket.socket.connect(),this.lastConnectionAttempt=new Date,setTimeout(function(_this){return function(){return _this.connected?void 0:_this.startAutoReconnectCountdown()}}(this),2e3))},ConnectionManager.prototype.MIN_RETRY_INTERVAL=1e3,ConnectionManager.prototype.BACKGROUND_RETRY_INTERVAL=5e3,ConnectionManager.prototype.tryReconnectWithRateLimit=function(options){var allowedInterval,clickedTryNow,reconnectingSoon,ref,ref1;if((null!=(ref=this.$scope.connection)?!ref.reconnecting:!0)&&(reconnectingSoon=null!=(null!=(ref1=this.$scope.connection)?ref1.reconnection_countdown:void 0)&&this.$scope.connection.reconnection_countdown<=5,clickedTryNow=null!=options?options.force:void 0,(!reconnectingSoon||clickedTryNow)&&(allowedInterval=clickedTryNow?this.MIN_RETRY_INTERVAL:this.BACKGROUND_RETRY_INTERVAL,!(null!=this.lastConnectionAttempt&&new Date-this.lastConnectionAttempt<allowedInterval))))return this.tryReconnect()},ConnectionManager.prototype.disconnectIfInactive=function(){return this.userIsInactive=new Date-this.lastUserAction>this.disconnectAfterMs,this.userIsInactive&&this.connected?(this.disconnect(),this.$scope.$apply(function(_this){return function(){return _this.$scope.connection.inactive_disconnect=!0}}(this))):void 0},ConnectionManager.prototype.RECONNECT_GRACEFULLY_RETRY_INTERVAL=5e3,ConnectionManager.prototype.MAX_RECONNECT_GRACEFULLY_INTERVAL=3e5,ConnectionManager.prototype.reconnectGracefully=function(){var maxIntervalReached,userIsInactive;return null==this.reconnectGracefullyStarted&&(this.reconnectGracefullyStarted=new Date),userIsInactive=new Date-this.lastUserAction>this.RECONNECT_GRACEFULLY_RETRY_INTERVAL,maxIntervalReached=new Date-this.reconnectGracefullyStarted>this.MAX_RECONNECT_GRACEFULLY_INTERVAL,userIsInactive||maxIntervalReached?(sl_console.log("[reconnectGracefully] User didn't do anything for last 5 seconds, reconnecting"),this._reconnectGracefullyNow()):(sl_console.log("[reconnectGracefully] User is working, will try again in 5 seconds"),setTimeout(function(_this){return function(){return _this.reconnectGracefully()}}(this),this.RECONNECT_GRACEFULLY_RETRY_INTERVAL))},ConnectionManager.prototype._reconnectGracefullyNow=function(){return this.gracefullyReconnecting=!0,this.reconnectGracefullyStarted=null,$.cookie("SERVERID","",{expires:-1,path:"/"}),this.reconnectImmediately()},ConnectionManager}()})}.call(this),function(){var slice=[].slice;define("utils/EventEmitter",[],function(){var EventEmitter;return EventEmitter=function(){function EventEmitter(){}return EventEmitter.prototype.on=function(event,callback){var base,namespace,ref;return this.events||(this.events={}),ref=event.split("."),event=ref[0],namespace=ref[1],(base=this.events)[event]||(base[event]=[]),this.events[event].push({callback:callback,namespace:namespace})},EventEmitter.prototype.off=function(event){var callback,i,len,namespace,ref,ref1,remaining_events;if(this.events||(this.events={}),null!=event){if(ref=event.split("."),event=ref[0],namespace=ref[1],null==namespace)return delete this.events[event];for(remaining_events=[],ref1=this.events[event]||[],i=0,len=ref1.length;len>i;i++)callback=ref1[i],callback.namespace!==namespace&&remaining_events.push(callback);return this.events[event]=remaining_events}return this.events={}},EventEmitter.prototype.trigger=function(){var args,callback,event,i,len,ref,results;for(event=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],this.events||(this.events={}),ref=this.events[event]||[],results=[],i=0,len=ref.length;len>i;i++)callback=ref[i],results.push(callback.callback.apply(callback,args));return results},EventEmitter.prototype.emit=function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],this.trigger.apply(this,args)},EventEmitter}()})}.call(this),function(){function exportAce(ns){var root=global;ns&&(global[ns]||(global[ns]={}),root=global[ns]),root.define&&root.define.packaged||(define.original=root.define,root.define=define,root.define.packaged=!0),root.require&&root.require.packaged||(require.original=root.require,root.require=require,root.require.packaged=!0)}var ACE_NAMESPACE="ace",global=function(){return this}();if(global||"undefined"==typeof window||(global=window),ACE_NAMESPACE||"undefined"==typeof requirejs){var define=function(module,deps,payload){return"string"!=typeof module?void(define.original?define.original.apply(this,arguments):(console.error("dropping module because define wasn't a string."),console.trace())):(2==arguments.length&&(payload=deps),void(define.modules[module]||(define.payloads[module]=payload,define.modules[module]=null)))};define.modules={},define.payloads={};var _require=function(parentId,module,callback){if("string"==typeof module){var payload=lookup(parentId,module);if(void 0!=payload)return callback&&callback(),payload}else if("[object Array]"===Object.prototype.toString.call(module)){for(var params=[],i=0,l=module.length;l>i;++i){var dep=lookup(parentId,module[i]);if(void 0==dep&&require.original)return;params.push(dep)}return callback&&callback.apply(null,params)||!0}},require=function(module,callback){var packagedModule=_require("",module,callback);return void 0==packagedModule&&require.original?require.original.apply(this,arguments):packagedModule},normalizeModule=function(parentId,moduleName){if(-1!==moduleName.indexOf("!")){var chunks=moduleName.split("!");return normalizeModule(parentId,chunks[0])+"!"+normalizeModule(parentId,chunks[1])}if("."==moduleName.charAt(0)){var base=parentId.split("/").slice(0,-1).join("/");for(moduleName=base+"/"+moduleName;-1!==moduleName.indexOf(".")&&previous!=moduleName;){var previous=moduleName;moduleName=moduleName.replace(/\/\.\//,"/").replace(/[^\/]+\/\.\.\//,"")}}return moduleName},lookup=function(parentId,moduleName){moduleName=normalizeModule(parentId,moduleName);var module=define.modules[moduleName];if(!module){if(module=define.payloads[moduleName],"function"==typeof module){var exports={},mod={id:moduleName,uri:"",exports:exports,packaged:!0},req=function(module,callback){return _require(moduleName,module,callback)},returnValue=module(req,exports,mod);exports=returnValue||mod.exports,define.modules[moduleName]=exports,delete define.payloads[moduleName]}module=define.modules[moduleName]=exports||module}return module};exportAce(ACE_NAMESPACE)}}(),ace.define("ace/lib/regexp",["require","exports","module"],function(require,exports,module){"use strict";function getNativeFlags(regex){return(regex.global?"g":"")+(regex.ignoreCase?"i":"")+(regex.multiline?"m":"")+(regex.extended?"x":"")+(regex.sticky?"y":"")}function indexOf(array,item,from){if(Array.prototype.indexOf)return array.indexOf(item,from);for(var i=from||0;i<array.length;i++)if(array[i]===item)return i;return-1}var real={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},compliantExecNpcg=void 0===real.exec.call(/()??/,"")[1],compliantLastIndexIncrement=function(){var x=/^/g;return real.test.call(x,""),!x.lastIndex}();compliantLastIndexIncrement&&compliantExecNpcg||(RegExp.prototype.exec=function(str){var name,r2,match=real.exec.apply(this,arguments);if("string"==typeof str&&match){if(!compliantExecNpcg&&match.length>1&&indexOf(match,"")>-1&&(r2=RegExp(this.source,real.replace.call(getNativeFlags(this),"g","")),real.replace.call(str.slice(match.index),r2,function(){for(var i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(match[i]=void 0)})),this._xregexp&&this._xregexp.captureNames)for(var i=1;i<match.length;i++)name=this._xregexp.captureNames[i-1],name&&(match[name]=match[i]);!compliantLastIndexIncrement&&this.global&&!match[0].length&&this.lastIndex>match.index&&this.lastIndex--}return match},compliantLastIndexIncrement||(RegExp.prototype.test=function(str){var match=real.exec.call(this,str);return match&&this.global&&!match[0].length&&this.lastIndex>match.index&&this.lastIndex--,!!match}))}),ace.define("ace/lib/es5-shim",["require","exports","module"],function(require,exports,module){function Empty(){}function doesDefinePropertyWork(object){try{return Object.defineProperty(object,"sentinel",{}),"sentinel"in object}catch(exception){}}function toInteger(n){return n=+n,n!==n?n=0:0!==n&&n!==1/0&&n!==-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n))),n}Function.prototype.bind||(Function.prototype.bind=function(that){var target=this;if("function"!=typeof target)throw new TypeError("Function.prototype.bind called on incompatible "+target);var args=slice.call(arguments,1),bound=function(){if(this instanceof bound){var result=target.apply(this,args.concat(slice.call(arguments)));return Object(result)===result?result:this}return target.apply(that,args.concat(slice.call(arguments)))};return target.prototype&&(Empty.prototype=target.prototype,bound.prototype=new Empty,Empty.prototype=null),bound});var defineGetter,defineSetter,lookupGetter,lookupSetter,supportsAccessors,call=Function.prototype.call,prototypeOfArray=Array.prototype,prototypeOfObject=Object.prototype,slice=prototypeOfArray.slice,_toString=call.bind(prototypeOfObject.toString),owns=call.bind(prototypeOfObject.hasOwnProperty);if((supportsAccessors=owns(prototypeOfObject,"__defineGetter__"))&&(defineGetter=call.bind(prototypeOfObject.__defineGetter__),defineSetter=call.bind(prototypeOfObject.__defineSetter__),lookupGetter=call.bind(prototypeOfObject.__lookupGetter__),lookupSetter=call.bind(prototypeOfObject.__lookupSetter__)),2!=[1,2].splice(0).length)if(function(){function makeArray(l){var a=new Array(l+2);return a[0]=a[1]=0,a}var lengthBefore,array=[];return array.splice.apply(array,makeArray(20)),array.splice.apply(array,makeArray(26)),lengthBefore=array.length,array.splice(5,0,"XXX"),lengthBefore+1==array.length,lengthBefore+1==array.length?!0:void 0}()){var array_splice=Array.prototype.splice;Array.prototype.splice=function(start,deleteCount){return arguments.length?array_splice.apply(this,[void 0===start?0:start,void 0===deleteCount?this.length-start:deleteCount].concat(slice.call(arguments,2))):[]}}else Array.prototype.splice=function(pos,removeCount){var length=this.length;pos>0?pos>length&&(pos=length):void 0==pos?pos=0:0>pos&&(pos=Math.max(length+pos,0)),length>pos+removeCount||(removeCount=length-pos);var removed=this.slice(pos,pos+removeCount),insert=slice.call(arguments,2),add=insert.length;if(pos===length)add&&this.push.apply(this,insert);else{var remove=Math.min(removeCount,length-pos),tailOldPos=pos+remove,tailNewPos=tailOldPos+add-remove,tailCount=length-tailOldPos,lengthAfterRemove=length-remove;if(tailOldPos>tailNewPos)for(var i=0;tailCount>i;++i)this[tailNewPos+i]=this[tailOldPos+i];else if(tailNewPos>tailOldPos)for(i=tailCount;i--;)this[tailNewPos+i]=this[tailOldPos+i];if(add&&pos===lengthAfterRemove)this.length=lengthAfterRemove,this.push.apply(this,insert);else for(this.length=lengthAfterRemove+add,i=0;add>i;++i)this[pos+i]=insert[i]}return removed};Array.isArray||(Array.isArray=function(obj){return"[object Array]"==_toString(obj)});var boxedString=Object("a"),splitString="a"!=boxedString[0]||!(0 in boxedString);if(Array.prototype.forEach||(Array.prototype.forEach=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,thisp=arguments[1],i=-1,length=self.length>>>0;if("[object Function]"!=_toString(fun))throw new TypeError;for(;++i<length;)i in self&&fun.call(thisp,self[i],i,object)}),Array.prototype.map||(Array.prototype.map=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,result=Array(length),thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)i in self&&(result[i]=fun.call(thisp,self[i],i,object));return result}),Array.prototype.filter||(Array.prototype.filter=function(fun){var value,object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,result=[],thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)i in self&&(value=self[i],fun.call(thisp,value,i,object)&&result.push(value));return result}),Array.prototype.every||(Array.prototype.every=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)if(i in self&&!fun.call(thisp,self[i],i,object))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)if(i in self&&fun.call(thisp,self[i],i,object))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0;if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");if(!length&&1==arguments.length)throw new TypeError("reduce of empty array with no initial value");var result,i=0;if(arguments.length>=2)result=arguments[1];else for(;;){if(i in self){result=self[i++];break}if(++i>=length)throw new TypeError("reduce of empty array with no initial value")}for(;length>i;i++)i in self&&(result=fun.call(void 0,result,self[i],i,object));return result}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0;if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");if(!length&&1==arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var result,i=length-1;if(arguments.length>=2)result=arguments[1];else for(;;){if(i in self){result=self[i--];break}if(--i<0)throw new TypeError("reduceRight of empty array with no initial value")}do i in this&&(result=fun.call(void 0,result,self[i],i,object));while(i--);return result}),Array.prototype.indexOf&&-1==[0,1].indexOf(1,2)||(Array.prototype.indexOf=function(sought){var self=splitString&&"[object String]"==_toString(this)?this.split(""):toObject(this),length=self.length>>>0;if(!length)return-1;var i=0;for(arguments.length>1&&(i=toInteger(arguments[1])),i=i>=0?i:Math.max(0,length+i);length>i;i++)if(i in self&&self[i]===sought)return i;return-1}),Array.prototype.lastIndexOf&&-1==[0,1].lastIndexOf(0,-3)||(Array.prototype.lastIndexOf=function(sought){var self=splitString&&"[object String]"==_toString(this)?this.split(""):toObject(this),length=self.length>>>0;if(!length)return-1;var i=length-1;for(arguments.length>1&&(i=Math.min(i,toInteger(arguments[1]))),i=i>=0?i:length-Math.abs(i);i>=0;i--)if(i in self&&sought===self[i])return i;return-1}),Object.getPrototypeOf||(Object.getPrototypeOf=function(object){return object.__proto__||(object.constructor?object.constructor.prototype:prototypeOfObject)}),!Object.getOwnPropertyDescriptor){var ERR_NON_OBJECT="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function(object,property){if("object"!=typeof object&&"function"!=typeof object||null===object)throw new TypeError(ERR_NON_OBJECT+object);if(owns(object,property)){var descriptor,getter,setter;if(descriptor={enumerable:!0,configurable:!0},supportsAccessors){var prototype=object.__proto__;object.__proto__=prototypeOfObject;var getter=lookupGetter(object,property),setter=lookupSetter(object,property);if(object.__proto__=prototype,getter||setter)return getter&&(descriptor.get=getter),setter&&(descriptor.set=setter),descriptor}return descriptor.value=object[property],descriptor}}}if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(object){return Object.keys(object)}),!Object.create){var createEmpty;createEmpty=null===Object.prototype.__proto__?function(){return{__proto__:null}}:function(){var empty={};for(var i in empty)empty[i]=null;return empty.constructor=empty.hasOwnProperty=empty.propertyIsEnumerable=empty.isPrototypeOf=empty.toLocaleString=empty.toString=empty.valueOf=empty.__proto__=null,empty},Object.create=function(prototype,properties){var object;if(null===prototype)object=createEmpty();else{if("object"!=typeof prototype)throw new TypeError("typeof prototype["+typeof prototype+"] != 'object'");var Type=function(){};Type.prototype=prototype,object=new Type,object.__proto__=prototype}return void 0!==properties&&Object.defineProperties(object,properties),object}}if(Object.defineProperty){var definePropertyWorksOnObject=doesDefinePropertyWork({}),definePropertyWorksOnDom="undefined"==typeof document||doesDefinePropertyWork(document.createElement("div"));if(!definePropertyWorksOnObject||!definePropertyWorksOnDom)var definePropertyFallback=Object.defineProperty}if(!Object.defineProperty||definePropertyFallback){var ERR_NON_OBJECT_DESCRIPTOR="Property description must be an object: ",ERR_NON_OBJECT_TARGET="Object.defineProperty called on non-object: ",ERR_ACCESSORS_NOT_SUPPORTED="getters & setters can not be defined on this javascript engine";
Object.defineProperty=function(object,property,descriptor){if("object"!=typeof object&&"function"!=typeof object||null===object)throw new TypeError(ERR_NON_OBJECT_TARGET+object);if("object"!=typeof descriptor&&"function"!=typeof descriptor||null===descriptor)throw new TypeError(ERR_NON_OBJECT_DESCRIPTOR+descriptor);if(definePropertyFallback)try{return definePropertyFallback.call(Object,object,property,descriptor)}catch(exception){}if(owns(descriptor,"value"))if(supportsAccessors&&(lookupGetter(object,property)||lookupSetter(object,property))){var prototype=object.__proto__;object.__proto__=prototypeOfObject,delete object[property],object[property]=descriptor.value,object.__proto__=prototype}else object[property]=descriptor.value;else{if(!supportsAccessors)throw new TypeError(ERR_ACCESSORS_NOT_SUPPORTED);owns(descriptor,"get")&&defineGetter(object,property,descriptor.get),owns(descriptor,"set")&&defineSetter(object,property,descriptor.set)}return object}}Object.defineProperties||(Object.defineProperties=function(object,properties){for(var property in properties)owns(properties,property)&&Object.defineProperty(object,property,properties[property]);return object}),Object.seal||(Object.seal=function(object){return object}),Object.freeze||(Object.freeze=function(object){return object});try{Object.freeze(function(){})}catch(exception){Object.freeze=function(freezeObject){return function(object){return"function"==typeof object?object:freezeObject(object)}}(Object.freeze)}if(Object.preventExtensions||(Object.preventExtensions=function(object){return object}),Object.isSealed||(Object.isSealed=function(object){return!1}),Object.isFrozen||(Object.isFrozen=function(object){return!1}),Object.isExtensible||(Object.isExtensible=function(object){if(Object(object)===object)throw new TypeError;for(var name="";owns(object,name);)name+="?";object[name]=!0;var returnValue=owns(object,name);return delete object[name],returnValue}),!Object.keys){var hasDontEnumBug=!0,dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;for(var key in{toString:null})hasDontEnumBug=!1;Object.keys=function keys(object){if("object"!=typeof object&&"function"!=typeof object||null===object)throw new TypeError("Object.keys called on a non-object");var keys=[];for(var name in object)owns(object,name)&&keys.push(name);if(hasDontEnumBug)for(var i=0,ii=dontEnumsLength;ii>i;i++){var dontEnum=dontEnums[i];owns(object,dontEnum)&&keys.push(dontEnum)}return keys}}Date.now||(Date.now=function(){return(new Date).getTime()});var ws="	\n\x0B\f\r   ᠎             　\u2028\u2029\ufeff";if(!String.prototype.trim||ws.trim()){ws="["+ws+"]";var trimBeginRegexp=new RegExp("^"+ws+ws+"*"),trimEndRegexp=new RegExp(ws+ws+"*$");String.prototype.trim=function(){return String(this).replace(trimBeginRegexp,"").replace(trimEndRegexp,"")}}var toObject=function(o){if(null==o)throw new TypeError("can't convert "+o+" to object");return Object(o)}}),ace.define("ace/lib/fixoldbrowsers",["require","exports","module","ace/lib/regexp","ace/lib/es5-shim"],function(require,exports,module){"use strict";require("./regexp"),require("./es5-shim")}),ace.define("ace/lib/dom",["require","exports","module"],function(require,exports,module){"use strict";var XHTML_NS="http://www.w3.org/1999/xhtml";return exports.getDocumentHead=function(doc){return doc||(doc=document),doc.head||doc.getElementsByTagName("head")[0]||doc.documentElement},exports.createElement=function(tag,ns){return document.createElementNS?document.createElementNS(ns||XHTML_NS,tag):document.createElement(tag)},exports.hasCssClass=function(el,name){var classes=(el.className+"").split(/\s+/g);return-1!==classes.indexOf(name)},exports.addCssClass=function(el,name){exports.hasCssClass(el,name)||(el.className+=" "+name)},exports.removeCssClass=function(el,name){for(var classes=el.className.split(/\s+/g);;){var index=classes.indexOf(name);if(-1==index)break;classes.splice(index,1)}el.className=classes.join(" ")},exports.toggleCssClass=function(el,name){for(var classes=el.className.split(/\s+/g),add=!0;;){var index=classes.indexOf(name);if(-1==index)break;add=!1,classes.splice(index,1)}return add&&classes.push(name),el.className=classes.join(" "),add},exports.setCssClass=function(node,className,include){include?exports.addCssClass(node,className):exports.removeCssClass(node,className)},exports.hasCssString=function(id,doc){var sheets,index=0;if(doc=doc||document,doc.createStyleSheet&&(sheets=doc.styleSheets)){for(;index<sheets.length;)if(sheets[index++].owningElement.id===id)return!0}else if(sheets=doc.getElementsByTagName("style"))for(;index<sheets.length;)if(sheets[index++].id===id)return!0;return!1},exports.importCssString=function(cssText,id,doc){if(doc=doc||document,id&&exports.hasCssString(id,doc))return null;var style;id&&(cssText+="\n/*# sourceURL=ace/css/"+id+" */"),doc.createStyleSheet?(style=doc.createStyleSheet(),style.cssText=cssText,id&&(style.owningElement.id=id)):(style=exports.createElement("style"),style.appendChild(doc.createTextNode(cssText)),id&&(style.id=id),exports.getDocumentHead(doc).appendChild(style))},exports.importCssStylsheet=function(uri,doc){if(doc.createStyleSheet)doc.createStyleSheet(uri);else{var link=exports.createElement("link");link.rel="stylesheet",link.href=uri,exports.getDocumentHead(doc).appendChild(link)}},exports.getInnerWidth=function(element){return parseInt(exports.computedStyle(element,"paddingLeft"),10)+parseInt(exports.computedStyle(element,"paddingRight"),10)+element.clientWidth},exports.getInnerHeight=function(element){return parseInt(exports.computedStyle(element,"paddingTop"),10)+parseInt(exports.computedStyle(element,"paddingBottom"),10)+element.clientHeight},exports.scrollbarWidth=function(document){var inner=exports.createElement("ace_inner");inner.style.width="100%",inner.style.minWidth="0px",inner.style.height="200px",inner.style.display="block";var outer=exports.createElement("ace_outer"),style=outer.style;style.position="absolute",style.left="-10000px",style.overflow="hidden",style.width="200px",style.minWidth="0px",style.height="150px",style.display="block",outer.appendChild(inner);var body=document.documentElement;body.appendChild(outer);var noScrollbar=inner.offsetWidth;style.overflow="scroll";var withScrollbar=inner.offsetWidth;return noScrollbar==withScrollbar&&(withScrollbar=outer.clientWidth),body.removeChild(outer),noScrollbar-withScrollbar},"undefined"==typeof document?void(exports.importCssString=function(){}):(void 0!==window.pageYOffset?(exports.getPageScrollTop=function(){return window.pageYOffset},exports.getPageScrollLeft=function(){return window.pageXOffset}):(exports.getPageScrollTop=function(){return document.body.scrollTop},exports.getPageScrollLeft=function(){return document.body.scrollLeft}),window.getComputedStyle?exports.computedStyle=function(element,style){return style?(window.getComputedStyle(element,"")||{})[style]||"":window.getComputedStyle(element,"")||{}}:exports.computedStyle=function(element,style){return style?element.currentStyle[style]:element.currentStyle},exports.setInnerHtml=function(el,innerHtml){var element=el.cloneNode(!1);return element.innerHTML=innerHtml,el.parentNode.replaceChild(element,el),element},"textContent"in document.documentElement?(exports.setInnerText=function(el,innerText){el.textContent=innerText},exports.getInnerText=function(el){return el.textContent}):(exports.setInnerText=function(el,innerText){el.innerText=innerText},exports.getInnerText=function(el){return el.innerText}),void(exports.getParentWindow=function(document){return document.defaultView||document.parentWindow}))}),ace.define("ace/lib/oop",["require","exports","module"],function(require,exports,module){"use strict";exports.inherits=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})},exports.mixin=function(obj,mixin){for(var key in mixin)obj[key]=mixin[key];return obj},exports.implement=function(proto,mixin){exports.mixin(proto,mixin)}}),ace.define("ace/lib/keys",["require","exports","module","ace/lib/fixoldbrowsers","ace/lib/oop"],function(require,exports,module){"use strict";require("./fixoldbrowsers");var oop=require("./oop"),Keys=function(){var name,i,ret={MODIFIER_KEYS:{16:"Shift",17:"Ctrl",18:"Alt",224:"Meta"},KEY_MODS:{ctrl:1,alt:2,option:2,shift:4,"super":8,meta:8,command:8,cmd:8},FUNCTION_KEYS:{8:"Backspace",9:"Tab",13:"Return",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock"},PRINTABLE_KEYS:{32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*"}};for(i in ret.FUNCTION_KEYS)name=ret.FUNCTION_KEYS[i].toLowerCase(),ret[name]=parseInt(i,10);for(i in ret.PRINTABLE_KEYS)name=ret.PRINTABLE_KEYS[i].toLowerCase(),ret[name]=parseInt(i,10);return oop.mixin(ret,ret.MODIFIER_KEYS),oop.mixin(ret,ret.PRINTABLE_KEYS),oop.mixin(ret,ret.FUNCTION_KEYS),ret.enter=ret["return"],ret.escape=ret.esc,ret.del=ret["delete"],ret[173]="-",function(){for(var mods=["cmd","ctrl","alt","shift"],i=Math.pow(2,mods.length);i--;)ret.KEY_MODS[i]=mods.filter(function(x){return i&ret.KEY_MODS[x]}).join("-")+"-"}(),ret.KEY_MODS[0]="",ret.KEY_MODS[-1]="input-",ret}();oop.mixin(exports,Keys),exports.keyCodeToString=function(keyCode){var keyString=Keys[keyCode];return"string"!=typeof keyString&&(keyString=String.fromCharCode(keyCode)),keyString.toLowerCase()}}),ace.define("ace/lib/useragent",["require","exports","module"],function(require,exports,module){"use strict";if(exports.OS={LINUX:"LINUX",MAC:"MAC",WINDOWS:"WINDOWS"},exports.getOS=function(){return exports.isMac?exports.OS.MAC:exports.isLinux?exports.OS.LINUX:exports.OS.WINDOWS},"object"==typeof navigator){var os=(navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase(),ua=navigator.userAgent;exports.isWin="win"==os,exports.isMac="mac"==os,exports.isLinux="linux"==os,exports.isIE="Microsoft Internet Explorer"==navigator.appName||navigator.appName.indexOf("MSAppHost")>=0?parseFloat((ua.match(/(?:MSIE |Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]):parseFloat((ua.match(/(?:Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]),exports.isOldIE=exports.isIE&&exports.isIE<9,exports.isGecko=exports.isMozilla=(window.Controllers||window.controllers)&&"Gecko"===window.navigator.product,exports.isOldGecko=exports.isGecko&&parseInt((ua.match(/rv:(\d+)/)||[])[1],10)<4,exports.isOpera=window.opera&&"[object Opera]"==Object.prototype.toString.call(window.opera),exports.isWebKit=parseFloat(ua.split("WebKit/")[1])||void 0,exports.isChrome=parseFloat(ua.split(" Chrome/")[1])||void 0,exports.isAIR=ua.indexOf("AdobeAIR")>=0,exports.isIPad=ua.indexOf("iPad")>=0,exports.isTouchPad=ua.indexOf("TouchPad")>=0,exports.isChromeOS=ua.indexOf(" CrOS ")>=0}}),ace.define("ace/lib/event",["require","exports","module","ace/lib/keys","ace/lib/useragent"],function(require,exports,module){"use strict";function normalizeCommandKeys(callback,e,keyCode){var hashId=getModifierHash(e);if(!useragent.isMac&&pressedKeys){if(e.getModifierState&&(e.getModifierState("OS")||e.getModifierState("Win"))&&(hashId|=8),pressedKeys.altGr){if(3==(3&hashId))return;pressedKeys.altGr=0}if(18===keyCode||17===keyCode){var location="location"in e?e.location:e.keyLocation;if(17===keyCode&&1===location)1==pressedKeys[keyCode]&&(ts=e.timeStamp);else if(18===keyCode&&3===hashId&&2===location){var dt=e.timeStamp-ts;50>dt&&(pressedKeys.altGr=!0)}}}if(keyCode in keys.MODIFIER_KEYS&&(keyCode=-1),8&hashId&&keyCode>=91&&93>=keyCode&&(keyCode=-1),!hashId&&13===keyCode){var location="location"in e?e.location:e.keyLocation;if(3===location&&(callback(e,hashId,-keyCode),e.defaultPrevented))return}if(useragent.isChromeOS&&8&hashId){if(callback(e,hashId,keyCode),e.defaultPrevented)return;hashId&=-9}return hashId||keyCode in keys.FUNCTION_KEYS||keyCode in keys.PRINTABLE_KEYS?callback(e,hashId,keyCode):!1}function resetPressedKeys(){pressedKeys=Object.create(null)}var keys=require("./keys"),useragent=require("./useragent"),pressedKeys=null,ts=0;exports.addListener=function(elem,type,callback){if(elem.addEventListener)return elem.addEventListener(type,callback,!1);if(elem.attachEvent){var wrapper=function(){callback.call(elem,window.event)};callback._wrapper=wrapper,elem.attachEvent("on"+type,wrapper)}},exports.removeListener=function(elem,type,callback){return elem.removeEventListener?elem.removeEventListener(type,callback,!1):void(elem.detachEvent&&elem.detachEvent("on"+type,callback._wrapper||callback))},exports.stopEvent=function(e){return exports.stopPropagation(e),exports.preventDefault(e),!1},exports.stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},exports.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},exports.getButton=function(e){return"dblclick"==e.type?0:"contextmenu"==e.type||useragent.isMac&&e.ctrlKey&&!e.altKey&&!e.shiftKey?2:e.preventDefault?e.button:{1:0,2:2,4:1}[e.button]},exports.capture=function(el,eventHandler,releaseCaptureHandler){function onMouseUp(e){eventHandler&&eventHandler(e),releaseCaptureHandler&&releaseCaptureHandler(e),exports.removeListener(document,"mousemove",eventHandler,!0),exports.removeListener(document,"mouseup",onMouseUp,!0),exports.removeListener(document,"dragstart",onMouseUp,!0)}return exports.addListener(document,"mousemove",eventHandler,!0),exports.addListener(document,"mouseup",onMouseUp,!0),exports.addListener(document,"dragstart",onMouseUp,!0),onMouseUp},exports.addTouchMoveListener=function(el,callback){if("ontouchmove"in el){var startx,starty;exports.addListener(el,"touchstart",function(e){var touchObj=e.changedTouches[0];startx=touchObj.clientX,starty=touchObj.clientY}),exports.addListener(el,"touchmove",function(e){var factor=1,touchObj=e.changedTouches[0];e.wheelX=-(touchObj.clientX-startx)/factor,e.wheelY=-(touchObj.clientY-starty)/factor,startx=touchObj.clientX,starty=touchObj.clientY,callback(e)})}},exports.addMouseWheelListener=function(el,callback){"onmousewheel"in el?exports.addListener(el,"mousewheel",function(e){var factor=8;void 0!==e.wheelDeltaX?(e.wheelX=-e.wheelDeltaX/factor,e.wheelY=-e.wheelDeltaY/factor):(e.wheelX=0,e.wheelY=-e.wheelDelta/factor),callback(e)}):"onwheel"in el?exports.addListener(el,"wheel",function(e){var factor=.35;switch(e.deltaMode){case e.DOM_DELTA_PIXEL:e.wheelX=e.deltaX*factor||0,e.wheelY=e.deltaY*factor||0;break;case e.DOM_DELTA_LINE:case e.DOM_DELTA_PAGE:e.wheelX=5*(e.deltaX||0),e.wheelY=5*(e.deltaY||0)}callback(e)}):exports.addListener(el,"DOMMouseScroll",function(e){e.axis&&e.axis==e.HORIZONTAL_AXIS?(e.wheelX=5*(e.detail||0),e.wheelY=0):(e.wheelX=0,e.wheelY=5*(e.detail||0)),callback(e)})},exports.addMultiMouseDownListener=function(elements,timeouts,eventHandler,callbackName){function onMousedown(e){if(0!==exports.getButton(e)?clicks=0:e.detail>1?(clicks++,clicks>4&&(clicks=1)):clicks=1,useragent.isIE){var isNewClick=Math.abs(e.clientX-startX)>5||Math.abs(e.clientY-startY)>5;(!timer||isNewClick)&&(clicks=1),timer&&clearTimeout(timer),timer=setTimeout(function(){timer=null},timeouts[clicks-1]||600),1==clicks&&(startX=e.clientX,startY=e.clientY)}if(e._clicks=clicks,eventHandler[callbackName]("mousedown",e),clicks>4)clicks=0;else if(clicks>1)return eventHandler[callbackName](eventNames[clicks],e)}function onDblclick(e){clicks=2,timer&&clearTimeout(timer),timer=setTimeout(function(){timer=null},timeouts[clicks-1]||600),eventHandler[callbackName]("mousedown",e),eventHandler[callbackName](eventNames[clicks],e)}var startX,startY,timer,clicks=0,eventNames={2:"dblclick",3:"tripleclick",4:"quadclick"};Array.isArray(elements)||(elements=[elements]),elements.forEach(function(el){exports.addListener(el,"mousedown",onMousedown),useragent.isOldIE&&exports.addListener(el,"dblclick",onDblclick)})};var getModifierHash=!useragent.isMac||!useragent.isOpera||"KeyboardEvent"in window?function(e){return 0|(e.ctrlKey?1:0)|(e.altKey?2:0)|(e.shiftKey?4:0)|(e.metaKey?8:0)}:function(e){return 0|(e.metaKey?1:0)|(e.altKey?2:0)|(e.shiftKey?4:0)|(e.ctrlKey?8:0)};if(exports.getModifierString=function(e){return keys.KEY_MODS[getModifierHash(e)]},exports.addCommandKeyListener=function(el,callback){var addListener=exports.addListener;if(useragent.isOldGecko||useragent.isOpera&&!("KeyboardEvent"in window)){var lastKeyDownKeyCode=null;addListener(el,"keydown",function(e){lastKeyDownKeyCode=e.keyCode}),addListener(el,"keypress",function(e){return normalizeCommandKeys(callback,e,lastKeyDownKeyCode)})}else{var lastDefaultPrevented=null;addListener(el,"keydown",function(e){pressedKeys[e.keyCode]=(pressedKeys[e.keyCode]||0)+1;var result=normalizeCommandKeys(callback,e,e.keyCode);return lastDefaultPrevented=e.defaultPrevented,result}),addListener(el,"keypress",function(e){lastDefaultPrevented&&(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)&&(exports.stopEvent(e),lastDefaultPrevented=null)}),addListener(el,"keyup",function(e){pressedKeys[e.keyCode]=null}),pressedKeys||(resetPressedKeys(),addListener(window,"focus",resetPressedKeys))}},"object"==typeof window&&window.postMessage&&!useragent.isOldIE){var postMessageId=1;exports.nextTick=function(callback,win){win=win||window;var messageName="zero-timeout-message-"+postMessageId;exports.addListener(win,"message",function listener(e){e.data==messageName&&(exports.stopPropagation(e),exports.removeListener(win,"message",listener),callback())}),win.postMessage(messageName,"*")}}exports.nextFrame="object"==typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame),exports.nextFrame?exports.nextFrame=exports.nextFrame.bind(window):exports.nextFrame=function(callback){setTimeout(callback,17)}}),ace.define("ace/lib/lang",["require","exports","module"],function(require,exports,module){"use strict";exports.last=function(a){return a[a.length-1]},exports.stringReverse=function(string){return string.split("").reverse().join("")},exports.stringRepeat=function(string,count){for(var result="";count>0;)1&count&&(result+=string),(count>>=1)&&(string+=string);return result};var trimBeginRegexp=/^\s\s*/,trimEndRegexp=/\s\s*$/;exports.stringTrimLeft=function(string){return string.replace(trimBeginRegexp,"")},exports.stringTrimRight=function(string){return string.replace(trimEndRegexp,"")},exports.copyObject=function(obj){var copy={};for(var key in obj)copy[key]=obj[key];return copy},exports.copyArray=function(array){for(var copy=[],i=0,l=array.length;l>i;i++)array[i]&&"object"==typeof array[i]?copy[i]=this.copyObject(array[i]):copy[i]=array[i];return copy},exports.deepCopy=function deepCopy(obj){if("object"!=typeof obj||!obj)return obj;var copy;if(Array.isArray(obj)){copy=[];for(var key=0;key<obj.length;key++)copy[key]=deepCopy(obj[key]);return copy}if("[object Object]"!==Object.prototype.toString.call(obj))return obj;copy={};for(var key in obj)copy[key]=deepCopy(obj[key]);return copy},exports.arrayToMap=function(arr){for(var map={},i=0;i<arr.length;i++)map[arr[i]]=1;return map},exports.createMap=function(props){var map=Object.create(null);for(var i in props)map[i]=props[i];return map},exports.arrayRemove=function(array,value){for(var i=0;i<=array.length;i++)value===array[i]&&array.splice(i,1)},exports.escapeRegExp=function(str){return str.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")},exports.escapeHTML=function(str){return str.replace(/&/g,"&#38;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&#60;")},exports.getMatchOffsets=function(string,regExp){var matches=[];return string.replace(regExp,function(str){matches.push({offset:arguments[arguments.length-2],length:str.length})}),matches},exports.deferredCall=function(fcn){var timer=null,callback=function(){timer=null,fcn()},deferred=function(timeout){return deferred.cancel(),timer=setTimeout(callback,timeout||0),deferred};return deferred.schedule=deferred,deferred.call=function(){return this.cancel(),fcn(),deferred},deferred.cancel=function(){return clearTimeout(timer),timer=null,deferred},deferred.isPending=function(){return timer},deferred},exports.delayedCall=function(fcn,defaultTimeout){var timer=null,callback=function(){timer=null,fcn()},_self=function(timeout){null==timer&&(timer=setTimeout(callback,timeout||defaultTimeout))};return _self.delay=function(timeout){timer&&clearTimeout(timer),timer=setTimeout(callback,timeout||defaultTimeout)},_self.schedule=_self,_self.call=function(){this.cancel(),fcn()},_self.cancel=function(){timer&&clearTimeout(timer),timer=null},_self.isPending=function(){return timer},_self}}),ace.define("ace/keyboard/textinput",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/lib/dom","ace/lib/lang"],function(require,exports,module){"use strict";var event=require("../lib/event"),useragent=require("../lib/useragent"),dom=require("../lib/dom"),lang=require("../lib/lang"),BROKEN_SETDATA=useragent.isChrome<18,USE_IE_MIME_TYPE=useragent.isIE,TextInput=function(parentNode,host){function resetSelection(isEmpty){if(!inComposition){if(inComposition=!0,inputHandler)selectionStart=0,selectionEnd=isEmpty?0:text.value.length-1;else var selectionStart=isEmpty?2:1,selectionEnd=2;try{text.setSelectionRange(selectionStart,selectionEnd)}catch(e){}inComposition=!1}}function resetValue(){inComposition||(text.value=PLACEHOLDER,useragent.isWebKit&&syncValue.schedule())}function onContextMenuClose(){clearTimeout(closeTimeout),closeTimeout=setTimeout(function(){tempStyle&&(text.style.cssText=tempStyle,tempStyle=""),null==host.renderer.$keepTextAreaAtCursor&&(host.renderer.$keepTextAreaAtCursor=!0,host.renderer.$moveTextAreaToCursor())},useragent.isOldIE?200:0)}var text=dom.createElement("textarea");text.className="ace_text-input",useragent.isTouchPad&&text.setAttribute("x-palm-disable-auto-cap",!0),text.setAttribute("wrap","off"),text.setAttribute("autocorrect","off"),text.setAttribute("autocapitalize","off"),text.setAttribute("spellcheck",!1),text.style.opacity="0",useragent.isOldIE&&(text.style.top="-1000px"),parentNode.insertBefore(text,parentNode.firstChild);var PLACEHOLDER="",copied=!1,pasted=!1,inComposition=!1,tempStyle="",isSelectionEmpty=!0;try{var isFocused=document.activeElement===text}catch(e){}event.addListener(text,"blur",function(e){host.onBlur(e),isFocused=!1}),event.addListener(text,"focus",function(e){isFocused=!0,host.onFocus(e),resetSelection()}),this.focus=function(){if(tempStyle)return text.focus();var top=text.style.top;text.style.position="fixed",text.style.top="0px",text.focus(),setTimeout(function(){text.style.position="","0px"==text.style.top&&(text.style.top=top)},0)},this.blur=function(){text.blur()},this.isFocused=function(){return isFocused};var syncSelection=lang.delayedCall(function(){isFocused&&resetSelection(isSelectionEmpty)}),syncValue=lang.delayedCall(function(){inComposition||(text.value=PLACEHOLDER,isFocused&&resetSelection())});useragent.isWebKit||host.addEventListener("changeSelection",function(){host.selection.isEmpty()!=isSelectionEmpty&&(isSelectionEmpty=!isSelectionEmpty,syncSelection.schedule())}),resetValue(),isFocused&&host.onFocus();var isAllSelected=function(text){return 0===text.selectionStart&&text.selectionEnd===text.value.length};if(!text.setSelectionRange&&text.createTextRange&&(text.setSelectionRange=function(selectionStart,selectionEnd){var range=this.createTextRange();range.collapse(!0),range.moveStart("character",selectionStart),range.moveEnd("character",selectionEnd),range.select()},isAllSelected=function(text){try{var range=text.ownerDocument.selection.createRange()}catch(e){}return range&&range.parentElement()==text?range.text==text.value:!1}),useragent.isOldIE){var inPropertyChange=!1,onPropertyChange=function(e){if(!inPropertyChange){var data=text.value;if(!inComposition&&data&&data!=PLACEHOLDER){if(e&&data==PLACEHOLDER[0])return syncProperty.schedule();sendText(data),inPropertyChange=!0,resetValue(),inPropertyChange=!1}}},syncProperty=lang.delayedCall(onPropertyChange);event.addListener(text,"propertychange",onPropertyChange);var keytable={13:1,27:1};event.addListener(text,"keyup",function(e){return!inComposition||text.value&&!keytable[e.keyCode]||setTimeout(onCompositionEnd,0),(text.value.charCodeAt(0)||0)<129?syncProperty.call():void(inComposition?onCompositionUpdate():onCompositionStart())}),event.addListener(text,"keydown",function(e){syncProperty.schedule(50)})}var onSelect=function(e){copied?copied=!1:isAllSelected(text)?(host.selectAll(),resetSelection()):inputHandler&&resetSelection(host.selection.isEmpty())},inputHandler=null;this.setInputHandler=function(cb){inputHandler=cb},this.getInputHandler=function(){return inputHandler};var afterContextMenu=!1,sendText=function(data){inputHandler&&(data=inputHandler(data),inputHandler=null),pasted?(resetSelection(),data&&host.onPaste(data),pasted=!1):data==PLACEHOLDER.charAt(0)?afterContextMenu?host.execCommand("del",{source:"ace"}):host.execCommand("backspace",{source:"ace"}):(data.substring(0,2)==PLACEHOLDER?data=data.substr(2):data.charAt(0)==PLACEHOLDER.charAt(0)?data=data.substr(1):data.charAt(data.length-1)==PLACEHOLDER.charAt(0)&&(data=data.slice(0,-1)),data.charAt(data.length-1)==PLACEHOLDER.charAt(0)&&(data=data.slice(0,-1)),data&&host.onTextInput(data)),afterContextMenu&&(afterContextMenu=!1)},onInput=function(e){if(!inComposition){var data=text.value;sendText(data),resetValue()}},handleClipboardData=function(e,data,forceIEMime){var clipboardData=e.clipboardData||window.clipboardData;if(clipboardData&&!BROKEN_SETDATA){var mime=USE_IE_MIME_TYPE||forceIEMime?"Text":"text/plain";try{return data?clipboardData.setData(mime,data)!==!1:clipboardData.getData(mime)}catch(e){if(!forceIEMime)return handleClipboardData(e,data,!0)}}},doCopy=function(e,isCut){var data=host.getCopyText();return data?void(handleClipboardData(e,data)?(isCut?host.onCut():host.onCopy(),event.preventDefault(e)):(copied=!0,text.value=data,text.select(),setTimeout(function(){copied=!1,resetValue(),resetSelection(),isCut?host.onCut():host.onCopy()}))):event.preventDefault(e)},onCut=function(e){doCopy(e,!0)},onCopy=function(e){doCopy(e,!1)},onPaste=function(e){var data=handleClipboardData(e);"string"==typeof data?(data&&host.onPaste(data,e),useragent.isIE&&setTimeout(resetSelection),event.preventDefault(e)):(text.value="",pasted=!0)};event.addCommandKeyListener(text,host.onCommandKey.bind(host)),event.addListener(text,"select",onSelect),event.addListener(text,"input",onInput),event.addListener(text,"cut",onCut),event.addListener(text,"copy",onCopy),event.addListener(text,"paste",onPaste),"oncut"in text&&"oncopy"in text&&"onpaste"in text||event.addListener(parentNode,"keydown",function(e){if((!useragent.isMac||e.metaKey)&&e.ctrlKey)switch(e.keyCode){case 67:onCopy(e);break;case 86:onPaste(e);break;case 88:onCut(e)}});var onCompositionStart=function(e){inComposition||!host.onCompositionStart||host.$readOnly||(inComposition={},inComposition.canUndo=host.session.$undoManager,host.onCompositionStart(),setTimeout(onCompositionUpdate,0),host.on("mousedown",onCompositionEnd),inComposition.canUndo&&!host.selection.isEmpty()&&(host.insert(""),host.session.markUndoGroup(),host.selection.clearSelection()),host.session.markUndoGroup())},onCompositionUpdate=function(){if(inComposition&&host.onCompositionUpdate&&!host.$readOnly){var val=text.value.replace(/\x01/g,"");if(inComposition.lastValue!==val&&(host.onCompositionUpdate(val),inComposition.lastValue&&host.undo(),inComposition.canUndo&&(inComposition.lastValue=val),inComposition.lastValue)){var r=host.selection.getRange();host.insert(inComposition.lastValue),host.session.markUndoGroup(),inComposition.range=host.selection.getRange(),host.selection.setRange(r),host.selection.clearSelection()}}},onCompositionEnd=function(e){if(host.onCompositionEnd&&!host.$readOnly){var c=inComposition;inComposition=!1;var timer=setTimeout(function(){timer=null;var str=text.value.replace(/\x01/g,"");inComposition||(str==c.lastValue?resetValue():!c.lastValue&&str&&(resetValue(),sendText(str)))});inputHandler=function(str){return timer&&clearTimeout(timer),str=str.replace(/\x01/g,""),str==c.lastValue?"":(c.lastValue&&timer&&host.undo(),str)},host.onCompositionEnd(),host.removeListener("mousedown",onCompositionEnd),"compositionend"==e.type&&c.range&&host.selection.setRange(c.range);var needsOnInput=!!useragent.isChrome&&useragent.isChrome>=53||!!useragent.isWebKit&&useragent.isWebKit>=603;needsOnInput&&onInput()}},syncComposition=lang.delayedCall(onCompositionUpdate,50);event.addListener(text,"compositionstart",onCompositionStart),useragent.isGecko?event.addListener(text,"text",function(){syncComposition.schedule()}):(event.addListener(text,"keyup",function(){syncComposition.schedule()}),event.addListener(text,"keydown",function(){syncComposition.schedule()})),event.addListener(text,"compositionend",onCompositionEnd),this.getElement=function(){return text},this.setReadOnly=function(readOnly){text.readOnly=readOnly},this.onContextMenu=function(e){afterContextMenu=!0,resetSelection(host.selection.isEmpty()),host._emit("nativecontextmenu",{target:host,domEvent:e}),this.moveToMouse(e,!0)},this.moveToMouse=function(e,bringToFront){if(bringToFront||!useragent.isOldIE){tempStyle||(tempStyle=text.style.cssText),text.style.cssText=(bringToFront?"z-index:100000;":"")+"height:"+text.style.height+";"+(useragent.isIE?"opacity:0.1;":"");var rect=host.container.getBoundingClientRect(),style=dom.computedStyle(host.container),top=rect.top+(parseInt(style.borderTopWidth)||0),left=rect.left+(parseInt(rect.borderLeftWidth)||0),maxTop=rect.bottom-top-text.clientHeight-2,move=function(e){text.style.left=e.clientX-left-2+"px",text.style.top=Math.min(e.clientY-top-2,maxTop)+"px"};move(e),"mousedown"==e.type&&(host.renderer.$keepTextAreaAtCursor&&(host.renderer.$keepTextAreaAtCursor=null),clearTimeout(closeTimeout),useragent.isWin&&!useragent.isOldIE&&event.capture(host.container,move,onContextMenuClose))}},this.onContextMenuClose=onContextMenuClose;var closeTimeout,onContextMenu=function(e){host.textInput.onContextMenu(e),onContextMenuClose()};event.addListener(text,"mouseup",onContextMenu),event.addListener(text,"mousedown",function(e){e.preventDefault(),onContextMenuClose()}),event.addListener(host.renderer.scroller,"contextmenu",onContextMenu),event.addListener(text,"contextmenu",onContextMenu)};exports.TextInput=TextInput}),ace.define("ace/mouse/default_handlers",["require","exports","module","ace/lib/dom","ace/lib/event","ace/lib/useragent"],function(require,exports,module){"use strict";function DefaultHandlers(mouseHandler){mouseHandler.$clickSelection=null;var editor=mouseHandler.editor;editor.setDefaultHandler("mousedown",this.onMouseDown.bind(mouseHandler)),editor.setDefaultHandler("dblclick",this.onDoubleClick.bind(mouseHandler)),editor.setDefaultHandler("tripleclick",this.onTripleClick.bind(mouseHandler)),editor.setDefaultHandler("quadclick",this.onQuadClick.bind(mouseHandler)),editor.setDefaultHandler("mousewheel",this.onMouseWheel.bind(mouseHandler)),editor.setDefaultHandler("touchmove",this.onTouchMove.bind(mouseHandler));var exports=["select","startSelect","selectEnd","selectAllEnd","selectByWordsEnd","selectByLinesEnd","dragWait","dragWaitEnd","focusWait"];
exports.forEach(function(x){mouseHandler[x]=this[x]},this),mouseHandler.selectByLines=this.extendSelectionBy.bind(mouseHandler,"getLineRange"),mouseHandler.selectByWords=this.extendSelectionBy.bind(mouseHandler,"getWordRange")}function calcDistance(ax,ay,bx,by){return Math.sqrt(Math.pow(bx-ax,2)+Math.pow(by-ay,2))}function calcRangeOrientation(range,cursor){if(range.start.row==range.end.row)var cmp=2*cursor.column-range.start.column-range.end.column;else if(range.start.row!=range.end.row-1||range.start.column||range.end.column)var cmp=2*cursor.row-range.start.row-range.end.row;else var cmp=cursor.column-4;return 0>cmp?{cursor:range.start,anchor:range.end}:{cursor:range.end,anchor:range.start}}var DRAG_OFFSET=(require("../lib/dom"),require("../lib/event"),require("../lib/useragent"),0);(function(){this.onMouseDown=function(ev){var inSelection=ev.inSelection(),pos=ev.getDocumentPosition();this.mousedownEvent=ev;var editor=this.editor,button=ev.getButton();if(0!==button){var selectionRange=editor.getSelectionRange(),selectionEmpty=selectionRange.isEmpty();return editor.$blockScrolling++,(selectionEmpty||1==button)&&editor.selection.moveToPosition(pos),editor.$blockScrolling--,void(2==button&&editor.textInput.onContextMenu(ev.domEvent))}return this.mousedownEvent.time=Date.now(),!inSelection||editor.isFocused()||(editor.focus(),!this.$focusTimout||this.$clickSelection||editor.inMultiSelectMode)?(this.captureMouse(ev),this.startSelect(pos,ev.domEvent._clicks>1),ev.preventDefault()):(this.setState("focusWait"),void this.captureMouse(ev))},this.startSelect=function(pos,waitForClickSelection){pos=pos||this.editor.renderer.screenToTextCoordinates(this.x,this.y);var editor=this.editor;editor.$blockScrolling++,this.mousedownEvent.getShiftKey()?editor.selection.selectToPosition(pos):waitForClickSelection||editor.selection.moveToPosition(pos),waitForClickSelection||this.select(),editor.renderer.scroller.setCapture&&editor.renderer.scroller.setCapture(),editor.setStyle("ace_selecting"),this.setState("select"),editor.$blockScrolling--},this.select=function(){var anchor,editor=this.editor,cursor=editor.renderer.screenToTextCoordinates(this.x,this.y);if(editor.$blockScrolling++,this.$clickSelection){var cmp=this.$clickSelection.comparePoint(cursor);if(-1==cmp)anchor=this.$clickSelection.end;else if(1==cmp)anchor=this.$clickSelection.start;else{var orientedRange=calcRangeOrientation(this.$clickSelection,cursor);cursor=orientedRange.cursor,anchor=orientedRange.anchor}editor.selection.setSelectionAnchor(anchor.row,anchor.column)}editor.selection.selectToPosition(cursor),editor.$blockScrolling--,editor.renderer.scrollCursorIntoView()},this.extendSelectionBy=function(unitName){var anchor,editor=this.editor,cursor=editor.renderer.screenToTextCoordinates(this.x,this.y),range=editor.selection[unitName](cursor.row,cursor.column);if(editor.$blockScrolling++,this.$clickSelection){var cmpStart=this.$clickSelection.comparePoint(range.start),cmpEnd=this.$clickSelection.comparePoint(range.end);if(-1==cmpStart&&0>=cmpEnd)anchor=this.$clickSelection.end,(range.end.row!=cursor.row||range.end.column!=cursor.column)&&(cursor=range.start);else if(1==cmpEnd&&cmpStart>=0)anchor=this.$clickSelection.start,(range.start.row!=cursor.row||range.start.column!=cursor.column)&&(cursor=range.end);else if(-1==cmpStart&&1==cmpEnd)cursor=range.end,anchor=range.start;else{var orientedRange=calcRangeOrientation(this.$clickSelection,cursor);cursor=orientedRange.cursor,anchor=orientedRange.anchor}editor.selection.setSelectionAnchor(anchor.row,anchor.column)}editor.selection.selectToPosition(cursor),editor.$blockScrolling--,editor.renderer.scrollCursorIntoView()},this.selectEnd=this.selectAllEnd=this.selectByWordsEnd=this.selectByLinesEnd=function(){this.$clickSelection=null,this.editor.unsetStyle("ace_selecting"),this.editor.renderer.scroller.releaseCapture&&this.editor.renderer.scroller.releaseCapture()},this.focusWait=function(){var distance=calcDistance(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y),time=Date.now();(distance>DRAG_OFFSET||time-this.mousedownEvent.time>this.$focusTimout)&&this.startSelect(this.mousedownEvent.getDocumentPosition())},this.onDoubleClick=function(ev){var pos=ev.getDocumentPosition(),editor=this.editor,session=editor.session,range=session.getBracketRange(pos);range?(range.isEmpty()&&(range.start.column--,range.end.column++),this.setState("select")):(range=editor.selection.getWordRange(pos.row,pos.column),this.setState("selectByWords")),this.$clickSelection=range,this.select()},this.onTripleClick=function(ev){var pos=ev.getDocumentPosition(),editor=this.editor;this.setState("selectByLines");var range=editor.getSelectionRange();range.isMultiLine()&&range.contains(pos.row,pos.column)?(this.$clickSelection=editor.selection.getLineRange(range.start.row),this.$clickSelection.end=editor.selection.getLineRange(range.end.row).end):this.$clickSelection=editor.selection.getLineRange(pos.row),this.select()},this.onQuadClick=function(ev){var editor=this.editor;editor.selectAll(),this.$clickSelection=editor.getSelectionRange(),this.setState("selectAll")},this.onMouseWheel=function(ev){if(!ev.getAccelKey()){ev.getShiftKey()&&ev.wheelY&&!ev.wheelX&&(ev.wheelX=ev.wheelY,ev.wheelY=0);var t=ev.domEvent.timeStamp,dt=t-(this.$lastScrollTime||0),editor=this.editor,isScrolable=editor.renderer.isScrollableBy(ev.wheelX*ev.speed,ev.wheelY*ev.speed);return isScrolable||200>dt?(this.$lastScrollTime=t,editor.renderer.scrollBy(ev.wheelX*ev.speed,ev.wheelY*ev.speed),ev.stop()):void 0}},this.onTouchMove=function(ev){var t=ev.domEvent.timeStamp,dt=t-(this.$lastScrollTime||0),editor=this.editor,isScrolable=editor.renderer.isScrollableBy(ev.wheelX*ev.speed,ev.wheelY*ev.speed);return isScrolable||200>dt?(this.$lastScrollTime=t,editor.renderer.scrollBy(ev.wheelX*ev.speed,ev.wheelY*ev.speed),ev.stop()):void 0}}).call(DefaultHandlers.prototype),exports.DefaultHandlers=DefaultHandlers}),ace.define("ace/tooltip",["require","exports","module","ace/lib/oop","ace/lib/dom"],function(require,exports,module){"use strict";function Tooltip(parentNode){this.isOpen=!1,this.$element=null,this.$parentNode=parentNode}var dom=(require("./lib/oop"),require("./lib/dom"));(function(){this.$init=function(){return this.$element=dom.createElement("div"),this.$element.className="ace_tooltip",this.$element.style.display="none",this.$parentNode.appendChild(this.$element),this.$element},this.getElement=function(){return this.$element||this.$init()},this.setText=function(text){dom.setInnerText(this.getElement(),text)},this.setHtml=function(html){this.getElement().innerHTML=html},this.setPosition=function(x,y){this.getElement().style.left=x+"px",this.getElement().style.top=y+"px"},this.setClassName=function(className){dom.addCssClass(this.getElement(),className)},this.show=function(text,x,y){null!=text&&this.setText(text),null!=x&&null!=y&&this.setPosition(x,y),this.isOpen||(this.getElement().style.display="block",this.isOpen=!0)},this.hide=function(){this.isOpen&&(this.getElement().style.display="none",this.isOpen=!1)},this.getHeight=function(){return this.getElement().offsetHeight},this.getWidth=function(){return this.getElement().offsetWidth}}).call(Tooltip.prototype),exports.Tooltip=Tooltip}),ace.define("ace/mouse/default_gutter_handler",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/event","ace/tooltip"],function(require,exports,module){"use strict";function GutterHandler(mouseHandler){function showTooltip(){var row=mouseEvent.getDocumentPosition().row,annotation=gutter.$annotations[row];if(!annotation)return hideTooltip();var maxRow=editor.session.getLength();if(row==maxRow){var screenRow=editor.renderer.pixelToScreenCoordinates(0,mouseEvent.y).row,pos=mouseEvent.$pos;if(screenRow>editor.session.documentToScreenRow(pos.row,pos.column))return hideTooltip()}if(tooltipAnnotation!=annotation)if(tooltipAnnotation=annotation.text.join("<br/>"),tooltip.setHtml(tooltipAnnotation),tooltip.show(),editor._signal("showGutterTooltip",tooltip),editor.on("mousewheel",hideTooltip),mouseHandler.$tooltipFollowsMouse)moveTooltip(mouseEvent);else{var gutterElement=mouseEvent.domEvent.target,rect=gutterElement.getBoundingClientRect(),style=tooltip.getElement().style;style.left=rect.right+"px",style.top=rect.bottom+"px"}}function hideTooltip(){tooltipTimeout&&(tooltipTimeout=clearTimeout(tooltipTimeout)),tooltipAnnotation&&(tooltip.hide(),tooltipAnnotation=null,editor._signal("hideGutterTooltip",tooltip),editor.removeEventListener("mousewheel",hideTooltip))}function moveTooltip(e){tooltip.setPosition(e.x,e.y)}var editor=mouseHandler.editor,gutter=editor.renderer.$gutterLayer,tooltip=new GutterTooltip(editor.container);mouseHandler.editor.setDefaultHandler("guttermousedown",function(e){if(editor.isFocused()&&0==e.getButton()){var gutterRegion=gutter.getRegion(e);if("foldWidgets"!=gutterRegion){var row=e.getDocumentPosition().row,selection=editor.session.selection;if(e.getShiftKey())selection.selectTo(row,0);else{if(2==e.domEvent.detail)return editor.selectAll(),e.preventDefault();mouseHandler.$clickSelection=editor.selection.getLineRange(row)}return mouseHandler.setState("selectByLines"),mouseHandler.captureMouse(e),e.preventDefault()}}});var tooltipTimeout,mouseEvent,tooltipAnnotation;mouseHandler.editor.setDefaultHandler("guttermousemove",function(e){var target=e.domEvent.target||e.domEvent.srcElement;return dom.hasCssClass(target,"ace_fold-widget")?hideTooltip():(tooltipAnnotation&&mouseHandler.$tooltipFollowsMouse&&moveTooltip(e),mouseEvent=e,void(tooltipTimeout||(tooltipTimeout=setTimeout(function(){tooltipTimeout=null,mouseEvent&&!mouseHandler.isMousePressed?showTooltip():hideTooltip()},50))))}),event.addListener(editor.renderer.$gutter,"mouseout",function(e){mouseEvent=null,tooltipAnnotation&&!tooltipTimeout&&(tooltipTimeout=setTimeout(function(){tooltipTimeout=null,hideTooltip()},50))}),editor.on("changeSession",hideTooltip)}function GutterTooltip(parentNode){Tooltip.call(this,parentNode)}var dom=require("../lib/dom"),oop=require("../lib/oop"),event=require("../lib/event"),Tooltip=require("../tooltip").Tooltip;oop.inherits(GutterTooltip,Tooltip),function(){this.setPosition=function(x,y){var windowWidth=window.innerWidth||document.documentElement.clientWidth,windowHeight=window.innerHeight||document.documentElement.clientHeight,width=this.getWidth(),height=this.getHeight();x+=15,y+=15,x+width>windowWidth&&(x-=x+width-windowWidth),y+height>windowHeight&&(y-=20+height),Tooltip.prototype.setPosition.call(this,x,y)}}.call(GutterTooltip.prototype),exports.GutterHandler=GutterHandler}),ace.define("ace/mouse/mouse_event",["require","exports","module","ace/lib/event","ace/lib/useragent"],function(require,exports,module){"use strict";var event=require("../lib/event"),useragent=require("../lib/useragent"),MouseEvent=exports.MouseEvent=function(domEvent,editor){this.domEvent=domEvent,this.editor=editor,this.x=this.clientX=domEvent.clientX,this.y=this.clientY=domEvent.clientY,this.$pos=null,this.$inSelection=null,this.propagationStopped=!1,this.defaultPrevented=!1};(function(){this.stopPropagation=function(){event.stopPropagation(this.domEvent),this.propagationStopped=!0},this.preventDefault=function(){event.preventDefault(this.domEvent),this.defaultPrevented=!0},this.stop=function(){this.stopPropagation(),this.preventDefault()},this.getDocumentPosition=function(){return this.$pos?this.$pos:(this.$pos=this.editor.renderer.screenToTextCoordinates(this.clientX,this.clientY),this.$pos)},this.inSelection=function(){if(null!==this.$inSelection)return this.$inSelection;var editor=this.editor,selectionRange=editor.getSelectionRange();if(selectionRange.isEmpty())this.$inSelection=!1;else{var pos=this.getDocumentPosition();this.$inSelection=selectionRange.contains(pos.row,pos.column)}return this.$inSelection},this.getButton=function(){return event.getButton(this.domEvent)},this.getShiftKey=function(){return this.domEvent.shiftKey},this.getAccelKey=useragent.isMac?function(){return this.domEvent.metaKey}:function(){return this.domEvent.ctrlKey}}).call(MouseEvent.prototype)}),ace.define("ace/mouse/dragdrop_handler",["require","exports","module","ace/lib/dom","ace/lib/event","ace/lib/useragent"],function(require,exports,module){"use strict";function DragdropHandler(mouseHandler){function scrollCursorIntoView(cursor,prevCursor){var now=Date.now(),vMovement=!prevCursor||cursor.row!=prevCursor.row,hMovement=!prevCursor||cursor.column!=prevCursor.column;if(!cursorMovedTime||vMovement||hMovement)editor.$blockScrolling+=1,editor.moveCursorToPosition(cursor),editor.$blockScrolling-=1,cursorMovedTime=now,cursorPointOnCaretMoved={x:x,y:y};else{var distance=calcDistance(cursorPointOnCaretMoved.x,cursorPointOnCaretMoved.y,x,y);distance>SCROLL_CURSOR_HYSTERESIS?cursorMovedTime=null:now-cursorMovedTime>=SCROLL_CURSOR_DELAY&&(editor.renderer.scrollCursorIntoView(),cursorMovedTime=null)}}function autoScroll(cursor,prevCursor){var now=Date.now(),lineHeight=editor.renderer.layerConfig.lineHeight,characterWidth=editor.renderer.layerConfig.characterWidth,editorRect=editor.renderer.scroller.getBoundingClientRect(),offsets={x:{left:x-editorRect.left,right:editorRect.right-x},y:{top:y-editorRect.top,bottom:editorRect.bottom-y}},nearestXOffset=Math.min(offsets.x.left,offsets.x.right),nearestYOffset=Math.min(offsets.y.top,offsets.y.bottom),scrollCursor={row:cursor.row,column:cursor.column};2>=nearestXOffset/characterWidth&&(scrollCursor.column+=offsets.x.left<offsets.x.right?-3:2),1>=nearestYOffset/lineHeight&&(scrollCursor.row+=offsets.y.top<offsets.y.bottom?-1:1);var vScroll=cursor.row!=scrollCursor.row,hScroll=cursor.column!=scrollCursor.column,vMovement=!prevCursor||cursor.row!=prevCursor.row;vScroll||hScroll&&!vMovement?autoScrollStartTime?now-autoScrollStartTime>=AUTOSCROLL_DELAY&&editor.renderer.scrollCursorIntoView(scrollCursor):autoScrollStartTime=now:autoScrollStartTime=null}function onDragInterval(){var prevCursor=dragCursor;dragCursor=editor.renderer.screenToTextCoordinates(x,y),scrollCursorIntoView(dragCursor,prevCursor),autoScroll(dragCursor,prevCursor)}function addDragMarker(){range=editor.selection.toOrientedRange(),dragSelectionMarker=editor.session.addMarker(range,"ace_selection",editor.getSelectionStyle()),editor.clearSelection(),editor.isFocused()&&editor.renderer.$cursorLayer.setBlinking(!1),clearInterval(timerId),onDragInterval(),timerId=setInterval(onDragInterval,20),counter=0,event.addListener(document,"mousemove",onMouseMove)}function clearDragMarker(){clearInterval(timerId),editor.session.removeMarker(dragSelectionMarker),dragSelectionMarker=null,editor.$blockScrolling+=1,editor.selection.fromOrientedRange(range),editor.$blockScrolling-=1,editor.isFocused()&&!isInternal&&editor.renderer.$cursorLayer.setBlinking(!editor.getReadOnly()),range=null,dragCursor=null,counter=0,autoScrollStartTime=null,cursorMovedTime=null,event.removeListener(document,"mousemove",onMouseMove)}function onMouseMove(){null==onMouseMoveTimer&&(onMouseMoveTimer=setTimeout(function(){null!=onMouseMoveTimer&&dragSelectionMarker&&clearDragMarker()},20))}function canAccept(dataTransfer){var types=dataTransfer.types;return!types||Array.prototype.some.call(types,function(type){return"text/plain"==type||"Text"==type})}function getDropEffect(e){var copyAllowed=["copy","copymove","all","uninitialized"],moveAllowed=["move","copymove","linkmove","all","uninitialized"],copyModifierState=useragent.isMac?e.altKey:e.ctrlKey,effectAllowed="uninitialized";try{effectAllowed=e.dataTransfer.effectAllowed.toLowerCase()}catch(e){}var dropEffect="none";return copyModifierState&&copyAllowed.indexOf(effectAllowed)>=0?dropEffect="copy":moveAllowed.indexOf(effectAllowed)>=0?dropEffect="move":copyAllowed.indexOf(effectAllowed)>=0&&(dropEffect="copy"),dropEffect}var editor=mouseHandler.editor,blankImage=dom.createElement("img");blankImage.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",useragent.isOpera&&(blankImage.style.cssText="width:1px;height:1px;position:fixed;top:0;left:0;z-index:2147483647;opacity:0;");var exports=["dragWait","dragWaitEnd","startDrag","dragReadyEnd","onMouseDrag"];exports.forEach(function(x){mouseHandler[x]=this[x]},this),editor.addEventListener("mousedown",this.onMouseDown.bind(mouseHandler));var dragSelectionMarker,x,y,timerId,range,dragCursor,dragOperation,isInternal,autoScrollStartTime,cursorMovedTime,cursorPointOnCaretMoved,mouseTarget=editor.container,counter=0;this.onDragStart=function(e){if(this.cancelDrag||!mouseTarget.draggable){var self=this;return setTimeout(function(){self.startSelect(),self.captureMouse(e)},0),e.preventDefault()}range=editor.getSelectionRange();var dataTransfer=e.dataTransfer;dataTransfer.effectAllowed=editor.getReadOnly()?"copy":"copyMove",useragent.isOpera&&(editor.container.appendChild(blankImage),blankImage.scrollTop=0),dataTransfer.setDragImage&&dataTransfer.setDragImage(blankImage,0,0),useragent.isOpera&&editor.container.removeChild(blankImage),dataTransfer.clearData(),dataTransfer.setData("Text",editor.session.getTextRange()),isInternal=!0,this.setState("drag")},this.onDragEnd=function(e){if(mouseTarget.draggable=!1,isInternal=!1,this.setState(null),!editor.getReadOnly()){var dropEffect=e.dataTransfer.dropEffect;dragOperation||"move"!=dropEffect||editor.session.remove(editor.getSelectionRange()),editor.renderer.$cursorLayer.setBlinking(!0)}this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle("")},this.onDragEnter=function(e){return!editor.getReadOnly()&&canAccept(e.dataTransfer)?(x=e.clientX,y=e.clientY,dragSelectionMarker||addDragMarker(),counter++,e.dataTransfer.dropEffect=dragOperation=getDropEffect(e),event.preventDefault(e)):void 0},this.onDragOver=function(e){return!editor.getReadOnly()&&canAccept(e.dataTransfer)?(x=e.clientX,y=e.clientY,dragSelectionMarker||(addDragMarker(),counter++),null!==onMouseMoveTimer&&(onMouseMoveTimer=null),e.dataTransfer.dropEffect=dragOperation=getDropEffect(e),event.preventDefault(e)):void 0},this.onDragLeave=function(e){return counter--,0>=counter&&dragSelectionMarker?(clearDragMarker(),dragOperation=null,event.preventDefault(e)):void 0},this.onDrop=function(e){if(dragCursor){var dataTransfer=e.dataTransfer;if(isInternal)switch(dragOperation){case"move":range=range.contains(dragCursor.row,dragCursor.column)?{start:dragCursor,end:dragCursor}:editor.moveText(range,dragCursor);break;case"copy":range=editor.moveText(range,dragCursor,!0)}else{var dropData=dataTransfer.getData("Text");range={start:dragCursor,end:editor.session.insert(dragCursor,dropData)},editor.focus(),dragOperation=null}return clearDragMarker(),event.preventDefault(e)}},event.addListener(mouseTarget,"dragstart",this.onDragStart.bind(mouseHandler)),event.addListener(mouseTarget,"dragend",this.onDragEnd.bind(mouseHandler)),event.addListener(mouseTarget,"dragenter",this.onDragEnter.bind(mouseHandler)),event.addListener(mouseTarget,"dragover",this.onDragOver.bind(mouseHandler)),event.addListener(mouseTarget,"dragleave",this.onDragLeave.bind(mouseHandler)),event.addListener(mouseTarget,"drop",this.onDrop.bind(mouseHandler));var onMouseMoveTimer=null}function calcDistance(ax,ay,bx,by){return Math.sqrt(Math.pow(bx-ax,2)+Math.pow(by-ay,2))}var dom=require("../lib/dom"),event=require("../lib/event"),useragent=require("../lib/useragent"),AUTOSCROLL_DELAY=200,SCROLL_CURSOR_DELAY=200,SCROLL_CURSOR_HYSTERESIS=5;(function(){this.dragWait=function(){var interval=Date.now()-this.mousedownEvent.time;interval>this.editor.getDragDelay()&&this.startDrag()},this.dragWaitEnd=function(){var target=this.editor.container;target.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()),this.selectEnd()},this.dragReadyEnd=function(e){this.editor.renderer.$cursorLayer.setBlinking(!this.editor.getReadOnly()),this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle(""),this.dragWaitEnd()},this.startDrag=function(){this.cancelDrag=!1;var editor=this.editor,target=editor.container;target.draggable=!0,editor.renderer.$cursorLayer.setBlinking(!1),editor.setStyle("ace_dragging");var cursorStyle=useragent.isWin?"default":"move";editor.renderer.setCursorStyle(cursorStyle),this.setState("dragReady")},this.onMouseDrag=function(e){var target=this.editor.container;if(useragent.isIE&&"dragReady"==this.state){var distance=calcDistance(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);distance>3&&target.dragDrop()}if("dragWait"===this.state){var distance=calcDistance(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);distance>0&&(target.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()))}},this.onMouseDown=function(e){if(this.$dragEnabled){this.mousedownEvent=e;var editor=this.editor,inSelection=e.inSelection(),button=e.getButton(),clickCount=e.domEvent.detail||1;if(1===clickCount&&0===button&&inSelection){if(e.editor.inMultiSelectMode&&(e.getAccelKey()||e.getShiftKey()))return;this.mousedownEvent.time=Date.now();var eventTarget=e.domEvent.target||e.domEvent.srcElement;if("unselectable"in eventTarget&&(eventTarget.unselectable="on"),editor.getDragDelay()){if(useragent.isWebKit){this.cancelDrag=!0;var mouseTarget=editor.container;mouseTarget.draggable=!0}this.setState("dragWait")}else this.startDrag();this.captureMouse(e,this.onMouseDrag.bind(this)),e.defaultPrevented=!0}}}}).call(DragdropHandler.prototype),exports.DragdropHandler=DragdropHandler}),ace.define("ace/lib/net",["require","exports","module","ace/lib/dom"],function(require,exports,module){"use strict";var dom=require("./dom");exports.get=function(url,callback){var xhr=new XMLHttpRequest;xhr.open("GET",url,!0),xhr.onreadystatechange=function(){4===xhr.readyState&&callback(xhr.responseText)},xhr.send(null)},exports.loadScript=function(path,callback){var head=dom.getDocumentHead(),s=document.createElement("script");s.src=path,head.appendChild(s),s.onload=s.onreadystatechange=function(_,isAbort){(isAbort||!s.readyState||"loaded"==s.readyState||"complete"==s.readyState)&&(s=s.onload=s.onreadystatechange=null,isAbort||callback())}},exports.qualifyURL=function(url){var a=document.createElement("a");return a.href=url,a.href}}),ace.define("ace/lib/event_emitter",["require","exports","module"],function(require,exports,module){"use strict";var EventEmitter={},stopPropagation=function(){this.propagationStopped=!0},preventDefault=function(){this.defaultPrevented=!0};EventEmitter._emit=EventEmitter._dispatchEvent=function(eventName,e){this._eventRegistry||(this._eventRegistry={}),this._defaultHandlers||(this._defaultHandlers={});var listeners=this._eventRegistry[eventName]||[],defaultHandler=this._defaultHandlers[eventName];if(listeners.length||defaultHandler){"object"==typeof e&&e||(e={}),e.type||(e.type=eventName),e.stopPropagation||(e.stopPropagation=stopPropagation),e.preventDefault||(e.preventDefault=preventDefault),listeners=listeners.slice();for(var i=0;i<listeners.length&&(listeners[i](e,this),!e.propagationStopped);i++);return defaultHandler&&!e.defaultPrevented?defaultHandler(e,this):void 0}},EventEmitter._signal=function(eventName,e){var listeners=(this._eventRegistry||{})[eventName];if(listeners){listeners=listeners.slice();for(var i=0;i<listeners.length;i++)listeners[i](e,this)}},EventEmitter.once=function(eventName,callback){var _self=this;callback&&this.addEventListener(eventName,function newCallback(){_self.removeEventListener(eventName,newCallback),callback.apply(null,arguments)})},EventEmitter.setDefaultHandler=function(eventName,callback){var handlers=this._defaultHandlers;if(handlers||(handlers=this._defaultHandlers={_disabled_:{}}),handlers[eventName]){var old=handlers[eventName],disabled=handlers._disabled_[eventName];disabled||(handlers._disabled_[eventName]=disabled=[]),disabled.push(old);var i=disabled.indexOf(callback);-1!=i&&disabled.splice(i,1)}handlers[eventName]=callback},EventEmitter.removeDefaultHandler=function(eventName,callback){var handlers=this._defaultHandlers;if(handlers){var disabled=handlers._disabled_[eventName];if(handlers[eventName]==callback){handlers[eventName];disabled&&this.setDefaultHandler(eventName,disabled.pop())}else if(disabled){var i=disabled.indexOf(callback);-1!=i&&disabled.splice(i,1)}}},EventEmitter.on=EventEmitter.addEventListener=function(eventName,callback,capturing){this._eventRegistry=this._eventRegistry||{};var listeners=this._eventRegistry[eventName];return listeners||(listeners=this._eventRegistry[eventName]=[]),-1==listeners.indexOf(callback)&&listeners[capturing?"unshift":"push"](callback),callback},EventEmitter.off=EventEmitter.removeListener=EventEmitter.removeEventListener=function(eventName,callback){this._eventRegistry=this._eventRegistry||{};var listeners=this._eventRegistry[eventName];if(listeners){var index=listeners.indexOf(callback);-1!==index&&listeners.splice(index,1)}},EventEmitter.removeAllListeners=function(eventName){this._eventRegistry&&(this._eventRegistry[eventName]=[])},exports.EventEmitter=EventEmitter}),ace.define("ace/lib/app_config",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(require,exports,module){"no use strict";function warn(message){"undefined"!=typeof console&&console.warn&&console.warn.apply(console,arguments)}function reportError(msg,data){var e=new Error(msg);e.data=data,"object"==typeof console&&console.error&&console.error(e),setTimeout(function(){throw e})}var oop=require("./oop"),EventEmitter=require("./event_emitter").EventEmitter,optionsProvider={setOptions:function(optList){Object.keys(optList).forEach(function(key){this.setOption(key,optList[key])},this)},getOptions:function(optionNames){var result={};return optionNames?Array.isArray(optionNames)||(result=optionNames,optionNames=Object.keys(result)):optionNames=Object.keys(this.$options),optionNames.forEach(function(key){result[key]=this.getOption(key)},this),result},setOption:function(name,value){if(this["$"+name]!==value){var opt=this.$options[name];if(!opt)return warn('misspelled option "'+name+'"');if(opt.forwardTo)return this[opt.forwardTo]&&this[opt.forwardTo].setOption(name,value);opt.handlesSet||(this["$"+name]=value),opt&&opt.set&&opt.set.call(this,value)}},getOption:function(name){var opt=this.$options[name];return opt?opt.forwardTo?this[opt.forwardTo]&&this[opt.forwardTo].getOption(name):opt&&opt.get?opt.get.call(this):this["$"+name]:warn('misspelled option "'+name+'"')}},AppConfig=function(){this.$defaultOptions={}};(function(){oop.implement(this,EventEmitter),this.defineOptions=function(obj,path,options){return obj.$options||(this.$defaultOptions[path]=obj.$options={}),Object.keys(options).forEach(function(key){var opt=options[key];"string"==typeof opt&&(opt={forwardTo:opt}),opt.name||(opt.name=key),obj.$options[opt.name]=opt,"initialValue"in opt&&(obj["$"+opt.name]=opt.initialValue)}),oop.implement(obj,optionsProvider),this},this.resetOptions=function(obj){Object.keys(obj.$options).forEach(function(key){var opt=obj.$options[key];"value"in opt&&obj.setOption(key,opt.value)})},this.setDefaultValue=function(path,name,value){var opts=this.$defaultOptions[path]||(this.$defaultOptions[path]={});opts[name]&&(opts.forwardTo?this.setDefaultValue(opts.forwardTo,name,value):opts[name].value=value)},this.setDefaultValues=function(path,optionHash){Object.keys(optionHash).forEach(function(key){this.setDefaultValue(path,key,optionHash[key])},this)},this.warn=warn,this.reportError=reportError}).call(AppConfig.prototype),exports.AppConfig=AppConfig}),ace.define("ace/config",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/lib/net","ace/lib/app_config"],function(require,exports,module){"no use strict";function init(packaged){if(global&&global.document){options.packaged=packaged||require.packaged||module.packaged||global.define&&define.packaged;for(var scriptOptions={},scriptUrl="",currentScript=document.currentScript||document._currentScript,currentDocument=currentScript&&currentScript.ownerDocument||document,scripts=currentDocument.getElementsByTagName("script"),i=0;i<scripts.length;i++){var script=scripts[i],src=script.src||script.getAttribute("src");if(src){for(var attributes=script.attributes,j=0,l=attributes.length;l>j;j++){var attr=attributes[j];0===attr.name.indexOf("data-ace-")&&(scriptOptions[deHyphenate(attr.name.replace(/^data-ace-/,""))]=attr.value)}var m=src.match(/^(.*)\/ace(\-\w+)?\.js(\?|$)/);m&&(scriptUrl=m[1])}}scriptUrl&&(scriptOptions.base=scriptOptions.base||scriptUrl,scriptOptions.packaged=!0),scriptOptions.basePath=scriptOptions.base,scriptOptions.workerPath=scriptOptions.workerPath||scriptOptions.base,scriptOptions.modePath=scriptOptions.modePath||scriptOptions.base,scriptOptions.themePath=scriptOptions.themePath||scriptOptions.base,delete scriptOptions.base;for(var key in scriptOptions)"undefined"!=typeof scriptOptions[key]&&exports.set(key,scriptOptions[key])}}function deHyphenate(str){return str.replace(/-(.)/g,function(m,m1){return m1.toUpperCase()})}var lang=require("./lib/lang"),net=(require("./lib/oop"),require("./lib/net")),AppConfig=require("./lib/app_config").AppConfig;module.exports=exports=new AppConfig;var global=function(){return this||"undefined"!=typeof window&&window}(),options={packaged:!1,workerPath:null,modePath:null,themePath:null,basePath:"",suffix:".js",$moduleUrls:{}};exports.get=function(key){if(!options.hasOwnProperty(key))throw new Error("Unknown config key: "+key);return options[key]},exports.set=function(key,value){if(!options.hasOwnProperty(key))throw new Error("Unknown config key: "+key);options[key]=value},exports.all=function(){return lang.copyObject(options)},exports.moduleUrl=function(name,component){if(options.$moduleUrls[name])return options.$moduleUrls[name];var parts=name.split("/");component=component||parts[parts.length-2]||"";var sep="snippets"==component?"/":"-",base=parts[parts.length-1];if("worker"==component&&"-"==sep){var re=new RegExp("^"+component+"[\\-_]|[\\-_]"+component+"$","g");base=base.replace(re,"")}(!base||base==component)&&parts.length>1&&(base=parts[parts.length-2]);var path=options[component+"Path"];return null==path?path=options.basePath:"/"==sep&&(component=sep=""),path&&"/"!=path.slice(-1)&&(path+="/"),path+component+sep+base+this.get("suffix")},exports.setModuleUrl=function(name,subst){return options.$moduleUrls[name]=subst},exports.$loading={},exports.loadModule=function(moduleName,onLoad){var module,moduleType;Array.isArray(moduleName)&&(moduleType=moduleName[0],moduleName=moduleName[1]);try{module=require(moduleName)}catch(e){}if(module&&!exports.$loading[moduleName])return onLoad&&onLoad(module);if(exports.$loading[moduleName]||(exports.$loading[moduleName]=[]),exports.$loading[moduleName].push(onLoad),!(exports.$loading[moduleName].length>1)){var afterLoad=function(){require([moduleName],function(module){exports._emit("load.module",{name:moduleName,module:module});var listeners=exports.$loading[moduleName];exports.$loading[moduleName]=null,listeners.forEach(function(onLoad){onLoad&&onLoad(module)})})};return exports.get("packaged")?void net.loadScript(exports.moduleUrl(moduleName,moduleType),afterLoad):afterLoad()}},init(!0),exports.init=init}),ace.define("ace/mouse/mouse_handler",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/mouse/default_handlers","ace/mouse/default_gutter_handler","ace/mouse/mouse_event","ace/mouse/dragdrop_handler","ace/config"],function(require,exports,module){"use strict";var event=require("../lib/event"),useragent=require("../lib/useragent"),DefaultHandlers=require("./default_handlers").DefaultHandlers,DefaultGutterHandler=require("./default_gutter_handler").GutterHandler,MouseEvent=require("./mouse_event").MouseEvent,DragdropHandler=require("./dragdrop_handler").DragdropHandler,config=require("../config"),MouseHandler=function(editor){var _self=this;this.editor=editor,new DefaultHandlers(this),new DefaultGutterHandler(this),new DragdropHandler(this);var focusEditor=function(e){var windowBlurred=!document.hasFocus||!document.hasFocus()||!editor.isFocused()&&document.activeElement==(editor.textInput&&editor.textInput.getElement());
windowBlurred&&window.focus(),editor.focus()},mouseTarget=editor.renderer.getMouseEventTarget();event.addListener(mouseTarget,"click",this.onMouseEvent.bind(this,"click")),event.addListener(mouseTarget,"mousemove",this.onMouseMove.bind(this,"mousemove")),event.addMultiMouseDownListener([mouseTarget,editor.renderer.scrollBarV&&editor.renderer.scrollBarV.inner,editor.renderer.scrollBarH&&editor.renderer.scrollBarH.inner,editor.textInput&&editor.textInput.getElement()].filter(Boolean),[400,300,250],this,"onMouseEvent"),event.addMouseWheelListener(editor.container,this.onMouseWheel.bind(this,"mousewheel")),event.addTouchMoveListener(editor.container,this.onTouchMove.bind(this,"touchmove"));var gutterEl=editor.renderer.$gutter;event.addListener(gutterEl,"mousedown",this.onMouseEvent.bind(this,"guttermousedown")),event.addListener(gutterEl,"click",this.onMouseEvent.bind(this,"gutterclick")),event.addListener(gutterEl,"dblclick",this.onMouseEvent.bind(this,"gutterdblclick")),event.addListener(gutterEl,"mousemove",this.onMouseEvent.bind(this,"guttermousemove")),event.addListener(mouseTarget,"mousedown",focusEditor),event.addListener(gutterEl,"mousedown",focusEditor),useragent.isIE&&editor.renderer.scrollBarV&&(event.addListener(editor.renderer.scrollBarV.element,"mousedown",focusEditor),event.addListener(editor.renderer.scrollBarH.element,"mousedown",focusEditor)),editor.on("mousemove",function(e){if(!_self.state&&!_self.$dragDelay&&_self.$dragEnabled){var character=editor.renderer.screenToTextCoordinates(e.x,e.y),range=editor.session.selection.getRange(),renderer=editor.renderer;!range.isEmpty()&&range.insideStart(character.row,character.column)?renderer.setCursorStyle("default"):renderer.setCursorStyle("")}})};(function(){this.onMouseEvent=function(name,e){this.editor._emit(name,new MouseEvent(e,this.editor))},this.onMouseMove=function(name,e){var listeners=this.editor._eventRegistry&&this.editor._eventRegistry.mousemove;listeners&&listeners.length&&this.editor._emit(name,new MouseEvent(e,this.editor))},this.onMouseWheel=function(name,e){var mouseEvent=new MouseEvent(e,this.editor);mouseEvent.speed=2*this.$scrollSpeed,mouseEvent.wheelX=e.wheelX,mouseEvent.wheelY=e.wheelY,this.editor._emit(name,mouseEvent)},this.onTouchMove=function(name,e){var mouseEvent=new MouseEvent(e,this.editor);mouseEvent.speed=1,mouseEvent.wheelX=e.wheelX,mouseEvent.wheelY=e.wheelY,this.editor._emit(name,mouseEvent)},this.setState=function(state){this.state=state},this.captureMouse=function(ev,mouseMoveHandler){this.x=ev.x,this.y=ev.y,this.isMousePressed=!0;var renderer=this.editor.renderer;renderer.$keepTextAreaAtCursor&&(renderer.$keepTextAreaAtCursor=null);var self=this,onMouseMove=function(e){if(e){if(useragent.isWebKit&&!e.which&&self.releaseMouse)return self.releaseMouse();self.x=e.clientX,self.y=e.clientY,mouseMoveHandler&&mouseMoveHandler(e),self.mouseEvent=new MouseEvent(e,self.editor),self.$mouseMoved=!0}},onCaptureEnd=function(e){clearInterval(timerId),onCaptureInterval(),self[self.state+"End"]&&self[self.state+"End"](e),self.state="",null==renderer.$keepTextAreaAtCursor&&(renderer.$keepTextAreaAtCursor=!0,renderer.$moveTextAreaToCursor()),self.isMousePressed=!1,self.$onCaptureMouseMove=self.releaseMouse=null,e&&self.onMouseEvent("mouseup",e)},onCaptureInterval=function(){self[self.state]&&self[self.state](),self.$mouseMoved=!1};if(useragent.isOldIE&&"dblclick"==ev.domEvent.type)return setTimeout(function(){onCaptureEnd(ev)});self.$onCaptureMouseMove=onMouseMove,self.releaseMouse=event.capture(this.editor.container,onMouseMove,onCaptureEnd);var timerId=setInterval(onCaptureInterval,20)},this.releaseMouse=null,this.cancelContextMenu=function(){var stop=function(e){e&&e.domEvent&&"contextmenu"!=e.domEvent.type||(this.editor.off("nativecontextmenu",stop),e&&e.domEvent&&event.stopEvent(e.domEvent))}.bind(this);setTimeout(stop,10),this.editor.on("nativecontextmenu",stop)}}).call(MouseHandler.prototype),config.defineOptions(MouseHandler.prototype,"mouseHandler",{scrollSpeed:{initialValue:2},dragDelay:{initialValue:useragent.isMac?150:0},dragEnabled:{initialValue:!0},focusTimout:{initialValue:0},tooltipFollowsMouse:{initialValue:!0}}),exports.MouseHandler=MouseHandler}),ace.define("ace/mouse/fold_handler",["require","exports","module"],function(require,exports,module){"use strict";function FoldHandler(editor){editor.on("click",function(e){var position=e.getDocumentPosition(),session=editor.session,fold=session.getFoldAt(position.row,position.column,1);fold&&(e.getAccelKey()?session.removeFold(fold):session.expandFold(fold),e.stop())}),editor.on("gutterclick",function(e){var gutterRegion=editor.renderer.$gutterLayer.getRegion(e);if("foldWidgets"==gutterRegion){var row=e.getDocumentPosition().row,session=editor.session;session.foldWidgets&&session.foldWidgets[row]&&editor.session.onFoldWidgetClick(row,e),editor.isFocused()||editor.focus(),e.stop()}}),editor.on("gutterdblclick",function(e){var gutterRegion=editor.renderer.$gutterLayer.getRegion(e);if("foldWidgets"==gutterRegion){var row=e.getDocumentPosition().row,session=editor.session,data=session.getParentFoldRangeData(row,!0),range=data.range||data.firstRange;if(range){row=range.start.row;var fold=session.getFoldAt(row,session.getLine(row).length,1);fold?session.removeFold(fold):(session.addFold("...",range),editor.renderer.scrollCursorIntoView({row:range.start.row,column:0}))}e.stop()}})}exports.FoldHandler=FoldHandler}),ace.define("ace/keyboard/keybinding",["require","exports","module","ace/lib/keys","ace/lib/event"],function(require,exports,module){"use strict";var keyUtil=require("../lib/keys"),event=require("../lib/event"),KeyBinding=function(editor){this.$editor=editor,this.$data={editor:editor},this.$handlers=[],this.setDefaultHandler(editor.commands)};(function(){this.setDefaultHandler=function(kb){this.removeKeyboardHandler(this.$defaultHandler),this.$defaultHandler=kb,this.addKeyboardHandler(kb,0)},this.setKeyboardHandler=function(kb){var h=this.$handlers;if(h[h.length-1]!=kb){for(;h[h.length-1]&&h[h.length-1]!=this.$defaultHandler;)this.removeKeyboardHandler(h[h.length-1]);this.addKeyboardHandler(kb,1)}},this.addKeyboardHandler=function(kb,pos){if(kb){"function"!=typeof kb||kb.handleKeyboard||(kb.handleKeyboard=kb);var i=this.$handlers.indexOf(kb);-1!=i&&this.$handlers.splice(i,1),void 0==pos?this.$handlers.push(kb):this.$handlers.splice(pos,0,kb),-1==i&&kb.attach&&kb.attach(this.$editor)}},this.removeKeyboardHandler=function(kb){var i=this.$handlers.indexOf(kb);return-1==i?!1:(this.$handlers.splice(i,1),kb.detach&&kb.detach(this.$editor),!0)},this.getKeyboardHandler=function(){return this.$handlers[this.$handlers.length-1]},this.getStatusText=function(){var data=this.$data,editor=data.editor;return this.$handlers.map(function(h){return h.getStatusText&&h.getStatusText(editor,data)||""}).filter(Boolean).join(" ")},this.$callKeyboardHandlers=function(hashId,keyString,keyCode,e){for(var toExecute,success=!1,commands=this.$editor.commands,i=this.$handlers.length;i--&&(toExecute=this.$handlers[i].handleKeyboard(this.$data,hashId,keyString,keyCode,e),!(toExecute&&toExecute.command&&(success="null"==toExecute.command?!0:commands.exec(toExecute.command,this.$editor,toExecute.args,e),success&&e&&-1!=hashId&&1!=toExecute.passEvent&&1!=toExecute.command.passEvent&&event.stopEvent(e),success))););return success||-1!=hashId||(toExecute={command:"insertstring"},success=commands.exec("insertstring",this.$editor,keyString)),success&&this.$editor._signal&&this.$editor._signal("keyboardActivity",toExecute),success},this.onCommandKey=function(e,hashId,keyCode){var keyString=keyUtil.keyCodeToString(keyCode);this.$callKeyboardHandlers(hashId,keyString,keyCode,e)},this.onTextInput=function(text){this.$callKeyboardHandlers(-1,text)}}).call(KeyBinding.prototype),exports.KeyBinding=KeyBinding}),ace.define("ace/range",["require","exports","module"],function(require,exports,module){"use strict";var comparePoints=function(p1,p2){return p1.row-p2.row||p1.column-p2.column},Range=function(startRow,startColumn,endRow,endColumn){this.start={row:startRow,column:startColumn},this.end={row:endRow,column:endColumn}};(function(){this.isEqual=function(range){return this.start.row===range.start.row&&this.end.row===range.end.row&&this.start.column===range.start.column&&this.end.column===range.end.column},this.toString=function(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"},this.contains=function(row,column){return 0==this.compare(row,column)},this.compareRange=function(range){var cmp,end=range.end,start=range.start;return cmp=this.compare(end.row,end.column),1==cmp?(cmp=this.compare(start.row,start.column),1==cmp?2:0==cmp?1:0):-1==cmp?-2:(cmp=this.compare(start.row,start.column),-1==cmp?-1:1==cmp?42:0)},this.comparePoint=function(p){return this.compare(p.row,p.column)},this.containsRange=function(range){return 0==this.comparePoint(range.start)&&0==this.comparePoint(range.end)},this.intersects=function(range){var cmp=this.compareRange(range);return-1==cmp||0==cmp||1==cmp},this.isEnd=function(row,column){return this.end.row==row&&this.end.column==column},this.isStart=function(row,column){return this.start.row==row&&this.start.column==column},this.setStart=function(row,column){"object"==typeof row?(this.start.column=row.column,this.start.row=row.row):(this.start.row=row,this.start.column=column)},this.setEnd=function(row,column){"object"==typeof row?(this.end.column=row.column,this.end.row=row.row):(this.end.row=row,this.end.column=column)},this.inside=function(row,column){return 0==this.compare(row,column)?this.isEnd(row,column)||this.isStart(row,column)?!1:!0:!1},this.insideStart=function(row,column){return 0==this.compare(row,column)?this.isEnd(row,column)?!1:!0:!1},this.insideEnd=function(row,column){return 0==this.compare(row,column)?this.isStart(row,column)?!1:!0:!1},this.compare=function(row,column){return this.isMultiLine()||row!==this.start.row?row<this.start.row?-1:row>this.end.row?1:this.start.row===row?column>=this.start.column?0:-1:this.end.row===row?column<=this.end.column?0:1:0:column<this.start.column?-1:column>this.end.column?1:0},this.compareStart=function(row,column){return this.start.row==row&&this.start.column==column?-1:this.compare(row,column)},this.compareEnd=function(row,column){return this.end.row==row&&this.end.column==column?1:this.compare(row,column)},this.compareInside=function(row,column){return this.end.row==row&&this.end.column==column?1:this.start.row==row&&this.start.column==column?-1:this.compare(row,column)},this.clipRows=function(firstRow,lastRow){if(this.end.row>lastRow)var end={row:lastRow+1,column:0};else if(this.end.row<firstRow)var end={row:firstRow,column:0};if(this.start.row>lastRow)var start={row:lastRow+1,column:0};else if(this.start.row<firstRow)var start={row:firstRow,column:0};return Range.fromPoints(start||this.start,end||this.end)},this.extend=function(row,column){var cmp=this.compare(row,column);if(0==cmp)return this;if(-1==cmp)var start={row:row,column:column};else var end={row:row,column:column};return Range.fromPoints(start||this.start,end||this.end)},this.isEmpty=function(){return this.start.row===this.end.row&&this.start.column===this.end.column},this.isMultiLine=function(){return this.start.row!==this.end.row},this.clone=function(){return Range.fromPoints(this.start,this.end)},this.collapseRows=function(){return 0==this.end.column?new Range(this.start.row,0,Math.max(this.start.row,this.end.row-1),0):new Range(this.start.row,0,this.end.row,0)},this.toScreenRange=function(session){var screenPosStart=session.documentToScreenPosition(this.start),screenPosEnd=session.documentToScreenPosition(this.end);return new Range(screenPosStart.row,screenPosStart.column,screenPosEnd.row,screenPosEnd.column)},this.moveBy=function(row,column){this.start.row+=row,this.start.column+=column,this.end.row+=row,this.end.column+=column}}).call(Range.prototype),Range.fromPoints=function(start,end){return new Range(start.row,start.column,end.row,end.column)},Range.comparePoints=comparePoints,Range.comparePoints=function(p1,p2){return p1.row-p2.row||p1.column-p2.column},exports.Range=Range}),ace.define("ace/selection",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter","ace/range"],function(require,exports,module){"use strict";var oop=require("./lib/oop"),lang=require("./lib/lang"),EventEmitter=require("./lib/event_emitter").EventEmitter,Range=require("./range").Range,Selection=function(session){this.session=session,this.doc=session.getDocument(),this.clearSelection(),this.lead=this.selectionLead=this.doc.createAnchor(0,0),this.anchor=this.selectionAnchor=this.doc.createAnchor(0,0);var self=this;this.lead.on("change",function(e){self._emit("changeCursor"),self.$isEmpty||self._emit("changeSelection"),self.$keepDesiredColumnOnChange||e.old.column==e.value.column||(self.$desiredColumn=null)}),this.selectionAnchor.on("change",function(){self.$isEmpty||self._emit("changeSelection")})};(function(){oop.implement(this,EventEmitter),this.isEmpty=function(){return this.$isEmpty||this.anchor.row==this.lead.row&&this.anchor.column==this.lead.column},this.isMultiLine=function(){return this.isEmpty()?!1:this.getRange().isMultiLine()},this.getCursor=function(){return this.lead.getPosition()},this.setSelectionAnchor=function(row,column){this.anchor.setPosition(row,column),this.$isEmpty&&(this.$isEmpty=!1,this._emit("changeSelection"))},this.getSelectionAnchor=function(){return this.$isEmpty?this.getSelectionLead():this.anchor.getPosition()},this.getSelectionLead=function(){return this.lead.getPosition()},this.shiftSelection=function(columns){if(this.$isEmpty)return void this.moveCursorTo(this.lead.row,this.lead.column+columns);var anchor=this.getSelectionAnchor(),lead=this.getSelectionLead(),isBackwards=this.isBackwards();isBackwards&&0===anchor.column||this.setSelectionAnchor(anchor.row,anchor.column+columns),(isBackwards||0!==lead.column)&&this.$moveSelection(function(){this.moveCursorTo(lead.row,lead.column+columns)})},this.isBackwards=function(){var anchor=this.anchor,lead=this.lead;return anchor.row>lead.row||anchor.row==lead.row&&anchor.column>lead.column},this.getRange=function(){var anchor=this.anchor,lead=this.lead;return this.isEmpty()?Range.fromPoints(lead,lead):this.isBackwards()?Range.fromPoints(lead,anchor):Range.fromPoints(anchor,lead)},this.clearSelection=function(){this.$isEmpty||(this.$isEmpty=!0,this._emit("changeSelection"))},this.selectAll=function(){var lastRow=this.doc.getLength()-1;this.setSelectionAnchor(0,0),this.moveCursorTo(lastRow,this.doc.getLine(lastRow).length)},this.setRange=this.setSelectionRange=function(range,reverse){reverse?(this.setSelectionAnchor(range.end.row,range.end.column),this.selectTo(range.start.row,range.start.column)):(this.setSelectionAnchor(range.start.row,range.start.column),this.selectTo(range.end.row,range.end.column)),this.getRange().isEmpty()&&(this.$isEmpty=!0),this.$desiredColumn=null},this.$moveSelection=function(mover){var lead=this.lead;this.$isEmpty&&this.setSelectionAnchor(lead.row,lead.column),mover.call(this)},this.selectTo=function(row,column){this.$moveSelection(function(){this.moveCursorTo(row,column)})},this.selectToPosition=function(pos){this.$moveSelection(function(){this.moveCursorToPosition(pos)})},this.moveTo=function(row,column){this.clearSelection(),this.moveCursorTo(row,column)},this.moveToPosition=function(pos){this.clearSelection(),this.moveCursorToPosition(pos)},this.selectUp=function(){this.$moveSelection(this.moveCursorUp)},this.selectDown=function(){this.$moveSelection(this.moveCursorDown)},this.selectRight=function(){this.$moveSelection(this.moveCursorRight)},this.selectLeft=function(){this.$moveSelection(this.moveCursorLeft)},this.selectLineStart=function(){this.$moveSelection(this.moveCursorLineStart)},this.selectLineEnd=function(){this.$moveSelection(this.moveCursorLineEnd)},this.selectFileEnd=function(){this.$moveSelection(this.moveCursorFileEnd)},this.selectFileStart=function(){this.$moveSelection(this.moveCursorFileStart)},this.selectWordRight=function(){this.$moveSelection(this.moveCursorWordRight)},this.selectWordLeft=function(){this.$moveSelection(this.moveCursorWordLeft)},this.getWordRange=function(row,column){if("undefined"==typeof column){var cursor=row||this.lead;row=cursor.row,column=cursor.column}return this.session.getWordRange(row,column)},this.selectWord=function(){this.setSelectionRange(this.getWordRange())},this.selectAWord=function(){var cursor=this.getCursor(),range=this.session.getAWordRange(cursor.row,cursor.column);this.setSelectionRange(range)},this.getLineRange=function(row,excludeLastChar){var rowEnd,rowStart="number"==typeof row?row:this.lead.row,foldLine=this.session.getFoldLine(rowStart);return foldLine?(rowStart=foldLine.start.row,rowEnd=foldLine.end.row):rowEnd=rowStart,excludeLastChar===!0?new Range(rowStart,0,rowEnd,this.session.getLine(rowEnd).length):new Range(rowStart,0,rowEnd+1,0)},this.selectLine=function(){this.setSelectionRange(this.getLineRange())},this.moveCursorUp=function(){this.moveCursorBy(-1,0)},this.moveCursorDown=function(){this.moveCursorBy(1,0)},this.moveCursorLeft=function(){var fold,cursor=this.lead.getPosition();if(fold=this.session.getFoldAt(cursor.row,cursor.column,-1))this.moveCursorTo(fold.start.row,fold.start.column);else if(0===cursor.column)cursor.row>0&&this.moveCursorTo(cursor.row-1,this.doc.getLine(cursor.row-1).length);else{var tabSize=this.session.getTabSize();this.session.isTabStop(cursor)&&this.doc.getLine(cursor.row).slice(cursor.column-tabSize,cursor.column).split(" ").length-1==tabSize?this.moveCursorBy(0,-tabSize):this.moveCursorBy(0,-1)}},this.moveCursorRight=function(){var fold,cursor=this.lead.getPosition();if(fold=this.session.getFoldAt(cursor.row,cursor.column,1))this.moveCursorTo(fold.end.row,fold.end.column);else if(this.lead.column==this.doc.getLine(this.lead.row).length)this.lead.row<this.doc.getLength()-1&&this.moveCursorTo(this.lead.row+1,0);else{var tabSize=this.session.getTabSize(),cursor=this.lead;this.session.isTabStop(cursor)&&this.doc.getLine(cursor.row).slice(cursor.column,cursor.column+tabSize).split(" ").length-1==tabSize?this.moveCursorBy(0,tabSize):this.moveCursorBy(0,1)}},this.moveCursorLineStart=function(){var row=this.lead.row,column=this.lead.column,screenRow=this.session.documentToScreenRow(row,column),firstColumnPosition=this.session.screenToDocumentPosition(screenRow,0),beforeCursor=this.session.getDisplayLine(row,null,firstColumnPosition.row,firstColumnPosition.column),leadingSpace=beforeCursor.match(/^\s*/);leadingSpace[0].length==column||this.session.$useEmacsStyleLineStart||(firstColumnPosition.column+=leadingSpace[0].length),this.moveCursorToPosition(firstColumnPosition)},this.moveCursorLineEnd=function(){var lead=this.lead,lineEnd=this.session.getDocumentLastRowColumnPosition(lead.row,lead.column);if(this.lead.column==lineEnd.column){var line=this.session.getLine(lineEnd.row);if(lineEnd.column==line.length){var textEnd=line.search(/\s+$/);textEnd>0&&(lineEnd.column=textEnd)}}this.moveCursorTo(lineEnd.row,lineEnd.column)},this.moveCursorFileEnd=function(){var row=this.doc.getLength()-1,column=this.doc.getLine(row).length;this.moveCursorTo(row,column)},this.moveCursorFileStart=function(){this.moveCursorTo(0,0)},this.moveCursorLongWordRight=function(){var match,row=this.lead.row,column=this.lead.column,line=this.doc.getLine(row),rightOfCursor=line.substring(column);this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0;var fold=this.session.getFoldAt(row,column,1);return fold?void this.moveCursorTo(fold.end.row,fold.end.column):((match=this.session.nonTokenRe.exec(rightOfCursor))&&(column+=this.session.nonTokenRe.lastIndex,this.session.nonTokenRe.lastIndex=0,rightOfCursor=line.substring(column)),column>=line.length?(this.moveCursorTo(row,line.length),this.moveCursorRight(),void(row<this.doc.getLength()-1&&this.moveCursorWordRight())):((match=this.session.tokenRe.exec(rightOfCursor))&&(column+=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),void this.moveCursorTo(row,column)))},this.moveCursorLongWordLeft=function(){var fold,row=this.lead.row,column=this.lead.column;if(fold=this.session.getFoldAt(row,column,-1))return void this.moveCursorTo(fold.start.row,fold.start.column);var str=this.session.getFoldStringAt(row,column,-1);null==str&&(str=this.doc.getLine(row).substring(0,column));var match,leftOfCursor=lang.stringReverse(str);return this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0,(match=this.session.nonTokenRe.exec(leftOfCursor))&&(column-=this.session.nonTokenRe.lastIndex,leftOfCursor=leftOfCursor.slice(this.session.nonTokenRe.lastIndex),this.session.nonTokenRe.lastIndex=0),0>=column?(this.moveCursorTo(row,0),this.moveCursorLeft(),void(row>0&&this.moveCursorWordLeft())):((match=this.session.tokenRe.exec(leftOfCursor))&&(column-=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),void this.moveCursorTo(row,column))},this.$shortWordEndIndex=function(rightOfCursor){var match,ch,index=0,whitespaceRe=/\s/,tokenRe=this.session.tokenRe;if(tokenRe.lastIndex=0,match=this.session.tokenRe.exec(rightOfCursor))index=this.session.tokenRe.lastIndex;else{for(;(ch=rightOfCursor[index])&&whitespaceRe.test(ch);)index++;if(1>index)for(tokenRe.lastIndex=0;(ch=rightOfCursor[index])&&!tokenRe.test(ch);)if(tokenRe.lastIndex=0,index++,whitespaceRe.test(ch)){if(index>2){index--;break}for(;(ch=rightOfCursor[index])&&whitespaceRe.test(ch);)index++;if(index>2)break}}return tokenRe.lastIndex=0,index},this.moveCursorShortWordRight=function(){var row=this.lead.row,column=this.lead.column,line=this.doc.getLine(row),rightOfCursor=line.substring(column),fold=this.session.getFoldAt(row,column,1);if(fold)return this.moveCursorTo(fold.end.row,fold.end.column);if(column==line.length){var l=this.doc.getLength();do row++,rightOfCursor=this.doc.getLine(row);while(l>row&&/^\s*$/.test(rightOfCursor));/^\s+/.test(rightOfCursor)||(rightOfCursor=""),column=0}var index=this.$shortWordEndIndex(rightOfCursor);this.moveCursorTo(row,column+index)},this.moveCursorShortWordLeft=function(){var fold,row=this.lead.row,column=this.lead.column;if(fold=this.session.getFoldAt(row,column,-1))return this.moveCursorTo(fold.start.row,fold.start.column);var line=this.session.getLine(row).substring(0,column);if(0===column){do row--,line=this.doc.getLine(row);while(row>0&&/^\s*$/.test(line));column=line.length,/\s+$/.test(line)||(line="")}var leftOfCursor=lang.stringReverse(line),index=this.$shortWordEndIndex(leftOfCursor);return this.moveCursorTo(row,column-index)},this.moveCursorWordRight=function(){this.session.$selectLongWords?this.moveCursorLongWordRight():this.moveCursorShortWordRight()},this.moveCursorWordLeft=function(){this.session.$selectLongWords?this.moveCursorLongWordLeft():this.moveCursorShortWordLeft()},this.moveCursorBy=function(rows,chars){var screenPos=this.session.documentToScreenPosition(this.lead.row,this.lead.column);0===chars&&(this.$desiredColumn?screenPos.column=this.$desiredColumn:this.$desiredColumn=screenPos.column);var docPos=this.session.screenToDocumentPosition(screenPos.row+rows,screenPos.column);0!==rows&&0===chars&&docPos.row===this.lead.row&&docPos.column===this.lead.column&&this.session.lineWidgets&&this.session.lineWidgets[docPos.row]&&(docPos.row>0||rows>0)&&docPos.row++,this.moveCursorTo(docPos.row,docPos.column+chars,0===chars)},this.moveCursorToPosition=function(position){this.moveCursorTo(position.row,position.column)},this.moveCursorTo=function(row,column,keepDesiredColumn){var fold=this.session.getFoldAt(row,column,1);fold&&(row=fold.start.row,column=fold.start.column),this.$keepDesiredColumnOnChange=!0,this.lead.setPosition(row,column),this.$keepDesiredColumnOnChange=!1,keepDesiredColumn||(this.$desiredColumn=null)},this.moveCursorToScreen=function(row,column,keepDesiredColumn){var pos=this.session.screenToDocumentPosition(row,column);this.moveCursorTo(pos.row,pos.column,keepDesiredColumn)},this.detach=function(){this.lead.detach(),this.anchor.detach(),this.session=this.doc=null},this.fromOrientedRange=function(range){this.setSelectionRange(range,range.cursor==range.start),this.$desiredColumn=range.desiredColumn||this.$desiredColumn},this.toOrientedRange=function(range){var r=this.getRange();return range?(range.start.column=r.start.column,range.start.row=r.start.row,range.end.column=r.end.column,range.end.row=r.end.row):range=r,range.cursor=this.isBackwards()?range.start:range.end,range.desiredColumn=this.$desiredColumn,range},this.getRangeOfMovements=function(func){var start=this.getCursor();try{func(this);var end=this.getCursor();return Range.fromPoints(start,end)}catch(e){return Range.fromPoints(start,start)}finally{this.moveCursorToPosition(start)}},this.toJSON=function(){if(this.rangeCount)var data=this.ranges.map(function(r){var r1=r.clone();return r1.isBackwards=r.cursor==r.start,r1});else{var data=this.getRange();data.isBackwards=this.isBackwards()}return data},this.fromJSON=function(data){if(void 0==data.start){if(this.rangeList){this.toSingleRange(data[0]);for(var i=data.length;i--;){var r=Range.fromPoints(data[i].start,data[i].end);data[i].isBackwards&&(r.cursor=r.start),this.addRange(r,!0)}return}data=data[0]}this.rangeList&&this.toSingleRange(data),this.setSelectionRange(data,data.isBackwards)},this.isEqual=function(data){if((data.length||this.rangeCount)&&data.length!=this.rangeCount)return!1;if(!data.length||!this.ranges)return this.getRange().isEqual(data);for(var i=this.ranges.length;i--;)if(!this.ranges[i].isEqual(data[i]))return!1;return!0}}).call(Selection.prototype),exports.Selection=Selection}),ace.define("ace/tokenizer",["require","exports","module","ace/config"],function(require,exports,module){"use strict";var config=require("./config"),MAX_TOKEN_COUNT=2e3,Tokenizer=function(rules){this.states=rules,this.regExps={},this.matchMappings={};for(var key in this.states){for(var state=this.states[key],ruleRegExps=[],matchTotal=0,mapping=this.matchMappings[key]={defaultToken:"text"},flag="g",splitterRurles=[],i=0;i<state.length;i++){var rule=state[i];if(rule.defaultToken&&(mapping.defaultToken=rule.defaultToken),rule.caseInsensitive&&(flag="gi"),null!=rule.regex){rule.regex instanceof RegExp&&(rule.regex=rule.regex.toString().slice(1,-1));var adjustedregex=rule.regex,matchcount=new RegExp("(?:("+adjustedregex+")|(.))").exec("a").length-2;Array.isArray(rule.token)?1==rule.token.length||1==matchcount?rule.token=rule.token[0]:matchcount-1!=rule.token.length?(this.reportError("number of classes and regexp groups doesn't match",{rule:rule,groupCount:matchcount-1}),rule.token=rule.token[0]):(rule.tokenArray=rule.token,rule.token=null,rule.onMatch=this.$arrayTokens):"function"!=typeof rule.token||rule.onMatch||(matchcount>1?rule.onMatch=this.$applyToken:rule.onMatch=rule.token),matchcount>1&&(/\\\d/.test(rule.regex)?adjustedregex=rule.regex.replace(/\\([0-9]+)/g,function(match,digit){return"\\"+(parseInt(digit,10)+matchTotal+1)}):(matchcount=1,adjustedregex=this.removeCapturingGroups(rule.regex)),rule.splitRegex||"string"==typeof rule.token||splitterRurles.push(rule)),mapping[matchTotal]=i,matchTotal+=matchcount,ruleRegExps.push(adjustedregex),rule.onMatch||(rule.onMatch=null)}}ruleRegExps.length||(mapping[0]=0,ruleRegExps.push("$")),splitterRurles.forEach(function(rule){rule.splitRegex=this.createSplitterRegexp(rule.regex,flag)},this),this.regExps[key]=new RegExp("("+ruleRegExps.join(")|(")+")|($)",flag)}};(function(){this.$setMaxTokenCount=function(m){MAX_TOKEN_COUNT=0|m},this.$applyToken=function(str){var values=this.splitRegex.exec(str).slice(1),types=this.token.apply(this,values);if("string"==typeof types)return[{type:types,value:str}];for(var tokens=[],i=0,l=types.length;l>i;i++)values[i]&&(tokens[tokens.length]={type:types[i],value:values[i]});return tokens},this.$arrayTokens=function(str){if(!str)return[];var values=this.splitRegex.exec(str);if(!values)return"text";for(var tokens=[],types=this.tokenArray,i=0,l=types.length;l>i;i++)values[i+1]&&(tokens[tokens.length]={type:types[i],value:values[i+1]});return tokens},this.removeCapturingGroups=function(src){var r=src.replace(/\[(?:\\.|[^\]])*?\]|\\.|\(\?[:=!]|(\()/g,function(x,y){return y?"(?:":x});return r},this.createSplitterRegexp=function(src,flag){if(-1!=src.indexOf("(?=")){var stack=0,inChClass=!1,lastCapture={};src.replace(/(\\.)|(\((?:\?[=!])?)|(\))|([\[\]])/g,function(m,esc,parenOpen,parenClose,square,index){return inChClass?inChClass="]"!=square:square?inChClass=!0:parenClose?(stack==lastCapture.stack&&(lastCapture.end=index+1,lastCapture.stack=-1),stack--):parenOpen&&(stack++,1!=parenOpen.length&&(lastCapture.stack=stack,lastCapture.start=index)),m}),null!=lastCapture.end&&/^\)*$/.test(src.substr(lastCapture.end))&&(src=src.substring(0,lastCapture.start)+src.substr(lastCapture.end))}return"^"!=src.charAt(0)&&(src="^"+src),"$"!=src.charAt(src.length-1)&&(src+="$"),new RegExp(src,(flag||"").replace("g",""))},this.getLineTokens=function(line,startState){if(startState&&"string"!=typeof startState){var stack=startState.slice(0);startState=stack[0],"#tmp"===startState&&(stack.shift(),startState=stack.shift())}else var stack=[];var currentState=startState||"start",state=this.states[currentState];state||(currentState="start",state=this.states[currentState]);var mapping=this.matchMappings[currentState],re=this.regExps[currentState];re.lastIndex=0;for(var match,tokens=[],lastIndex=0,matchAttempts=0,token={type:null,value:""};match=re.exec(line);){var type=mapping.defaultToken,rule=null,value=match[0],index=re.lastIndex;if(index-value.length>lastIndex){var skipped=line.substring(lastIndex,index-value.length);token.type==type?token.value+=skipped:(token.type&&tokens.push(token),token={type:type,value:skipped})}for(var i=0;i<match.length-2;i++)if(void 0!==match[i+1]){rule=state[mapping[i]],type=rule.onMatch?rule.onMatch(value,currentState,stack):rule.token,rule.next&&(currentState="string"==typeof rule.next?rule.next:rule.next(currentState,stack),state=this.states[currentState],state||(this.reportError("state doesn't exist",currentState),currentState="start",state=this.states[currentState]),mapping=this.matchMappings[currentState],lastIndex=index,re=this.regExps[currentState],re.lastIndex=index);break}if(value)if("string"==typeof type)rule&&rule.merge===!1||token.type!==type?(token.type&&tokens.push(token),token={type:type,value:value}):token.value+=value;else if(type){token.type&&tokens.push(token),token={type:null,value:""};for(var i=0;i<type.length;i++)tokens.push(type[i])}if(lastIndex==line.length)break;if(lastIndex=index,matchAttempts++>MAX_TOKEN_COUNT){for(matchAttempts>2*line.length&&this.reportError("infinite loop with in ace tokenizer",{startState:startState,line:line});lastIndex<line.length;)token.type&&tokens.push(token),token={value:line.substring(lastIndex,lastIndex+=2e3),type:"overflow"};currentState="start",stack=[];break}}return token.type&&tokens.push(token),stack.length>1&&stack[0]!==currentState&&stack.unshift("#tmp",currentState),{tokens:tokens,state:stack.length?stack:currentState}},this.reportError=config.reportError}).call(Tokenizer.prototype),exports.Tokenizer=Tokenizer}),ace.define("ace/mode/text_highlight_rules",["require","exports","module","ace/lib/lang"],function(require,exports,module){"use strict";var lang=require("../lib/lang"),TextHighlightRules=function(){this.$rules={start:[{token:"empty_line",regex:"^$"},{defaultToken:"text"}]}};(function(){this.addRules=function(rules,prefix){if(prefix)for(var key in rules){for(var state=rules[key],i=0;i<state.length;i++){var rule=state[i];(rule.next||rule.onMatch)&&("string"==typeof rule.next&&0!==rule.next.indexOf(prefix)&&(rule.next=prefix+rule.next),rule.nextState&&0!==rule.nextState.indexOf(prefix)&&(rule.nextState=prefix+rule.nextState))}this.$rules[prefix+key]=state}else for(var key in rules)this.$rules[key]=rules[key];
},this.getRules=function(){return this.$rules},this.embedRules=function(HighlightRules,prefix,escapeRules,states,append){var embedRules="function"==typeof HighlightRules?(new HighlightRules).getRules():HighlightRules;if(states)for(var i=0;i<states.length;i++)states[i]=prefix+states[i];else{states=[];for(var key in embedRules)states.push(prefix+key)}if(this.addRules(embedRules,prefix),escapeRules)for(var addRules=Array.prototype[append?"push":"unshift"],i=0;i<states.length;i++)addRules.apply(this.$rules[states[i]],lang.deepCopy(escapeRules));this.$embeds||(this.$embeds=[]),this.$embeds.push(prefix)},this.getEmbeds=function(){return this.$embeds};var pushState=function(currentState,stack){return("start"!=currentState||stack.length)&&stack.unshift(this.nextState,currentState),this.nextState},popState=function(currentState,stack){return stack.shift(),stack.shift()||"start"};this.normalizeRules=function(){function processState(key){var state=rules[key];state.processed=!0;for(var i=0;i<state.length;i++){var rule=state[i],toInsert=null;Array.isArray(rule)&&(toInsert=rule,rule={}),!rule.regex&&rule.start&&(rule.regex=rule.start,rule.next||(rule.next=[]),rule.next.push({defaultToken:rule.token},{token:rule.token+".end",regex:rule.end||rule.start,next:"pop"}),rule.token=rule.token+".start",rule.push=!0);var next=rule.next||rule.push;if(next&&Array.isArray(next)){var stateName=rule.stateName;stateName||(stateName=rule.token,"string"!=typeof stateName&&(stateName=stateName[0]||""),rules[stateName]&&(stateName+=id++)),rules[stateName]=next,rule.next=stateName,processState(stateName)}else"pop"==next&&(rule.next=popState);if(rule.push&&(rule.nextState=rule.next||rule.push,rule.next=pushState,delete rule.push),rule.rules)for(var r in rule.rules)rules[r]?rules[r].push&&rules[r].push.apply(rules[r],rule.rules[r]):rules[r]=rule.rules[r];var includeName="string"==typeof rule?rule:"string"==typeof rule.include?rule.include:"";if(includeName&&(toInsert=rules[includeName]),toInsert){var args=[i,1].concat(toInsert);rule.noEscape&&(args=args.filter(function(x){return!x.next})),state.splice.apply(state,args),i--}rule.keywordMap&&(rule.token=this.createKeywordMapper(rule.keywordMap,rule.defaultToken||"text",rule.caseInsensitive),delete rule.defaultToken)}}var id=0,rules=this.$rules;Object.keys(rules).forEach(processState,this)},this.createKeywordMapper=function(map,defaultToken,ignoreCase,splitChar){var keywords=Object.create(null);return Object.keys(map).forEach(function(className){var a=map[className];ignoreCase&&(a=a.toLowerCase());for(var list=a.split(splitChar||"|"),i=list.length;i--;)keywords[list[i]]=className}),Object.getPrototypeOf(keywords)&&(keywords.__proto__=null),this.$keywordList=Object.keys(keywords),map=null,ignoreCase?function(value){return keywords[value.toLowerCase()]||defaultToken}:function(value){return keywords[value]||defaultToken}},this.getKeywords=function(){return this.$keywords}}).call(TextHighlightRules.prototype),exports.TextHighlightRules=TextHighlightRules}),ace.define("ace/mode/behaviour",["require","exports","module"],function(require,exports,module){"use strict";var Behaviour=function(){this.$behaviours={}};(function(){this.add=function(name,action,callback){switch(void 0){case this.$behaviours:this.$behaviours={};case this.$behaviours[name]:this.$behaviours[name]={}}this.$behaviours[name][action]=callback},this.addBehaviours=function(behaviours){for(var key in behaviours)for(var action in behaviours[key])this.add(key,action,behaviours[key][action])},this.remove=function(name){this.$behaviours&&this.$behaviours[name]&&delete this.$behaviours[name]},this.inherit=function(mode,filter){if("function"==typeof mode)var behaviours=(new mode).getBehaviours(filter);else var behaviours=mode.getBehaviours(filter);this.addBehaviours(behaviours)},this.getBehaviours=function(filter){if(filter){for(var ret={},i=0;i<filter.length;i++)this.$behaviours[filter[i]]&&(ret[filter[i]]=this.$behaviours[filter[i]]);return ret}return this.$behaviours}}).call(Behaviour.prototype),exports.Behaviour=Behaviour}),ace.define("ace/token_iterator",["require","exports","module"],function(require,exports,module){"use strict";var TokenIterator=function(session,initialRow,initialColumn){this.$session=session,this.$row=initialRow,this.$rowTokens=session.getTokens(initialRow);var token=session.getTokenAt(initialRow,initialColumn);this.$tokenIndex=token?token.index:-1};(function(){this.stepBackward=function(){for(this.$tokenIndex-=1;this.$tokenIndex<0;){if(this.$row-=1,this.$row<0)return this.$row=0,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=this.$rowTokens.length-1}return this.$rowTokens[this.$tokenIndex]},this.stepForward=function(){this.$tokenIndex+=1;for(var rowCount;this.$tokenIndex>=this.$rowTokens.length;){if(this.$row+=1,rowCount||(rowCount=this.$session.getLength()),this.$row>=rowCount)return this.$row=rowCount-1,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=0}return this.$rowTokens[this.$tokenIndex]},this.getCurrentToken=function(){return this.$rowTokens[this.$tokenIndex]},this.getCurrentTokenRow=function(){return this.$row},this.getCurrentTokenColumn=function(){var rowTokens=this.$rowTokens,tokenIndex=this.$tokenIndex,column=rowTokens[tokenIndex].start;if(void 0!==column)return column;for(column=0;tokenIndex>0;)tokenIndex-=1,column+=rowTokens[tokenIndex].value.length;return column},this.getCurrentTokenPosition=function(){return{row:this.$row,column:this.getCurrentTokenColumn()}}}).call(TokenIterator.prototype),exports.TokenIterator=TokenIterator}),ace.define("ace/mode/behaviour/cstyle",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/token_iterator","ace/lib/lang"],function(require,exports,module){"use strict";var context,oop=require("../../lib/oop"),Behaviour=require("../behaviour").Behaviour,TokenIterator=require("../../token_iterator").TokenIterator,lang=require("../../lib/lang"),SAFE_INSERT_IN_TOKENS=["text","paren.rparen","punctuation.operator"],SAFE_INSERT_BEFORE_TOKENS=["text","paren.rparen","punctuation.operator","comment"],contextCache={},initContext=function(editor){var id=-1;return editor.multiSelect&&(id=editor.selection.index,contextCache.rangeCount!=editor.multiSelect.rangeCount&&(contextCache={rangeCount:editor.multiSelect.rangeCount})),contextCache[id]?context=contextCache[id]:void(context=contextCache[id]={autoInsertedBrackets:0,autoInsertedRow:-1,autoInsertedLineEnd:"",maybeInsertedBrackets:0,maybeInsertedRow:-1,maybeInsertedLineStart:"",maybeInsertedLineEnd:""})},getWrapped=function(selection,selected,opening,closing){var rowDiff=selection.end.row-selection.start.row;return{text:opening+selected+closing,selection:[0,selection.start.column+1,rowDiff,selection.end.column+(rowDiff?0:1)]}},CstyleBehaviour=function(){this.add("braces","insertion",function(state,action,editor,session,text){var cursor=editor.getCursorPosition(),line=session.doc.getLine(cursor.row);if("{"==text){initContext(editor);var selection=editor.getSelectionRange(),selected=session.doc.getTextRange(selection);if(""!==selected&&"{"!==selected&&editor.getWrapBehavioursEnabled())return getWrapped(selection,selected,"{","}");if(CstyleBehaviour.isSaneInsertion(editor,session))return/[\]\}\)]/.test(line[cursor.column])||editor.inMultiSelectMode?(CstyleBehaviour.recordAutoInsert(editor,session,"}"),{text:"{}",selection:[1,1]}):(CstyleBehaviour.recordMaybeInsert(editor,session,"{"),{text:"{",selection:[1,1]})}else if("}"==text){initContext(editor);var rightChar=line.substring(cursor.column,cursor.column+1);if("}"==rightChar){var matching=session.$findOpeningBracket("}",{column:cursor.column+1,row:cursor.row});if(null!==matching&&CstyleBehaviour.isAutoInsertedClosing(cursor,line,text))return CstyleBehaviour.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}else{if("\n"==text||"\r\n"==text){initContext(editor);var closing="";CstyleBehaviour.isMaybeInsertedClosing(cursor,line)&&(closing=lang.stringRepeat("}",context.maybeInsertedBrackets),CstyleBehaviour.clearMaybeInsertedClosing());var rightChar=line.substring(cursor.column,cursor.column+1);if("}"===rightChar){var openBracePos=session.findMatchingBracket({row:cursor.row,column:cursor.column+1},"}");if(!openBracePos)return null;var next_indent=this.$getIndent(session.getLine(openBracePos.row))}else{if(!closing)return void CstyleBehaviour.clearMaybeInsertedClosing();var next_indent=this.$getIndent(line)}var indent=next_indent+session.getTabString();return{text:"\n"+indent+"\n"+next_indent+closing,selection:[1,indent.length,1,indent.length]}}CstyleBehaviour.clearMaybeInsertedClosing()}}),this.add("braces","deletion",function(state,action,editor,session,range){var selected=session.doc.getTextRange(range);if(!range.isMultiLine()&&"{"==selected){initContext(editor);var line=session.doc.getLine(range.start.row),rightChar=line.substring(range.end.column,range.end.column+1);if("}"==rightChar)return range.end.column++,range;context.maybeInsertedBrackets--}}),this.add("parens","insertion",function(state,action,editor,session,text){if("("==text){initContext(editor);var selection=editor.getSelectionRange(),selected=session.doc.getTextRange(selection);if(""!==selected&&editor.getWrapBehavioursEnabled())return getWrapped(selection,selected,"(",")");if(CstyleBehaviour.isSaneInsertion(editor,session))return CstyleBehaviour.recordAutoInsert(editor,session,")"),{text:"()",selection:[1,1]}}else if(")"==text){initContext(editor);var cursor=editor.getCursorPosition(),line=session.doc.getLine(cursor.row),rightChar=line.substring(cursor.column,cursor.column+1);if(")"==rightChar){var matching=session.$findOpeningBracket(")",{column:cursor.column+1,row:cursor.row});if(null!==matching&&CstyleBehaviour.isAutoInsertedClosing(cursor,line,text))return CstyleBehaviour.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}}),this.add("parens","deletion",function(state,action,editor,session,range){var selected=session.doc.getTextRange(range);if(!range.isMultiLine()&&"("==selected){initContext(editor);var line=session.doc.getLine(range.start.row),rightChar=line.substring(range.start.column+1,range.start.column+2);if(")"==rightChar)return range.end.column++,range}}),this.add("brackets","insertion",function(state,action,editor,session,text){if("["==text){initContext(editor);var selection=editor.getSelectionRange(),selected=session.doc.getTextRange(selection);if(""!==selected&&editor.getWrapBehavioursEnabled())return getWrapped(selection,selected,"[","]");if(CstyleBehaviour.isSaneInsertion(editor,session))return CstyleBehaviour.recordAutoInsert(editor,session,"]"),{text:"[]",selection:[1,1]}}else if("]"==text){initContext(editor);var cursor=editor.getCursorPosition(),line=session.doc.getLine(cursor.row),rightChar=line.substring(cursor.column,cursor.column+1);if("]"==rightChar){var matching=session.$findOpeningBracket("]",{column:cursor.column+1,row:cursor.row});if(null!==matching&&CstyleBehaviour.isAutoInsertedClosing(cursor,line,text))return CstyleBehaviour.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}}),this.add("brackets","deletion",function(state,action,editor,session,range){var selected=session.doc.getTextRange(range);if(!range.isMultiLine()&&"["==selected){initContext(editor);var line=session.doc.getLine(range.start.row),rightChar=line.substring(range.start.column+1,range.start.column+2);if("]"==rightChar)return range.end.column++,range}}),this.add("string_dquotes","insertion",function(state,action,editor,session,text){if('"'==text||"'"==text){if(this.lineCommentStart&&-1!=this.lineCommentStart.indexOf(text))return;initContext(editor);var quote=text,selection=editor.getSelectionRange(),selected=session.doc.getTextRange(selection);if(""!==selected&&"'"!==selected&&'"'!=selected&&editor.getWrapBehavioursEnabled())return getWrapped(selection,selected,quote,quote);if(!selected){var cursor=editor.getCursorPosition(),line=session.doc.getLine(cursor.row),leftChar=line.substring(cursor.column-1,cursor.column),rightChar=line.substring(cursor.column,cursor.column+1),token=session.getTokenAt(cursor.row,cursor.column),rightToken=session.getTokenAt(cursor.row,cursor.column+1);if("\\"==leftChar&&token&&/escape/.test(token.type))return null;var pair,stringBefore=token&&/string|escape/.test(token.type),stringAfter=!rightToken||/string|escape/.test(rightToken.type);if(rightChar==quote)pair=stringBefore!==stringAfter,pair&&/string\.end/.test(rightToken.type)&&(pair=!1);else{if(stringBefore&&!stringAfter)return null;if(stringBefore&&stringAfter)return null;var wordRe=session.$mode.tokenRe;wordRe.lastIndex=0;var isWordBefore=wordRe.test(leftChar);wordRe.lastIndex=0;var isWordAfter=wordRe.test(leftChar);if(isWordBefore||isWordAfter)return null;if(rightChar&&!/[\s;,.})\]\\]/.test(rightChar))return null;pair=!0}return{text:pair?quote+quote:"",selection:[1,1]}}}}),this.add("string_dquotes","deletion",function(state,action,editor,session,range){var selected=session.doc.getTextRange(range);if(!range.isMultiLine()&&('"'==selected||"'"==selected)){initContext(editor);var line=session.doc.getLine(range.start.row),rightChar=line.substring(range.start.column+1,range.start.column+2);if(rightChar==selected)return range.end.column++,range}})};CstyleBehaviour.isSaneInsertion=function(editor,session){var cursor=editor.getCursorPosition(),iterator=new TokenIterator(session,cursor.row,cursor.column);if(!this.$matchTokenType(iterator.getCurrentToken()||"text",SAFE_INSERT_IN_TOKENS)){var iterator2=new TokenIterator(session,cursor.row,cursor.column+1);if(!this.$matchTokenType(iterator2.getCurrentToken()||"text",SAFE_INSERT_IN_TOKENS))return!1}return iterator.stepForward(),iterator.getCurrentTokenRow()!==cursor.row||this.$matchTokenType(iterator.getCurrentToken()||"text",SAFE_INSERT_BEFORE_TOKENS)},CstyleBehaviour.$matchTokenType=function(token,types){return types.indexOf(token.type||token)>-1},CstyleBehaviour.recordAutoInsert=function(editor,session,bracket){var cursor=editor.getCursorPosition(),line=session.doc.getLine(cursor.row);this.isAutoInsertedClosing(cursor,line,context.autoInsertedLineEnd[0])||(context.autoInsertedBrackets=0),context.autoInsertedRow=cursor.row,context.autoInsertedLineEnd=bracket+line.substr(cursor.column),context.autoInsertedBrackets++},CstyleBehaviour.recordMaybeInsert=function(editor,session,bracket){var cursor=editor.getCursorPosition(),line=session.doc.getLine(cursor.row);this.isMaybeInsertedClosing(cursor,line)||(context.maybeInsertedBrackets=0),context.maybeInsertedRow=cursor.row,context.maybeInsertedLineStart=line.substr(0,cursor.column)+bracket,context.maybeInsertedLineEnd=line.substr(cursor.column),context.maybeInsertedBrackets++},CstyleBehaviour.isAutoInsertedClosing=function(cursor,line,bracket){return context.autoInsertedBrackets>0&&cursor.row===context.autoInsertedRow&&bracket===context.autoInsertedLineEnd[0]&&line.substr(cursor.column)===context.autoInsertedLineEnd},CstyleBehaviour.isMaybeInsertedClosing=function(cursor,line){return context.maybeInsertedBrackets>0&&cursor.row===context.maybeInsertedRow&&line.substr(cursor.column)===context.maybeInsertedLineEnd&&line.substr(0,cursor.column)==context.maybeInsertedLineStart},CstyleBehaviour.popAutoInsertedClosing=function(){context.autoInsertedLineEnd=context.autoInsertedLineEnd.substr(1),context.autoInsertedBrackets--},CstyleBehaviour.clearMaybeInsertedClosing=function(){context&&(context.maybeInsertedBrackets=0,context.maybeInsertedRow=-1)},oop.inherits(CstyleBehaviour,Behaviour),exports.CstyleBehaviour=CstyleBehaviour}),ace.define("ace/unicode",["require","exports","module"],function(require,exports,module){"use strict";function addUnicodePackage(pack){var codePoint=/\w{4}/g;for(var name in pack)exports.packages[name]=pack[name].replace(codePoint,"\\u$&")}exports.packages={},addUnicodePackage({L:"0041-005A0061-007A00AA00B500BA00C0-00D600D8-00F600F8-02C102C6-02D102E0-02E402EC02EE0370-037403760377037A-037D03860388-038A038C038E-03A103A3-03F503F7-0481048A-05250531-055605590561-058705D0-05EA05F0-05F20621-064A066E066F0671-06D306D506E506E606EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA07F407F507FA0800-0815081A082408280904-0939093D09500958-0961097109720979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10D05-0D0C0D0E-0D100D12-0D280D2A-0D390D3D0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E460E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EC60EDC0EDD0F000F40-0F470F49-0F6C0F88-0F8B1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10A0-10C510D0-10FA10FC1100-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317D717DC1820-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541AA71B05-1B331B45-1B4B1B83-1BA01BAE1BAF1C00-1C231C4D-1C4F1C5A-1C7D1CE9-1CEC1CEE-1CF11D00-1DBF1E00-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FBC1FBE1FC2-1FC41FC6-1FCC1FD0-1FD31FD6-1FDB1FE0-1FEC1FF2-1FF41FF6-1FFC2071207F2090-209421022107210A-211321152119-211D212421262128212A-212D212F-2139213C-213F2145-2149214E218321842C00-2C2E2C30-2C5E2C60-2CE42CEB-2CEE2D00-2D252D30-2D652D6F2D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE2E2F300530063031-3035303B303C3041-3096309D-309F30A1-30FA30FC-30FF3105-312D3131-318E31A0-31B731F0-31FF3400-4DB54E00-9FCBA000-A48CA4D0-A4FDA500-A60CA610-A61FA62AA62BA640-A65FA662-A66EA67F-A697A6A0-A6E5A717-A71FA722-A788A78BA78CA7FB-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2A9CFAA00-AA28AA40-AA42AA44-AA4BAA60-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADB-AADDABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA2DFA30-FA6DFA70-FAD9FB00-FB06FB13-FB17FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF21-FF3AFF41-FF5AFF66-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",Ll:"0061-007A00AA00B500BA00DF-00F600F8-00FF01010103010501070109010B010D010F01110113011501170119011B011D011F01210123012501270129012B012D012F01310133013501370138013A013C013E014001420144014601480149014B014D014F01510153015501570159015B015D015F01610163016501670169016B016D016F0171017301750177017A017C017E-0180018301850188018C018D019201950199-019B019E01A101A301A501A801AA01AB01AD01B001B401B601B901BA01BD-01BF01C601C901CC01CE01D001D201D401D601D801DA01DC01DD01DF01E101E301E501E701E901EB01ED01EF01F001F301F501F901FB01FD01FF02010203020502070209020B020D020F02110213021502170219021B021D021F02210223022502270229022B022D022F02310233-0239023C023F0240024202470249024B024D024F-02930295-02AF037103730377037B-037D039003AC-03CE03D003D103D5-03D703D903DB03DD03DF03E103E303E503E703E903EB03ED03EF-03F303F503F803FB03FC0430-045F04610463046504670469046B046D046F04710473047504770479047B047D047F0481048B048D048F04910493049504970499049B049D049F04A104A304A504A704A904AB04AD04AF04B104B304B504B704B904BB04BD04BF04C204C404C604C804CA04CC04CE04CF04D104D304D504D704D904DB04DD04DF04E104E304E504E704E904EB04ED04EF04F104F304F504F704F904FB04FD04FF05010503050505070509050B050D050F05110513051505170519051B051D051F0521052305250561-05871D00-1D2B1D62-1D771D79-1D9A1E011E031E051E071E091E0B1E0D1E0F1E111E131E151E171E191E1B1E1D1E1F1E211E231E251E271E291E2B1E2D1E2F1E311E331E351E371E391E3B1E3D1E3F1E411E431E451E471E491E4B1E4D1E4F1E511E531E551E571E591E5B1E5D1E5F1E611E631E651E671E691E6B1E6D1E6F1E711E731E751E771E791E7B1E7D1E7F1E811E831E851E871E891E8B1E8D1E8F1E911E931E95-1E9D1E9F1EA11EA31EA51EA71EA91EAB1EAD1EAF1EB11EB31EB51EB71EB91EBB1EBD1EBF1EC11EC31EC51EC71EC91ECB1ECD1ECF1ED11ED31ED51ED71ED91EDB1EDD1EDF1EE11EE31EE51EE71EE91EEB1EED1EEF1EF11EF31EF51EF71EF91EFB1EFD1EFF-1F071F10-1F151F20-1F271F30-1F371F40-1F451F50-1F571F60-1F671F70-1F7D1F80-1F871F90-1F971FA0-1FA71FB0-1FB41FB61FB71FBE1FC2-1FC41FC61FC71FD0-1FD31FD61FD71FE0-1FE71FF2-1FF41FF61FF7210A210E210F2113212F21342139213C213D2146-2149214E21842C30-2C5E2C612C652C662C682C6A2C6C2C712C732C742C76-2C7C2C812C832C852C872C892C8B2C8D2C8F2C912C932C952C972C992C9B2C9D2C9F2CA12CA32CA52CA72CA92CAB2CAD2CAF2CB12CB32CB52CB72CB92CBB2CBD2CBF2CC12CC32CC52CC72CC92CCB2CCD2CCF2CD12CD32CD52CD72CD92CDB2CDD2CDF2CE12CE32CE42CEC2CEE2D00-2D25A641A643A645A647A649A64BA64DA64FA651A653A655A657A659A65BA65DA65FA663A665A667A669A66BA66DA681A683A685A687A689A68BA68DA68FA691A693A695A697A723A725A727A729A72BA72DA72F-A731A733A735A737A739A73BA73DA73FA741A743A745A747A749A74BA74DA74FA751A753A755A757A759A75BA75DA75FA761A763A765A767A769A76BA76DA76FA771-A778A77AA77CA77FA781A783A785A787A78CFB00-FB06FB13-FB17FF41-FF5A",Lu:"0041-005A00C0-00D600D8-00DE01000102010401060108010A010C010E01100112011401160118011A011C011E01200122012401260128012A012C012E01300132013401360139013B013D013F0141014301450147014A014C014E01500152015401560158015A015C015E01600162016401660168016A016C016E017001720174017601780179017B017D018101820184018601870189-018B018E-0191019301940196-0198019C019D019F01A001A201A401A601A701A901AC01AE01AF01B1-01B301B501B701B801BC01C401C701CA01CD01CF01D101D301D501D701D901DB01DE01E001E201E401E601E801EA01EC01EE01F101F401F6-01F801FA01FC01FE02000202020402060208020A020C020E02100212021402160218021A021C021E02200222022402260228022A022C022E02300232023A023B023D023E02410243-02460248024A024C024E03700372037603860388-038A038C038E038F0391-03A103A3-03AB03CF03D2-03D403D803DA03DC03DE03E003E203E403E603E803EA03EC03EE03F403F703F903FA03FD-042F04600462046404660468046A046C046E04700472047404760478047A047C047E0480048A048C048E04900492049404960498049A049C049E04A004A204A404A604A804AA04AC04AE04B004B204B404B604B804BA04BC04BE04C004C104C304C504C704C904CB04CD04D004D204D404D604D804DA04DC04DE04E004E204E404E604E804EA04EC04EE04F004F204F404F604F804FA04FC04FE05000502050405060508050A050C050E05100512051405160518051A051C051E0520052205240531-055610A0-10C51E001E021E041E061E081E0A1E0C1E0E1E101E121E141E161E181E1A1E1C1E1E1E201E221E241E261E281E2A1E2C1E2E1E301E321E341E361E381E3A1E3C1E3E1E401E421E441E461E481E4A1E4C1E4E1E501E521E541E561E581E5A1E5C1E5E1E601E621E641E661E681E6A1E6C1E6E1E701E721E741E761E781E7A1E7C1E7E1E801E821E841E861E881E8A1E8C1E8E1E901E921E941E9E1EA01EA21EA41EA61EA81EAA1EAC1EAE1EB01EB21EB41EB61EB81EBA1EBC1EBE1EC01EC21EC41EC61EC81ECA1ECC1ECE1ED01ED21ED41ED61ED81EDA1EDC1EDE1EE01EE21EE41EE61EE81EEA1EEC1EEE1EF01EF21EF41EF61EF81EFA1EFC1EFE1F08-1F0F1F18-1F1D1F28-1F2F1F38-1F3F1F48-1F4D1F591F5B1F5D1F5F1F68-1F6F1FB8-1FBB1FC8-1FCB1FD8-1FDB1FE8-1FEC1FF8-1FFB21022107210B-210D2110-211221152119-211D212421262128212A-212D2130-2133213E213F214521832C00-2C2E2C602C62-2C642C672C692C6B2C6D-2C702C722C752C7E-2C802C822C842C862C882C8A2C8C2C8E2C902C922C942C962C982C9A2C9C2C9E2CA02CA22CA42CA62CA82CAA2CAC2CAE2CB02CB22CB42CB62CB82CBA2CBC2CBE2CC02CC22CC42CC62CC82CCA2CCC2CCE2CD02CD22CD42CD62CD82CDA2CDC2CDE2CE02CE22CEB2CEDA640A642A644A646A648A64AA64CA64EA650A652A654A656A658A65AA65CA65EA662A664A666A668A66AA66CA680A682A684A686A688A68AA68CA68EA690A692A694A696A722A724A726A728A72AA72CA72EA732A734A736A738A73AA73CA73EA740A742A744A746A748A74AA74CA74EA750A752A754A756A758A75AA75CA75EA760A762A764A766A768A76AA76CA76EA779A77BA77DA77EA780A782A784A786A78BFF21-FF3A",Lt:"01C501C801CB01F21F88-1F8F1F98-1F9F1FA8-1FAF1FBC1FCC1FFC",Lm:"02B0-02C102C6-02D102E0-02E402EC02EE0374037A0559064006E506E607F407F507FA081A0824082809710E460EC610FC17D718431AA71C78-1C7D1D2C-1D611D781D9B-1DBF2071207F2090-20942C7D2D6F2E2F30053031-3035303B309D309E30FC-30FEA015A4F8-A4FDA60CA67FA717-A71FA770A788A9CFAA70AADDFF70FF9EFF9F",Lo:"01BB01C0-01C3029405D0-05EA05F0-05F20621-063F0641-064A066E066F0671-06D306D506EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA0800-08150904-0939093D09500958-096109720979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10D05-0D0C0D0E-0D100D12-0D280D2A-0D390D3D0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E450E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EDC0EDD0F000F40-0F470F49-0F6C0F88-0F8B1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10D0-10FA1100-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317DC1820-18421844-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541B05-1B331B45-1B4B1B83-1BA01BAE1BAF1C00-1C231C4D-1C4F1C5A-1C771CE9-1CEC1CEE-1CF12135-21382D30-2D652D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE3006303C3041-3096309F30A1-30FA30FF3105-312D3131-318E31A0-31B731F0-31FF3400-4DB54E00-9FCBA000-A014A016-A48CA4D0-A4F7A500-A60BA610-A61FA62AA62BA66EA6A0-A6E5A7FB-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2AA00-AA28AA40-AA42AA44-AA4BAA60-AA6FAA71-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADBAADCABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA2DFA30-FA6DFA70-FAD9FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF66-FF6FFF71-FF9DFFA0-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",M:"0300-036F0483-04890591-05BD05BF05C105C205C405C505C70610-061A064B-065E067006D6-06DC06DE-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0900-0903093C093E-094E0951-0955096209630981-098309BC09BE-09C409C709C809CB-09CD09D709E209E30A01-0A030A3C0A3E-0A420A470A480A4B-0A4D0A510A700A710A750A81-0A830ABC0ABE-0AC50AC7-0AC90ACB-0ACD0AE20AE30B01-0B030B3C0B3E-0B440B470B480B4B-0B4D0B560B570B620B630B820BBE-0BC20BC6-0BC80BCA-0BCD0BD70C01-0C030C3E-0C440C46-0C480C4A-0C4D0C550C560C620C630C820C830CBC0CBE-0CC40CC6-0CC80CCA-0CCD0CD50CD60CE20CE30D020D030D3E-0D440D46-0D480D4A-0D4D0D570D620D630D820D830DCA0DCF-0DD40DD60DD8-0DDF0DF20DF30E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F3E0F3F0F71-0F840F860F870F90-0F970F99-0FBC0FC6102B-103E1056-1059105E-10601062-10641067-106D1071-10741082-108D108F109A-109D135F1712-17141732-1734175217531772177317B6-17D317DD180B-180D18A91920-192B1930-193B19B0-19C019C819C91A17-1A1B1A55-1A5E1A60-1A7C1A7F1B00-1B041B34-1B441B6B-1B731B80-1B821BA1-1BAA1C24-1C371CD0-1CD21CD4-1CE81CED1CF21DC0-1DE61DFD-1DFF20D0-20F02CEF-2CF12DE0-2DFF302A-302F3099309AA66F-A672A67CA67DA6F0A6F1A802A806A80BA823-A827A880A881A8B4-A8C4A8E0-A8F1A926-A92DA947-A953A980-A983A9B3-A9C0AA29-AA36AA43AA4CAA4DAA7BAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1ABE3-ABEAABECABEDFB1EFE00-FE0FFE20-FE26",Mn:"0300-036F0483-04870591-05BD05BF05C105C205C405C505C70610-061A064B-065E067006D6-06DC06DF-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0900-0902093C0941-0948094D0951-095509620963098109BC09C1-09C409CD09E209E30A010A020A3C0A410A420A470A480A4B-0A4D0A510A700A710A750A810A820ABC0AC1-0AC50AC70AC80ACD0AE20AE30B010B3C0B3F0B41-0B440B4D0B560B620B630B820BC00BCD0C3E-0C400C46-0C480C4A-0C4D0C550C560C620C630CBC0CBF0CC60CCC0CCD0CE20CE30D41-0D440D4D0D620D630DCA0DD2-0DD40DD60E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F71-0F7E0F80-0F840F860F870F90-0F970F99-0FBC0FC6102D-10301032-10371039103A103D103E10581059105E-10601071-1074108210851086108D109D135F1712-17141732-1734175217531772177317B7-17BD17C617C9-17D317DD180B-180D18A91920-19221927192819321939-193B1A171A181A561A58-1A5E1A601A621A65-1A6C1A73-1A7C1A7F1B00-1B031B341B36-1B3A1B3C1B421B6B-1B731B801B811BA2-1BA51BA81BA91C2C-1C331C361C371CD0-1CD21CD4-1CE01CE2-1CE81CED1DC0-1DE61DFD-1DFF20D0-20DC20E120E5-20F02CEF-2CF12DE0-2DFF302A-302F3099309AA66FA67CA67DA6F0A6F1A802A806A80BA825A826A8C4A8E0-A8F1A926-A92DA947-A951A980-A982A9B3A9B6-A9B9A9BCAA29-AA2EAA31AA32AA35AA36AA43AA4CAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1ABE5ABE8ABEDFB1EFE00-FE0FFE20-FE26",Mc:"0903093E-09400949-094C094E0982098309BE-09C009C709C809CB09CC09D70A030A3E-0A400A830ABE-0AC00AC90ACB0ACC0B020B030B3E0B400B470B480B4B0B4C0B570BBE0BBF0BC10BC20BC6-0BC80BCA-0BCC0BD70C01-0C030C41-0C440C820C830CBE0CC0-0CC40CC70CC80CCA0CCB0CD50CD60D020D030D3E-0D400D46-0D480D4A-0D4C0D570D820D830DCF-0DD10DD8-0DDF0DF20DF30F3E0F3F0F7F102B102C10311038103B103C105610571062-10641067-106D108310841087-108C108F109A-109C17B617BE-17C517C717C81923-19261929-192B193019311933-193819B0-19C019C819C91A19-1A1B1A551A571A611A631A641A6D-1A721B041B351B3B1B3D-1B411B431B441B821BA11BA61BA71BAA1C24-1C2B1C341C351CE11CF2A823A824A827A880A881A8B4-A8C3A952A953A983A9B4A9B5A9BAA9BBA9BD-A9C0AA2FAA30AA33AA34AA4DAA7BABE3ABE4ABE6ABE7ABE9ABEAABEC",Me:"0488048906DE20DD-20E020E2-20E4A670-A672",N:"0030-003900B200B300B900BC-00BE0660-066906F0-06F907C0-07C90966-096F09E6-09EF09F4-09F90A66-0A6F0AE6-0AEF0B66-0B6F0BE6-0BF20C66-0C6F0C78-0C7E0CE6-0CEF0D66-0D750E50-0E590ED0-0ED90F20-0F331040-10491090-10991369-137C16EE-16F017E0-17E917F0-17F91810-18191946-194F19D0-19DA1A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C5920702074-20792080-20892150-21822185-21892460-249B24EA-24FF2776-27932CFD30073021-30293038-303A3192-31953220-32293251-325F3280-328932B1-32BFA620-A629A6E6-A6EFA830-A835A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",Nd:"0030-00390660-066906F0-06F907C0-07C90966-096F09E6-09EF0A66-0A6F0AE6-0AEF0B66-0B6F0BE6-0BEF0C66-0C6F0CE6-0CEF0D66-0D6F0E50-0E590ED0-0ED90F20-0F291040-10491090-109917E0-17E91810-18191946-194F19D0-19DA1A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C59A620-A629A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",Nl:"16EE-16F02160-21822185-218830073021-30293038-303AA6E6-A6EF",No:"00B200B300B900BC-00BE09F4-09F90BF0-0BF20C78-0C7E0D70-0D750F2A-0F331369-137C17F0-17F920702074-20792080-20892150-215F21892460-249B24EA-24FF2776-27932CFD3192-31953220-32293251-325F3280-328932B1-32BFA830-A835",P:"0021-00230025-002A002C-002F003A003B003F0040005B-005D005F007B007D00A100AB00B700BB00BF037E0387055A-055F0589058A05BE05C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E0964096509700DF40E4F0E5A0E5B0F04-0F120F3A-0F3D0F850FD0-0FD4104A-104F10FB1361-13681400166D166E169B169C16EB-16ED1735173617D4-17D617D8-17DA1800-180A1944194519DE19DF1A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601C3B-1C3F1C7E1C7F1CD32010-20272030-20432045-20512053-205E207D207E208D208E2329232A2768-277527C527C627E6-27EF2983-299829D8-29DB29FC29FD2CF9-2CFC2CFE2CFF2E00-2E2E2E302E313001-30033008-30113014-301F3030303D30A030FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFABEBFD3EFD3FFE10-FE19FE30-FE52FE54-FE61FE63FE68FE6AFE6BFF01-FF03FF05-FF0AFF0C-FF0FFF1AFF1BFF1FFF20FF3B-FF3DFF3FFF5BFF5DFF5F-FF65",Pd:"002D058A05BE140018062010-20152E172E1A301C303030A0FE31FE32FE58FE63FF0D",Ps:"0028005B007B0F3A0F3C169B201A201E2045207D208D23292768276A276C276E27702772277427C527E627E827EA27EC27EE2983298529872989298B298D298F299129932995299729D829DA29FC2E222E242E262E283008300A300C300E3010301430163018301A301DFD3EFE17FE35FE37FE39FE3BFE3DFE3FFE41FE43FE47FE59FE5BFE5DFF08FF3BFF5BFF5FFF62",Pe:"0029005D007D0F3B0F3D169C2046207E208E232A2769276B276D276F27712773277527C627E727E927EB27ED27EF298429862988298A298C298E2990299229942996299829D929DB29FD2E232E252E272E293009300B300D300F3011301530173019301B301E301FFD3FFE18FE36FE38FE3AFE3CFE3EFE40FE42FE44FE48FE5AFE5CFE5EFF09FF3DFF5DFF60FF63",
Pi:"00AB2018201B201C201F20392E022E042E092E0C2E1C2E20",Pf:"00BB2019201D203A2E032E052E0A2E0D2E1D2E21",Pc:"005F203F20402054FE33FE34FE4D-FE4FFF3F",Po:"0021-00230025-0027002A002C002E002F003A003B003F0040005C00A100B700BF037E0387055A-055F058905C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E0964096509700DF40E4F0E5A0E5B0F04-0F120F850FD0-0FD4104A-104F10FB1361-1368166D166E16EB-16ED1735173617D4-17D617D8-17DA1800-18051807-180A1944194519DE19DF1A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601C3B-1C3F1C7E1C7F1CD3201620172020-20272030-2038203B-203E2041-20432047-205120532055-205E2CF9-2CFC2CFE2CFF2E002E012E06-2E082E0B2E0E-2E162E182E192E1B2E1E2E1F2E2A-2E2E2E302E313001-3003303D30FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFABEBFE10-FE16FE19FE30FE45FE46FE49-FE4CFE50-FE52FE54-FE57FE5F-FE61FE68FE6AFE6BFF01-FF03FF05-FF07FF0AFF0CFF0EFF0FFF1AFF1BFF1FFF20FF3CFF61FF64FF65",S:"0024002B003C-003E005E0060007C007E00A2-00A900AC00AE-00B100B400B600B800D700F702C2-02C502D2-02DF02E5-02EB02ED02EF-02FF03750384038503F604820606-0608060B060E060F06E906FD06FE07F609F209F309FA09FB0AF10B700BF3-0BFA0C7F0CF10CF20D790E3F0F01-0F030F13-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F13601390-139917DB194019E0-19FF1B61-1B6A1B74-1B7C1FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE20442052207A-207C208A-208C20A0-20B8210021012103-21062108210921142116-2118211E-2123212521272129212E213A213B2140-2144214A-214D214F2190-2328232B-23E82400-24262440-244A249C-24E92500-26CD26CF-26E126E326E8-26FF2701-27042706-2709270C-27272729-274B274D274F-27522756-275E2761-276727942798-27AF27B1-27BE27C0-27C427C7-27CA27CC27D0-27E527F0-29822999-29D729DC-29FB29FE-2B4C2B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F309B309C319031913196-319F31C0-31E33200-321E322A-32503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A700-A716A720A721A789A78AA828-A82BA836-A839AA77-AA79FB29FDFCFDFDFE62FE64-FE66FE69FF04FF0BFF1C-FF1EFF3EFF40FF5CFF5EFFE0-FFE6FFE8-FFEEFFFCFFFD",Sm:"002B003C-003E007C007E00AC00B100D700F703F60606-060820442052207A-207C208A-208C2140-2144214B2190-2194219A219B21A021A321A621AE21CE21CF21D221D421F4-22FF2308-230B23202321237C239B-23B323DC-23E125B725C125F8-25FF266F27C0-27C427C7-27CA27CC27D0-27E527F0-27FF2900-29822999-29D729DC-29FB29FE-2AFF2B30-2B442B47-2B4CFB29FE62FE64-FE66FF0BFF1C-FF1EFF5CFF5EFFE2FFE9-FFEC",Sc:"002400A2-00A5060B09F209F309FB0AF10BF90E3F17DB20A0-20B8A838FDFCFE69FF04FFE0FFE1FFE5FFE6",Sk:"005E006000A800AF00B400B802C2-02C502D2-02DF02E5-02EB02ED02EF-02FF0375038403851FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE309B309CA700-A716A720A721A789A78AFF3EFF40FFE3",So:"00A600A700A900AE00B000B60482060E060F06E906FD06FE07F609FA0B700BF3-0BF80BFA0C7F0CF10CF20D790F01-0F030F13-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F13601390-1399194019E0-19FF1B61-1B6A1B74-1B7C210021012103-21062108210921142116-2118211E-2123212521272129212E213A213B214A214C214D214F2195-2199219C-219F21A121A221A421A521A7-21AD21AF-21CD21D021D121D321D5-21F32300-2307230C-231F2322-2328232B-237B237D-239A23B4-23DB23E2-23E82400-24262440-244A249C-24E92500-25B625B8-25C025C2-25F72600-266E2670-26CD26CF-26E126E326E8-26FF2701-27042706-2709270C-27272729-274B274D274F-27522756-275E2761-276727942798-27AF27B1-27BE2800-28FF2B00-2B2F2B452B462B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F319031913196-319F31C0-31E33200-321E322A-32503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A828-A82BA836A837A839AA77-AA79FDFDFFE4FFE8FFEDFFEEFFFCFFFD",Z:"002000A01680180E2000-200A20282029202F205F3000",Zs:"002000A01680180E2000-200A202F205F3000",Zl:"2028",Zp:"2029",C:"0000-001F007F-009F00AD03780379037F-0383038B038D03A20526-05300557055805600588058B-059005C8-05CF05EB-05EF05F5-0605061C061D0620065F06DD070E070F074B074C07B2-07BF07FB-07FF082E082F083F-08FF093A093B094F095609570973-097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF00AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B72-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D290D3A-0D3C0D450D490D4E-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EDE-0EFF0F480F6D-0F700F8C-0F8F0F980FBD0FCD0FD9-0FFF10C6-10CF10FD-10FF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B-135E137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17B417B517DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BAB-1BAD1BBA-1BFF1C38-1C3A1C4A-1C4C1C80-1CCF1CF3-1CFF1DE7-1DFC1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF200B-200F202A-202E2060-206F20722073208F2095-209F20B9-20CF20F1-20FF218A-218F23E9-23FF2427-243F244B-245F26CE26E226E4-26E727002705270A270B2728274C274E2753-2755275F27602795-279727B027BF27CB27CD-27CF2B4D-2B4F2B5A-2BFF2C2F2C5F2CF2-2CF82D26-2D2F2D66-2D6E2D70-2D7F2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E32-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31B8-31BF31E4-31EF321F32FF4DB6-4DBF9FCC-9FFFA48D-A48FA4C7-A4CFA62C-A63FA660A661A674-A67BA698-A69FA6F8-A6FFA78D-A7FAA82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAE0-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-F8FFFA2EFA2FFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBB2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFD-FF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFFBFFFEFFFF",Cc:"0000-001F007F-009F",Cf:"00AD0600-060306DD070F17B417B5200B-200F202A-202E2060-2064206A-206FFEFFFFF9-FFFB",Co:"E000-F8FF",Cs:"D800-DFFF",Cn:"03780379037F-0383038B038D03A20526-05300557055805600588058B-059005C8-05CF05EB-05EF05F5-05FF06040605061C061D0620065F070E074B074C07B2-07BF07FB-07FF082E082F083F-08FF093A093B094F095609570973-097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF00AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B72-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D290D3A-0D3C0D450D490D4E-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EDE-0EFF0F480F6D-0F700F8C-0F8F0F980FBD0FCD0FD9-0FFF10C6-10CF10FD-10FF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B-135E137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BAB-1BAD1BBA-1BFF1C38-1C3A1C4A-1C4C1C80-1CCF1CF3-1CFF1DE7-1DFC1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF2065-206920722073208F2095-209F20B9-20CF20F1-20FF218A-218F23E9-23FF2427-243F244B-245F26CE26E226E4-26E727002705270A270B2728274C274E2753-2755275F27602795-279727B027BF27CB27CD-27CF2B4D-2B4F2B5A-2BFF2C2F2C5F2CF2-2CF82D26-2D2F2D66-2D6E2D70-2D7F2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E32-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31B8-31BF31E4-31EF321F32FF4DB6-4DBF9FCC-9FFFA48D-A48FA4C7-A4CFA62C-A63FA660A661A674-A67BA698-A69FA6F8-A6FFA78D-A7FAA82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAE0-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-D7FFFA2EFA2FFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBB2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFDFEFEFF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFF8FFFEFFFF"})}),ace.define("ace/mode/text",["require","exports","module","ace/tokenizer","ace/mode/text_highlight_rules","ace/mode/behaviour/cstyle","ace/unicode","ace/lib/lang","ace/token_iterator","ace/range"],function(require,exports,module){"use strict";var Tokenizer=require("../tokenizer").Tokenizer,TextHighlightRules=require("./text_highlight_rules").TextHighlightRules,CstyleBehaviour=require("./behaviour/cstyle").CstyleBehaviour,unicode=require("../unicode"),lang=require("../lib/lang"),TokenIterator=require("../token_iterator").TokenIterator,Range=require("../range").Range,Mode=function(){this.HighlightRules=TextHighlightRules};(function(){this.$behaviour=new CstyleBehaviour,this.tokenRe=new RegExp("^["+unicode.packages.L+unicode.packages.Mn+unicode.packages.Mc+unicode.packages.Nd+unicode.packages.Pc+"\\$_]+","g"),this.nonTokenRe=new RegExp("^(?:[^"+unicode.packages.L+unicode.packages.Mn+unicode.packages.Mc+unicode.packages.Nd+unicode.packages.Pc+"\\$_]|\\s])+","g"),this.getTokenizer=function(){return this.$tokenizer||(this.$highlightRules=this.$highlightRules||new this.HighlightRules(this.$highlightRuleConfig),this.$tokenizer=new Tokenizer(this.$highlightRules.getRules())),this.$tokenizer},this.lineCommentStart="",this.blockComment="",this.toggleCommentLines=function(state,session,startRow,endRow){function iter(fun){for(var i=startRow;endRow>=i;i++)fun(doc.getLine(i),i)}var doc=session.doc,ignoreBlankLines=!0,shouldRemove=!0,minIndent=1/0,tabSize=session.getTabSize(),insertAtTabStop=!1;if(this.lineCommentStart){if(Array.isArray(this.lineCommentStart))var regexpStart=this.lineCommentStart.map(lang.escapeRegExp).join("|"),lineCommentStart=this.lineCommentStart[0];else var regexpStart=lang.escapeRegExp(this.lineCommentStart),lineCommentStart=this.lineCommentStart;regexpStart=new RegExp("^(\\s*)(?:"+regexpStart+") ?"),insertAtTabStop=session.getUseSoftTabs();var uncomment=function(line,i){var m=line.match(regexpStart);if(m){var start=m[1].length,end=m[0].length;shouldInsertSpace(line,start,end)||" "!=m[0][end-1]||end--,doc.removeInLine(i,start,end)}},commentWithSpace=lineCommentStart+" ",comment=function(line,i){(!ignoreBlankLines||/\S/.test(line))&&(shouldInsertSpace(line,minIndent,minIndent)?doc.insertInLine({row:i,column:minIndent},commentWithSpace):doc.insertInLine({row:i,column:minIndent},lineCommentStart))},testRemove=function(line,i){return regexpStart.test(line)},shouldInsertSpace=function(line,before,after){for(var spaces=0;before--&&" "==line.charAt(before);)spaces++;if(spaces%tabSize!=0)return!1;for(var spaces=0;" "==line.charAt(after++);)spaces++;return tabSize>2?spaces%tabSize!=tabSize-1:spaces%tabSize==0}}else{if(!this.blockComment)return!1;var lineCommentStart=this.blockComment.start,lineCommentEnd=this.blockComment.end,regexpStart=new RegExp("^(\\s*)(?:"+lang.escapeRegExp(lineCommentStart)+")"),regexpEnd=new RegExp("(?:"+lang.escapeRegExp(lineCommentEnd)+")\\s*$"),comment=function(line,i){testRemove(line,i)||(!ignoreBlankLines||/\S/.test(line))&&(doc.insertInLine({row:i,column:line.length},lineCommentEnd),doc.insertInLine({row:i,column:minIndent},lineCommentStart))},uncomment=function(line,i){var m;(m=line.match(regexpEnd))&&doc.removeInLine(i,line.length-m[0].length,line.length),(m=line.match(regexpStart))&&doc.removeInLine(i,m[1].length,m[0].length)},testRemove=function(line,row){if(regexpStart.test(line))return!0;for(var tokens=session.getTokens(row),i=0;i<tokens.length;i++)if("comment"===tokens[i].type)return!0}}var minEmptyLength=1/0;iter(function(line,i){var indent=line.search(/\S/);-1!==indent?(minIndent>indent&&(minIndent=indent),shouldRemove&&!testRemove(line,i)&&(shouldRemove=!1)):minEmptyLength>line.length&&(minEmptyLength=line.length)}),minIndent==1/0&&(minIndent=minEmptyLength,ignoreBlankLines=!1,shouldRemove=!1),insertAtTabStop&&minIndent%tabSize!=0&&(minIndent=Math.floor(minIndent/tabSize)*tabSize),iter(shouldRemove?uncomment:comment)},this.toggleBlockComment=function(state,session,range,cursor){var comment=this.blockComment;if(comment){!comment.start&&comment[0]&&(comment=comment[0]);var startRow,colDiff,iterator=new TokenIterator(session,cursor.row,cursor.column),token=iterator.getCurrentToken(),initialRange=(session.selection,session.selection.toOrientedRange());if(token&&/comment/.test(token.type)){for(var startRange,endRange;token&&/comment/.test(token.type);){var i=token.value.indexOf(comment.start);if(-1!=i){var row=iterator.getCurrentTokenRow(),column=iterator.getCurrentTokenColumn()+i;startRange=new Range(row,column,row,column+comment.start.length);break}token=iterator.stepBackward()}for(var iterator=new TokenIterator(session,cursor.row,cursor.column),token=iterator.getCurrentToken();token&&/comment/.test(token.type);){var i=token.value.indexOf(comment.end);if(-1!=i){var row=iterator.getCurrentTokenRow(),column=iterator.getCurrentTokenColumn()+i;endRange=new Range(row,column,row,column+comment.end.length);break}token=iterator.stepForward()}endRange&&session.remove(endRange),startRange&&(session.remove(startRange),startRow=startRange.start.row,colDiff=-comment.start.length)}else colDiff=comment.start.length,startRow=range.start.row,session.insert(range.end,comment.end),session.insert(range.start,comment.start);initialRange.start.row==startRow&&(initialRange.start.column+=colDiff),initialRange.end.row==startRow&&(initialRange.end.column+=colDiff),session.selection.fromOrientedRange(initialRange)}},this.getNextLineIndent=function(state,line,tab){return this.$getIndent(line)},this.checkOutdent=function(state,line,input){return!1},this.autoOutdent=function(state,doc,row){},this.$getIndent=function(line){return line.match(/^\s*/)[0]},this.createWorker=function(session){return null},this.createModeDelegates=function(mapping){this.$embeds=[],this.$modes={};for(var i in mapping)mapping[i]&&(this.$embeds.push(i),this.$modes[i]=new mapping[i]);for(var delegations=["toggleBlockComment","toggleCommentLines","getNextLineIndent","checkOutdent","autoOutdent","transformAction","getCompletions"],i=0;i<delegations.length;i++)!function(scope){var functionName=delegations[i],defaultHandler=scope[functionName];scope[delegations[i]]=function(){return this.$delegator(functionName,arguments,defaultHandler)}}(this)},this.$delegator=function(method,args,defaultHandler){var state=args[0];"string"!=typeof state&&(state=state[0]);for(var i=0;i<this.$embeds.length;i++)if(this.$modes[this.$embeds[i]]){var split=state.split(this.$embeds[i]);if(!split[0]&&split[1]){args[0]=split[1];var mode=this.$modes[this.$embeds[i]];return mode[method].apply(mode,args)}}var ret=defaultHandler.apply(this,args);return defaultHandler?ret:void 0},this.transformAction=function(state,action,editor,session,param){if(this.$behaviour){var behaviours=this.$behaviour.getBehaviours();for(var key in behaviours)if(behaviours[key][action]){var ret=behaviours[key][action].apply(this,arguments);if(ret)return ret}}},this.getKeywords=function(append){if(!this.completionKeywords){var rules=this.$tokenizer.rules,completionKeywords=[];for(var rule in rules)for(var ruleItr=rules[rule],r=0,l=ruleItr.length;l>r;r++)if("string"==typeof ruleItr[r].token)/keyword|support|storage/.test(ruleItr[r].token)&&completionKeywords.push(ruleItr[r].regex);else if("object"==typeof ruleItr[r].token)for(var a=0,aLength=ruleItr[r].token.length;aLength>a;a++)if(/keyword|support|storage/.test(ruleItr[r].token[a])){var rule=ruleItr[r].regex.match(/\(.+?\)/g)[a];completionKeywords.push(rule.substr(1,rule.length-2))}this.completionKeywords=completionKeywords}return append?completionKeywords.concat(this.$keywordList||[]):this.$keywordList},this.$createKeywordList=function(){return this.$highlightRules||this.getTokenizer(),this.$keywordList=this.$highlightRules.$keywordList||[]},this.getCompletions=function(state,session,pos,prefix){var keywords=this.$keywordList||this.$createKeywordList();return keywords.map(function(word){return{name:word,value:word,score:0,meta:"keyword"}})},this.$id="ace/mode/text"}).call(Mode.prototype),exports.Mode=Mode}),ace.define("ace/apply_delta",["require","exports","module"],function(require,exports,module){"use strict";exports.applyDelta=function(docLines,delta,doNotValidate){var row=delta.start.row,startColumn=delta.start.column,line=docLines[row]||"";switch(delta.action){case"insert":var lines=delta.lines;if(1===lines.length)docLines[row]=line.substring(0,startColumn)+delta.lines[0]+line.substring(startColumn);else{var args=[row,1].concat(delta.lines);docLines.splice.apply(docLines,args),docLines[row]=line.substring(0,startColumn)+docLines[row],docLines[row+delta.lines.length-1]+=line.substring(startColumn)}break;case"remove":var endColumn=delta.end.column,endRow=delta.end.row;row===endRow?docLines[row]=line.substring(0,startColumn)+line.substring(endColumn):docLines.splice(row,endRow-row+1,line.substring(0,startColumn)+docLines[endRow].substring(endColumn))}}}),ace.define("ace/anchor",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(require,exports,module){"use strict";var oop=require("./lib/oop"),EventEmitter=require("./lib/event_emitter").EventEmitter,Anchor=exports.Anchor=function(doc,row,column){this.$onChange=this.onChange.bind(this),this.attach(doc),"undefined"==typeof column?this.setPosition(row.row,row.column):this.setPosition(row,column)};(function(){function $pointsInOrder(point1,point2,equalPointsInOrder){var bColIsAfter=equalPointsInOrder?point1.column<=point2.column:point1.column<point2.column;return point1.row<point2.row||point1.row==point2.row&&bColIsAfter}function $getTransformedPoint(delta,point,moveIfEqual){var deltaIsInsert="insert"==delta.action,deltaRowShift=(deltaIsInsert?1:-1)*(delta.end.row-delta.start.row),deltaColShift=(deltaIsInsert?1:-1)*(delta.end.column-delta.start.column),deltaStart=delta.start,deltaEnd=deltaIsInsert?deltaStart:delta.end;return $pointsInOrder(point,deltaStart,moveIfEqual)?{row:point.row,column:point.column}:$pointsInOrder(deltaEnd,point,!moveIfEqual)?{row:point.row+deltaRowShift,column:point.column+(point.row==deltaEnd.row?deltaColShift:0)}:{row:deltaStart.row,column:deltaStart.column}}oop.implement(this,EventEmitter),this.getPosition=function(){return this.$clipPositionToDocument(this.row,this.column)},this.getDocument=function(){return this.document},this.$insertRight=!1,this.onChange=function(delta){if(!(delta.start.row==delta.end.row&&delta.start.row!=this.row||delta.start.row>this.row)){var point=$getTransformedPoint(delta,{row:this.row,column:this.column},this.$insertRight);this.setPosition(point.row,point.column,!0)}},this.setPosition=function(row,column,noClip){var pos;if(pos=noClip?{row:row,column:column}:this.$clipPositionToDocument(row,column),this.row!=pos.row||this.column!=pos.column){var old={row:this.row,column:this.column};this.row=pos.row,this.column=pos.column,this._signal("change",{old:old,value:pos})}},this.detach=function(){this.document.removeEventListener("change",this.$onChange)},this.attach=function(doc){this.document=doc||this.document,this.document.on("change",this.$onChange)},this.$clipPositionToDocument=function(row,column){var pos={};return row>=this.document.getLength()?(pos.row=Math.max(0,this.document.getLength()-1),pos.column=this.document.getLine(pos.row).length):0>row?(pos.row=0,pos.column=0):(pos.row=row,pos.column=Math.min(this.document.getLine(pos.row).length,Math.max(0,column))),0>column&&(pos.column=0),pos}}).call(Anchor.prototype)}),ace.define("ace/document",["require","exports","module","ace/lib/oop","ace/apply_delta","ace/lib/event_emitter","ace/range","ace/anchor"],function(require,exports,module){"use strict";var oop=require("./lib/oop"),applyDelta=require("./apply_delta").applyDelta,EventEmitter=require("./lib/event_emitter").EventEmitter,Range=require("./range").Range,Anchor=require("./anchor").Anchor,Document=function(textOrLines){this.$lines=[""],0===textOrLines.length?this.$lines=[""]:Array.isArray(textOrLines)?this.insertMergedLines({row:0,column:0},textOrLines):this.insert({row:0,column:0},textOrLines)};(function(){oop.implement(this,EventEmitter),this.setValue=function(text){var len=this.getLength()-1;this.remove(new Range(0,0,len,this.getLine(len).length)),this.insert({row:0,column:0},text)},this.getValue=function(){return this.getAllLines().join(this.getNewLineCharacter())},this.createAnchor=function(row,column){return new Anchor(this,row,column)},0==="aaa".split(/a/).length?this.$split=function(text){return text.replace(/\r\n|\r/g,"\n").split("\n")}:this.$split=function(text){return text.split(/\r\n|\r|\n/)},this.$detectNewLine=function(text){var match=text.match(/^.*?(\r\n|\r|\n)/m);this.$autoNewLine=match?match[1]:"\n",this._signal("changeNewLineMode")},this.getNewLineCharacter=function(){switch(this.$newLineMode){case"windows":return"\r\n";case"unix":return"\n";default:return this.$autoNewLine||"\n"}},this.$autoNewLine="",this.$newLineMode="auto",this.setNewLineMode=function(newLineMode){this.$newLineMode!==newLineMode&&(this.$newLineMode=newLineMode,this._signal("changeNewLineMode"))},this.getNewLineMode=function(){return this.$newLineMode},this.isNewLine=function(text){return"\r\n"==text||"\r"==text||"\n"==text},this.getLine=function(row){return this.$lines[row]||""},this.getLines=function(firstRow,lastRow){return this.$lines.slice(firstRow,lastRow+1)},this.getAllLines=function(){return this.getLines(0,this.getLength())},this.getLength=function(){return this.$lines.length},this.getTextRange=function(range){return this.getLinesForRange(range).join(this.getNewLineCharacter())},this.getLinesForRange=function(range){var lines;if(range.start.row===range.end.row)lines=[this.getLine(range.start.row).substring(range.start.column,range.end.column)];else{lines=this.getLines(range.start.row,range.end.row),lines[0]=(lines[0]||"").substring(range.start.column);var l=lines.length-1;range.end.row-range.start.row==l&&(lines[l]=lines[l].substring(0,range.end.column))}return lines},this.insertLines=function(row,lines){return console.warn("Use of document.insertLines is deprecated. Use the insertFullLines method instead."),this.insertFullLines(row,lines)},this.removeLines=function(firstRow,lastRow){return console.warn("Use of document.removeLines is deprecated. Use the removeFullLines method instead."),this.removeFullLines(firstRow,lastRow)},this.insertNewLine=function(position){return console.warn("Use of document.insertNewLine is deprecated. Use insertMergedLines(position, ['', '']) instead."),this.insertMergedLines(position,["",""])},this.insert=function(position,text){return this.getLength()<=1&&this.$detectNewLine(text),this.insertMergedLines(position,this.$split(text))},this.insertInLine=function(position,text){var start=this.clippedPos(position.row,position.column),end=this.pos(position.row,position.column+text.length);return this.applyDelta({start:start,end:end,action:"insert",lines:[text]},!0),this.clonePos(end)},this.clippedPos=function(row,column){var length=this.getLength();void 0===row?row=length:0>row?row=0:row>=length&&(row=length-1,column=void 0);var line=this.getLine(row);return void 0==column&&(column=line.length),column=Math.min(Math.max(column,0),line.length),{row:row,column:column}},this.clonePos=function(pos){return{row:pos.row,column:pos.column}},this.pos=function(row,column){return{row:row,column:column}},this.$clipPosition=function(position){var length=this.getLength();return position.row>=length?(position.row=Math.max(0,length-1),position.column=this.getLine(length-1).length):(position.row=Math.max(0,position.row),position.column=Math.min(Math.max(position.column,0),this.getLine(position.row).length)),position},this.insertFullLines=function(row,lines){row=Math.min(Math.max(row,0),this.getLength());var column=0;row<this.getLength()?(lines=lines.concat([""]),column=0):(lines=[""].concat(lines),row--,column=this.$lines[row].length),this.insertMergedLines({row:row,column:column},lines)},this.insertMergedLines=function(position,lines){var start=this.clippedPos(position.row,position.column),end={row:start.row+lines.length-1,column:(1==lines.length?start.column:0)+lines[lines.length-1].length};return this.applyDelta({start:start,end:end,action:"insert",lines:lines}),this.clonePos(end)},this.remove=function(range){var start=this.clippedPos(range.start.row,range.start.column),end=this.clippedPos(range.end.row,range.end.column);return this.applyDelta({start:start,end:end,action:"remove",lines:this.getLinesForRange({start:start,end:end})}),this.clonePos(start)},this.removeInLine=function(row,startColumn,endColumn){var start=this.clippedPos(row,startColumn),end=this.clippedPos(row,endColumn);return this.applyDelta({start:start,end:end,action:"remove",lines:this.getLinesForRange({start:start,end:end})},!0),this.clonePos(start)},this.removeFullLines=function(firstRow,lastRow){firstRow=Math.min(Math.max(0,firstRow),this.getLength()-1),lastRow=Math.min(Math.max(0,lastRow),this.getLength()-1);var deleteFirstNewLine=lastRow==this.getLength()-1&&firstRow>0,deleteLastNewLine=lastRow<this.getLength()-1,startRow=deleteFirstNewLine?firstRow-1:firstRow,startCol=deleteFirstNewLine?this.getLine(startRow).length:0,endRow=deleteLastNewLine?lastRow+1:lastRow,endCol=deleteLastNewLine?0:this.getLine(endRow).length,range=new Range(startRow,startCol,endRow,endCol),deletedLines=this.$lines.slice(firstRow,lastRow+1);return this.applyDelta({start:range.start,end:range.end,action:"remove",lines:this.getLinesForRange(range)}),deletedLines},this.removeNewLine=function(row){row<this.getLength()-1&&row>=0&&this.applyDelta({start:this.pos(row,this.getLine(row).length),end:this.pos(row+1,0),action:"remove",lines:["",""]})},this.replace=function(range,text){if(range instanceof Range||(range=Range.fromPoints(range.start,range.end)),0===text.length&&range.isEmpty())return range.start;if(text==this.getTextRange(range))return range.end;this.remove(range);var end;return end=text?this.insert(range.start,text):range.start},this.applyDeltas=function(deltas){for(var i=0;i<deltas.length;i++)this.applyDelta(deltas[i])},this.revertDeltas=function(deltas){for(var i=deltas.length-1;i>=0;i--)this.revertDelta(deltas[i])},this.applyDelta=function(delta,doNotValidate){var isInsert="insert"==delta.action;(isInsert?delta.lines.length<=1&&!delta.lines[0]:!Range.comparePoints(delta.start,delta.end))||(isInsert&&delta.lines.length>2e4&&this.$splitAndapplyLargeDelta(delta,2e4),applyDelta(this.$lines,delta,doNotValidate),this._signal("change",delta))},this.$splitAndapplyLargeDelta=function(delta,MAX){for(var lines=delta.lines,l=lines.length,row=delta.start.row,column=delta.start.column,from=0,to=0;;){from=to,to+=MAX-1;var chunk=lines.slice(from,to);if(to>l){delta.lines=chunk,delta.start.row=row+from,delta.start.column=column;break}chunk.push(""),this.applyDelta({start:this.pos(row+from,column),end:this.pos(row+to,column=0),action:delta.action,lines:chunk},!0)}},this.revertDelta=function(delta){this.applyDelta({start:this.clonePos(delta.start),end:this.clonePos(delta.end),action:"insert"==delta.action?"remove":"insert",lines:delta.lines.slice()})},this.indexToPosition=function(index,startRow){for(var lines=this.$lines||this.getAllLines(),newlineLength=this.getNewLineCharacter().length,i=startRow||0,l=lines.length;l>i;i++)if(index-=lines[i].length+newlineLength,0>index)return{row:i,column:index+lines[i].length+newlineLength};return{row:l-1,column:lines[l-1].length}},this.positionToIndex=function(pos,startRow){for(var lines=this.$lines||this.getAllLines(),newlineLength=this.getNewLineCharacter().length,index=0,row=Math.min(pos.row,lines.length),i=startRow||0;row>i;++i)index+=lines[i].length+newlineLength;return index+pos.column}}).call(Document.prototype),exports.Document=Document}),ace.define("ace/background_tokenizer",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(require,exports,module){"use strict";var oop=require("./lib/oop"),EventEmitter=require("./lib/event_emitter").EventEmitter,BackgroundTokenizer=function(tokenizer,editor){this.running=!1,this.lines=[],this.states=[],this.currentLine=0,this.tokenizer=tokenizer;var self=this;this.$worker=function(){if(self.running){for(var workerStart=new Date,currentLine=self.currentLine,endLine=-1,doc=self.doc,startLine=currentLine;self.lines[currentLine];)currentLine++;var len=doc.getLength(),processedLines=0;for(self.running=!1;len>currentLine;){self.$tokenizeRow(currentLine),endLine=currentLine;do currentLine++;while(self.lines[currentLine]);if(processedLines++,processedLines%5===0&&new Date-workerStart>20){self.running=setTimeout(self.$worker,20);break}}self.currentLine=currentLine,endLine>=startLine&&self.fireUpdateEvent(startLine,endLine)}}};(function(){oop.implement(this,EventEmitter),this.setTokenizer=function(tokenizer){this.tokenizer=tokenizer,this.lines=[],this.states=[],this.start(0)},this.setDocument=function(doc){this.doc=doc,this.lines=[],this.states=[],this.stop()},this.fireUpdateEvent=function(firstRow,lastRow){var data={first:firstRow,last:lastRow};this._signal("update",{data:data})},this.start=function(startRow){this.currentLine=Math.min(startRow||0,this.currentLine,this.doc.getLength()),this.lines.splice(this.currentLine,this.lines.length),this.states.splice(this.currentLine,this.states.length),this.stop(),this.running=setTimeout(this.$worker,700)},this.scheduleStart=function(){this.running||(this.running=setTimeout(this.$worker,700))},this.$updateOnChange=function(delta){var startRow=delta.start.row,len=delta.end.row-startRow;if(0===len)this.lines[startRow]=null;else if("remove"==delta.action)this.lines.splice(startRow,len+1,null),this.states.splice(startRow,len+1,null);else{var args=Array(len+1);args.unshift(startRow,1),this.lines.splice.apply(this.lines,args),this.states.splice.apply(this.states,args)}this.currentLine=Math.min(startRow,this.currentLine,this.doc.getLength()),this.stop()},this.stop=function(){this.running&&clearTimeout(this.running),this.running=!1},this.getTokens=function(row){return this.lines[row]||this.$tokenizeRow(row)},this.getState=function(row){return this.currentLine==row&&this.$tokenizeRow(row),this.states[row]||"start"},this.$tokenizeRow=function(row){var line=this.doc.getLine(row),state=this.states[row-1],data=this.tokenizer.getLineTokens(line,state,row);return this.states[row]+""!=data.state+""?(this.states[row]=data.state,this.lines[row+1]=null,this.currentLine>row+1&&(this.currentLine=row+1)):this.currentLine==row&&(this.currentLine=row+1),this.lines[row]=data.tokens}}).call(BackgroundTokenizer.prototype),exports.BackgroundTokenizer=BackgroundTokenizer}),ace.define("ace/search_highlight",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"],function(require,exports,module){"use strict";var lang=require("./lib/lang"),Range=(require("./lib/oop"),require("./range").Range),SearchHighlight=function(regExp,clazz,type){this.setRegexp(regExp),this.clazz=clazz,this.type=type||"text";
};(function(){this.MAX_RANGES=500,this.setRegexp=function(regExp){this.regExp+""!=regExp+""&&(this.regExp=regExp,this.cache=[])},this.update=function(html,markerLayer,session,config){if(this.regExp)for(var start=config.firstRow,end=config.lastRow,i=start;end>=i;i++){var ranges=this.cache[i];null==ranges&&(ranges=lang.getMatchOffsets(session.getLine(i),this.regExp),ranges.length>this.MAX_RANGES&&(ranges=ranges.slice(0,this.MAX_RANGES)),ranges=ranges.map(function(match){return new Range(i,match.offset,i,match.offset+match.length)}),this.cache[i]=ranges.length?ranges:"");for(var j=ranges.length;j--;)markerLayer.drawSingleLineMarker(html,ranges[j].toScreenRange(session),this.clazz,config)}}}).call(SearchHighlight.prototype),exports.SearchHighlight=SearchHighlight}),ace.define("ace/edit_session/fold_line",["require","exports","module","ace/range"],function(require,exports,module){"use strict";function FoldLine(foldData,folds){this.foldData=foldData,Array.isArray(folds)?this.folds=folds:folds=this.folds=[folds];var last=folds[folds.length-1];this.range=new Range(folds[0].start.row,folds[0].start.column,last.end.row,last.end.column),this.start=this.range.start,this.end=this.range.end,this.folds.forEach(function(fold){fold.setFoldLine(this)},this)}var Range=require("../range").Range;(function(){this.shiftRow=function(shift){this.start.row+=shift,this.end.row+=shift,this.folds.forEach(function(fold){fold.start.row+=shift,fold.end.row+=shift})},this.addFold=function(fold){if(fold.sameRow){if(fold.start.row<this.startRow||fold.endRow>this.endRow)throw new Error("Can't add a fold to this FoldLine as it has no connection");this.folds.push(fold),this.folds.sort(function(a,b){return-a.range.compareEnd(b.start.row,b.start.column)}),this.range.compareEnd(fold.start.row,fold.start.column)>0?(this.end.row=fold.end.row,this.end.column=fold.end.column):this.range.compareStart(fold.end.row,fold.end.column)<0&&(this.start.row=fold.start.row,this.start.column=fold.start.column)}else if(fold.start.row==this.end.row)this.folds.push(fold),this.end.row=fold.end.row,this.end.column=fold.end.column;else{if(fold.end.row!=this.start.row)throw new Error("Trying to add fold to FoldRow that doesn't have a matching row");this.folds.unshift(fold),this.start.row=fold.start.row,this.start.column=fold.start.column}fold.foldLine=this},this.containsRow=function(row){return row>=this.start.row&&row<=this.end.row},this.walk=function(callback,endRow,endColumn){var fold,cmp,stop,lastEnd=0,folds=this.folds,isNewRow=!0;null==endRow&&(endRow=this.end.row,endColumn=this.end.column);for(var i=0;i<folds.length;i++){if(fold=folds[i],cmp=fold.range.compareStart(endRow,endColumn),-1==cmp)return void callback(null,endRow,endColumn,lastEnd,isNewRow);if(stop=callback(null,fold.start.row,fold.start.column,lastEnd,isNewRow),stop=!stop&&callback(fold.placeholder,fold.start.row,fold.start.column,lastEnd),stop||0===cmp)return;isNewRow=!fold.sameRow,lastEnd=fold.end.column}callback(null,endRow,endColumn,lastEnd,isNewRow)},this.getNextFoldTo=function(row,column){for(var fold,cmp,i=0;i<this.folds.length;i++){if(fold=this.folds[i],cmp=fold.range.compareEnd(row,column),-1==cmp)return{fold:fold,kind:"after"};if(0===cmp)return{fold:fold,kind:"inside"}}return null},this.addRemoveChars=function(row,column,len){var fold,folds,ret=this.getNextFoldTo(row,column);if(ret)if(fold=ret.fold,"inside"==ret.kind&&fold.start.column!=column&&fold.start.row!=row)window.console&&window.console.log(row,column,fold);else if(fold.start.row==row){folds=this.folds;var i=folds.indexOf(fold);for(0===i&&(this.start.column+=len),i;i<folds.length;i++){if(fold=folds[i],fold.start.column+=len,!fold.sameRow)return;fold.end.column+=len}this.end.column+=len}},this.split=function(row,column){var pos=this.getNextFoldTo(row,column);if(!pos||"inside"==pos.kind)return null;var fold=pos.fold,folds=this.folds,foldData=this.foldData,i=folds.indexOf(fold),foldBefore=folds[i-1];this.end.row=foldBefore.end.row,this.end.column=foldBefore.end.column,folds=folds.splice(i,folds.length-i);var newFoldLine=new FoldLine(foldData,folds);return foldData.splice(foldData.indexOf(this)+1,0,newFoldLine),newFoldLine},this.merge=function(foldLineNext){for(var folds=foldLineNext.folds,i=0;i<folds.length;i++)this.addFold(folds[i]);var foldData=this.foldData;foldData.splice(foldData.indexOf(foldLineNext),1)},this.toString=function(){var ret=[this.range.toString()+": ["];return this.folds.forEach(function(fold){ret.push("  "+fold.toString())}),ret.push("]"),ret.join("\n")},this.idxToPosition=function(idx){for(var lastFoldEndColumn=0,i=0;i<this.folds.length;i++){var fold=this.folds[i];if(idx-=fold.start.column-lastFoldEndColumn,0>idx)return{row:fold.start.row,column:fold.start.column+idx};if(idx-=fold.placeholder.length,0>idx)return fold.start;lastFoldEndColumn=fold.end.column}return{row:this.end.row,column:this.end.column+idx}}}).call(FoldLine.prototype),exports.FoldLine=FoldLine}),ace.define("ace/range_list",["require","exports","module","ace/range"],function(require,exports,module){"use strict";var Range=require("./range").Range,comparePoints=Range.comparePoints,RangeList=function(){this.ranges=[]};(function(){this.comparePoints=comparePoints,this.pointIndex=function(pos,excludeEdges,startIndex){for(var list=this.ranges,i=startIndex||0;i<list.length;i++){var range=list[i],cmpEnd=comparePoints(pos,range.end);if(!(cmpEnd>0)){var cmpStart=comparePoints(pos,range.start);return 0===cmpEnd?excludeEdges&&0!==cmpStart?-i-2:i:cmpStart>0||0===cmpStart&&!excludeEdges?i:-i-1}}return-i-1},this.add=function(range){var excludeEdges=!range.isEmpty(),startIndex=this.pointIndex(range.start,excludeEdges);0>startIndex&&(startIndex=-startIndex-1);var endIndex=this.pointIndex(range.end,excludeEdges,startIndex);return 0>endIndex?endIndex=-endIndex-1:endIndex++,this.ranges.splice(startIndex,endIndex-startIndex,range)},this.addList=function(list){for(var removed=[],i=list.length;i--;)removed.push.apply(removed,this.add(list[i]));return removed},this.substractPoint=function(pos){var i=this.pointIndex(pos);return i>=0?this.ranges.splice(i,1):void 0},this.merge=function(){var removed=[],list=this.ranges;list=list.sort(function(a,b){return comparePoints(a.start,b.start)});for(var range,next=list[0],i=1;i<list.length;i++){range=next,next=list[i];var cmp=comparePoints(range.end,next.start);0>cmp||(0!=cmp||range.isEmpty()||next.isEmpty())&&(comparePoints(range.end,next.end)<0&&(range.end.row=next.end.row,range.end.column=next.end.column),list.splice(i,1),removed.push(next),next=range,i--)}return this.ranges=list,removed},this.contains=function(row,column){return this.pointIndex({row:row,column:column})>=0},this.containsPoint=function(pos){return this.pointIndex(pos)>=0},this.rangeAtPoint=function(pos){var i=this.pointIndex(pos);return i>=0?this.ranges[i]:void 0},this.clipRows=function(startRow,endRow){var list=this.ranges;if(list[0].start.row>endRow||list[list.length-1].start.row<startRow)return[];var startIndex=this.pointIndex({row:startRow,column:0});0>startIndex&&(startIndex=-startIndex-1);var endIndex=this.pointIndex({row:endRow,column:0},startIndex);0>endIndex&&(endIndex=-endIndex-1);for(var clipped=[],i=startIndex;endIndex>i;i++)clipped.push(list[i]);return clipped},this.removeAll=function(){return this.ranges.splice(0,this.ranges.length)},this.attach=function(session){this.session&&this.detach(),this.session=session,this.onChange=this.$onChange.bind(this),this.session.on("change",this.onChange)},this.detach=function(){this.session&&(this.session.removeListener("change",this.onChange),this.session=null)},this.$onChange=function(delta){if("insert"==delta.action)var start=delta.start,end=delta.end;else var end=delta.start,start=delta.end;for(var startRow=start.row,endRow=end.row,lineDif=endRow-startRow,colDiff=-start.column+end.column,ranges=this.ranges,i=0,n=ranges.length;n>i;i++){var r=ranges[i];if(!(r.end.row<startRow)){if(r.start.row>startRow)break;if(r.start.row==startRow&&r.start.column>=start.column&&(r.start.column==start.column&&this.$insertRight||(r.start.column+=colDiff,r.start.row+=lineDif)),r.end.row==startRow&&r.end.column>=start.column){if(r.end.column==start.column&&this.$insertRight)continue;r.end.column==start.column&&colDiff>0&&n-1>i&&r.end.column>r.start.column&&r.end.column==ranges[i+1].start.column&&(r.end.column-=colDiff),r.end.column+=colDiff,r.end.row+=lineDif}}}if(0!=lineDif&&n>i)for(;n>i;i++){var r=ranges[i];r.start.row+=lineDif,r.end.row+=lineDif}}}).call(RangeList.prototype),exports.RangeList=RangeList}),ace.define("ace/edit_session/fold",["require","exports","module","ace/range","ace/range_list","ace/lib/oop"],function(require,exports,module){"use strict";function consumePoint(point,anchor){point.row-=anchor.row,0==point.row&&(point.column-=anchor.column)}function consumeRange(range,anchor){consumePoint(range.start,anchor),consumePoint(range.end,anchor)}function restorePoint(point,anchor){0==point.row&&(point.column+=anchor.column),point.row+=anchor.row}function restoreRange(range,anchor){restorePoint(range.start,anchor),restorePoint(range.end,anchor)}var RangeList=(require("../range").Range,require("../range_list").RangeList),oop=require("../lib/oop"),Fold=exports.Fold=function(range,placeholder){this.foldLine=null,this.placeholder=placeholder,this.range=range,this.start=range.start,this.end=range.end,this.sameRow=range.start.row==range.end.row,this.subFolds=this.ranges=[]};oop.inherits(Fold,RangeList),function(){this.toString=function(){return'"'+this.placeholder+'" '+this.range.toString()},this.setFoldLine=function(foldLine){this.foldLine=foldLine,this.subFolds.forEach(function(fold){fold.setFoldLine(foldLine)})},this.clone=function(){var range=this.range.clone(),fold=new Fold(range,this.placeholder);return this.subFolds.forEach(function(subFold){fold.subFolds.push(subFold.clone())}),fold.collapseChildren=this.collapseChildren,fold},this.addSubFold=function(fold){if(!this.range.isEqual(fold)){if(!this.range.containsRange(fold))throw new Error("A fold can't intersect already existing fold"+fold.range+this.range);consumeRange(fold,this.start);for(var row=fold.start.row,column=fold.start.column,i=0,cmp=-1;i<this.subFolds.length&&(cmp=this.subFolds[i].range.compare(row,column),1==cmp);i++);var afterStart=this.subFolds[i];if(0==cmp)return afterStart.addSubFold(fold);for(var row=fold.range.end.row,column=fold.range.end.column,j=i,cmp=-1;j<this.subFolds.length&&(cmp=this.subFolds[j].range.compare(row,column),1==cmp);j++);this.subFolds[j];if(0==cmp)throw new Error("A fold can't intersect already existing fold"+fold.range+this.range);this.subFolds.splice(i,j-i,fold);return fold.setFoldLine(this.foldLine),fold}},this.restoreRange=function(range){return restoreRange(range,this.start)}}.call(Fold.prototype)}),ace.define("ace/edit_session/folding",["require","exports","module","ace/range","ace/edit_session/fold_line","ace/edit_session/fold","ace/token_iterator"],function(require,exports,module){"use strict";function Folding(){this.getFoldAt=function(row,column,side){var foldLine=this.getFoldLine(row);if(!foldLine)return null;for(var folds=foldLine.folds,i=0;i<folds.length;i++){var fold=folds[i];if(fold.range.contains(row,column)){if(1==side&&fold.range.isEnd(row,column))continue;if(-1==side&&fold.range.isStart(row,column))continue;return fold}}},this.getFoldsInRange=function(range){var start=range.start,end=range.end,foldLines=this.$foldData,foundFolds=[];start.column+=1,end.column-=1;for(var i=0;i<foldLines.length;i++){var cmp=foldLines[i].range.compareRange(range);if(2!=cmp){if(-2==cmp)break;for(var folds=foldLines[i].folds,j=0;j<folds.length;j++){var fold=folds[j];if(cmp=fold.range.compareRange(range),-2==cmp)break;if(2!=cmp){if(42==cmp)break;foundFolds.push(fold)}}}}return start.column-=1,end.column+=1,foundFolds},this.getFoldsInRangeList=function(ranges){if(Array.isArray(ranges)){var folds=[];ranges.forEach(function(range){folds=folds.concat(this.getFoldsInRange(range))},this)}else var folds=this.getFoldsInRange(ranges);return folds},this.getAllFolds=function(){for(var folds=[],foldLines=this.$foldData,i=0;i<foldLines.length;i++)for(var j=0;j<foldLines[i].folds.length;j++)folds.push(foldLines[i].folds[j]);return folds},this.getFoldStringAt=function(row,column,trim,foldLine){if(foldLine=foldLine||this.getFoldLine(row),!foldLine)return null;for(var str,fold,lastFold={end:{column:0}},i=0;i<foldLine.folds.length;i++){fold=foldLine.folds[i];var cmp=fold.range.compareEnd(row,column);if(-1==cmp){str=this.getLine(fold.start.row).substring(lastFold.end.column,fold.start.column);break}if(0===cmp)return null;lastFold=fold}return str||(str=this.getLine(fold.start.row).substring(lastFold.end.column)),-1==trim?str.substring(0,column-lastFold.end.column):1==trim?str.substring(column-lastFold.end.column):str},this.getFoldLine=function(docRow,startFoldLine){var foldData=this.$foldData,i=0;for(startFoldLine&&(i=foldData.indexOf(startFoldLine)),-1==i&&(i=0),i;i<foldData.length;i++){var foldLine=foldData[i];if(foldLine.start.row<=docRow&&foldLine.end.row>=docRow)return foldLine;if(foldLine.end.row>docRow)return null}return null},this.getNextFoldLine=function(docRow,startFoldLine){var foldData=this.$foldData,i=0;for(startFoldLine&&(i=foldData.indexOf(startFoldLine)),-1==i&&(i=0),i;i<foldData.length;i++){var foldLine=foldData[i];if(foldLine.end.row>=docRow)return foldLine}return null},this.getFoldedRowCount=function(first,last){for(var foldData=this.$foldData,rowCount=last-first+1,i=0;i<foldData.length;i++){var foldLine=foldData[i],end=foldLine.end.row,start=foldLine.start.row;if(end>=last){last>start&&(start>=first?rowCount-=last-start:rowCount=0);break}end>=first&&(rowCount-=start>=first?end-start:end-first+1)}return rowCount},this.$addFoldLine=function(foldLine){return this.$foldData.push(foldLine),this.$foldData.sort(function(a,b){return a.start.row-b.start.row}),foldLine},this.addFold=function(placeholder,range){var fold,foldData=this.$foldData,added=!1;placeholder instanceof Fold?fold=placeholder:(fold=new Fold(range,placeholder),fold.collapseChildren=range.collapseChildren),this.$clipRangeToDocument(fold.range);var startRow=fold.start.row,startColumn=fold.start.column,endRow=fold.end.row,endColumn=fold.end.column;if(!(endRow>startRow||startRow==endRow&&endColumn-2>=startColumn))throw new Error("The range has to be at least 2 characters width");var startFold=this.getFoldAt(startRow,startColumn,1),endFold=this.getFoldAt(endRow,endColumn,-1);if(startFold&&endFold==startFold)return startFold.addSubFold(fold);startFold&&!startFold.range.isStart(startRow,startColumn)&&this.removeFold(startFold),endFold&&!endFold.range.isEnd(endRow,endColumn)&&this.removeFold(endFold);var folds=this.getFoldsInRange(fold.range);folds.length>0&&(this.removeFolds(folds),folds.forEach(function(subFold){fold.addSubFold(subFold)}));for(var i=0;i<foldData.length;i++){var foldLine=foldData[i];if(endRow==foldLine.start.row){foldLine.addFold(fold),added=!0;break}if(startRow==foldLine.end.row){if(foldLine.addFold(fold),added=!0,!fold.sameRow){var foldLineNext=foldData[i+1];if(foldLineNext&&foldLineNext.start.row==endRow){foldLine.merge(foldLineNext);break}}break}if(endRow<=foldLine.start.row)break}return added||(foldLine=this.$addFoldLine(new FoldLine(this.$foldData,fold))),this.$useWrapMode?this.$updateWrapData(foldLine.start.row,foldLine.start.row):this.$updateRowLengthCache(foldLine.start.row,foldLine.start.row),this.$modified=!0,this._signal("changeFold",{data:fold,action:"add"}),fold},this.addFolds=function(folds){folds.forEach(function(fold){this.addFold(fold)},this)},this.removeFold=function(fold){var foldLine=fold.foldLine,startRow=foldLine.start.row,endRow=foldLine.end.row,foldLines=this.$foldData,folds=foldLine.folds;if(1==folds.length)foldLines.splice(foldLines.indexOf(foldLine),1);else if(foldLine.range.isEnd(fold.end.row,fold.end.column))folds.pop(),foldLine.end.row=folds[folds.length-1].end.row,foldLine.end.column=folds[folds.length-1].end.column;else if(foldLine.range.isStart(fold.start.row,fold.start.column))folds.shift(),foldLine.start.row=folds[0].start.row,foldLine.start.column=folds[0].start.column;else if(fold.sameRow)folds.splice(folds.indexOf(fold),1);else{var newFoldLine=foldLine.split(fold.start.row,fold.start.column);folds=newFoldLine.folds,folds.shift(),newFoldLine.start.row=folds[0].start.row,newFoldLine.start.column=folds[0].start.column}this.$updating||(this.$useWrapMode?this.$updateWrapData(startRow,endRow):this.$updateRowLengthCache(startRow,endRow)),this.$modified=!0,this._signal("changeFold",{data:fold,action:"remove"})},this.removeFolds=function(folds){for(var cloneFolds=[],i=0;i<folds.length;i++)cloneFolds.push(folds[i]);cloneFolds.forEach(function(fold){this.removeFold(fold)},this),this.$modified=!0},this.expandFold=function(fold){this.removeFold(fold),fold.subFolds.forEach(function(subFold){fold.restoreRange(subFold),this.addFold(subFold)},this),fold.collapseChildren>0&&this.foldAll(fold.start.row+1,fold.end.row,fold.collapseChildren-1),fold.subFolds=[]},this.expandFolds=function(folds){folds.forEach(function(fold){this.expandFold(fold)},this)},this.unfold=function(location,expandInner){var range,folds;if(null==location?(range=new Range(0,0,this.getLength(),0),expandInner=!0):range="number"==typeof location?new Range(location,0,location,this.getLine(location).length):"row"in location?Range.fromPoints(location,location):location,folds=this.getFoldsInRangeList(range),expandInner)this.removeFolds(folds);else for(var subFolds=folds;subFolds.length;)this.expandFolds(subFolds),subFolds=this.getFoldsInRangeList(range);return folds.length?folds:void 0},this.isRowFolded=function(docRow,startFoldRow){return!!this.getFoldLine(docRow,startFoldRow)},this.getRowFoldEnd=function(docRow,startFoldRow){var foldLine=this.getFoldLine(docRow,startFoldRow);return foldLine?foldLine.end.row:docRow},this.getRowFoldStart=function(docRow,startFoldRow){var foldLine=this.getFoldLine(docRow,startFoldRow);return foldLine?foldLine.start.row:docRow},this.getFoldDisplayLine=function(foldLine,endRow,endColumn,startRow,startColumn){null==startRow&&(startRow=foldLine.start.row),null==startColumn&&(startColumn=0),null==endRow&&(endRow=foldLine.end.row),null==endColumn&&(endColumn=this.getLine(endRow).length);var doc=this.doc,textLine="";return foldLine.walk(function(placeholder,row,column,lastColumn){if(!(startRow>row)){if(row==startRow){if(startColumn>column)return;lastColumn=Math.max(startColumn,lastColumn)}textLine+=null!=placeholder?placeholder:doc.getLine(row).substring(lastColumn,column)}},endRow,endColumn),textLine},this.getDisplayLine=function(row,endColumn,startRow,startColumn){var foldLine=this.getFoldLine(row);if(foldLine)return this.getFoldDisplayLine(foldLine,row,endColumn,startRow,startColumn);var line;return line=this.doc.getLine(row),line.substring(startColumn||0,endColumn||line.length)},this.$cloneFoldData=function(){var fd=[];return fd=this.$foldData.map(function(foldLine){var folds=foldLine.folds.map(function(fold){return fold.clone()});return new FoldLine(fd,folds)})},this.toggleFold=function(tryToUnfold){var fold,bracketPos,selection=this.selection,range=selection.getRange();if(range.isEmpty()){var cursor=range.start;if(fold=this.getFoldAt(cursor.row,cursor.column))return void this.expandFold(fold);(bracketPos=this.findMatchingBracket(cursor))?1==range.comparePoint(bracketPos)?range.end=bracketPos:(range.start=bracketPos,range.start.column++,range.end.column--):(bracketPos=this.findMatchingBracket({row:cursor.row,column:cursor.column+1}))?(1==range.comparePoint(bracketPos)?range.end=bracketPos:range.start=bracketPos,range.start.column++):range=this.getCommentFoldRange(cursor.row,cursor.column)||range}else{var folds=this.getFoldsInRange(range);if(tryToUnfold&&folds.length)return void this.expandFolds(folds);1==folds.length&&(fold=folds[0])}if(fold||(fold=this.getFoldAt(range.start.row,range.start.column)),fold&&fold.range.toString()==range.toString())return void this.expandFold(fold);var placeholder="...";if(!range.isMultiLine()){if(placeholder=this.getTextRange(range),placeholder.length<4)return;placeholder=placeholder.trim().substring(0,2)+".."}this.addFold(placeholder,range)},this.getCommentFoldRange=function(row,column,dir){var iterator=new TokenIterator(this,row,column),token=iterator.getCurrentToken();if(token&&/^comment|string/.test(token.type)){var range=new Range,re=new RegExp(token.type.replace(/\..*/,"\\."));if(1!=dir){do token=iterator.stepBackward();while(token&&re.test(token.type));iterator.stepForward()}if(range.start.row=iterator.getCurrentTokenRow(),range.start.column=iterator.getCurrentTokenColumn()+2,iterator=new TokenIterator(this,row,column),-1!=dir){do token=iterator.stepForward();while(token&&re.test(token.type));token=iterator.stepBackward()}else token=iterator.getCurrentToken();return range.end.row=iterator.getCurrentTokenRow(),range.end.column=iterator.getCurrentTokenColumn()+token.value.length-2,range}},this.foldAll=function(startRow,endRow,depth){void 0==depth&&(depth=1e5);var foldWidgets=this.foldWidgets;if(foldWidgets){endRow=endRow||this.getLength(),startRow=startRow||0;for(var row=startRow;endRow>row;row++)if(null==foldWidgets[row]&&(foldWidgets[row]=this.getFoldWidget(row)),"start"==foldWidgets[row]){var range=this.getFoldWidgetRange(row);if(range&&range.isMultiLine()&&range.end.row<=endRow&&range.start.row>=startRow){row=range.end.row;try{var fold=this.addFold("...",range);fold&&(fold.collapseChildren=depth)}catch(e){}}}}},this.$foldStyles={manual:1,markbegin:1,markbeginend:1},this.$foldStyle="markbegin",this.setFoldStyle=function(style){if(!this.$foldStyles[style])throw new Error("invalid fold style: "+style+"["+Object.keys(this.$foldStyles).join(", ")+"]");if(this.$foldStyle!=style){this.$foldStyle=style,"manual"==style&&this.unfold();var mode=this.$foldMode;this.$setFolding(null),this.$setFolding(mode)}},this.$setFolding=function(foldMode){if(this.$foldMode!=foldMode){if(this.$foldMode=foldMode,this.off("change",this.$updateFoldWidgets),this.off("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets),this._signal("changeAnnotation"),!foldMode||"manual"==this.$foldStyle)return void(this.foldWidgets=null);this.foldWidgets=[],this.getFoldWidget=foldMode.getFoldWidget.bind(foldMode,this,this.$foldStyle),this.getFoldWidgetRange=foldMode.getFoldWidgetRange.bind(foldMode,this,this.$foldStyle),this.$updateFoldWidgets=this.updateFoldWidgets.bind(this),this.$tokenizerUpdateFoldWidgets=this.tokenizerUpdateFoldWidgets.bind(this),this.on("change",this.$updateFoldWidgets),this.on("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets)}},this.getParentFoldRangeData=function(row,ignoreCurrent){var fw=this.foldWidgets;if(!fw||ignoreCurrent&&fw[row])return{};for(var firstRange,i=row-1;i>=0;){var c=fw[i];if(null==c&&(c=fw[i]=this.getFoldWidget(i)),"start"==c){var range=this.getFoldWidgetRange(i);if(firstRange||(firstRange=range),range&&range.end.row>=row)break}i--}return{range:-1!==i&&range,firstRange:firstRange}},this.onFoldWidgetClick=function(row,e){e=e.domEvent;var options={children:e.shiftKey,all:e.ctrlKey||e.metaKey,siblings:e.altKey},range=this.$toggleFoldWidget(row,options);if(!range){var el=e.target||e.srcElement;el&&/ace_fold-widget/.test(el.className)&&(el.className+=" ace_invalid")}},this.$toggleFoldWidget=function(row,options){if(this.getFoldWidget){var type=this.getFoldWidget(row),line=this.getLine(row),dir="end"===type?-1:1,fold=this.getFoldAt(row,-1===dir?0:line.length,dir);if(fold)return options.children||options.all?this.removeFold(fold):this.expandFold(fold),fold;var range=this.getFoldWidgetRange(row,!0);if(range&&!range.isMultiLine()&&(fold=this.getFoldAt(range.start.row,range.start.column,1),fold&&range.isEqual(fold.range)))return this.removeFold(fold),fold;if(options.siblings){var data=this.getParentFoldRangeData(row);if(data.range)var startRow=data.range.start.row+1,endRow=data.range.end.row;this.foldAll(startRow,endRow,options.all?1e4:0)}else options.children?(endRow=range?range.end.row:this.getLength(),this.foldAll(row+1,endRow,options.all?1e4:0)):range&&(options.all&&(range.collapseChildren=1e4),this.addFold("...",range));return range}},this.toggleFoldWidget=function(toggleParent){var row=this.selection.getCursor().row;row=this.getRowFoldStart(row);var range=this.$toggleFoldWidget(row,{});if(!range){var data=this.getParentFoldRangeData(row,!0);if(range=data.range||data.firstRange){row=range.start.row;var fold=this.getFoldAt(row,this.getLine(row).length,1);fold?this.removeFold(fold):this.addFold("...",range)}}},this.updateFoldWidgets=function(delta){var firstRow=delta.start.row,len=delta.end.row-firstRow;if(0===len)this.foldWidgets[firstRow]=null;else if("remove"==delta.action)this.foldWidgets.splice(firstRow,len+1,null);else{var args=Array(len+1);args.unshift(firstRow,1),this.foldWidgets.splice.apply(this.foldWidgets,args)}},this.tokenizerUpdateFoldWidgets=function(e){var rows=e.data;rows.first!=rows.last&&this.foldWidgets.length>rows.first&&this.foldWidgets.splice(rows.first,this.foldWidgets.length)}}var Range=require("../range").Range,FoldLine=require("./fold_line").FoldLine,Fold=require("./fold").Fold,TokenIterator=require("../token_iterator").TokenIterator;exports.Folding=Folding}),ace.define("ace/edit_session/bracket_match",["require","exports","module","ace/token_iterator","ace/range"],function(require,exports,module){"use strict";function BracketMatch(){this.findMatchingBracket=function(position,chr){if(0==position.column)return null;var charBeforeCursor=chr||this.getLine(position.row).charAt(position.column-1);if(""==charBeforeCursor)return null;var match=charBeforeCursor.match(/([\(\[\{])|([\)\]\}])/);return match?match[1]?this.$findClosingBracket(match[1],position):this.$findOpeningBracket(match[2],position):null},this.getBracketRange=function(pos){var range,line=this.getLine(pos.row),before=!0,chr=line.charAt(pos.column-1),match=chr&&chr.match(/([\(\[\{])|([\)\]\}])/);if(match||(chr=line.charAt(pos.column),pos={row:pos.row,column:pos.column+1},match=chr&&chr.match(/([\(\[\{])|([\)\]\}])/),before=!1),!match)return null;if(match[1]){var bracketPos=this.$findClosingBracket(match[1],pos);if(!bracketPos)return null;range=Range.fromPoints(pos,bracketPos),before||(range.end.column++,range.start.column--),range.cursor=range.end}else{var bracketPos=this.$findOpeningBracket(match[2],pos);if(!bracketPos)return null;range=Range.fromPoints(bracketPos,pos),before||(range.start.column++,range.end.column--),range.cursor=range.start}return range},this.$brackets={")":"(","(":")","]":"[","[":"]","{":"}","}":"{"},this.$findOpeningBracket=function(bracket,position,typeRe){var openBracket=this.$brackets[bracket],depth=1,iterator=new TokenIterator(this,position.row,position.column),token=iterator.getCurrentToken();if(token||(token=iterator.stepForward()),token){typeRe||(typeRe=new RegExp("(\\.?"+token.type.replace(".","\\.").replace("rparen",".paren").replace(/\b(?:end)\b/,"(?:start|begin|end)")+")+"));for(var valueIndex=position.column-iterator.getCurrentTokenColumn()-2,value=token.value;;){for(;valueIndex>=0;){var chr=value.charAt(valueIndex);if(chr==openBracket){if(depth-=1,0==depth)return{row:iterator.getCurrentTokenRow(),column:valueIndex+iterator.getCurrentTokenColumn()}}else chr==bracket&&(depth+=1);valueIndex-=1}do token=iterator.stepBackward();while(token&&!typeRe.test(token.type));if(null==token)break;value=token.value,valueIndex=value.length-1}return null}},this.$findClosingBracket=function(bracket,position,typeRe){var closingBracket=this.$brackets[bracket],depth=1,iterator=new TokenIterator(this,position.row,position.column),token=iterator.getCurrentToken();if(token||(token=iterator.stepForward()),token){typeRe||(typeRe=new RegExp("(\\.?"+token.type.replace(".","\\.").replace("lparen",".paren").replace(/\b(?:start|begin)\b/,"(?:start|begin|end)")+")+"));for(var valueIndex=position.column-iterator.getCurrentTokenColumn();;){for(var value=token.value,valueLength=value.length;valueLength>valueIndex;){var chr=value.charAt(valueIndex);if(chr==closingBracket){if(depth-=1,0==depth)return{row:iterator.getCurrentTokenRow(),column:valueIndex+iterator.getCurrentTokenColumn()}}else chr==bracket&&(depth+=1);valueIndex+=1}do token=iterator.stepForward();while(token&&!typeRe.test(token.type));if(null==token)break;valueIndex=0}return null}}}var TokenIterator=require("../token_iterator").TokenIterator,Range=require("../range").Range;exports.BracketMatch=BracketMatch}),ace.define("ace/edit_session",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/config","ace/lib/event_emitter","ace/selection","ace/mode/text","ace/range","ace/document","ace/background_tokenizer","ace/search_highlight","ace/edit_session/folding","ace/edit_session/bracket_match"],function(require,exports,module){"use strict";var oop=require("./lib/oop"),lang=require("./lib/lang"),config=require("./config"),EventEmitter=require("./lib/event_emitter").EventEmitter,Selection=require("./selection").Selection,TextMode=require("./mode/text").Mode,Range=require("./range").Range,Document=require("./document").Document,BackgroundTokenizer=require("./background_tokenizer").BackgroundTokenizer,SearchHighlight=require("./search_highlight").SearchHighlight,EditSession=function(text,mode){this.$breakpoints=[],this.$decorations=[],this.$frontMarkers={},this.$backMarkers={},this.$markerId=1,this.$undoSelect=!0,this.$foldData=[],this.id="session"+ ++EditSession.$uid,this.$foldData.toString=function(){return this.join("\n")},this.on("changeFold",this.onChangeFold.bind(this)),this.$onChange=this.onChange.bind(this),"object"==typeof text&&text.getLine||(text=new Document(text)),this.setDocument(text),this.selection=new Selection(this),config.resetOptions(this),this.setMode(mode),config._signal("session",this)};(function(){function isFullWidth(c){return 4352>c?!1:c>=4352&&4447>=c||c>=4515&&4519>=c||c>=4602&&4607>=c||c>=9001&&9002>=c||c>=11904&&11929>=c||c>=11931&&12019>=c||c>=12032&&12245>=c||c>=12272&&12283>=c||c>=12288&&12350>=c||c>=12353&&12438>=c||c>=12441&&12543>=c||c>=12549&&12589>=c||c>=12593&&12686>=c||c>=12688&&12730>=c||c>=12736&&12771>=c||c>=12784&&12830>=c||c>=12832&&12871>=c||c>=12880&&13054>=c||c>=13056&&19903>=c||c>=19968&&42124>=c||c>=42128&&42182>=c||c>=43360&&43388>=c||c>=44032&&55203>=c||c>=55216&&55238>=c||c>=55243&&55291>=c||c>=63744&&64255>=c||c>=65040&&65049>=c||c>=65072&&65106>=c||c>=65108&&65126>=c||c>=65128&&65131>=c||c>=65281&&65376>=c||c>=65504&&65510>=c}oop.implement(this,EventEmitter),this.setDocument=function(doc){this.doc&&this.doc.removeListener("change",this.$onChange),this.doc=doc,doc.on("change",this.$onChange),this.bgTokenizer&&this.bgTokenizer.setDocument(this.getDocument()),this.resetCaches()},this.getDocument=function(){return this.doc},this.$resetRowCache=function(docRow){if(!docRow)return this.$docRowCache=[],void(this.$screenRowCache=[]);var l=this.$docRowCache.length,i=this.$getRowCacheIndex(this.$docRowCache,docRow)+1;l>i&&(this.$docRowCache.splice(i,l),this.$screenRowCache.splice(i,l))},this.$getRowCacheIndex=function(cacheArray,val){for(var low=0,hi=cacheArray.length-1;hi>=low;){var mid=low+hi>>1,c=cacheArray[mid];if(val>c)low=mid+1;else{if(!(c>val))return mid;hi=mid-1}}return low-1},this.resetCaches=function(){this.$modified=!0,this.$wrapData=[],this.$rowLengthCache=[],this.$resetRowCache(0),this.bgTokenizer&&this.bgTokenizer.start(0)},this.onChangeFold=function(e){var fold=e.data;this.$resetRowCache(fold.start.row)},this.onChange=function(delta){this.$modified=!0,this.$resetRowCache(delta.start.row);var removedFolds=this.$updateInternalDataOnChange(delta);this.$fromUndo||!this.$undoManager||delta.ignore||(this.$deltasDoc.push(delta),removedFolds&&0!=removedFolds.length&&this.$deltasFold.push({action:"removeFolds",folds:removedFolds}),this.$informUndoManager.schedule()),this.bgTokenizer&&this.bgTokenizer.$updateOnChange(delta),this._signal("change",delta)},this.setValue=function(text){this.doc.setValue(text),this.selection.moveTo(0,0),
this.$resetRowCache(0),this.$deltas=[],this.$deltasDoc=[],this.$deltasFold=[],this.setUndoManager(this.$undoManager),this.getUndoManager().reset()},this.getValue=this.toString=function(){return this.doc.getValue()},this.getSelection=function(){return this.selection},this.getState=function(row){return this.bgTokenizer.getState(row)},this.getTokens=function(row){return this.bgTokenizer.getTokens(row)},this.getTokenAt=function(row,column){var token,tokens=this.bgTokenizer.getTokens(row),c=0;if(null==column)i=tokens.length-1,c=this.getLine(row).length;else for(var i=0;i<tokens.length&&(c+=tokens[i].value.length,!(c>=column));i++);return(token=tokens[i])?(token.index=i,token.start=c-token.value.length,token):null},this.setUndoManager=function(undoManager){if(this.$undoManager=undoManager,this.$deltas=[],this.$deltasDoc=[],this.$deltasFold=[],this.$informUndoManager&&this.$informUndoManager.cancel(),undoManager){var self=this;this.$syncInformUndoManager=function(){self.$informUndoManager.cancel(),self.$deltasFold.length&&(self.$deltas.push({group:"fold",deltas:self.$deltasFold}),self.$deltasFold=[]),self.$deltasDoc.length&&(self.$deltas.push({group:"doc",deltas:self.$deltasDoc}),self.$deltasDoc=[]),self.$deltas.length>0&&undoManager.execute({action:"aceupdate",args:[self.$deltas,self],merge:self.mergeUndoDeltas}),self.mergeUndoDeltas=!1,self.$deltas=[]},this.$informUndoManager=lang.delayedCall(this.$syncInformUndoManager)}},this.markUndoGroup=function(){this.$syncInformUndoManager&&this.$syncInformUndoManager()},this.$defaultUndoManager={undo:function(){},redo:function(){},reset:function(){}},this.getUndoManager=function(){return this.$undoManager||this.$defaultUndoManager},this.getTabString=function(){return this.getUseSoftTabs()?lang.stringRepeat(" ",this.getTabSize()):"	"},this.setUseSoftTabs=function(val){this.setOption("useSoftTabs",val)},this.getUseSoftTabs=function(){return this.$useSoftTabs&&!this.$mode.$indentWithTabs},this.setTabSize=function(tabSize){this.setOption("tabSize",tabSize)},this.getTabSize=function(){return this.$tabSize},this.isTabStop=function(position){return this.$useSoftTabs&&position.column%this.$tabSize===0},this.$overwrite=!1,this.setOverwrite=function(overwrite){this.setOption("overwrite",overwrite)},this.getOverwrite=function(){return this.$overwrite},this.toggleOverwrite=function(){this.setOverwrite(!this.$overwrite)},this.addGutterDecoration=function(row,className){this.$decorations[row]||(this.$decorations[row]=""),this.$decorations[row]+=" "+className,this._signal("changeBreakpoint",{})},this.removeGutterDecoration=function(row,className){this.$decorations[row]=(this.$decorations[row]||"").replace(" "+className,""),this._signal("changeBreakpoint",{})},this.getBreakpoints=function(){return this.$breakpoints},this.setBreakpoints=function(rows){this.$breakpoints=[];for(var i=0;i<rows.length;i++)this.$breakpoints[rows[i]]="ace_breakpoint";this._signal("changeBreakpoint",{})},this.clearBreakpoints=function(){this.$breakpoints=[],this._signal("changeBreakpoint",{})},this.setBreakpoint=function(row,className){void 0===className&&(className="ace_breakpoint"),className?this.$breakpoints[row]=className:delete this.$breakpoints[row],this._signal("changeBreakpoint",{})},this.clearBreakpoint=function(row){delete this.$breakpoints[row],this._signal("changeBreakpoint",{})},this.addMarker=function(range,clazz,type,inFront){var id=this.$markerId++,marker={range:range,type:type||"line",renderer:"function"==typeof type?type:null,clazz:clazz,inFront:!!inFront,id:id};return inFront?(this.$frontMarkers[id]=marker,this._signal("changeFrontMarker")):(this.$backMarkers[id]=marker,this._signal("changeBackMarker")),id},this.addDynamicMarker=function(marker,inFront){if(marker.update){var id=this.$markerId++;return marker.id=id,marker.inFront=!!inFront,inFront?(this.$frontMarkers[id]=marker,this._signal("changeFrontMarker")):(this.$backMarkers[id]=marker,this._signal("changeBackMarker")),marker}},this.removeMarker=function(markerId){var marker=this.$frontMarkers[markerId]||this.$backMarkers[markerId];if(marker){var markers=marker.inFront?this.$frontMarkers:this.$backMarkers;marker&&(delete markers[markerId],this._signal(marker.inFront?"changeFrontMarker":"changeBackMarker"))}},this.getMarkers=function(inFront){return inFront?this.$frontMarkers:this.$backMarkers},this.highlight=function(re){if(!this.$searchHighlight){var highlight=new SearchHighlight(null,"ace_selected-word","text");this.$searchHighlight=this.addDynamicMarker(highlight)}this.$searchHighlight.setRegexp(re)},this.highlightLines=function(startRow,endRow,clazz,inFront){"number"!=typeof endRow&&(clazz=endRow,endRow=startRow),clazz||(clazz="ace_step");var range=new Range(startRow,0,endRow,1/0);return range.id=this.addMarker(range,clazz,"fullLine",inFront),range},this.setAnnotations=function(annotations){this.$annotations=annotations,this._signal("changeAnnotation",{})},this.getAnnotations=function(){return this.$annotations||[]},this.clearAnnotations=function(){this.setAnnotations([])},this.$detectNewLine=function(text){var match=text.match(/^.*?(\r?\n)/m);match?this.$autoNewLine=match[1]:this.$autoNewLine="\n"},this.getWordRange=function(row,column){var line=this.getLine(row),inToken=!1;if(column>0&&(inToken=!!line.charAt(column-1).match(this.tokenRe)),inToken||(inToken=!!line.charAt(column).match(this.tokenRe)),inToken)var re=this.tokenRe;else if(/^\s+$/.test(line.slice(column-1,column+1)))var re=/\s/;else var re=this.nonTokenRe;var start=column;if(start>0){do start--;while(start>=0&&line.charAt(start).match(re));start++}for(var end=column;end<line.length&&line.charAt(end).match(re);)end++;return new Range(row,start,row,end)},this.getAWordRange=function(row,column){for(var wordRange=this.getWordRange(row,column),line=this.getLine(wordRange.end.row);line.charAt(wordRange.end.column).match(/[ \t]/);)wordRange.end.column+=1;return wordRange},this.setNewLineMode=function(newLineMode){this.doc.setNewLineMode(newLineMode)},this.getNewLineMode=function(){return this.doc.getNewLineMode()},this.setUseWorker=function(useWorker){this.setOption("useWorker",useWorker)},this.getUseWorker=function(){return this.$useWorker},this.onReloadTokenizer=function(e){var rows=e.data;this.bgTokenizer.start(rows.first),this._signal("tokenizerUpdate",e)},this.$modes={},this.$mode=null,this.$modeId=null,this.setMode=function(mode,cb){if(mode&&"object"==typeof mode){if(mode.getTokenizer)return this.$onChangeMode(mode);var options=mode,path=options.path}else path=mode||"ace/mode/text";return this.$modes["ace/mode/text"]||(this.$modes["ace/mode/text"]=new TextMode),this.$modes[path]&&!options?(this.$onChangeMode(this.$modes[path]),void(cb&&cb())):(this.$modeId=path,config.loadModule(["mode",path],function(m){return this.$modeId!==path?cb&&cb():(this.$modes[path]&&!options?this.$onChangeMode(this.$modes[path]):m&&m.Mode&&(m=new m.Mode(options),options||(this.$modes[path]=m,m.$id=path),this.$onChangeMode(m)),void(cb&&cb()))}.bind(this)),void(this.$mode||this.$onChangeMode(this.$modes["ace/mode/text"],!0)))},this.$onChangeMode=function(mode,$isPlaceholder){if($isPlaceholder||(this.$modeId=mode.$id),this.$mode!==mode){this.$mode=mode,this.$stopWorker(),this.$useWorker&&this.$startWorker();var tokenizer=mode.getTokenizer();if(void 0!==tokenizer.addEventListener){var onReloadTokenizer=this.onReloadTokenizer.bind(this);tokenizer.addEventListener("update",onReloadTokenizer)}if(this.bgTokenizer)this.bgTokenizer.setTokenizer(tokenizer);else{this.bgTokenizer=new BackgroundTokenizer(tokenizer);var _self=this;this.bgTokenizer.addEventListener("update",function(e){_self._signal("tokenizerUpdate",e)})}this.bgTokenizer.setDocument(this.getDocument()),this.tokenRe=mode.tokenRe,this.nonTokenRe=mode.nonTokenRe,$isPlaceholder||(mode.attachToSession&&mode.attachToSession(this),this.$options.wrapMethod.set.call(this,this.$wrapMethod),this.$setFolding(mode.foldingRules),this.bgTokenizer.start(0),this._emit("changeMode"))}},this.$stopWorker=function(){this.$worker&&(this.$worker.terminate(),this.$worker=null)},this.$startWorker=function(){try{this.$worker=this.$mode.createWorker(this)}catch(e){config.warn("Could not load worker",e),this.$worker=null}},this.getMode=function(){return this.$mode},this.$scrollTop=0,this.setScrollTop=function(scrollTop){this.$scrollTop===scrollTop||isNaN(scrollTop)||(this.$scrollTop=scrollTop,this._signal("changeScrollTop",scrollTop))},this.getScrollTop=function(){return this.$scrollTop},this.$scrollLeft=0,this.setScrollLeft=function(scrollLeft){this.$scrollLeft===scrollLeft||isNaN(scrollLeft)||(this.$scrollLeft=scrollLeft,this._signal("changeScrollLeft",scrollLeft))},this.getScrollLeft=function(){return this.$scrollLeft},this.getScreenWidth=function(){return this.$computeWidth(),this.lineWidgets?Math.max(this.getLineWidgetMaxWidth(),this.screenWidth):this.screenWidth},this.getLineWidgetMaxWidth=function(){if(null!=this.lineWidgetsWidth)return this.lineWidgetsWidth;var width=0;return this.lineWidgets.forEach(function(w){w&&w.screenWidth>width&&(width=w.screenWidth)}),this.lineWidgetWidth=width},this.$computeWidth=function(force){if(this.$modified||force){if(this.$modified=!1,this.$useWrapMode)return this.screenWidth=this.$wrapLimit;for(var lines=this.doc.getAllLines(),cache=this.$rowLengthCache,longestScreenLine=0,foldIndex=0,foldLine=this.$foldData[foldIndex],foldStart=foldLine?foldLine.start.row:1/0,len=lines.length,i=0;len>i;i++){if(i>foldStart){if(i=foldLine.end.row+1,i>=len)break;foldLine=this.$foldData[foldIndex++],foldStart=foldLine?foldLine.start.row:1/0}null==cache[i]&&(cache[i]=this.$getStringScreenWidth(lines[i])[0]),cache[i]>longestScreenLine&&(longestScreenLine=cache[i])}this.screenWidth=longestScreenLine}},this.getLine=function(row){return this.doc.getLine(row)},this.getLines=function(firstRow,lastRow){return this.doc.getLines(firstRow,lastRow)},this.getLength=function(){return this.doc.getLength()},this.getTextRange=function(range){return this.doc.getTextRange(range||this.selection.getRange())},this.insert=function(position,text){return this.doc.insert(position,text)},this.remove=function(range){return this.doc.remove(range)},this.removeFullLines=function(firstRow,lastRow){return this.doc.removeFullLines(firstRow,lastRow)},this.undoChanges=function(deltas,dontSelect){if(deltas.length){this.$fromUndo=!0;for(var lastUndoRange=null,i=deltas.length-1;-1!=i;i--){var delta=deltas[i];"doc"==delta.group?(this.doc.revertDeltas(delta.deltas),lastUndoRange=this.$getUndoSelection(delta.deltas,!0,lastUndoRange)):delta.deltas.forEach(function(foldDelta){this.addFolds(foldDelta.folds)},this)}return this.$fromUndo=!1,lastUndoRange&&this.$undoSelect&&!dontSelect&&this.selection.setSelectionRange(lastUndoRange),lastUndoRange}},this.redoChanges=function(deltas,dontSelect){if(deltas.length){this.$fromUndo=!0;for(var lastUndoRange=null,i=0;i<deltas.length;i++){var delta=deltas[i];"doc"==delta.group&&(this.doc.applyDeltas(delta.deltas),lastUndoRange=this.$getUndoSelection(delta.deltas,!1,lastUndoRange))}return this.$fromUndo=!1,lastUndoRange&&this.$undoSelect&&!dontSelect&&this.selection.setSelectionRange(lastUndoRange),lastUndoRange}},this.setUndoSelect=function(enable){this.$undoSelect=enable},this.$getUndoSelection=function(deltas,isUndo,lastUndoRange){function isInsert(delta){return isUndo?"insert"!==delta.action:"insert"===delta.action}var range,point,delta=deltas[0],lastDeltaIsInsert=!1;isInsert(delta)?(range=Range.fromPoints(delta.start,delta.end),lastDeltaIsInsert=!0):(range=Range.fromPoints(delta.start,delta.start),lastDeltaIsInsert=!1);for(var i=1;i<deltas.length;i++)delta=deltas[i],isInsert(delta)?(point=delta.start,-1==range.compare(point.row,point.column)&&range.setStart(point),point=delta.end,1==range.compare(point.row,point.column)&&range.setEnd(point),lastDeltaIsInsert=!0):(point=delta.start,-1==range.compare(point.row,point.column)&&(range=Range.fromPoints(delta.start,delta.start)),lastDeltaIsInsert=!1);if(null!=lastUndoRange){0===Range.comparePoints(lastUndoRange.start,range.start)&&(lastUndoRange.start.column+=range.end.column-range.start.column,lastUndoRange.end.column+=range.end.column-range.start.column);var cmp=lastUndoRange.compareRange(range);1==cmp?range.setStart(lastUndoRange.start):-1==cmp&&range.setEnd(lastUndoRange.end)}return range},this.replace=function(range,text){return this.doc.replace(range,text)},this.moveText=function(fromRange,toPosition,copy){var text=this.getTextRange(fromRange),folds=this.getFoldsInRange(fromRange),toRange=Range.fromPoints(toPosition,toPosition);if(!copy){this.remove(fromRange);var rowDiff=fromRange.start.row-fromRange.end.row,collDiff=rowDiff?-fromRange.end.column:fromRange.start.column-fromRange.end.column;collDiff&&(toRange.start.row==fromRange.end.row&&toRange.start.column>fromRange.end.column&&(toRange.start.column+=collDiff),toRange.end.row==fromRange.end.row&&toRange.end.column>fromRange.end.column&&(toRange.end.column+=collDiff)),rowDiff&&toRange.start.row>=fromRange.end.row&&(toRange.start.row+=rowDiff,toRange.end.row+=rowDiff)}if(toRange.end=this.insert(toRange.start,text),folds.length){var oldStart=fromRange.start,newStart=toRange.start,rowDiff=newStart.row-oldStart.row,collDiff=newStart.column-oldStart.column;this.addFolds(folds.map(function(x){return x=x.clone(),x.start.row==oldStart.row&&(x.start.column+=collDiff),x.end.row==oldStart.row&&(x.end.column+=collDiff),x.start.row+=rowDiff,x.end.row+=rowDiff,x}))}return toRange},this.indentRows=function(startRow,endRow,indentString){indentString=indentString.replace(/\t/g,this.getTabString());for(var row=startRow;endRow>=row;row++)this.doc.insertInLine({row:row,column:0},indentString)},this.outdentRows=function(range){for(var rowRange=range.collapseRows(),deleteRange=new Range(0,0,0,0),size=this.getTabSize(),i=rowRange.start.row;i<=rowRange.end.row;++i){var line=this.getLine(i);deleteRange.start.row=i,deleteRange.end.row=i;for(var j=0;size>j&&" "==line.charAt(j);++j);size>j&&"	"==line.charAt(j)?(deleteRange.start.column=j,deleteRange.end.column=j+1):(deleteRange.start.column=0,deleteRange.end.column=j),this.remove(deleteRange)}},this.$moveLines=function(firstRow,lastRow,dir){if(firstRow=this.getRowFoldStart(firstRow),lastRow=this.getRowFoldEnd(lastRow),0>dir){var row=this.getRowFoldStart(firstRow+dir);if(0>row)return 0;var diff=row-firstRow}else if(dir>0){var row=this.getRowFoldEnd(lastRow+dir);if(row>this.doc.getLength()-1)return 0;var diff=row-lastRow}else{firstRow=this.$clipRowToDocument(firstRow),lastRow=this.$clipRowToDocument(lastRow);var diff=lastRow-firstRow+1}var range=new Range(firstRow,0,lastRow,Number.MAX_VALUE),folds=this.getFoldsInRange(range).map(function(x){return x=x.clone(),x.start.row+=diff,x.end.row+=diff,x}),lines=0==dir?this.doc.getLines(firstRow,lastRow):this.doc.removeFullLines(firstRow,lastRow);return this.doc.insertFullLines(firstRow+diff,lines),folds.length&&this.addFolds(folds),diff},this.moveLinesUp=function(firstRow,lastRow){return this.$moveLines(firstRow,lastRow,-1)},this.moveLinesDown=function(firstRow,lastRow){return this.$moveLines(firstRow,lastRow,1)},this.duplicateLines=function(firstRow,lastRow){return this.$moveLines(firstRow,lastRow,0)},this.$clipRowToDocument=function(row){return Math.max(0,Math.min(row,this.doc.getLength()-1))},this.$clipColumnToRow=function(row,column){return 0>column?0:Math.min(this.doc.getLine(row).length,column)},this.$clipPositionToDocument=function(row,column){if(column=Math.max(0,column),0>row)row=0,column=0;else{var len=this.doc.getLength();row>=len?(row=len-1,column=this.doc.getLine(len-1).length):column=Math.min(this.doc.getLine(row).length,column)}return{row:row,column:column}},this.$clipRangeToDocument=function(range){range.start.row<0?(range.start.row=0,range.start.column=0):range.start.column=this.$clipColumnToRow(range.start.row,range.start.column);var len=this.doc.getLength()-1;return range.end.row>len?(range.end.row=len,range.end.column=this.doc.getLine(len).length):range.end.column=this.$clipColumnToRow(range.end.row,range.end.column),range},this.$wrapLimit=80,this.$useWrapMode=!1,this.$wrapLimitRange={min:null,max:null},this.setUseWrapMode=function(useWrapMode){if(useWrapMode!=this.$useWrapMode){if(this.$useWrapMode=useWrapMode,this.$modified=!0,this.$resetRowCache(0),useWrapMode){var len=this.getLength();this.$wrapData=Array(len),this.$updateWrapData(0,len-1)}this._signal("changeWrapMode")}},this.getUseWrapMode=function(){return this.$useWrapMode},this.setWrapLimitRange=function(min,max){(this.$wrapLimitRange.min!==min||this.$wrapLimitRange.max!==max)&&(this.$wrapLimitRange={min:min,max:max},this.$modified=!0,this.$useWrapMode&&this._signal("changeWrapMode"))},this.adjustWrapLimit=function(desiredLimit,$printMargin){var limits=this.$wrapLimitRange;limits.max<0&&(limits={min:$printMargin,max:$printMargin});var wrapLimit=this.$constrainWrapLimit(desiredLimit,limits.min,limits.max);return wrapLimit!=this.$wrapLimit&&wrapLimit>1?(this.$wrapLimit=wrapLimit,this.$modified=!0,this.$useWrapMode&&(this.$updateWrapData(0,this.getLength()-1),this.$resetRowCache(0),this._signal("changeWrapLimit")),!0):!1},this.$constrainWrapLimit=function(wrapLimit,min,max){return min&&(wrapLimit=Math.max(min,wrapLimit)),max&&(wrapLimit=Math.min(max,wrapLimit)),wrapLimit},this.getWrapLimit=function(){return this.$wrapLimit},this.setWrapLimit=function(limit){this.setWrapLimitRange(limit,limit)},this.getWrapLimitRange=function(){return{min:this.$wrapLimitRange.min,max:this.$wrapLimitRange.max}},this.$updateInternalDataOnChange=function(delta){var useWrapMode=this.$useWrapMode,action=delta.action,start=delta.start,end=delta.end,firstRow=start.row,lastRow=end.row,len=lastRow-firstRow,removedFolds=null;if(this.$updating=!0,0!=len)if("remove"===action){this[useWrapMode?"$wrapData":"$rowLengthCache"].splice(firstRow,len);var foldLines=this.$foldData;removedFolds=this.getFoldsInRange(delta),this.removeFolds(removedFolds);var foldLine=this.getFoldLine(end.row),idx=0;if(foldLine){foldLine.addRemoveChars(end.row,end.column,start.column-end.column),foldLine.shiftRow(-len);var foldLineBefore=this.getFoldLine(firstRow);foldLineBefore&&foldLineBefore!==foldLine&&(foldLineBefore.merge(foldLine),foldLine=foldLineBefore),idx=foldLines.indexOf(foldLine)+1}for(idx;idx<foldLines.length;idx++){var foldLine=foldLines[idx];foldLine.start.row>=end.row&&foldLine.shiftRow(-len)}lastRow=firstRow}else{var args=Array(len);args.unshift(firstRow,0);var arr=useWrapMode?this.$wrapData:this.$rowLengthCache;arr.splice.apply(arr,args);var foldLines=this.$foldData,foldLine=this.getFoldLine(firstRow),idx=0;if(foldLine){var cmp=foldLine.range.compareInside(start.row,start.column);0==cmp?(foldLine=foldLine.split(start.row,start.column),foldLine&&(foldLine.shiftRow(len),foldLine.addRemoveChars(lastRow,0,end.column-start.column))):-1==cmp&&(foldLine.addRemoveChars(firstRow,0,end.column-start.column),foldLine.shiftRow(len)),idx=foldLines.indexOf(foldLine)+1}for(idx;idx<foldLines.length;idx++){var foldLine=foldLines[idx];foldLine.start.row>=firstRow&&foldLine.shiftRow(len)}}else{len=Math.abs(delta.start.column-delta.end.column),"remove"===action&&(removedFolds=this.getFoldsInRange(delta),this.removeFolds(removedFolds),len=-len);var foldLine=this.getFoldLine(firstRow);foldLine&&foldLine.addRemoveChars(firstRow,start.column,len)}return useWrapMode&&this.$wrapData.length!=this.doc.getLength()&&console.error("doc.getLength() and $wrapData.length have to be the same!"),this.$updating=!1,useWrapMode?this.$updateWrapData(firstRow,lastRow):this.$updateRowLengthCache(firstRow,lastRow),removedFolds},this.$updateRowLengthCache=function(firstRow,lastRow,b){this.$rowLengthCache[firstRow]=null,this.$rowLengthCache[lastRow]=null},this.$updateWrapData=function(firstRow,lastRow){var tokens,foldLine,lines=this.doc.getAllLines(),tabSize=this.getTabSize(),wrapData=this.$wrapData,wrapLimit=this.$wrapLimit,row=firstRow;for(lastRow=Math.min(lastRow,lines.length-1);lastRow>=row;)foldLine=this.getFoldLine(row,foldLine),foldLine?(tokens=[],foldLine.walk(function(placeholder,row,column,lastColumn){var walkTokens;if(null!=placeholder){walkTokens=this.$getDisplayTokens(placeholder,tokens.length),walkTokens[0]=PLACEHOLDER_START;for(var i=1;i<walkTokens.length;i++)walkTokens[i]=PLACEHOLDER_BODY}else walkTokens=this.$getDisplayTokens(lines[row].substring(lastColumn,column),tokens.length);tokens=tokens.concat(walkTokens)}.bind(this),foldLine.end.row,lines[foldLine.end.row].length+1),wrapData[foldLine.start.row]=this.$computeWrapSplits(tokens,wrapLimit,tabSize),row=foldLine.end.row+1):(tokens=this.$getDisplayTokens(lines[row]),wrapData[row]=this.$computeWrapSplits(tokens,wrapLimit,tabSize),row++)};var CHAR=1,CHAR_EXT=2,PLACEHOLDER_START=3,PLACEHOLDER_BODY=4,PUNCTUATION=9,SPACE=10,TAB=11,TAB_SPACE=12;this.$computeWrapSplits=function(tokens,wrapLimit,tabSize){function getWrapIndent(){var indentation=0;if(0===maxIndent)return indentation;if(indentedSoftWrap)for(var i=0;i<tokens.length;i++){var token=tokens[i];if(token==SPACE)indentation+=1;else{if(token!=TAB){if(token==TAB_SPACE)continue;break}indentation+=tabSize}}return isCode&&indentedSoftWrap!==!1&&(indentation+=tabSize),Math.min(indentation,maxIndent)}function addSplit(screenPos){var displayed=tokens.slice(lastSplit,screenPos),len=displayed.length;displayed.join("").replace(/12/g,function(){len-=1}).replace(/2/g,function(){len-=1}),splits.length||(indent=getWrapIndent(),splits.indent=indent),lastDocSplit+=len,splits.push(lastDocSplit),lastSplit=screenPos}if(0==tokens.length)return[];for(var splits=[],displayLength=tokens.length,lastSplit=0,lastDocSplit=0,isCode=this.$wrapAsCode,indentedSoftWrap=this.$indentedSoftWrap,maxIndent=wrapLimit<=Math.max(2*tabSize,8)||indentedSoftWrap===!1?0:Math.floor(wrapLimit/2),indent=0;displayLength-lastSplit>wrapLimit-indent;){var split=lastSplit+wrapLimit-indent;if(tokens[split-1]>=SPACE&&tokens[split]>=SPACE)addSplit(split);else if(tokens[split]!=PLACEHOLDER_START&&tokens[split]!=PLACEHOLDER_BODY){for(var minSplit=Math.max(split-(wrapLimit-(wrapLimit>>2)),lastSplit-1);split>minSplit&&tokens[split]<PLACEHOLDER_START;)split--;if(isCode){for(;split>minSplit&&tokens[split]<PLACEHOLDER_START;)split--;for(;split>minSplit&&tokens[split]==PUNCTUATION;)split--}else for(;split>minSplit&&tokens[split]<SPACE;)split--;split>minSplit?addSplit(++split):(split=lastSplit+wrapLimit,tokens[split]==CHAR_EXT&&split--,addSplit(split-indent))}else{for(split;split!=lastSplit-1&&tokens[split]!=PLACEHOLDER_START;split--);if(split>lastSplit){addSplit(split);continue}for(split=lastSplit+wrapLimit;split<tokens.length&&tokens[split]==PLACEHOLDER_BODY;split++);if(split==tokens.length)break;addSplit(split)}}return splits},this.$getDisplayTokens=function(str,offset){var tabSize,arr=[];offset=offset||0;for(var i=0;i<str.length;i++){var c=str.charCodeAt(i);if(9==c){tabSize=this.getScreenTabSize(arr.length+offset),arr.push(TAB);for(var n=1;tabSize>n;n++)arr.push(TAB_SPACE)}else 32==c?arr.push(SPACE):c>39&&48>c||c>57&&64>c?arr.push(PUNCTUATION):c>=4352&&isFullWidth(c)?arr.push(CHAR,CHAR_EXT):arr.push(CHAR)}return arr},this.$getStringScreenWidth=function(str,maxScreenColumn,screenColumn){if(0==maxScreenColumn)return[0,0];null==maxScreenColumn&&(maxScreenColumn=1/0),screenColumn=screenColumn||0;var c,column;for(column=0;column<str.length&&(c=str.charCodeAt(column),screenColumn+=9==c?this.getScreenTabSize(screenColumn):c>=4352&&isFullWidth(c)?2:1,!(screenColumn>maxScreenColumn));column++);return[screenColumn,column]},this.lineWidgets=null,this.getRowLength=function(row){if(this.lineWidgets)var h=this.lineWidgets[row]&&this.lineWidgets[row].rowCount||0;else h=0;return this.$useWrapMode&&this.$wrapData[row]?this.$wrapData[row].length+1+h:1+h},this.getRowLineCount=function(row){return this.$useWrapMode&&this.$wrapData[row]?this.$wrapData[row].length+1:1},this.getRowWrapIndent=function(screenRow){if(this.$useWrapMode){var pos=this.screenToDocumentPosition(screenRow,Number.MAX_VALUE),splits=this.$wrapData[pos.row];return splits.length&&splits[0]<pos.column?splits.indent:0}return 0},this.getScreenLastRowColumn=function(screenRow){var pos=this.screenToDocumentPosition(screenRow,Number.MAX_VALUE);return this.documentToScreenColumn(pos.row,pos.column)},this.getDocumentLastRowColumn=function(docRow,docColumn){var screenRow=this.documentToScreenRow(docRow,docColumn);return this.getScreenLastRowColumn(screenRow)},this.getDocumentLastRowColumnPosition=function(docRow,docColumn){var screenRow=this.documentToScreenRow(docRow,docColumn);return this.screenToDocumentPosition(screenRow,Number.MAX_VALUE/10)},this.getRowSplitData=function(row){return this.$useWrapMode?this.$wrapData[row]:void 0},this.getScreenTabSize=function(screenColumn){return this.$tabSize-screenColumn%this.$tabSize},this.screenToDocumentRow=function(screenRow,screenColumn){return this.screenToDocumentPosition(screenRow,screenColumn).row},this.screenToDocumentColumn=function(screenRow,screenColumn){return this.screenToDocumentPosition(screenRow,screenColumn).column},this.screenToDocumentPosition=function(screenRow,screenColumn){if(0>screenRow)return{row:0,column:0};var line,column,docRow=0,docColumn=0,row=0,rowLength=0,rowCache=this.$screenRowCache,i=this.$getRowCacheIndex(rowCache,screenRow),l=rowCache.length;if(l&&i>=0)var row=rowCache[i],docRow=this.$docRowCache[i],doCache=screenRow>rowCache[l-1];else var doCache=!l;for(var maxRow=this.getLength()-1,foldLine=this.getNextFoldLine(docRow),foldStart=foldLine?foldLine.start.row:1/0;screenRow>=row&&(rowLength=this.getRowLength(docRow),!(row+rowLength>screenRow||docRow>=maxRow));)row+=rowLength,docRow++,docRow>foldStart&&(docRow=foldLine.end.row+1,foldLine=this.getNextFoldLine(docRow,foldLine),foldStart=foldLine?foldLine.start.row:1/0),doCache&&(this.$docRowCache.push(docRow),this.$screenRowCache.push(row));if(foldLine&&foldLine.start.row<=docRow)line=this.getFoldDisplayLine(foldLine),docRow=foldLine.start.row;else{if(screenRow>=row+rowLength||docRow>maxRow)return{row:maxRow,column:this.getLine(maxRow).length};line=this.getLine(docRow),foldLine=null}var wrapIndent=0;if(this.$useWrapMode){var splits=this.$wrapData[docRow];if(splits){var splitIndex=Math.floor(screenRow-row);column=splits[splitIndex],splitIndex>0&&splits.length&&(wrapIndent=splits.indent,docColumn=splits[splitIndex-1]||splits[splits.length-1],line=line.substring(docColumn))}}return docColumn+=this.$getStringScreenWidth(line,screenColumn-wrapIndent)[1],this.$useWrapMode&&docColumn>=column&&(docColumn=column-1),foldLine?foldLine.idxToPosition(docColumn):{row:docRow,column:docColumn}},this.documentToScreenPosition=function(docRow,docColumn){if("undefined"==typeof docColumn)var pos=this.$clipPositionToDocument(docRow.row,docRow.column);else pos=this.$clipPositionToDocument(docRow,docColumn);docRow=pos.row,docColumn=pos.column;var screenRow=0,foldStartRow=null,fold=null;fold=this.getFoldAt(docRow,docColumn,1),fold&&(docRow=fold.start.row,docColumn=fold.start.column);var rowEnd,row=0,rowCache=this.$docRowCache,i=this.$getRowCacheIndex(rowCache,docRow),l=rowCache.length;if(l&&i>=0)var row=rowCache[i],screenRow=this.$screenRowCache[i],doCache=docRow>rowCache[l-1];else var doCache=!l;for(var foldLine=this.getNextFoldLine(row),foldStart=foldLine?foldLine.start.row:1/0;docRow>row;){if(row>=foldStart){if(rowEnd=foldLine.end.row+1,rowEnd>docRow)break;foldLine=this.getNextFoldLine(rowEnd,foldLine),foldStart=foldLine?foldLine.start.row:1/0}else rowEnd=row+1;screenRow+=this.getRowLength(row),row=rowEnd,doCache&&(this.$docRowCache.push(row),this.$screenRowCache.push(screenRow))}var textLine="";foldLine&&row>=foldStart?(textLine=this.getFoldDisplayLine(foldLine,docRow,docColumn),foldStartRow=foldLine.start.row):(textLine=this.getLine(docRow).substring(0,docColumn),foldStartRow=docRow);var wrapIndent=0;if(this.$useWrapMode){var wrapRow=this.$wrapData[foldStartRow];if(wrapRow){for(var screenRowOffset=0;textLine.length>=wrapRow[screenRowOffset];)screenRow++,screenRowOffset++;textLine=textLine.substring(wrapRow[screenRowOffset-1]||0,textLine.length),wrapIndent=screenRowOffset>0?wrapRow.indent:0}}return{row:screenRow,column:wrapIndent+this.$getStringScreenWidth(textLine)[0]}},this.documentToScreenColumn=function(row,docColumn){return this.documentToScreenPosition(row,docColumn).column},this.documentToScreenRow=function(docRow,docColumn){return this.documentToScreenPosition(docRow,docColumn).row},this.getScreenLength=function(){var screenRows=0,fold=null;if(this.$useWrapMode)for(var lastRow=this.$wrapData.length,row=0,i=0,fold=this.$foldData[i++],foldStart=fold?fold.start.row:1/0;lastRow>row;){var splits=this.$wrapData[row];screenRows+=splits?splits.length+1:1,row++,row>foldStart&&(row=fold.end.row+1,fold=this.$foldData[i++],foldStart=fold?fold.start.row:1/0)}else{screenRows=this.getLength();for(var foldData=this.$foldData,i=0;i<foldData.length;i++)fold=foldData[i],screenRows-=fold.end.row-fold.start.row}return this.lineWidgets&&(screenRows+=this.$getWidgetScreenLength()),screenRows},this.$setFontMetrics=function(fm){this.$enableVarChar&&(this.$getStringScreenWidth=function(str,maxScreenColumn,screenColumn){if(0===maxScreenColumn)return[0,0];maxScreenColumn||(maxScreenColumn=1/0),screenColumn=screenColumn||0;var c,column;for(column=0;column<str.length&&(c=str.charAt(column),screenColumn+="	"===c?this.getScreenTabSize(screenColumn):fm.getCharacterWidth(c),!(screenColumn>maxScreenColumn));column++);return[screenColumn,column]})},this.destroy=function(){this.bgTokenizer&&(this.bgTokenizer.setDocument(null),this.bgTokenizer=null),this.$stopWorker()}}).call(EditSession.prototype),require("./edit_session/folding").Folding.call(EditSession.prototype),require("./edit_session/bracket_match").BracketMatch.call(EditSession.prototype),config.defineOptions(EditSession.prototype,"session",{wrap:{set:function(value){if(value&&"off"!=value?"free"==value?value=!0:"printMargin"==value?value=-1:"string"==typeof value&&(value=parseInt(value,10)||!1):value=!1,this.$wrap!=value)if(this.$wrap=value,value){var col="number"==typeof value?value:null;this.setWrapLimitRange(col,col),this.setUseWrapMode(!0)}else this.setUseWrapMode(!1)},get:function(){return this.getUseWrapMode()?-1==this.$wrap?"printMargin":this.getWrapLimitRange().min?this.$wrap:"free":"off"},handlesSet:!0},wrapMethod:{set:function(val){val="auto"==val?"text"!=this.$mode.type:"text"!=val,val!=this.$wrapAsCode&&(this.$wrapAsCode=val,this.$useWrapMode&&(this.$modified=!0,this.$resetRowCache(0),this.$updateWrapData(0,this.getLength()-1)))},initialValue:"auto"},indentedSoftWrap:{initialValue:!0},firstLineNumber:{set:function(){this._signal("changeBreakpoint")},initialValue:1},useWorker:{set:function(useWorker){this.$useWorker=useWorker,this.$stopWorker(),useWorker&&this.$startWorker()},initialValue:!0},useSoftTabs:{initialValue:!0},tabSize:{set:function(tabSize){isNaN(tabSize)||this.$tabSize===tabSize||(this.$modified=!0,this.$rowLengthCache=[],this.$tabSize=tabSize,this._signal("changeTabSize"))},initialValue:4,handlesSet:!0},overwrite:{set:function(val){this._signal("changeOverwrite")},initialValue:!1},newLineMode:{set:function(val){this.doc.setNewLineMode(val)},get:function(){return this.doc.getNewLineMode()},handlesSet:!0},mode:{set:function(val){this.setMode(val)},get:function(){return this.$modeId}}}),exports.EditSession=EditSession}),ace.define("ace/search",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"],function(require,exports,module){"use strict";var lang=require("./lib/lang"),oop=require("./lib/oop"),Range=require("./range").Range,Search=function(){this.$options={}};(function(){this.set=function(options){return oop.mixin(this.$options,options),this},this.getOptions=function(){return lang.copyObject(this.$options)},this.setOptions=function(options){this.$options=options},this.find=function(session){var options=this.$options,iterator=this.$matchIterator(session,options);if(!iterator)return!1;var firstRange=null;
return iterator.forEach(function(range,row,offset){if(range.start)firstRange=range;else{var column=range.offset+(offset||0);if(firstRange=new Range(row,column,row,column+range.length),!range.length&&options.start&&options.start.start&&0!=options.skipCurrent&&firstRange.isEqual(options.start))return firstRange=null,!1}return!0}),firstRange},this.findAll=function(session){var options=this.$options;if(!options.needle)return[];this.$assembleRegExp(options);var range=options.range,lines=range?session.getLines(range.start.row,range.end.row):session.doc.getAllLines(),ranges=[],re=options.re;if(options.$isMultiLine){var prevRange,len=re.length,maxRow=lines.length-len;outer:for(var row=re.offset||0;maxRow>=row;row++){for(var j=0;len>j;j++)if(-1==lines[row+j].search(re[j]))continue outer;var startLine=lines[row],line=lines[row+len-1],startIndex=startLine.length-startLine.match(re[0])[0].length,endIndex=line.match(re[len-1])[0].length;prevRange&&prevRange.end.row===row&&prevRange.end.column>startIndex||(ranges.push(prevRange=new Range(row,startIndex,row+len-1,endIndex)),len>2&&(row=row+len-2))}}else for(var i=0;i<lines.length;i++)for(var matches=lang.getMatchOffsets(lines[i],re),j=0;j<matches.length;j++){var match=matches[j];ranges.push(new Range(i,match.offset,i,match.offset+match.length))}if(range){for(var startColumn=range.start.column,endColumn=range.start.column,i=0,j=ranges.length-1;j>i&&ranges[i].start.column<startColumn&&ranges[i].start.row==range.start.row;)i++;for(;j>i&&ranges[j].end.column>endColumn&&ranges[j].end.row==range.end.row;)j--;for(ranges=ranges.slice(i,j+1),i=0,j=ranges.length;j>i;i++)ranges[i].start.row+=range.start.row,ranges[i].end.row+=range.start.row}return ranges},this.replace=function(input,replacement){var options=this.$options,re=this.$assembleRegExp(options);if(options.$isMultiLine)return replacement;if(re){var match=re.exec(input);if(!match||match[0].length!=input.length)return null;if(replacement=input.replace(re,replacement),options.preserveCase){replacement=replacement.split("");for(var i=Math.min(input.length,input.length);i--;){var ch=input[i];ch&&ch.toLowerCase()!=ch?replacement[i]=replacement[i].toUpperCase():replacement[i]=replacement[i].toLowerCase()}replacement=replacement.join("")}return replacement}},this.$matchIterator=function(session,options){var re=this.$assembleRegExp(options);if(!re)return!1;var callback;if(options.$isMultiLine)var len=re.length,matchIterator=function(line,row,offset){var startIndex=line.search(re[0]);if(-1!=startIndex){for(var i=1;len>i;i++)if(line=session.getLine(row+i),-1==line.search(re[i]))return;var endIndex=line.match(re[len-1])[0].length,range=new Range(row,startIndex,row+len-1,endIndex);return 1==re.offset?(range.start.row--,range.start.column=Number.MAX_VALUE):offset&&(range.start.column+=offset),callback(range)?!0:void 0}};else if(options.backwards)var matchIterator=function(line,row,startIndex){for(var matches=lang.getMatchOffsets(line,re),i=matches.length-1;i>=0;i--)if(callback(matches[i],row,startIndex))return!0};else var matchIterator=function(line,row,startIndex){for(var matches=lang.getMatchOffsets(line,re),i=0;i<matches.length;i++)if(callback(matches[i],row,startIndex))return!0};var lineIterator=this.$lineIterator(session,options);return{forEach:function(_callback){callback=_callback,lineIterator.forEach(matchIterator)}}},this.$assembleRegExp=function(options,$disableFakeMultiline){if(options.needle instanceof RegExp)return options.re=options.needle;var needle=options.needle;if(!options.needle)return options.re=!1;options.regExp||(needle=lang.escapeRegExp(needle)),options.wholeWord&&(needle="\\b"+needle+"\\b");var modifier=options.caseSensitive?"gm":"gmi";if(options.$isMultiLine=!$disableFakeMultiline&&/[\n\r]/.test(needle),options.$isMultiLine)return options.re=this.$assembleMultilineRegExp(needle,modifier);try{var re=new RegExp(needle,modifier)}catch(e){re=!1}return options.re=re},this.$assembleMultilineRegExp=function(needle,modifier){for(var parts=needle.replace(/\r\n|\r|\n/g,"$\n^").split("\n"),re=[],i=0;i<parts.length;i++)try{re.push(new RegExp(parts[i],modifier))}catch(e){return!1}return""==parts[0]?(re.shift(),re.offset=1):re.offset=0,re},this.$lineIterator=function(session,options){var backwards=1==options.backwards,skipCurrent=0!=options.skipCurrent,range=options.range,start=options.start;start||(start=range?range[backwards?"end":"start"]:session.selection.getRange()),start.start&&(start=start[skipCurrent!=backwards?"end":"start"]);var firstRow=range?range.start.row:0,lastRow=range?range.end.row:session.getLength()-1,forEach=backwards?function(callback){var row=start.row,line=session.getLine(row).substring(0,start.column);if(!callback(line,row)){for(row--;row>=firstRow;row--)if(callback(session.getLine(row),row))return;if(0!=options.wrap)for(row=lastRow,firstRow=start.row;row>=firstRow;row--)if(callback(session.getLine(row),row))return}}:function(callback){var row=start.row,line=session.getLine(row).substr(start.column);if(!callback(line,row,start.column)){for(row+=1;lastRow>=row;row++)if(callback(session.getLine(row),row))return;if(0!=options.wrap)for(row=firstRow,lastRow=start.row;lastRow>=row;row++)if(callback(session.getLine(row),row))return}};return{forEach:forEach}}}).call(Search.prototype),exports.Search=Search}),ace.define("ace/keyboard/hash_handler",["require","exports","module","ace/lib/keys","ace/lib/useragent"],function(require,exports,module){"use strict";function HashHandler(config,platform){this.platform=platform||(useragent.isMac?"mac":"win"),this.commands={},this.commandKeyBinding={},this.addCommands(config),this.$singleCommand=!0}function MultiHashHandler(config,platform){HashHandler.call(this,config,platform),this.$singleCommand=!1}var keyUtil=require("../lib/keys"),useragent=require("../lib/useragent"),KEY_MODS=keyUtil.KEY_MODS;MultiHashHandler.prototype=HashHandler.prototype,function(){function getPosition(command){return"object"==typeof command&&command.bindKey&&command.bindKey.position||0}this.addCommand=function(command){this.commands[command.name]&&this.removeCommand(command),this.commands[command.name]=command,command.bindKey&&this._buildKeyHash(command)},this.removeCommand=function(command,keepCommand){var name=command&&("string"==typeof command?command:command.name);command=this.commands[name],keepCommand||delete this.commands[name];var ckb=this.commandKeyBinding;for(var keyId in ckb){var cmdGroup=ckb[keyId];if(cmdGroup==command)delete ckb[keyId];else if(Array.isArray(cmdGroup)){var i=cmdGroup.indexOf(command);-1!=i&&(cmdGroup.splice(i,1),1==cmdGroup.length&&(ckb[keyId]=cmdGroup[0]))}}},this.bindKey=function(key,command,position){return"object"==typeof key&&key&&(void 0==position&&(position=key.position),key=key[this.platform]),key?"function"==typeof command?this.addCommand({exec:command,bindKey:key,name:command.name||key}):void key.split("|").forEach(function(keyPart){var chain="";if(-1!=keyPart.indexOf(" ")){var parts=keyPart.split(/\s+/);keyPart=parts.pop(),parts.forEach(function(keyPart){var binding=this.parseKeys(keyPart),id=KEY_MODS[binding.hashId]+binding.key;chain+=(chain?" ":"")+id,this._addCommandToBinding(chain,"chainKeys")},this),chain+=" "}var binding=this.parseKeys(keyPart),id=KEY_MODS[binding.hashId]+binding.key;this._addCommandToBinding(chain+id,command,position)},this):void 0},this._addCommandToBinding=function(keyId,command,position){var i,ckb=this.commandKeyBinding;if(command)if(!ckb[keyId]||this.$singleCommand)ckb[keyId]=command;else{Array.isArray(ckb[keyId])?-1!=(i=ckb[keyId].indexOf(command))&&ckb[keyId].splice(i,1):ckb[keyId]=[ckb[keyId]],"number"!=typeof position&&(position=position||command.isDefault?-100:getPosition(command));var commands=ckb[keyId];for(i=0;i<commands.length;i++){var other=commands[i],otherPos=getPosition(other);if(otherPos>position)break}commands.splice(i,0,command)}else delete ckb[keyId]},this.addCommands=function(commands){commands&&Object.keys(commands).forEach(function(name){var command=commands[name];if(command){if("string"==typeof command)return this.bindKey(command,name);"function"==typeof command&&(command={exec:command}),"object"==typeof command&&(command.name||(command.name=name),this.addCommand(command))}},this)},this.removeCommands=function(commands){Object.keys(commands).forEach(function(name){this.removeCommand(commands[name])},this)},this.bindKeys=function(keyList){Object.keys(keyList).forEach(function(key){this.bindKey(key,keyList[key])},this)},this._buildKeyHash=function(command){this.bindKey(command.bindKey,command)},this.parseKeys=function(keys){var parts=keys.toLowerCase().split(/[\-\+]([\-\+])?/).filter(function(x){return x}),key=parts.pop(),keyCode=keyUtil[key];if(keyUtil.FUNCTION_KEYS[keyCode])key=keyUtil.FUNCTION_KEYS[keyCode].toLowerCase();else{if(!parts.length)return{key:key,hashId:-1};if(1==parts.length&&"shift"==parts[0])return{key:key.toUpperCase(),hashId:-1}}for(var hashId=0,i=parts.length;i--;){var modifier=keyUtil.KEY_MODS[parts[i]];if(null==modifier)return"undefined"!=typeof console&&console.error("invalid modifier "+parts[i]+" in "+keys),!1;hashId|=modifier}return{key:key,hashId:hashId}},this.findKeyCommand=function(hashId,keyString){var key=KEY_MODS[hashId]+keyString;return this.commandKeyBinding[key]},this.handleKeyboard=function(data,hashId,keyString,keyCode){if(!(0>keyCode)){var key=KEY_MODS[hashId]+keyString,command=this.commandKeyBinding[key];return data.$keyChain&&(data.$keyChain+=" "+key,command=this.commandKeyBinding[data.$keyChain]||command),!command||"chainKeys"!=command&&"chainKeys"!=command[command.length-1]?(data.$keyChain&&(hashId&&4!=hashId||1!=keyString.length?(-1==hashId||keyCode>0)&&(data.$keyChain=""):data.$keyChain=data.$keyChain.slice(0,-key.length-1)),{command:command}):(data.$keyChain=data.$keyChain||key,{command:"null"})}},this.getStatusText=function(editor,data){return data.$keyChain||""}}.call(HashHandler.prototype),exports.HashHandler=HashHandler,exports.MultiHashHandler=MultiHashHandler}),ace.define("ace/commands/command_manager",["require","exports","module","ace/lib/oop","ace/keyboard/hash_handler","ace/lib/event_emitter"],function(require,exports,module){"use strict";var oop=require("../lib/oop"),MultiHashHandler=require("../keyboard/hash_handler").MultiHashHandler,EventEmitter=require("../lib/event_emitter").EventEmitter,CommandManager=function(platform,commands){MultiHashHandler.call(this,commands,platform),this.byName=this.commands,this.setDefaultHandler("exec",function(e){return e.command.exec(e.editor,e.args||{})})};oop.inherits(CommandManager,MultiHashHandler),function(){oop.implement(this,EventEmitter),this.exec=function(command,editor,args){if(Array.isArray(command)){for(var i=command.length;i--;)if(this.exec(command[i],editor,args))return!0;return!1}if("string"==typeof command&&(command=this.commands[command]),!command)return!1;if(editor&&editor.$readOnly&&!command.readOnly)return!1;var e={editor:editor,command:command,args:args};return e.returnValue=this._emit("exec",e),this._signal("afterExec",e),e.returnValue===!1?!1:!0},this.toggleRecording=function(editor){return this.$inReplay?void 0:(editor&&editor._emit("changeStatus"),this.recording?(this.macro.pop(),this.removeEventListener("exec",this.$addCommandToMacro),this.macro.length||(this.macro=this.oldMacro),this.recording=!1):(this.$addCommandToMacro||(this.$addCommandToMacro=function(e){this.macro.push([e.command,e.args])}.bind(this)),this.oldMacro=this.macro,this.macro=[],this.on("exec",this.$addCommandToMacro),this.recording=!0))},this.replay=function(editor){if(!this.$inReplay&&this.macro){if(this.recording)return this.toggleRecording(editor);try{this.$inReplay=!0,this.macro.forEach(function(x){"string"==typeof x?this.exec(x,editor):this.exec(x[0],editor,x[1])},this)}finally{this.$inReplay=!1}}},this.trimMacro=function(m){return m.map(function(x){return"string"!=typeof x[0]&&(x[0]=x[0].name),x[1]||(x=x[0]),x})}}.call(CommandManager.prototype),exports.CommandManager=CommandManager}),ace.define("ace/commands/default_commands",["require","exports","module","ace/lib/lang","ace/config","ace/range"],function(require,exports,module){"use strict";function bindKey(win,mac){return{win:win,mac:mac}}var lang=require("../lib/lang"),config=require("../config"),Range=require("../range").Range;exports.commands=[{name:"showSettingsMenu",bindKey:bindKey("Ctrl-,","Command-,"),exec:function(editor){config.loadModule("ace/ext/settings_menu",function(module){module.init(editor),editor.showSettingsMenu()})},readOnly:!0},{name:"goToNextError",bindKey:bindKey("Alt-E","Ctrl-E"),exec:function(editor){config.loadModule("ace/ext/error_marker",function(module){module.showErrorMarker(editor,1)})},scrollIntoView:"animate",readOnly:!0},{name:"goToPreviousError",bindKey:bindKey("Alt-Shift-E","Ctrl-Shift-E"),exec:function(editor){config.loadModule("ace/ext/error_marker",function(module){module.showErrorMarker(editor,-1)})},scrollIntoView:"animate",readOnly:!0},{name:"selectall",bindKey:bindKey("Ctrl-A","Command-A"),exec:function(editor){editor.selectAll()},readOnly:!0},{name:"centerselection",bindKey:bindKey(null,"Ctrl-L"),exec:function(editor){editor.centerSelection()},readOnly:!0},{name:"gotoline",bindKey:bindKey("Ctrl-L","Command-L"),exec:function(editor){var line=parseInt(prompt("Enter line number:"),10);isNaN(line)||editor.gotoLine(line)},readOnly:!0},{name:"fold",bindKey:bindKey("Alt-L|Ctrl-F1","Command-Alt-L|Command-F1"),exec:function(editor){editor.session.toggleFold(!1)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"unfold",bindKey:bindKey("Alt-Shift-L|Ctrl-Shift-F1","Command-Alt-Shift-L|Command-Shift-F1"),exec:function(editor){editor.session.toggleFold(!0)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"toggleFoldWidget",bindKey:bindKey("F2","F2"),exec:function(editor){editor.session.toggleFoldWidget()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"toggleParentFoldWidget",bindKey:bindKey("Alt-F2","Alt-F2"),exec:function(editor){editor.session.toggleFoldWidget(!0)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"foldall",bindKey:bindKey(null,"Ctrl-Command-Option-0"),exec:function(editor){editor.session.foldAll()},scrollIntoView:"center",readOnly:!0},{name:"foldOther",bindKey:bindKey("Alt-0","Command-Option-0"),exec:function(editor){editor.session.foldAll(),editor.session.unfold(editor.selection.getAllRanges())},scrollIntoView:"center",readOnly:!0},{name:"unfoldall",bindKey:bindKey("Alt-Shift-0","Command-Option-Shift-0"),exec:function(editor){editor.session.unfold()},scrollIntoView:"center",readOnly:!0},{name:"findnext",bindKey:bindKey("Ctrl-K","Command-G"),exec:function(editor){editor.findNext()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"findprevious",bindKey:bindKey("Ctrl-Shift-K","Command-Shift-G"),exec:function(editor){editor.findPrevious()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"selectOrFindNext",bindKey:bindKey("Alt-K","Ctrl-G"),exec:function(editor){editor.selection.isEmpty()?editor.selection.selectWord():editor.findNext()},readOnly:!0},{name:"selectOrFindPrevious",bindKey:bindKey("Alt-Shift-K","Ctrl-Shift-G"),exec:function(editor){editor.selection.isEmpty()?editor.selection.selectWord():editor.findPrevious()},readOnly:!0},{name:"find",bindKey:bindKey("Ctrl-F","Command-F"),exec:function(editor){config.loadModule("ace/ext/searchbox",function(e){e.Search(editor)})},readOnly:!0},{name:"overwrite",bindKey:"Insert",exec:function(editor){editor.toggleOverwrite()},readOnly:!0},{name:"selecttostart",bindKey:bindKey("Ctrl-Shift-Home","Command-Shift-Up"),exec:function(editor){editor.getSelection().selectFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotostart",bindKey:bindKey("Ctrl-Home","Command-Home|Command-Up"),exec:function(editor){editor.navigateFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectup",bindKey:bindKey("Shift-Up","Shift-Up"),exec:function(editor){editor.getSelection().selectUp()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golineup",bindKey:bindKey("Up","Up|Ctrl-P"),exec:function(editor,args){editor.navigateUp(args.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttoend",bindKey:bindKey("Ctrl-Shift-End","Command-Shift-Down"),exec:function(editor){editor.getSelection().selectFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotoend",bindKey:bindKey("Ctrl-End","Command-End|Command-Down"),exec:function(editor){editor.navigateFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectdown",bindKey:bindKey("Shift-Down","Shift-Down"),exec:function(editor){editor.getSelection().selectDown()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golinedown",bindKey:bindKey("Down","Down|Ctrl-N"),exec:function(editor,args){editor.navigateDown(args.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordleft",bindKey:bindKey("Ctrl-Shift-Left","Option-Shift-Left"),exec:function(editor){editor.getSelection().selectWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordleft",bindKey:bindKey("Ctrl-Left","Option-Left"),exec:function(editor){editor.navigateWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolinestart",bindKey:bindKey("Alt-Shift-Left","Command-Shift-Left"),exec:function(editor){editor.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolinestart",bindKey:bindKey("Alt-Left|Home","Command-Left|Home|Ctrl-A"),exec:function(editor){editor.navigateLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectleft",bindKey:bindKey("Shift-Left","Shift-Left"),exec:function(editor){editor.getSelection().selectLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoleft",bindKey:bindKey("Left","Left|Ctrl-B"),exec:function(editor,args){editor.navigateLeft(args.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordright",bindKey:bindKey("Ctrl-Shift-Right","Option-Shift-Right"),exec:function(editor){editor.getSelection().selectWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordright",bindKey:bindKey("Ctrl-Right","Option-Right"),exec:function(editor){editor.navigateWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolineend",bindKey:bindKey("Alt-Shift-Right","Command-Shift-Right"),exec:function(editor){editor.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolineend",bindKey:bindKey("Alt-Right|End","Command-Right|End|Ctrl-E"),exec:function(editor){editor.navigateLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectright",bindKey:bindKey("Shift-Right","Shift-Right"),exec:function(editor){editor.getSelection().selectRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoright",bindKey:bindKey("Right","Right|Ctrl-F"),exec:function(editor,args){editor.navigateRight(args.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectpagedown",bindKey:"Shift-PageDown",exec:function(editor){editor.selectPageDown()},readOnly:!0},{name:"pagedown",bindKey:bindKey(null,"Option-PageDown"),exec:function(editor){editor.scrollPageDown()},readOnly:!0},{name:"gotopagedown",bindKey:bindKey("PageDown","PageDown|Ctrl-V"),exec:function(editor){editor.gotoPageDown()},readOnly:!0},{name:"selectpageup",bindKey:"Shift-PageUp",exec:function(editor){editor.selectPageUp()},readOnly:!0},{name:"pageup",bindKey:bindKey(null,"Option-PageUp"),exec:function(editor){editor.scrollPageUp()},readOnly:!0},{name:"gotopageup",bindKey:"PageUp",exec:function(editor){editor.gotoPageUp()},readOnly:!0},{name:"scrollup",bindKey:bindKey("Ctrl-Up",null),exec:function(e){e.renderer.scrollBy(0,-2*e.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"scrolldown",bindKey:bindKey("Ctrl-Down",null),exec:function(e){e.renderer.scrollBy(0,2*e.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"selectlinestart",bindKey:"Shift-Home",exec:function(editor){editor.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectlineend",bindKey:"Shift-End",exec:function(editor){editor.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"togglerecording",bindKey:bindKey("Ctrl-Alt-E","Command-Option-E"),exec:function(editor){editor.commands.toggleRecording(editor)},readOnly:!0},{name:"replaymacro",bindKey:bindKey("Ctrl-Shift-E","Command-Shift-E"),exec:function(editor){editor.commands.replay(editor)},readOnly:!0},{name:"jumptomatching",bindKey:bindKey("Ctrl-P","Ctrl-P"),exec:function(editor){editor.jumpToMatching()},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"selecttomatching",bindKey:bindKey("Ctrl-Shift-P","Ctrl-Shift-P"),exec:function(editor){editor.jumpToMatching(!0)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"expandToMatching",bindKey:bindKey("Ctrl-Shift-M","Ctrl-Shift-M"),exec:function(editor){editor.jumpToMatching(!0,!0)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"passKeysToBrowser",bindKey:bindKey(null,null),exec:function(){},passEvent:!0,readOnly:!0},{name:"copy",exec:function(editor){},readOnly:!0},{name:"cut",exec:function(editor){var range=editor.getSelectionRange();editor._emit("cut",range),editor.selection.isEmpty()||(editor.session.remove(range),editor.clearSelection())},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"paste",exec:function(editor,args){editor.$handlePaste(args)},scrollIntoView:"cursor"},{name:"removeline",bindKey:bindKey("Ctrl-D","Command-D"),exec:function(editor){editor.removeLines()},scrollIntoView:"cursor",multiSelectAction:"forEachLine"},{name:"duplicateSelection",bindKey:bindKey("Ctrl-Shift-D","Command-Shift-D"),exec:function(editor){editor.duplicateSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"sortlines",bindKey:bindKey("Ctrl-Alt-S","Command-Alt-S"),exec:function(editor){editor.sortLines()},scrollIntoView:"selection",multiSelectAction:"forEachLine"},{name:"togglecomment",bindKey:bindKey("Ctrl-/","Command-/"),exec:function(editor){editor.toggleCommentLines()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"toggleBlockComment",bindKey:bindKey("Ctrl-Shift-/","Command-Shift-/"),exec:function(editor){editor.toggleBlockComment()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"modifyNumberUp",bindKey:bindKey("Ctrl-Shift-Up","Alt-Shift-Up"),exec:function(editor){editor.modifyNumber(1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"modifyNumberDown",bindKey:bindKey("Ctrl-Shift-Down","Alt-Shift-Down"),exec:function(editor){editor.modifyNumber(-1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"replace",bindKey:bindKey("Ctrl-H","Command-Option-F"),exec:function(editor){config.loadModule("ace/ext/searchbox",function(e){e.Search(editor,!0)})}},{name:"undo",bindKey:bindKey("Ctrl-Z","Command-Z"),exec:function(editor){editor.undo()}},{name:"redo",bindKey:bindKey("Ctrl-Shift-Z|Ctrl-Y","Command-Shift-Z|Command-Y"),exec:function(editor){editor.redo()}},{name:"copylinesup",bindKey:bindKey("Alt-Shift-Up","Command-Option-Up"),exec:function(editor){editor.copyLinesUp()},scrollIntoView:"cursor"},{name:"movelinesup",bindKey:bindKey("Alt-Up","Option-Up"),exec:function(editor){editor.moveLinesUp()},scrollIntoView:"cursor"},{name:"copylinesdown",bindKey:bindKey("Alt-Shift-Down","Command-Option-Down"),exec:function(editor){editor.copyLinesDown()},scrollIntoView:"cursor"},{name:"movelinesdown",bindKey:bindKey("Alt-Down","Option-Down"),exec:function(editor){editor.moveLinesDown()},scrollIntoView:"cursor"},{name:"del",bindKey:bindKey("Delete","Delete|Ctrl-D|Shift-Delete"),exec:function(editor){editor.remove("right")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"backspace",bindKey:bindKey("Shift-Backspace|Backspace","Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"),exec:function(editor){editor.remove("left")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"cut_or_delete",bindKey:bindKey("Shift-Delete",null),exec:function(editor){return editor.selection.isEmpty()?void editor.remove("left"):!1},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestart",bindKey:bindKey("Alt-Backspace","Command-Backspace"),exec:function(editor){editor.removeToLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineend",bindKey:bindKey("Alt-Delete","Ctrl-K"),exec:function(editor){editor.removeToLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordleft",bindKey:bindKey("Ctrl-Backspace","Alt-Backspace|Ctrl-Alt-Backspace"),exec:function(editor){editor.removeWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordright",bindKey:bindKey("Ctrl-Delete","Alt-Delete"),exec:function(editor){editor.removeWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"outdent",bindKey:bindKey("Shift-Tab","Shift-Tab"),exec:function(editor){editor.blockOutdent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"indent",bindKey:bindKey("Tab","Tab"),exec:function(editor){editor.indent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"blockoutdent",bindKey:bindKey("Ctrl-[","Ctrl-["),exec:function(editor){editor.blockOutdent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"blockindent",bindKey:bindKey("Ctrl-]","Ctrl-]"),exec:function(editor){editor.blockIndent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"insertstring",exec:function(editor,str){editor.insert(str)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"inserttext",exec:function(editor,args){editor.insert(lang.stringRepeat(args.text||"",args.times||1))},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"splitline",bindKey:bindKey(null,"Ctrl-O"),exec:function(editor){editor.splitLine()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"transposeletters",bindKey:bindKey("Ctrl-T","Ctrl-T"),exec:function(editor){editor.transposeLetters()},multiSelectAction:function(editor){editor.transposeSelections(1)},scrollIntoView:"cursor"},{name:"touppercase",bindKey:bindKey("Ctrl-U","Ctrl-U"),exec:function(editor){editor.toUpperCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"tolowercase",bindKey:bindKey("Ctrl-Shift-U","Ctrl-Shift-U"),exec:function(editor){editor.toLowerCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"expandtoline",bindKey:bindKey("Ctrl-Shift-L","Command-Shift-L"),exec:function(editor){var range=editor.selection.getRange();range.start.column=range.end.column=0,range.end.row++,editor.selection.setRange(range,!1)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"joinlines",bindKey:bindKey(null,null),exec:function(editor){for(var isBackwards=editor.selection.isBackwards(),selectionStart=isBackwards?editor.selection.getSelectionLead():editor.selection.getSelectionAnchor(),selectionEnd=isBackwards?editor.selection.getSelectionAnchor():editor.selection.getSelectionLead(),firstLineEndCol=editor.session.doc.getLine(selectionStart.row).length,selectedText=editor.session.doc.getTextRange(editor.selection.getRange()),selectedCount=selectedText.replace(/\n\s*/," ").length,insertLine=editor.session.doc.getLine(selectionStart.row),i=selectionStart.row+1;i<=selectionEnd.row+1;i++){var curLine=lang.stringTrimLeft(lang.stringTrimRight(editor.session.doc.getLine(i)));0!==curLine.length&&(curLine=" "+curLine),insertLine+=curLine}selectionEnd.row+1<editor.session.doc.getLength()-1&&(insertLine+=editor.session.doc.getNewLineCharacter()),editor.clearSelection(),editor.session.doc.replace(new Range(selectionStart.row,0,selectionEnd.row+2,0),insertLine),selectedCount>0?(editor.selection.moveCursorTo(selectionStart.row,selectionStart.column),editor.selection.selectTo(selectionStart.row,selectionStart.column+selectedCount)):(firstLineEndCol=editor.session.doc.getLine(selectionStart.row).length>firstLineEndCol?firstLineEndCol+1:firstLineEndCol,editor.selection.moveCursorTo(selectionStart.row,firstLineEndCol))},multiSelectAction:"forEach",readOnly:!0},{name:"invertSelection",bindKey:bindKey(null,null),exec:function(editor){var endRow=editor.session.doc.getLength()-1,endCol=editor.session.doc.getLine(endRow).length,ranges=editor.selection.rangeList.ranges,newRanges=[];ranges.length<1&&(ranges=[editor.selection.getRange()]);for(var i=0;i<ranges.length;i++)i==ranges.length-1&&(ranges[i].end.row!==endRow||ranges[i].end.column!==endCol)&&newRanges.push(new Range(ranges[i].end.row,ranges[i].end.column,endRow,endCol)),0===i?(0!==ranges[i].start.row||0!==ranges[i].start.column)&&newRanges.push(new Range(0,0,ranges[i].start.row,ranges[i].start.column)):newRanges.push(new Range(ranges[i-1].end.row,ranges[i-1].end.column,ranges[i].start.row,ranges[i].start.column));editor.exitMultiSelectMode(),editor.clearSelection();for(var i=0;i<newRanges.length;i++)editor.selection.addRange(newRanges[i],!1)},readOnly:!0,scrollIntoView:"none"}]}),ace.define("ace/editor",["require","exports","module","ace/lib/fixoldbrowsers","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/keyboard/textinput","ace/mouse/mouse_handler","ace/mouse/fold_handler","ace/keyboard/keybinding","ace/edit_session","ace/search","ace/range","ace/lib/event_emitter","ace/commands/command_manager","ace/commands/default_commands","ace/config","ace/token_iterator"],function(require,exports,module){"use strict";require("./lib/fixoldbrowsers");var oop=require("./lib/oop"),dom=require("./lib/dom"),lang=require("./lib/lang"),useragent=require("./lib/useragent"),TextInput=require("./keyboard/textinput").TextInput,MouseHandler=require("./mouse/mouse_handler").MouseHandler,FoldHandler=require("./mouse/fold_handler").FoldHandler,KeyBinding=require("./keyboard/keybinding").KeyBinding,EditSession=require("./edit_session").EditSession,Search=require("./search").Search,Range=require("./range").Range,EventEmitter=require("./lib/event_emitter").EventEmitter,CommandManager=require("./commands/command_manager").CommandManager,defaultCommands=require("./commands/default_commands").commands,config=require("./config"),TokenIterator=require("./token_iterator").TokenIterator,Editor=function(renderer,session){var container=renderer.getContainerElement();this.container=container,this.renderer=renderer,this.commands=new CommandManager(useragent.isMac?"mac":"win",defaultCommands),this.textInput=new TextInput(renderer.getTextAreaContainer(),this),this.renderer.textarea=this.textInput.getElement(),this.keyBinding=new KeyBinding(this),this.$mouseHandler=new MouseHandler(this),new FoldHandler(this),this.$blockScrolling=0,this.$search=(new Search).set({wrap:!0}),this.$historyTracker=this.$historyTracker.bind(this),this.commands.on("exec",this.$historyTracker),this.$initOperationListeners(),this._$emitInputEvent=lang.delayedCall(function(){this._signal("input",{}),this.session&&this.session.bgTokenizer&&this.session.bgTokenizer.scheduleStart()}.bind(this)),this.on("change",function(_,_self){_self._$emitInputEvent.schedule(31)}),this.setSession(session||new EditSession("")),config.resetOptions(this),config._signal("editor",this)};(function(){oop.implement(this,EventEmitter),this.$initOperationListeners=function(){this.selections=[],this.commands.on("exec",this.startOperation.bind(this),!0),
this.commands.on("afterExec",this.endOperation.bind(this),!0),this.$opResetTimer=lang.delayedCall(this.endOperation.bind(this)),this.on("change",function(){this.curOp||this.startOperation(),this.curOp.docChanged=!0}.bind(this),!0),this.on("changeSelection",function(){this.curOp||this.startOperation(),this.curOp.selectionChanged=!0}.bind(this),!0)},this.curOp=null,this.prevOp={},this.startOperation=function(commadEvent){if(this.curOp){if(!commadEvent||this.curOp.command)return;this.prevOp=this.curOp}commadEvent||(this.previousCommand=null,commadEvent={}),this.$opResetTimer.schedule(),this.curOp={command:commadEvent.command||{},args:commadEvent.args,scrollTop:this.renderer.scrollTop},this.curOp.command.name&&void 0!==this.curOp.command.scrollIntoView&&this.$blockScrolling++},this.endOperation=function(e){if(this.curOp){if(e&&e.returnValue===!1)return this.curOp=null;this._signal("beforeEndOperation");var command=this.curOp.command;command.name&&this.$blockScrolling>0&&this.$blockScrolling--;var scrollIntoView=command&&command.scrollIntoView;if(scrollIntoView){switch(scrollIntoView){case"center-animate":scrollIntoView="animate";case"center":this.renderer.scrollCursorIntoView(null,.5);break;case"animate":case"cursor":this.renderer.scrollCursorIntoView();break;case"selectionPart":var range=this.selection.getRange(),config=this.renderer.layerConfig;(range.start.row>=config.lastRow||range.end.row<=config.firstRow)&&this.renderer.scrollSelectionIntoView(this.selection.anchor,this.selection.lead)}"animate"==scrollIntoView&&this.renderer.animateScrolling(this.curOp.scrollTop)}this.prevOp=this.curOp,this.curOp=null}},this.$mergeableCommands=["backspace","del","insertstring"],this.$historyTracker=function(e){if(this.$mergeUndoDeltas){var prev=this.prevOp,mergeableCommands=this.$mergeableCommands,shouldMerge=prev.command&&e.command.name==prev.command.name;if("insertstring"==e.command.name){var text=e.args;void 0===this.mergeNextCommand&&(this.mergeNextCommand=!0),shouldMerge=shouldMerge&&this.mergeNextCommand&&(!/\s/.test(text)||/\s/.test(prev.args)),this.mergeNextCommand=!0}else shouldMerge=shouldMerge&&-1!==mergeableCommands.indexOf(e.command.name);"always"!=this.$mergeUndoDeltas&&Date.now()-this.sequenceStartTime>2e3&&(shouldMerge=!1),shouldMerge?this.session.mergeUndoDeltas=!0:-1!==mergeableCommands.indexOf(e.command.name)&&(this.sequenceStartTime=Date.now())}},this.setKeyboardHandler=function(keyboardHandler,cb){if(keyboardHandler&&"string"==typeof keyboardHandler){this.$keybindingId=keyboardHandler;var _self=this;config.loadModule(["keybinding",keyboardHandler],function(module){_self.$keybindingId==keyboardHandler&&_self.keyBinding.setKeyboardHandler(module&&module.handler),cb&&cb()})}else this.$keybindingId=null,this.keyBinding.setKeyboardHandler(keyboardHandler),cb&&cb()},this.getKeyboardHandler=function(){return this.keyBinding.getKeyboardHandler()},this.setSession=function(session){if(this.session!=session){this.curOp&&this.endOperation(),this.curOp={};var oldSession=this.session;if(oldSession){this.session.off("change",this.$onDocumentChange),this.session.off("changeMode",this.$onChangeMode),this.session.off("tokenizerUpdate",this.$onTokenizerUpdate),this.session.off("changeTabSize",this.$onChangeTabSize),this.session.off("changeWrapLimit",this.$onChangeWrapLimit),this.session.off("changeWrapMode",this.$onChangeWrapMode),this.session.off("changeFold",this.$onChangeFold),this.session.off("changeFrontMarker",this.$onChangeFrontMarker),this.session.off("changeBackMarker",this.$onChangeBackMarker),this.session.off("changeBreakpoint",this.$onChangeBreakpoint),this.session.off("changeAnnotation",this.$onChangeAnnotation),this.session.off("changeOverwrite",this.$onCursorChange),this.session.off("changeScrollTop",this.$onScrollTopChange),this.session.off("changeScrollLeft",this.$onScrollLeftChange);var selection=this.session.getSelection();selection.off("changeCursor",this.$onCursorChange),selection.off("changeSelection",this.$onSelectionChange)}this.session=session,session?(this.$onDocumentChange=this.onDocumentChange.bind(this),session.on("change",this.$onDocumentChange),this.renderer.setSession(session),this.$onChangeMode=this.onChangeMode.bind(this),session.on("changeMode",this.$onChangeMode),this.$onTokenizerUpdate=this.onTokenizerUpdate.bind(this),session.on("tokenizerUpdate",this.$onTokenizerUpdate),this.$onChangeTabSize=this.renderer.onChangeTabSize.bind(this.renderer),session.on("changeTabSize",this.$onChangeTabSize),this.$onChangeWrapLimit=this.onChangeWrapLimit.bind(this),session.on("changeWrapLimit",this.$onChangeWrapLimit),this.$onChangeWrapMode=this.onChangeWrapMode.bind(this),session.on("changeWrapMode",this.$onChangeWrapMode),this.$onChangeFold=this.onChangeFold.bind(this),session.on("changeFold",this.$onChangeFold),this.$onChangeFrontMarker=this.onChangeFrontMarker.bind(this),this.session.on("changeFrontMarker",this.$onChangeFrontMarker),this.$onChangeBackMarker=this.onChangeBackMarker.bind(this),this.session.on("changeBackMarker",this.$onChangeBackMarker),this.$onChangeBreakpoint=this.onChangeBreakpoint.bind(this),this.session.on("changeBreakpoint",this.$onChangeBreakpoint),this.$onChangeAnnotation=this.onChangeAnnotation.bind(this),this.session.on("changeAnnotation",this.$onChangeAnnotation),this.$onCursorChange=this.onCursorChange.bind(this),this.session.on("changeOverwrite",this.$onCursorChange),this.$onScrollTopChange=this.onScrollTopChange.bind(this),this.session.on("changeScrollTop",this.$onScrollTopChange),this.$onScrollLeftChange=this.onScrollLeftChange.bind(this),this.session.on("changeScrollLeft",this.$onScrollLeftChange),this.selection=session.getSelection(),this.selection.on("changeCursor",this.$onCursorChange),this.$onSelectionChange=this.onSelectionChange.bind(this),this.selection.on("changeSelection",this.$onSelectionChange),this.onChangeMode(),this.$blockScrolling+=1,this.onCursorChange(),this.$blockScrolling-=1,this.onScrollTopChange(),this.onScrollLeftChange(),this.onSelectionChange(),this.onChangeFrontMarker(),this.onChangeBackMarker(),this.onChangeBreakpoint(),this.onChangeAnnotation(),this.session.getUseWrapMode()&&this.renderer.adjustWrapLimit(),this.renderer.updateFull()):(this.selection=null,this.renderer.setSession(session)),this._signal("changeSession",{session:session,oldSession:oldSession}),this.curOp=null,oldSession&&oldSession._signal("changeEditor",{oldEditor:this}),session&&session._signal("changeEditor",{editor:this})}},this.getSession=function(){return this.session},this.setValue=function(val,cursorPos){return this.session.doc.setValue(val),cursorPos?1==cursorPos?this.navigateFileEnd():-1==cursorPos&&this.navigateFileStart():this.selectAll(),val},this.getValue=function(){return this.session.getValue()},this.getSelection=function(){return this.selection},this.resize=function(force){this.renderer.onResize(force)},this.setTheme=function(theme,cb){this.renderer.setTheme(theme,cb)},this.getTheme=function(){return this.renderer.getTheme()},this.setStyle=function(style){this.renderer.setStyle(style)},this.unsetStyle=function(style){this.renderer.unsetStyle(style)},this.getFontSize=function(){return this.getOption("fontSize")||dom.computedStyle(this.container,"fontSize")},this.setFontSize=function(size){this.setOption("fontSize",size)},this.$highlightBrackets=function(){if(this.session.$bracketHighlight&&(this.session.removeMarker(this.session.$bracketHighlight),this.session.$bracketHighlight=null),!this.$highlightPending){var self=this;this.$highlightPending=!0,setTimeout(function(){self.$highlightPending=!1;var session=self.session;if(session&&session.bgTokenizer){var pos=session.findMatchingBracket(self.getCursorPosition());if(pos)var range=new Range(pos.row,pos.column,pos.row,pos.column+1);else if(session.$mode.getMatching)var range=session.$mode.getMatching(self.session);range&&(session.$bracketHighlight=session.addMarker(range,"ace_bracket","text"))}},50)}},this.$highlightTags=function(){if(!this.$highlightTagPending){var self=this;this.$highlightTagPending=!0,setTimeout(function(){self.$highlightTagPending=!1;var session=self.session;if(session&&session.bgTokenizer){var pos=self.getCursorPosition(),iterator=new TokenIterator(self.session,pos.row,pos.column),token=iterator.getCurrentToken();if(!token||!/\b(?:tag-open|tag-name)/.test(token.type))return session.removeMarker(session.$tagHighlight),void(session.$tagHighlight=null);if(-1==token.type.indexOf("tag-open")||(token=iterator.stepForward())){var tag=token.value,depth=0,prevToken=iterator.stepBackward();if("<"==prevToken.value){do prevToken=token,token=iterator.stepForward(),token&&token.value===tag&&-1!==token.type.indexOf("tag-name")&&("<"===prevToken.value?depth++:"</"===prevToken.value&&depth--);while(token&&depth>=0)}else{do token=prevToken,prevToken=iterator.stepBackward(),token&&token.value===tag&&-1!==token.type.indexOf("tag-name")&&("<"===prevToken.value?depth++:"</"===prevToken.value&&depth--);while(prevToken&&0>=depth);iterator.stepForward()}if(!token)return session.removeMarker(session.$tagHighlight),void(session.$tagHighlight=null);var row=iterator.getCurrentTokenRow(),column=iterator.getCurrentTokenColumn(),range=new Range(row,column,row,column+token.value.length);session.$tagHighlight&&0!==range.compareRange(session.$backMarkers[session.$tagHighlight].range)&&(session.removeMarker(session.$tagHighlight),session.$tagHighlight=null),range&&!session.$tagHighlight&&(session.$tagHighlight=session.addMarker(range,"ace_bracket","text"))}}},50)}},this.focus=function(){var _self=this;setTimeout(function(){_self.textInput.focus()}),this.textInput.focus()},this.isFocused=function(){return this.textInput.isFocused()},this.blur=function(){this.textInput.blur()},this.onFocus=function(e){this.$isFocused||(this.$isFocused=!0,this.renderer.showCursor(),this.renderer.visualizeFocus(),this._emit("focus",e))},this.onBlur=function(e){this.$isFocused&&(this.$isFocused=!1,this.renderer.hideCursor(),this.renderer.visualizeBlur(),this._emit("blur",e))},this.$cursorChange=function(){this.renderer.updateCursor()},this.onDocumentChange=function(delta){var wrap=this.session.$useWrapMode,lastRow=delta.start.row==delta.end.row?delta.end.row:1/0;this.renderer.updateLines(delta.start.row,lastRow,wrap),this._signal("change",delta),this.$cursorChange(),this.$updateHighlightActiveLine()},this.onTokenizerUpdate=function(e){var rows=e.data;this.renderer.updateLines(rows.first,rows.last)},this.onScrollTopChange=function(){this.renderer.scrollToY(this.session.getScrollTop())},this.onScrollLeftChange=function(){this.renderer.scrollToX(this.session.getScrollLeft())},this.onCursorChange=function(){this.$cursorChange(),this.$blockScrolling||(config.warn("Automatically scrolling cursor into view after selection change","this will be disabled in the next version","set editor.$blockScrolling = Infinity to disable this message"),this.renderer.scrollCursorIntoView()),this.$highlightBrackets(),this.$highlightTags(),this.$updateHighlightActiveLine(),this._signal("changeSelection")},this.$updateHighlightActiveLine=function(){var highlight,session=this.getSession();if(this.$highlightActiveLine&&("line"==this.$selectionStyle&&this.selection.isMultiLine()||(highlight=this.getCursorPosition()),!this.renderer.$maxLines||1!==this.session.getLength()||this.renderer.$minLines>1||(highlight=!1)),session.$highlightLineMarker&&!highlight)session.removeMarker(session.$highlightLineMarker.id),session.$highlightLineMarker=null;else if(!session.$highlightLineMarker&&highlight){var range=new Range(highlight.row,highlight.column,highlight.row,1/0);range.id=session.addMarker(range,"ace_active-line","screenLine"),session.$highlightLineMarker=range}else highlight&&(session.$highlightLineMarker.start.row=highlight.row,session.$highlightLineMarker.end.row=highlight.row,session.$highlightLineMarker.start.column=highlight.column,session._signal("changeBackMarker"))},this.onSelectionChange=function(e){var session=this.session;if(session.$selectionMarker&&session.removeMarker(session.$selectionMarker),session.$selectionMarker=null,this.selection.isEmpty())this.$updateHighlightActiveLine();else{var range=this.selection.getRange(),style=this.getSelectionStyle();session.$selectionMarker=session.addMarker(range,"ace_selection",style)}var re=this.$highlightSelectedWord&&this.$getSelectionHighLightRegexp();this.session.highlight(re),this._signal("changeSelection")},this.$getSelectionHighLightRegexp=function(){var session=this.session,selection=this.getSelectionRange();if(!selection.isEmpty()&&!selection.isMultiLine()){var startOuter=selection.start.column-1,endOuter=selection.end.column+1,line=session.getLine(selection.start.row),lineCols=line.length,needle=line.substring(Math.max(startOuter,0),Math.min(endOuter,lineCols));if(!(startOuter>=0&&/^[\w\d]/.test(needle)||lineCols>=endOuter&&/[\w\d]$/.test(needle))&&(needle=line.substring(selection.start.column,selection.end.column),/^[\w\d]+$/.test(needle))){var re=this.$search.$assembleRegExp({wholeWord:!0,caseSensitive:!0,needle:needle});return re}}},this.onChangeFrontMarker=function(){this.renderer.updateFrontMarkers()},this.onChangeBackMarker=function(){this.renderer.updateBackMarkers()},this.onChangeBreakpoint=function(){this.renderer.updateBreakpoints()},this.onChangeAnnotation=function(){this.renderer.setAnnotations(this.session.getAnnotations())},this.onChangeMode=function(e){this.renderer.updateText(),this._emit("changeMode",e)},this.onChangeWrapLimit=function(){this.renderer.updateFull()},this.onChangeWrapMode=function(){this.renderer.onResize(!0)},this.onChangeFold=function(){this.$updateHighlightActiveLine(),this.renderer.updateFull()},this.getSelectedText=function(){return this.session.getTextRange(this.getSelectionRange())},this.getCopyText=function(){var text=this.getSelectedText();return this._signal("copy",text),text},this.onCopy=function(){this.commands.exec("copy",this)},this.onCut=function(){this.commands.exec("cut",this)},this.onPaste=function(text,event){var e={text:text,event:event};this.commands.exec("paste",this,e)},this.$handlePaste=function(e){"string"==typeof e&&(e={text:e}),this._signal("paste",e);var text=e.text;if(!this.inMultiSelectMode||this.inVirtualSelectionMode)this.insert(text);else{var lines=text.split(/\r\n|\r|\n/),ranges=this.selection.rangeList.ranges;if(lines.length>ranges.length||lines.length<2||!lines[1])return this.commands.exec("insertstring",this,text);for(var i=ranges.length;i--;){var range=ranges[i];range.isEmpty()||this.session.remove(range),this.session.insert(range.start,lines[i])}}},this.execCommand=function(command,args){return this.commands.exec(command,this,args)},this.insert=function(text,pasted){var session=this.session,mode=session.getMode(),cursor=this.getCursorPosition();if(this.getBehavioursEnabled()&&!pasted){var transform=mode.transformAction(session.getState(cursor.row),"insertion",this,session,text);transform&&(text!==transform.text&&(this.session.mergeUndoDeltas=!1,this.$mergeNextCommand=!1),text=transform.text)}if("	"==text&&(text=this.session.getTabString()),this.selection.isEmpty()){if(this.session.getOverwrite()){var range=new Range.fromPoints(cursor,cursor);range.end.column+=text.length,this.session.remove(range)}}else{var range=this.getSelectionRange();cursor=this.session.remove(range),this.clearSelection()}if("\n"==text||"\r\n"==text){var line=session.getLine(cursor.row);if(cursor.column>line.search(/\S|$/)){var d=line.substr(cursor.column).search(/\S|$/);session.doc.removeInLine(cursor.row,cursor.column,cursor.column+d)}}this.clearSelection();var start=cursor.column,lineState=session.getState(cursor.row),line=session.getLine(cursor.row),shouldOutdent=mode.checkOutdent(lineState,line,text);session.insert(cursor,text);if(transform&&transform.selection&&(2==transform.selection.length?this.selection.setSelectionRange(new Range(cursor.row,start+transform.selection[0],cursor.row,start+transform.selection[1])):this.selection.setSelectionRange(new Range(cursor.row+transform.selection[0],transform.selection[1],cursor.row+transform.selection[2],transform.selection[3]))),session.getDocument().isNewLine(text)){var lineIndent=mode.getNextLineIndent(lineState,line.slice(0,cursor.column),session.getTabString());session.insert({row:cursor.row+1,column:0},lineIndent)}shouldOutdent&&mode.autoOutdent(lineState,session,cursor.row)},this.onTextInput=function(text){this.keyBinding.onTextInput(text)},this.onCommandKey=function(e,hashId,keyCode){this.keyBinding.onCommandKey(e,hashId,keyCode)},this.setOverwrite=function(overwrite){this.session.setOverwrite(overwrite)},this.getOverwrite=function(){return this.session.getOverwrite()},this.toggleOverwrite=function(){this.session.toggleOverwrite()},this.setScrollSpeed=function(speed){this.setOption("scrollSpeed",speed)},this.getScrollSpeed=function(){return this.getOption("scrollSpeed")},this.setDragDelay=function(dragDelay){this.setOption("dragDelay",dragDelay)},this.getDragDelay=function(){return this.getOption("dragDelay")},this.setSelectionStyle=function(val){this.setOption("selectionStyle",val)},this.getSelectionStyle=function(){return this.getOption("selectionStyle")},this.setHighlightActiveLine=function(shouldHighlight){this.setOption("highlightActiveLine",shouldHighlight)},this.getHighlightActiveLine=function(){return this.getOption("highlightActiveLine")},this.setHighlightGutterLine=function(shouldHighlight){this.setOption("highlightGutterLine",shouldHighlight)},this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},this.setHighlightSelectedWord=function(shouldHighlight){this.setOption("highlightSelectedWord",shouldHighlight)},this.getHighlightSelectedWord=function(){return this.$highlightSelectedWord},this.setAnimatedScroll=function(shouldAnimate){this.renderer.setAnimatedScroll(shouldAnimate)},this.getAnimatedScroll=function(){return this.renderer.getAnimatedScroll()},this.setShowInvisibles=function(showInvisibles){this.renderer.setShowInvisibles(showInvisibles)},this.getShowInvisibles=function(){return this.renderer.getShowInvisibles()},this.setDisplayIndentGuides=function(display){this.renderer.setDisplayIndentGuides(display)},this.getDisplayIndentGuides=function(){return this.renderer.getDisplayIndentGuides()},this.setShowPrintMargin=function(showPrintMargin){this.renderer.setShowPrintMargin(showPrintMargin)},this.getShowPrintMargin=function(){return this.renderer.getShowPrintMargin()},this.setPrintMarginColumn=function(showPrintMargin){this.renderer.setPrintMarginColumn(showPrintMargin)},this.getPrintMarginColumn=function(){return this.renderer.getPrintMarginColumn()},this.setReadOnly=function(readOnly){this.setOption("readOnly",readOnly)},this.getReadOnly=function(){return this.getOption("readOnly")},this.setBehavioursEnabled=function(enabled){this.setOption("behavioursEnabled",enabled)},this.getBehavioursEnabled=function(){return this.getOption("behavioursEnabled")},this.setWrapBehavioursEnabled=function(enabled){this.setOption("wrapBehavioursEnabled",enabled)},this.getWrapBehavioursEnabled=function(){return this.getOption("wrapBehavioursEnabled")},this.setShowFoldWidgets=function(show){this.setOption("showFoldWidgets",show)},this.getShowFoldWidgets=function(){return this.getOption("showFoldWidgets")},this.setFadeFoldWidgets=function(fade){this.setOption("fadeFoldWidgets",fade)},this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},this.remove=function(dir){this.selection.isEmpty()&&("left"==dir?this.selection.selectLeft():this.selection.selectRight());var range=this.getSelectionRange();if(this.getBehavioursEnabled()){var session=this.session,state=session.getState(range.start.row),new_range=session.getMode().transformAction(state,"deletion",this,session,range);if(0===range.end.column){var text=session.getTextRange(range);if("\n"==text[text.length-1]){var line=session.getLine(range.end.row);/^\s+$/.test(line)&&(range.end.column=line.length)}}new_range&&(range=new_range)}this.session.remove(range),this.clearSelection()},this.removeWordRight=function(){this.selection.isEmpty()&&this.selection.selectWordRight(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeWordLeft=function(){this.selection.isEmpty()&&this.selection.selectWordLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeToLineStart=function(){this.selection.isEmpty()&&this.selection.selectLineStart(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeToLineEnd=function(){this.selection.isEmpty()&&this.selection.selectLineEnd();var range=this.getSelectionRange();range.start.column==range.end.column&&range.start.row==range.end.row&&(range.end.column=0,range.end.row++),this.session.remove(range),this.clearSelection()},this.splitLine=function(){this.selection.isEmpty()||(this.session.remove(this.getSelectionRange()),this.clearSelection());var cursor=this.getCursorPosition();this.insert("\n"),this.moveCursorToPosition(cursor)},this.transposeLetters=function(){if(this.selection.isEmpty()){var cursor=this.getCursorPosition(),column=cursor.column;if(0!==column){var swap,range,line=this.session.getLine(cursor.row);column<line.length?(swap=line.charAt(column)+line.charAt(column-1),range=new Range(cursor.row,column-1,cursor.row,column+1)):(swap=line.charAt(column-1)+line.charAt(column-2),range=new Range(cursor.row,column-2,cursor.row,column)),this.session.replace(range,swap)}}},this.toLowerCase=function(){var originalRange=this.getSelectionRange();this.selection.isEmpty()&&this.selection.selectWord();var range=this.getSelectionRange(),text=this.session.getTextRange(range);this.session.replace(range,text.toLowerCase()),this.selection.setSelectionRange(originalRange)},this.toUpperCase=function(){var originalRange=this.getSelectionRange();this.selection.isEmpty()&&this.selection.selectWord();var range=this.getSelectionRange(),text=this.session.getTextRange(range);this.session.replace(range,text.toUpperCase()),this.selection.setSelectionRange(originalRange)},this.indent=function(){var session=this.session,range=this.getSelectionRange();if(range.start.row<range.end.row){var rows=this.$getSelectedRows();return void session.indentRows(rows.first,rows.last,"	")}if(range.start.column<range.end.column){var text=session.getTextRange(range);if(!/^\s+$/.test(text)){var rows=this.$getSelectedRows();return void session.indentRows(rows.first,rows.last,"	")}}var line=session.getLine(range.start.row),position=range.start,size=session.getTabSize(),column=session.documentToScreenColumn(position.row,position.column);if(this.session.getUseSoftTabs())var count=size-column%size,indentString=lang.stringRepeat(" ",count);else{for(var count=column%size;" "==line[range.start.column-1]&&count;)range.start.column--,count--;this.selection.setSelectionRange(range),indentString="	"}return this.insert(indentString)},this.blockIndent=function(){var rows=this.$getSelectedRows();this.session.indentRows(rows.first,rows.last,"	")},this.blockOutdent=function(){var selection=this.session.getSelection();this.session.outdentRows(selection.getRange())},this.sortLines=function(){var rows=this.$getSelectedRows(),session=this.session,lines=[];for(i=rows.first;i<=rows.last;i++)lines.push(session.getLine(i));lines.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:a.toLowerCase()>b.toLowerCase()?1:0});for(var deleteRange=new Range(0,0,0,0),i=rows.first;i<=rows.last;i++){var line=session.getLine(i);deleteRange.start.row=i,deleteRange.end.row=i,deleteRange.end.column=line.length,session.replace(deleteRange,lines[i-rows.first])}},this.toggleCommentLines=function(){var state=this.session.getState(this.getCursorPosition().row),rows=this.$getSelectedRows();this.session.getMode().toggleCommentLines(state,this.session,rows.first,rows.last)},this.toggleBlockComment=function(){var cursor=this.getCursorPosition(),state=this.session.getState(cursor.row),range=this.getSelectionRange();this.session.getMode().toggleBlockComment(state,this.session,range,cursor)},this.getNumberAt=function(row,column){var _numberRx=/[\-]?[0-9]+(?:\.[0-9]+)?/g;_numberRx.lastIndex=0;for(var s=this.session.getLine(row);_numberRx.lastIndex<column;){var m=_numberRx.exec(s);if(m.index<=column&&m.index+m[0].length>=column){var number={value:m[0],start:m.index,end:m.index+m[0].length};return number}}return null},this.modifyNumber=function(amount){var row=this.selection.getCursor().row,column=this.selection.getCursor().column,charRange=new Range(row,column-1,row,column),c=this.session.getTextRange(charRange);if(!isNaN(parseFloat(c))&&isFinite(c)){var nr=this.getNumberAt(row,column);if(nr){var fp=nr.value.indexOf(".")>=0?nr.start+nr.value.indexOf(".")+1:nr.end,decimals=nr.start+nr.value.length-fp,t=parseFloat(nr.value);t*=Math.pow(10,decimals),amount*=fp!==nr.end&&fp>column?Math.pow(10,nr.end-column-1):Math.pow(10,nr.end-column),t+=amount,t/=Math.pow(10,decimals);var nnr=t.toFixed(decimals),replaceRange=new Range(row,nr.start,row,nr.end);this.session.replace(replaceRange,nnr),this.moveCursorTo(row,Math.max(nr.start+1,column+nnr.length-nr.value.length))}}},this.removeLines=function(){var rows=this.$getSelectedRows();this.session.removeFullLines(rows.first,rows.last),this.clearSelection()},this.duplicateSelection=function(){var sel=this.selection,doc=this.session,range=sel.getRange(),reverse=sel.isBackwards();if(range.isEmpty()){var row=range.start.row;doc.duplicateLines(row,row)}else{var point=reverse?range.start:range.end,endPoint=doc.insert(point,doc.getTextRange(range),!1);range.start=point,range.end=endPoint,sel.setSelectionRange(range,reverse)}},this.moveLinesDown=function(){this.$moveLines(1,!1)},this.moveLinesUp=function(){this.$moveLines(-1,!1)},this.moveText=function(range,toPosition,copy){return this.session.moveText(range,toPosition,copy)},this.copyLinesUp=function(){this.$moveLines(-1,!0)},this.copyLinesDown=function(){this.$moveLines(1,!0)},this.$moveLines=function(dir,copy){var rows,moved,selection=this.selection;if(!selection.inMultiSelectMode||this.inVirtualSelectionMode){var range=selection.toOrientedRange();rows=this.$getSelectedRows(range),moved=this.session.$moveLines(rows.first,rows.last,copy?0:dir),copy&&-1==dir&&(moved=0),range.moveBy(moved,0),selection.fromOrientedRange(range)}else{var ranges=selection.rangeList.ranges;selection.rangeList.detach(this.session),this.inVirtualSelectionMode=!0;for(var diff=0,totalDiff=0,l=ranges.length,i=0;l>i;i++){var rangeIndex=i;ranges[i].moveBy(diff,0),rows=this.$getSelectedRows(ranges[i]);for(var first=rows.first,last=rows.last;++i<l;){totalDiff&&ranges[i].moveBy(totalDiff,0);var subRows=this.$getSelectedRows(ranges[i]);if(copy&&subRows.first!=last)break;if(!copy&&subRows.first>last+1)break;last=subRows.last}for(i--,diff=this.session.$moveLines(first,last,copy?0:dir),copy&&-1==dir&&(rangeIndex=i+1);i>=rangeIndex;)ranges[rangeIndex].moveBy(diff,0),rangeIndex++;copy||(diff=0),totalDiff+=diff}selection.fromOrientedRange(selection.ranges[0]),selection.rangeList.attach(this.session),this.inVirtualSelectionMode=!1}},this.$getSelectedRows=function(range){return range=(range||this.getSelectionRange()).collapseRows(),{first:this.session.getRowFoldStart(range.start.row),last:this.session.getRowFoldEnd(range.end.row)}},this.onCompositionStart=function(text){this.renderer.showComposition(this.getCursorPosition())},this.onCompositionUpdate=function(text){this.renderer.setCompositionText(text)},this.onCompositionEnd=function(){this.renderer.hideComposition()},this.getFirstVisibleRow=function(){return this.renderer.getFirstVisibleRow()},this.getLastVisibleRow=function(){return this.renderer.getLastVisibleRow()},this.isRowVisible=function(row){return row>=this.getFirstVisibleRow()&&row<=this.getLastVisibleRow()},this.isRowFullyVisible=function(row){return row>=this.renderer.getFirstFullyVisibleRow()&&row<=this.renderer.getLastFullyVisibleRow()},this.$getVisibleRowCount=function(){return this.renderer.getScrollBottomRow()-this.renderer.getScrollTopRow()+1},this.$moveByPage=function(dir,select){var renderer=this.renderer,config=this.renderer.layerConfig,rows=dir*Math.floor(config.height/config.lineHeight);this.$blockScrolling++,select===!0?this.selection.$moveSelection(function(){this.moveCursorBy(rows,0)}):select===!1&&(this.selection.moveCursorBy(rows,0),this.selection.clearSelection()),this.$blockScrolling--;var scrollTop=renderer.scrollTop;renderer.scrollBy(0,rows*config.lineHeight),null!=select&&renderer.scrollCursorIntoView(null,.5),renderer.animateScrolling(scrollTop)},this.selectPageDown=function(){this.$moveByPage(1,!0)},this.selectPageUp=function(){this.$moveByPage(-1,!0)},this.gotoPageDown=function(){this.$moveByPage(1,!1)},this.gotoPageUp=function(){this.$moveByPage(-1,!1)},this.scrollPageDown=function(){this.$moveByPage(1)},this.scrollPageUp=function(){this.$moveByPage(-1)},this.scrollToRow=function(row){this.renderer.scrollToRow(row)},this.scrollToLine=function(line,center,animate,callback){this.renderer.scrollToLine(line,center,animate,callback)},this.centerSelection=function(){var range=this.getSelectionRange(),pos={row:Math.floor(range.start.row+(range.end.row-range.start.row)/2),column:Math.floor(range.start.column+(range.end.column-range.start.column)/2)};this.renderer.alignCursor(pos,.5)},this.getCursorPosition=function(){return this.selection.getCursor()},this.getCursorPositionScreen=function(){return this.session.documentToScreenPosition(this.getCursorPosition())},this.getSelectionRange=function(){return this.selection.getRange()},this.selectAll=function(){this.$blockScrolling+=1,this.selection.selectAll(),this.$blockScrolling-=1},this.clearSelection=function(){this.selection.clearSelection()},this.moveCursorTo=function(row,column){this.selection.moveCursorTo(row,column)},this.moveCursorToPosition=function(pos){this.selection.moveCursorToPosition(pos)},this.jumpToMatching=function(select,expand){var cursor=this.getCursorPosition(),iterator=new TokenIterator(this.session,cursor.row,cursor.column),prevToken=iterator.getCurrentToken(),token=prevToken||iterator.stepForward();if(token){var matchType,bracketType,found=!1,depth={},i=cursor.column-token.start,brackets={")":"(","(":"(","]":"[","[":"[","{":"{","}":"{"};do{if(token.value.match(/[{}()\[\]]/g)){for(;i<token.value.length&&!found;i++)if(brackets[token.value[i]])switch(bracketType=brackets[token.value[i]]+"."+token.type.replace("rparen","lparen"),isNaN(depth[bracketType])&&(depth[bracketType]=0),token.value[i]){case"(":case"[":case"{":depth[bracketType]++;break;case")":case"]":case"}":depth[bracketType]--,-1===depth[bracketType]&&(matchType="bracket",found=!0)}}else token&&-1!==token.type.indexOf("tag-name")&&(isNaN(depth[token.value])&&(depth[token.value]=0),"<"===prevToken.value?depth[token.value]++:"</"===prevToken.value&&depth[token.value]--,-1===depth[token.value]&&(matchType="tag",found=!0));found||(prevToken=token,token=iterator.stepForward(),i=0)}while(token&&!found);if(matchType){var range,pos;if("bracket"===matchType)range=this.session.getBracketRange(cursor),range||(range=new Range(iterator.getCurrentTokenRow(),iterator.getCurrentTokenColumn()+i-1,iterator.getCurrentTokenRow(),iterator.getCurrentTokenColumn()+i-1),pos=range.start,(expand||pos.row===cursor.row&&Math.abs(pos.column-cursor.column)<2)&&(range=this.session.getBracketRange(pos)));else if("tag"===matchType){if(!token||-1===token.type.indexOf("tag-name"))return;var tag=token.value;if(range=new Range(iterator.getCurrentTokenRow(),iterator.getCurrentTokenColumn()-2,iterator.getCurrentTokenRow(),iterator.getCurrentTokenColumn()-2),0===range.compare(cursor.row,cursor.column)){found=!1;do token=prevToken,prevToken=iterator.stepBackward(),prevToken&&(-1!==prevToken.type.indexOf("tag-close")&&range.setEnd(iterator.getCurrentTokenRow(),iterator.getCurrentTokenColumn()+1),token.value===tag&&-1!==token.type.indexOf("tag-name")&&("<"===prevToken.value?depth[tag]++:"</"===prevToken.value&&depth[tag]--,0===depth[tag]&&(found=!0)));while(prevToken&&!found);
}token&&token.type.indexOf("tag-name")&&(pos=range.start,pos.row==cursor.row&&Math.abs(pos.column-cursor.column)<2&&(pos=range.end))}pos=range&&range.cursor||pos,pos&&(select?range&&expand?this.selection.setRange(range):range&&range.isEqual(this.getSelectionRange())?this.clearSelection():this.selection.selectTo(pos.row,pos.column):this.selection.moveTo(pos.row,pos.column))}}},this.gotoLine=function(lineNumber,column,animate){this.selection.clearSelection(),this.session.unfold({row:lineNumber-1,column:column||0}),this.$blockScrolling+=1,this.exitMultiSelectMode&&this.exitMultiSelectMode(),this.moveCursorTo(lineNumber-1,column||0),this.$blockScrolling-=1,this.isRowFullyVisible(lineNumber-1)||this.scrollToLine(lineNumber-1,!0,animate)},this.navigateTo=function(row,column){this.selection.moveTo(row,column)},this.navigateUp=function(times){if(this.selection.isMultiLine()&&!this.selection.isBackwards()){var selectionStart=this.selection.anchor.getPosition();return this.moveCursorToPosition(selectionStart)}this.selection.clearSelection(),this.selection.moveCursorBy(-times||-1,0)},this.navigateDown=function(times){if(this.selection.isMultiLine()&&this.selection.isBackwards()){var selectionEnd=this.selection.anchor.getPosition();return this.moveCursorToPosition(selectionEnd)}this.selection.clearSelection(),this.selection.moveCursorBy(times||1,0)},this.navigateLeft=function(times){if(this.selection.isEmpty())for(times=times||1;times--;)this.selection.moveCursorLeft();else{var selectionStart=this.getSelectionRange().start;this.moveCursorToPosition(selectionStart)}this.clearSelection()},this.navigateRight=function(times){if(this.selection.isEmpty())for(times=times||1;times--;)this.selection.moveCursorRight();else{var selectionEnd=this.getSelectionRange().end;this.moveCursorToPosition(selectionEnd)}this.clearSelection()},this.navigateLineStart=function(){this.selection.moveCursorLineStart(),this.clearSelection()},this.navigateLineEnd=function(){this.selection.moveCursorLineEnd(),this.clearSelection()},this.navigateFileEnd=function(){this.selection.moveCursorFileEnd(),this.clearSelection()},this.navigateFileStart=function(){this.selection.moveCursorFileStart(),this.clearSelection()},this.navigateWordRight=function(){this.selection.moveCursorWordRight(),this.clearSelection()},this.navigateWordLeft=function(){this.selection.moveCursorWordLeft(),this.clearSelection()},this.replace=function(replacement,options){options&&this.$search.set(options);var range=this.$search.find(this.session),replaced=0;return range?(this.$tryReplace(range,replacement)&&(replaced=1),null!==range&&(this.selection.setSelectionRange(range),this.renderer.scrollSelectionIntoView(range.start,range.end)),replaced):replaced},this.replaceAll=function(replacement,options){options&&this.$search.set(options);var ranges=this.$search.findAll(this.session),replaced=0;if(!ranges.length)return replaced;this.$blockScrolling+=1;var selection=this.getSelectionRange();this.selection.moveTo(0,0);for(var i=ranges.length-1;i>=0;--i)this.$tryReplace(ranges[i],replacement)&&replaced++;return this.selection.setSelectionRange(selection),this.$blockScrolling-=1,replaced},this.$tryReplace=function(range,replacement){var input=this.session.getTextRange(range);return replacement=this.$search.replace(input,replacement),null!==replacement?(range.end=this.session.replace(range,replacement),range):null},this.getLastSearchOptions=function(){return this.$search.getOptions()},this.find=function(needle,options,animate){options||(options={}),"string"==typeof needle||needle instanceof RegExp?options.needle=needle:"object"==typeof needle&&oop.mixin(options,needle);var range=this.selection.getRange();null==options.needle&&(needle=this.session.getTextRange(range)||this.$search.$options.needle,needle||(range=this.session.getWordRange(range.start.row,range.start.column),needle=this.session.getTextRange(range)),this.$search.set({needle:needle})),this.$search.set(options),options.start||this.$search.set({start:range});var newRange=this.$search.find(this.session);return options.preventScroll?newRange:newRange?(this.revealRange(newRange,animate),newRange):(options.backwards?range.start=range.end:range.end=range.start,void this.selection.setRange(range))},this.findNext=function(options,animate){this.find({skipCurrent:!0,backwards:!1},options,animate)},this.findPrevious=function(options,animate){this.find(options,{skipCurrent:!0,backwards:!0},animate)},this.revealRange=function(range,animate){this.$blockScrolling+=1,this.session.unfold(range),this.selection.setSelectionRange(range),this.$blockScrolling-=1;var scrollTop=this.renderer.scrollTop;this.renderer.scrollSelectionIntoView(range.start,range.end,.5),animate!==!1&&this.renderer.animateScrolling(scrollTop)},this.undo=function(){this.$blockScrolling++,this.session.getUndoManager().undo(),this.$blockScrolling--,this.renderer.scrollCursorIntoView(null,.5)},this.redo=function(){this.$blockScrolling++,this.session.getUndoManager().redo(),this.$blockScrolling--,this.renderer.scrollCursorIntoView(null,.5)},this.destroy=function(){this.renderer.destroy(),this._signal("destroy",this),this.session&&this.session.destroy()},this.setAutoScrollEditorIntoView=function(enable){if(enable){var rect,self=this,shouldScroll=!1;this.$scrollAnchor||(this.$scrollAnchor=document.createElement("div"));var scrollAnchor=this.$scrollAnchor;scrollAnchor.style.cssText="position:absolute",this.container.insertBefore(scrollAnchor,this.container.firstChild);var onChangeSelection=this.on("changeSelection",function(){shouldScroll=!0}),onBeforeRender=this.renderer.on("beforeRender",function(){shouldScroll&&(rect=self.renderer.container.getBoundingClientRect())}),onAfterRender=this.renderer.on("afterRender",function(){if(shouldScroll&&rect&&(self.isFocused()||self.searchBox&&self.searchBox.isFocused())){var renderer=self.renderer,pos=renderer.$cursorLayer.$pixelPos,config=renderer.layerConfig,top=pos.top-config.offset;shouldScroll=pos.top>=0&&top+rect.top<0?!0:pos.top<config.height&&pos.top+rect.top+config.lineHeight>window.innerHeight?!1:null,null!=shouldScroll&&(scrollAnchor.style.top=top+"px",scrollAnchor.style.left=pos.left+"px",scrollAnchor.style.height=config.lineHeight+"px",scrollAnchor.scrollIntoView(shouldScroll)),shouldScroll=rect=null}});this.setAutoScrollEditorIntoView=function(enable){enable||(delete this.setAutoScrollEditorIntoView,this.off("changeSelection",onChangeSelection),this.renderer.off("afterRender",onAfterRender),this.renderer.off("beforeRender",onBeforeRender))}}},this.$resetCursorStyle=function(){var style=this.$cursorStyle||"ace",cursorLayer=this.renderer.$cursorLayer;cursorLayer&&(cursorLayer.setSmoothBlinking(/smooth/.test(style)),cursorLayer.isBlinking=!this.$readOnly&&"wide"!=style,dom.setCssClass(cursorLayer.element,"ace_slim-cursors",/slim/.test(style)))}}).call(Editor.prototype),config.defineOptions(Editor.prototype,"editor",{selectionStyle:{set:function(style){this.onSelectionChange(),this._signal("changeSelectionStyle",{data:style})},initialValue:"line"},highlightActiveLine:{set:function(){this.$updateHighlightActiveLine()},initialValue:!0},highlightSelectedWord:{set:function(shouldHighlight){this.$onSelectionChange()},initialValue:!0},readOnly:{set:function(readOnly){this.$resetCursorStyle()},initialValue:!1},cursorStyle:{set:function(val){this.$resetCursorStyle()},values:["ace","slim","smooth","wide"],initialValue:"ace"},mergeUndoDeltas:{values:[!1,!0,"always"],initialValue:!0},behavioursEnabled:{initialValue:!0},wrapBehavioursEnabled:{initialValue:!0},autoScrollEditorIntoView:{set:function(val){this.setAutoScrollEditorIntoView(val)}},keyboardHandler:{set:function(val){this.setKeyboardHandler(val)},get:function(){return this.keybindingId},handlesSet:!0},hScrollBarAlwaysVisible:"renderer",vScrollBarAlwaysVisible:"renderer",highlightGutterLine:"renderer",animatedScroll:"renderer",showInvisibles:"renderer",showPrintMargin:"renderer",printMarginColumn:"renderer",printMargin:"renderer",fadeFoldWidgets:"renderer",showFoldWidgets:"renderer",showLineNumbers:"renderer",showGutter:"renderer",displayIndentGuides:"renderer",fontSize:"renderer",fontFamily:"renderer",maxLines:"renderer",minLines:"renderer",scrollPastEnd:"renderer",fixedWidthGutter:"renderer",theme:"renderer",scrollSpeed:"$mouseHandler",dragDelay:"$mouseHandler",dragEnabled:"$mouseHandler",focusTimout:"$mouseHandler",tooltipFollowsMouse:"$mouseHandler",firstLineNumber:"session",overwrite:"session",newLineMode:"session",useWorker:"session",useSoftTabs:"session",tabSize:"session",wrap:"session",indentedSoftWrap:"session",foldStyle:"session",mode:"session"}),exports.Editor=Editor}),ace.define("ace/undomanager",["require","exports","module"],function(require,exports,module){"use strict";var UndoManager=function(){this.reset()};(function(){function $serializeDelta(delta){return{action:delta.action,start:delta.start,end:delta.end,lines:1==delta.lines.length?null:delta.lines,text:1==delta.lines.length?delta.lines[0]:null}}function $deserializeDelta(delta){return{action:delta.action,start:delta.start,end:delta.end,lines:delta.lines||[delta.text]}}function cloneDeltaSetsObj(deltaSets_old,fnGetModifiedDelta){for(var deltaSets_new=new Array(deltaSets_old.length),i=0;i<deltaSets_old.length;i++){for(var deltaSet_old=deltaSets_old[i],deltaSet_new={group:deltaSet_old.group,deltas:new Array(deltaSet_old.length)},j=0;j<deltaSet_old.deltas.length;j++){var delta_old=deltaSet_old.deltas[j];deltaSet_new.deltas[j]=fnGetModifiedDelta(delta_old)}deltaSets_new[i]=deltaSet_new}return deltaSets_new}this.execute=function(options){var deltaSets=options.args[0];this.$doc=options.args[1],options.merge&&this.hasUndo()&&(this.dirtyCounter--,deltaSets=this.$undoStack.pop().concat(deltaSets)),this.$undoStack.push(deltaSets),this.$redoStack=[],this.dirtyCounter<0&&(this.dirtyCounter=NaN),this.dirtyCounter++},this.undo=function(dontSelect){var deltaSets=this.$undoStack.pop(),undoSelectionRange=null;return deltaSets&&(undoSelectionRange=this.$doc.undoChanges(deltaSets,dontSelect),this.$redoStack.push(deltaSets),this.dirtyCounter--),undoSelectionRange},this.redo=function(dontSelect){var deltaSets=this.$redoStack.pop(),redoSelectionRange=null;return deltaSets&&(redoSelectionRange=this.$doc.redoChanges(this.$deserializeDeltas(deltaSets),dontSelect),this.$undoStack.push(deltaSets),this.dirtyCounter++),redoSelectionRange},this.reset=function(){this.$undoStack=[],this.$redoStack=[],this.dirtyCounter=0},this.hasUndo=function(){return this.$undoStack.length>0},this.hasRedo=function(){return this.$redoStack.length>0},this.markClean=function(){this.dirtyCounter=0},this.isClean=function(){return 0===this.dirtyCounter},this.$serializeDeltas=function(deltaSets){return cloneDeltaSetsObj(deltaSets,$serializeDelta)},this.$deserializeDeltas=function(deltaSets){return cloneDeltaSetsObj(deltaSets,$deserializeDelta)}}).call(UndoManager.prototype),exports.UndoManager=UndoManager}),ace.define("ace/layer/gutter",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter"],function(require,exports,module){"use strict";var dom=require("../lib/dom"),oop=require("../lib/oop"),lang=require("../lib/lang"),EventEmitter=require("../lib/event_emitter").EventEmitter,Gutter=function(parentEl){this.element=dom.createElement("div"),this.element.className="ace_layer ace_gutter-layer",parentEl.appendChild(this.element),this.setShowFoldWidgets(this.$showFoldWidgets),this.gutterWidth=0,this.$annotations=[],this.$updateAnnotations=this.$updateAnnotations.bind(this),this.$cells=[]};(function(){oop.implement(this,EventEmitter),this.setSession=function(session){this.session&&this.session.removeEventListener("change",this.$updateAnnotations),this.session=session,session&&session.on("change",this.$updateAnnotations)},this.addGutterDecoration=function(row,className){window.console&&console.warn&&console.warn("deprecated use session.addGutterDecoration"),this.session.addGutterDecoration(row,className)},this.removeGutterDecoration=function(row,className){window.console&&console.warn&&console.warn("deprecated use session.removeGutterDecoration"),this.session.removeGutterDecoration(row,className)},this.setAnnotations=function(annotations){this.$annotations=[];for(var i=0;i<annotations.length;i++){var annotation=annotations[i],row=annotation.row,rowInfo=this.$annotations[row];rowInfo||(rowInfo=this.$annotations[row]={text:[]});var annoText=annotation.text;annoText=annoText?lang.escapeHTML(annoText):annotation.html||"",-1===rowInfo.text.indexOf(annoText)&&rowInfo.text.push(annoText);var type=annotation.type;"error"==type?rowInfo.className=" ace_error":"warning"==type&&" ace_error"!=rowInfo.className?rowInfo.className=" ace_warning":"info"!=type||rowInfo.className||(rowInfo.className=" ace_info")}},this.$updateAnnotations=function(delta){if(this.$annotations.length){var firstRow=delta.start.row,len=delta.end.row-firstRow;if(0===len);else if("remove"==delta.action)this.$annotations.splice(firstRow,len+1,null);else{var args=new Array(len+1);args.unshift(firstRow,1),this.$annotations.splice.apply(this.$annotations,args)}}},this.update=function(config){for(var session=this.session,firstRow=config.firstRow,lastRow=Math.min(config.lastRow+config.gutterOffset,session.getLength()-1),fold=session.getNextFoldLine(firstRow),foldStart=fold?fold.start.row:1/0,foldWidgets=this.$showFoldWidgets&&session.foldWidgets,breakpoints=session.$breakpoints,decorations=session.$decorations,firstLineNumber=session.$firstLineNumber,lastLineNumber=0,gutterRenderer=session.gutterRenderer||this.$renderer,cell=null,index=-1,row=firstRow;;){if(row>foldStart&&(row=fold.end.row+1,fold=session.getNextFoldLine(row,fold),foldStart=fold?fold.start.row:1/0),row>lastRow){for(;this.$cells.length>index+1;)cell=this.$cells.pop(),this.element.removeChild(cell.element);break}cell=this.$cells[++index],cell||(cell={element:null,textNode:null,foldWidget:null},cell.element=dom.createElement("div"),cell.textNode=document.createTextNode(""),cell.element.appendChild(cell.textNode),this.element.appendChild(cell.element),this.$cells[index]=cell);var className="ace_gutter-cell ";breakpoints[row]&&(className+=breakpoints[row]),decorations[row]&&(className+=decorations[row]),this.$annotations[row]&&(className+=this.$annotations[row].className),cell.element.className!=className&&(cell.element.className=className);var height=session.getRowLength(row)*config.lineHeight+"px";if(height!=cell.element.style.height&&(cell.element.style.height=height),foldWidgets){var c=foldWidgets[row];null==c&&(c=foldWidgets[row]=session.getFoldWidget(row))}if(c){cell.foldWidget||(cell.foldWidget=dom.createElement("span"),cell.element.appendChild(cell.foldWidget));var className="ace_fold-widget ace_"+c;className+="start"==c&&row==foldStart&&row<fold.end.row?" ace_closed":" ace_open",cell.foldWidget.className!=className&&(cell.foldWidget.className=className);var height=config.lineHeight+"px";cell.foldWidget.style.height!=height&&(cell.foldWidget.style.height=height)}else cell.foldWidget&&(cell.element.removeChild(cell.foldWidget),cell.foldWidget=null);var text=lastLineNumber=gutterRenderer?gutterRenderer.getText(session,row):row+firstLineNumber;text!=cell.textNode.data&&(cell.textNode.data=text),row++}this.element.style.height=config.minHeight+"px",(this.$fixedWidth||session.$useWrapMode)&&(lastLineNumber=session.getLength()+firstLineNumber);var gutterWidth=gutterRenderer?gutterRenderer.getWidth(session,lastLineNumber,config):lastLineNumber.toString().length*config.characterWidth,padding=this.$padding||this.$computePadding();gutterWidth+=padding.left+padding.right,gutterWidth===this.gutterWidth||isNaN(gutterWidth)||(this.gutterWidth=gutterWidth,this.element.style.width=Math.ceil(this.gutterWidth)+"px",this._emit("changeGutterWidth",gutterWidth))},this.$fixedWidth=!1,this.$showLineNumbers=!0,this.$renderer="",this.setShowLineNumbers=function(show){this.$renderer=!show&&{getWidth:function(){return""},getText:function(){return""}}},this.getShowLineNumbers=function(){return this.$showLineNumbers},this.$showFoldWidgets=!0,this.setShowFoldWidgets=function(show){show?dom.addCssClass(this.element,"ace_folding-enabled"):dom.removeCssClass(this.element,"ace_folding-enabled"),this.$showFoldWidgets=show,this.$padding=null},this.getShowFoldWidgets=function(){return this.$showFoldWidgets},this.$computePadding=function(){if(!this.element.firstChild)return{left:0,right:0};var style=dom.computedStyle(this.element.firstChild);return this.$padding={},this.$padding.left=parseInt(style.paddingLeft)+1||0,this.$padding.right=parseInt(style.paddingRight)||0,this.$padding},this.getRegion=function(point){var padding=this.$padding||this.$computePadding(),rect=this.element.getBoundingClientRect();return point.x<padding.left+rect.left?"markers":this.$showFoldWidgets&&point.x>rect.right-padding.right?"foldWidgets":void 0}}).call(Gutter.prototype),exports.Gutter=Gutter}),ace.define("ace/layer/marker",["require","exports","module","ace/range","ace/lib/dom"],function(require,exports,module){"use strict";var Range=require("../range").Range,dom=require("../lib/dom"),Marker=function(parentEl){this.element=dom.createElement("div"),this.element.className="ace_layer ace_marker-layer",parentEl.appendChild(this.element)};(function(){function getBorderClass(tl,tr,br,bl){return(tl?1:0)|(tr?2:0)|(br?4:0)|(bl?8:0)}this.$padding=0,this.setPadding=function(padding){this.$padding=padding},this.setSession=function(session){this.session=session},this.setMarkers=function(markers){this.markers=markers},this.update=function(config){var config=config||this.config;if(config){this.config=config;var html=[];for(var key in this.markers){var marker=this.markers[key];if(marker.range){var range=marker.range.clipRows(config.firstRow,config.lastRow);if(!range.isEmpty())if(range=range.toScreenRange(this.session),marker.renderer){var top=this.$getTop(range.start.row,config),left=this.$padding+range.start.column*config.characterWidth;marker.renderer(html,range,left,top,config)}else"fullLine"==marker.type?this.drawFullLineMarker(html,range,marker.clazz,config):"screenLine"==marker.type?this.drawScreenLineMarker(html,range,marker.clazz,config):range.isMultiLine()?"text"==marker.type?this.drawTextMarker(html,range,marker.clazz,config):this.drawMultiLineMarker(html,range,marker.clazz,config):this.drawSingleLineMarker(html,range,marker.clazz+" ace_start ace_br15",config)}else marker.update(html,this,this.session,config)}this.element.innerHTML=html.join("")}},this.$getTop=function(row,layerConfig){return(row-layerConfig.firstRowScreen)*layerConfig.lineHeight},this.drawTextMarker=function(stringBuilder,range,clazz,layerConfig,extraStyle){for(var session=this.session,start=range.start.row,end=range.end.row,row=start,prev=0,curr=0,next=session.getScreenLastRowColumn(row),lineRange=new Range(row,range.start.column,row,curr);end>=row;row++)lineRange.start.row=lineRange.end.row=row,lineRange.start.column=row==start?range.start.column:session.getRowWrapIndent(row),lineRange.end.column=next,prev=curr,curr=next,next=end>row+1?session.getScreenLastRowColumn(row+1):row==end?0:range.end.column,this.drawSingleLineMarker(stringBuilder,lineRange,clazz+(row==start?" ace_start":"")+" ace_br"+getBorderClass(row==start||row==start+1&&range.start.column,curr>prev,curr>next,row==end),layerConfig,row==end?0:1,extraStyle)},this.drawMultiLineMarker=function(stringBuilder,range,clazz,config,extraStyle){var padding=this.$padding,height=config.lineHeight,top=this.$getTop(range.start.row,config),left=padding+range.start.column*config.characterWidth;extraStyle=extraStyle||"",stringBuilder.push("<div class='",clazz," ace_br1 ace_start' style='","height:",height,"px;","right:0;","top:",top,"px;","left:",left,"px;",extraStyle,"'></div>"),top=this.$getTop(range.end.row,config);var width=range.end.column*config.characterWidth;if(stringBuilder.push("<div class='",clazz," ace_br12' style='","height:",height,"px;","width:",width,"px;","top:",top,"px;","left:",padding,"px;",extraStyle,"'></div>"),height=(range.end.row-range.start.row-1)*config.lineHeight,!(0>=height)){top=this.$getTop(range.start.row+1,config);var radiusClass=(range.start.column?1:0)|(range.end.column?0:8);stringBuilder.push("<div class='",clazz,radiusClass?" ace_br"+radiusClass:"","' style='","height:",height,"px;","right:0;","top:",top,"px;","left:",padding,"px;",extraStyle,"'></div>")}},this.drawSingleLineMarker=function(stringBuilder,range,clazz,config,extraLength,extraStyle){var height=config.lineHeight,width=(range.end.column+(extraLength||0)-range.start.column)*config.characterWidth,top=this.$getTop(range.start.row,config),left=this.$padding+range.start.column*config.characterWidth;stringBuilder.push("<div class='",clazz,"' style='","height:",height,"px;","width:",width,"px;","top:",top,"px;","left:",left,"px;",extraStyle||"","'></div>")},this.drawFullLineMarker=function(stringBuilder,range,clazz,config,extraStyle){var top=this.$getTop(range.start.row,config),height=config.lineHeight;range.start.row!=range.end.row&&(height+=this.$getTop(range.end.row,config)-top),stringBuilder.push("<div class='",clazz,"' style='","height:",height,"px;","top:",top,"px;","left:0;right:0;",extraStyle||"","'></div>")},this.drawScreenLineMarker=function(stringBuilder,range,clazz,config,extraStyle){var top=this.$getTop(range.start.row,config),height=config.lineHeight;stringBuilder.push("<div class='",clazz,"' style='","height:",height,"px;","top:",top,"px;","left:0;right:0;",extraStyle||"","'></div>")}}).call(Marker.prototype),exports.Marker=Marker}),ace.define("ace/layer/text",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/lib/event_emitter"],function(require,exports,module){"use strict";var oop=require("../lib/oop"),dom=require("../lib/dom"),lang=require("../lib/lang"),EventEmitter=(require("../lib/useragent"),require("../lib/event_emitter").EventEmitter),Text=function(parentEl){this.element=dom.createElement("div"),this.element.className="ace_layer ace_text-layer",parentEl.appendChild(this.element),this.$updateEolChar=this.$updateEolChar.bind(this)};(function(){oop.implement(this,EventEmitter),this.EOF_CHAR="¶",this.EOL_CHAR_LF="¬",this.EOL_CHAR_CRLF="¤",this.EOL_CHAR=this.EOL_CHAR_LF,this.TAB_CHAR="—",this.SPACE_CHAR="·",this.$padding=0,this.$updateEolChar=function(){var EOL_CHAR="\n"==this.session.doc.getNewLineCharacter()?this.EOL_CHAR_LF:this.EOL_CHAR_CRLF;return this.EOL_CHAR!=EOL_CHAR?(this.EOL_CHAR=EOL_CHAR,!0):void 0},this.setPadding=function(padding){this.$padding=padding,this.element.style.padding="0 "+padding+"px"},this.getLineHeight=function(){return this.$fontMetrics.$characterSize.height||0},this.getCharacterWidth=function(){return this.$fontMetrics.$characterSize.width||0},this.$setFontMetrics=function(measure){this.$fontMetrics=measure,this.$fontMetrics.on("changeCharacterSize",function(e){this._signal("changeCharacterSize",e)}.bind(this)),this.$pollSizeChanges()},this.checkForSizeChanges=function(){this.$fontMetrics.checkForSizeChanges()},this.$pollSizeChanges=function(){return this.$pollSizeChangesTimer=this.$fontMetrics.$pollSizeChanges()},this.setSession=function(session){this.session=session,session&&this.$computeTabString()},this.showInvisibles=!1,this.setShowInvisibles=function(showInvisibles){return this.showInvisibles==showInvisibles?!1:(this.showInvisibles=showInvisibles,this.$computeTabString(),!0)},this.displayIndentGuides=!0,this.setDisplayIndentGuides=function(display){return this.displayIndentGuides==display?!1:(this.displayIndentGuides=display,this.$computeTabString(),!0)},this.$tabStrings=[],this.onChangeTabSize=this.$computeTabString=function(){var tabSize=this.session.getTabSize();this.tabSize=tabSize;for(var tabStr=this.$tabStrings=[0],i=1;tabSize+1>i;i++)this.showInvisibles?tabStr.push("<span class='ace_invisible ace_invisible_tab'>"+lang.stringRepeat(this.TAB_CHAR,i)+"</span>"):tabStr.push(lang.stringRepeat(" ",i));if(this.displayIndentGuides){this.$indentGuideRe=/\s\S| \t|\t |\s$/;var className="ace_indent-guide",spaceClass="",tabClass="";if(this.showInvisibles){className+=" ace_invisible",spaceClass=" ace_invisible_space",tabClass=" ace_invisible_tab";var spaceContent=lang.stringRepeat(this.SPACE_CHAR,this.tabSize),tabContent=lang.stringRepeat(this.TAB_CHAR,this.tabSize)}else var spaceContent=lang.stringRepeat(" ",this.tabSize),tabContent=spaceContent;this.$tabStrings[" "]="<span class='"+className+spaceClass+"'>"+spaceContent+"</span>",this.$tabStrings["	"]="<span class='"+className+tabClass+"'>"+tabContent+"</span>"}},this.updateLines=function(config,firstRow,lastRow){(this.config.lastRow!=config.lastRow||this.config.firstRow!=config.firstRow)&&this.scrollLines(config),this.config=config;for(var first=Math.max(firstRow,config.firstRow),last=Math.min(lastRow,config.lastRow),lineElements=this.element.childNodes,lineElementsIdx=0,row=config.firstRow;first>row;row++){var foldLine=this.session.getFoldLine(row);if(foldLine){if(foldLine.containsRow(first)){first=foldLine.start.row;break}row=foldLine.end.row}lineElementsIdx++}for(var row=first,foldLine=this.session.getNextFoldLine(row),foldStart=foldLine?foldLine.start.row:1/0;;){if(row>foldStart&&(row=foldLine.end.row+1,foldLine=this.session.getNextFoldLine(row,foldLine),foldStart=foldLine?foldLine.start.row:1/0),row>last)break;var lineElement=lineElements[lineElementsIdx++];if(lineElement){var html=[];this.$renderLine(html,row,!this.$useLineGroups(),row==foldStart?foldLine:!1),lineElement.style.height=config.lineHeight*this.session.getRowLength(row)+"px",lineElement.innerHTML=html.join("")}row++}},this.scrollLines=function(config){var oldConfig=this.config;if(this.config=config,!oldConfig||oldConfig.lastRow<config.firstRow)return this.update(config);if(config.lastRow<oldConfig.firstRow)return this.update(config);var el=this.element;if(oldConfig.firstRow<config.firstRow)for(var row=this.session.getFoldedRowCount(oldConfig.firstRow,config.firstRow-1);row>0;row--)el.removeChild(el.firstChild);if(oldConfig.lastRow>config.lastRow)for(var row=this.session.getFoldedRowCount(config.lastRow+1,oldConfig.lastRow);row>0;row--)el.removeChild(el.lastChild);if(config.firstRow<oldConfig.firstRow){var fragment=this.$renderLinesFragment(config,config.firstRow,oldConfig.firstRow-1);el.firstChild?el.insertBefore(fragment,el.firstChild):el.appendChild(fragment)}if(config.lastRow>oldConfig.lastRow){var fragment=this.$renderLinesFragment(config,oldConfig.lastRow+1,config.lastRow);el.appendChild(fragment)}},this.$renderLinesFragment=function(config,firstRow,lastRow){for(var fragment=this.element.ownerDocument.createDocumentFragment(),row=firstRow,foldLine=this.session.getNextFoldLine(row),foldStart=foldLine?foldLine.start.row:1/0;;){if(row>foldStart&&(row=foldLine.end.row+1,foldLine=this.session.getNextFoldLine(row,foldLine),foldStart=foldLine?foldLine.start.row:1/0),row>lastRow)break;var container=dom.createElement("div"),html=[];if(this.$renderLine(html,row,!1,row==foldStart?foldLine:!1),container.innerHTML=html.join(""),this.$useLineGroups())container.className="ace_line_group",fragment.appendChild(container),container.style.height=config.lineHeight*this.session.getRowLength(row)+"px";else for(;container.firstChild;)fragment.appendChild(container.firstChild);row++}return fragment},this.update=function(config){this.config=config;for(var html=[],firstRow=config.firstRow,lastRow=config.lastRow,row=firstRow,foldLine=this.session.getNextFoldLine(row),foldStart=foldLine?foldLine.start.row:1/0;;){if(row>foldStart&&(row=foldLine.end.row+1,foldLine=this.session.getNextFoldLine(row,foldLine),foldStart=foldLine?foldLine.start.row:1/0),row>lastRow)break;this.$useLineGroups()&&html.push("<div class='ace_line_group' style='height:",config.lineHeight*this.session.getRowLength(row),"px'>"),this.$renderLine(html,row,!1,row==foldStart?foldLine:!1),this.$useLineGroups()&&html.push("</div>"),row++}this.element.innerHTML=html.join("")},this.$textToken={text:!0,rparen:!0,lparen:!0},this.$renderToken=function(stringBuilder,screenColumn,token,value){var self=this,replaceReg=/\t|&|<|>|( +)|([\x00-\x1f\x80-\xa0\xad\u1680\u180E\u2000-\u200f\u2028\u2029\u202F\u205F\u3000\uFEFF\uFFF9-\uFFFC])|[\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3000-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFAFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]/g,replaceFunc=function(c,a,b,tabIdx,idx4){if(a)return self.showInvisibles?"<span class='ace_invisible ace_invisible_space'>"+lang.stringRepeat(self.SPACE_CHAR,c.length)+"</span>":c;if("&"==c)return"&#38;";if("<"==c)return"&#60;";if(">"==c)return"&#62;";if("	"==c){var tabSize=self.session.getScreenTabSize(screenColumn+tabIdx);return screenColumn+=tabSize-1,self.$tabStrings[tabSize]}if("　"==c){var classToUse=self.showInvisibles?"ace_cjk ace_invisible ace_invisible_space":"ace_cjk",space=self.showInvisibles?self.SPACE_CHAR:"";return screenColumn+=1,"<span class='"+classToUse+"' style='width:"+2*self.config.characterWidth+"px'>"+space+"</span>"}return b?"<span class='ace_invisible ace_invisible_space ace_invalid'>"+self.SPACE_CHAR+"</span>":(screenColumn+=1,"<span class='ace_cjk' style='width:"+2*self.config.characterWidth+"px'>"+c+"</span>")},output=value.replace(replaceReg,replaceFunc);if(this.$textToken[token.type])stringBuilder.push(output);else{var classes="ace_"+token.type.replace(/\./g," ace_"),style="";"fold"==token.type&&(style=" style='width:"+token.value.length*this.config.characterWidth+"px;' "),stringBuilder.push("<span class='",classes,"'",style,">",output,"</span>")}return screenColumn+value.length},this.renderIndentGuide=function(stringBuilder,value,max){var cols=value.search(this.$indentGuideRe);return 0>=cols||cols>=max?value:" "==value[0]?(cols-=cols%this.tabSize,stringBuilder.push(lang.stringRepeat(this.$tabStrings[" "],cols/this.tabSize)),value.substr(cols)):"	"==value[0]?(stringBuilder.push(lang.stringRepeat(this.$tabStrings["	"],cols)),value.substr(cols)):value},this.$renderWrappedLine=function(stringBuilder,tokens,splits,onlyContents){for(var chars=0,split=0,splitChars=splits[0],screenColumn=0,i=0;i<tokens.length;i++){var token=tokens[i],value=token.value;if(0==i&&this.displayIndentGuides){if(chars=value.length,value=this.renderIndentGuide(stringBuilder,value,splitChars),!value)continue;chars-=value.length}if(chars+value.length<splitChars)screenColumn=this.$renderToken(stringBuilder,screenColumn,token,value),chars+=value.length;else{for(;chars+value.length>=splitChars;)screenColumn=this.$renderToken(stringBuilder,screenColumn,token,value.substring(0,splitChars-chars)),value=value.substring(splitChars-chars),chars=splitChars,onlyContents||stringBuilder.push("</div>","<div class='ace_line' style='height:",this.config.lineHeight,"px'>"),stringBuilder.push(lang.stringRepeat(" ",splits.indent)),split++,screenColumn=0,splitChars=splits[split]||Number.MAX_VALUE;0!=value.length&&(chars+=value.length,screenColumn=this.$renderToken(stringBuilder,screenColumn,token,value))}}},this.$renderSimpleLine=function(stringBuilder,tokens){var screenColumn=0,token=tokens[0],value=token.value;this.displayIndentGuides&&(value=this.renderIndentGuide(stringBuilder,value)),value&&(screenColumn=this.$renderToken(stringBuilder,screenColumn,token,value));for(var i=1;i<tokens.length;i++)token=tokens[i],value=token.value,screenColumn=this.$renderToken(stringBuilder,screenColumn,token,value)},this.$renderLine=function(stringBuilder,row,onlyContents,foldLine){if(foldLine||0==foldLine||(foldLine=this.session.getFoldLine(row)),foldLine)var tokens=this.$getFoldLineTokens(row,foldLine);else var tokens=this.session.getTokens(row);if(onlyContents||stringBuilder.push("<div class='ace_line' style='height:",this.config.lineHeight*(this.$useLineGroups()?1:this.session.getRowLength(row)),"px'>"),
tokens.length){var splits=this.session.getRowSplitData(row);splits&&splits.length?this.$renderWrappedLine(stringBuilder,tokens,splits,onlyContents):this.$renderSimpleLine(stringBuilder,tokens)}this.showInvisibles&&(foldLine&&(row=foldLine.end.row),stringBuilder.push("<span class='ace_invisible ace_invisible_eol'>",row==this.session.getLength()-1?this.EOF_CHAR:this.EOL_CHAR,"</span>")),onlyContents||stringBuilder.push("</div>")},this.$getFoldLineTokens=function(row,foldLine){function addTokens(tokens,from,to){for(var idx=0,col=0;col+tokens[idx].value.length<from;)if(col+=tokens[idx].value.length,idx++,idx==tokens.length)return;if(col!=from){var value=tokens[idx].value.substring(from-col);value.length>to-from&&(value=value.substring(0,to-from)),renderTokens.push({type:tokens[idx].type,value:value}),col=from+value.length,idx+=1}for(;to>col&&idx<tokens.length;){var value=tokens[idx].value;value.length+col>to?renderTokens.push({type:tokens[idx].type,value:value.substring(0,to-col)}):renderTokens.push(tokens[idx]),col+=value.length,idx+=1}}var session=this.session,renderTokens=[],tokens=session.getTokens(row);return foldLine.walk(function(placeholder,row,column,lastColumn,isNewRow){null!=placeholder?renderTokens.push({type:"fold",value:placeholder}):(isNewRow&&(tokens=session.getTokens(row)),tokens.length&&addTokens(tokens,lastColumn,column))},foldLine.end.row,this.session.getLine(foldLine.end.row).length),renderTokens},this.$useLineGroups=function(){return this.session.getUseWrapMode()},this.destroy=function(){clearInterval(this.$pollSizeChangesTimer),this.$measureNode&&this.$measureNode.parentNode.removeChild(this.$measureNode),delete this.$measureNode}}).call(Text.prototype),exports.Text=Text}),ace.define("ace/layer/cursor",["require","exports","module","ace/lib/dom"],function(require,exports,module){"use strict";var isIE8,dom=require("../lib/dom"),Cursor=function(parentEl){this.element=dom.createElement("div"),this.element.className="ace_layer ace_cursor-layer",parentEl.appendChild(this.element),void 0===isIE8&&(isIE8=!("opacity"in this.element.style)),this.isVisible=!1,this.isBlinking=!0,this.blinkInterval=1e3,this.smoothBlinking=!1,this.cursors=[],this.cursor=this.addCursor(),dom.addCssClass(this.element,"ace_hidden-cursors"),this.$updateCursors=(isIE8?this.$updateVisibility:this.$updateOpacity).bind(this)};(function(){this.$updateVisibility=function(val){for(var cursors=this.cursors,i=cursors.length;i--;)cursors[i].style.visibility=val?"":"hidden"},this.$updateOpacity=function(val){for(var cursors=this.cursors,i=cursors.length;i--;)cursors[i].style.opacity=val?"":"0"},this.$padding=0,this.setPadding=function(padding){this.$padding=padding},this.setSession=function(session){this.session=session},this.setBlinking=function(blinking){blinking!=this.isBlinking&&(this.isBlinking=blinking,this.restartTimer())},this.setBlinkInterval=function(blinkInterval){blinkInterval!=this.blinkInterval&&(this.blinkInterval=blinkInterval,this.restartTimer())},this.setSmoothBlinking=function(smoothBlinking){smoothBlinking==this.smoothBlinking||isIE8||(this.smoothBlinking=smoothBlinking,dom.setCssClass(this.element,"ace_smooth-blinking",smoothBlinking),this.$updateCursors(!0),this.$updateCursors=this.$updateOpacity.bind(this),this.restartTimer())},this.addCursor=function(){var el=dom.createElement("div");return el.className="ace_cursor",this.element.appendChild(el),this.cursors.push(el),el},this.removeCursor=function(){if(this.cursors.length>1){var el=this.cursors.pop();return el.parentNode.removeChild(el),el}},this.hideCursor=function(){this.isVisible=!1,dom.addCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.showCursor=function(){this.isVisible=!0,dom.removeCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.restartTimer=function(){var update=this.$updateCursors;if(clearInterval(this.intervalId),clearTimeout(this.timeoutId),this.smoothBlinking&&dom.removeCssClass(this.element,"ace_smooth-blinking"),update(!0),this.isBlinking&&this.blinkInterval&&this.isVisible){this.smoothBlinking&&setTimeout(function(){dom.addCssClass(this.element,"ace_smooth-blinking")}.bind(this));var blink=function(){this.timeoutId=setTimeout(function(){update(!1)},.6*this.blinkInterval)}.bind(this);this.intervalId=setInterval(function(){update(!0),blink()},this.blinkInterval),blink()}},this.getPixelPosition=function(position,onScreen){if(!this.config||!this.session)return{left:0,top:0};position||(position=this.session.selection.getCursor());var pos=this.session.documentToScreenPosition(position),cursorLeft=this.$padding+pos.column*this.config.characterWidth,cursorTop=(pos.row-(onScreen?this.config.firstRowScreen:0))*this.config.lineHeight;return{left:cursorLeft,top:cursorTop}},this.update=function(config){this.config=config;var selections=this.session.$selectionMarkers,i=0,cursorIndex=0;(void 0===selections||0===selections.length)&&(selections=[{cursor:null}]);for(var i=0,n=selections.length;n>i;i++){var pixelPos=this.getPixelPosition(selections[i].cursor,!0);if(!((pixelPos.top>config.height+config.offset||pixelPos.top<0)&&i>1)){var style=(this.cursors[cursorIndex++]||this.addCursor()).style;this.drawCursor?this.drawCursor(style,pixelPos,config,selections[i],this.session):(style.left=pixelPos.left+"px",style.top=pixelPos.top+"px",style.width=config.characterWidth+"px",style.height=config.lineHeight+"px")}}for(;this.cursors.length>cursorIndex;)this.removeCursor();var overwrite=this.session.getOverwrite();this.$setOverwrite(overwrite),this.$pixelPos=pixelPos,this.restartTimer()},this.drawCursor=null,this.$setOverwrite=function(overwrite){overwrite!=this.overwrite&&(this.overwrite=overwrite,overwrite?dom.addCssClass(this.element,"ace_overwrite-cursors"):dom.removeCssClass(this.element,"ace_overwrite-cursors"))},this.destroy=function(){clearInterval(this.intervalId),clearTimeout(this.timeoutId)}}).call(Cursor.prototype),exports.Cursor=Cursor}),ace.define("ace/scrollbar",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/event","ace/lib/event_emitter"],function(require,exports,module){"use strict";var oop=require("./lib/oop"),dom=require("./lib/dom"),event=require("./lib/event"),EventEmitter=require("./lib/event_emitter").EventEmitter,MAX_SCROLL_H=32768,ScrollBar=function(parent){this.element=dom.createElement("div"),this.element.className="ace_scrollbar ace_scrollbar"+this.classSuffix,this.inner=dom.createElement("div"),this.inner.className="ace_scrollbar-inner",this.element.appendChild(this.inner),parent.appendChild(this.element),this.setVisible(!1),this.skipEvent=!1,event.addListener(this.element,"scroll",this.onScroll.bind(this)),event.addListener(this.element,"mousedown",event.preventDefault)};(function(){oop.implement(this,EventEmitter),this.setVisible=function(isVisible){this.element.style.display=isVisible?"":"none",this.isVisible=isVisible,this.coeff=1}}).call(ScrollBar.prototype);var VScrollBar=function(parent,renderer){ScrollBar.call(this,parent),this.scrollTop=0,this.scrollHeight=0,renderer.$scrollbarWidth=this.width=dom.scrollbarWidth(parent.ownerDocument),this.inner.style.width=this.element.style.width=(this.width||15)+5+"px"};oop.inherits(VScrollBar,ScrollBar),function(){this.classSuffix="-v",this.onScroll=function(){if(!this.skipEvent){if(this.scrollTop=this.element.scrollTop,1!=this.coeff){var h=this.element.clientHeight/this.scrollHeight;this.scrollTop=this.scrollTop*(1-h)/(this.coeff-h)}this._emit("scroll",{data:this.scrollTop})}this.skipEvent=!1},this.getWidth=function(){return this.isVisible?this.width:0},this.setHeight=function(height){this.element.style.height=height+"px"},this.setInnerHeight=this.setScrollHeight=function(height){this.scrollHeight=height,height>MAX_SCROLL_H?(this.coeff=MAX_SCROLL_H/height,height=MAX_SCROLL_H):1!=this.coeff&&(this.coeff=1),this.inner.style.height=height+"px"},this.setScrollTop=function(scrollTop){this.scrollTop!=scrollTop&&(this.skipEvent=!0,this.scrollTop=scrollTop,this.element.scrollTop=scrollTop*this.coeff)}}.call(VScrollBar.prototype);var HScrollBar=function(parent,renderer){ScrollBar.call(this,parent),this.scrollLeft=0,this.height=renderer.$scrollbarWidth,this.inner.style.height=this.element.style.height=(this.height||15)+5+"px"};oop.inherits(HScrollBar,ScrollBar),function(){this.classSuffix="-h",this.onScroll=function(){this.skipEvent||(this.scrollLeft=this.element.scrollLeft,this._emit("scroll",{data:this.scrollLeft})),this.skipEvent=!1},this.getHeight=function(){return this.isVisible?this.height:0},this.setWidth=function(width){this.element.style.width=width+"px"},this.setInnerWidth=function(width){this.inner.style.width=width+"px"},this.setScrollWidth=function(width){this.inner.style.width=width+"px"},this.setScrollLeft=function(scrollLeft){this.scrollLeft!=scrollLeft&&(this.skipEvent=!0,this.scrollLeft=this.element.scrollLeft=scrollLeft)}}.call(HScrollBar.prototype),exports.ScrollBar=VScrollBar,exports.ScrollBarV=VScrollBar,exports.ScrollBarH=HScrollBar,exports.VScrollBar=VScrollBar,exports.HScrollBar=HScrollBar}),ace.define("ace/renderloop",["require","exports","module","ace/lib/event"],function(require,exports,module){"use strict";var event=require("./lib/event"),RenderLoop=function(onRender,win){this.onRender=onRender,this.pending=!1,this.changes=0,this.window=win||window};(function(){this.schedule=function(change){if(this.changes=this.changes|change,!this.pending&&this.changes){this.pending=!0;var _self=this;event.nextFrame(function(){_self.pending=!1;for(var changes;changes=_self.changes;)_self.changes=0,_self.onRender(changes)},this.window)}}}).call(RenderLoop.prototype),exports.RenderLoop=RenderLoop}),ace.define("ace/layer/font_metrics",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/lib/event_emitter"],function(require,exports,module){var oop=require("../lib/oop"),dom=require("../lib/dom"),lang=require("../lib/lang"),useragent=require("../lib/useragent"),EventEmitter=require("../lib/event_emitter").EventEmitter,CHAR_COUNT=0,FontMetrics=exports.FontMetrics=function(parentEl){this.el=dom.createElement("div"),this.$setMeasureNodeStyles(this.el.style,!0),this.$main=dom.createElement("div"),this.$setMeasureNodeStyles(this.$main.style),this.$measureNode=dom.createElement("div"),this.$setMeasureNodeStyles(this.$measureNode.style),this.el.appendChild(this.$main),this.el.appendChild(this.$measureNode),parentEl.appendChild(this.el),CHAR_COUNT||this.$testFractionalRect(),this.$measureNode.innerHTML=lang.stringRepeat("X",CHAR_COUNT),this.$characterSize={width:0,height:0},this.checkForSizeChanges()};(function(){oop.implement(this,EventEmitter),this.$characterSize={width:0,height:0},this.$testFractionalRect=function(){var el=dom.createElement("div");this.$setMeasureNodeStyles(el.style),el.style.width="0.2px",document.documentElement.appendChild(el);var w=el.getBoundingClientRect().width;CHAR_COUNT=w>0&&1>w?50:100,el.parentNode.removeChild(el)},this.$setMeasureNodeStyles=function(style,isRoot){style.width=style.height="auto",style.left=style.top="0px",style.visibility="hidden",style.position="absolute",style.whiteSpace="pre",useragent.isIE<8?style["font-family"]="inherit":style.font="inherit",style.overflow=isRoot?"hidden":"visible"},this.checkForSizeChanges=function(){var size=this.$measureSizes();if(size&&(this.$characterSize.width!==size.width||this.$characterSize.height!==size.height)){this.$measureNode.style.fontWeight="bold";var boldSize=this.$measureSizes();this.$measureNode.style.fontWeight="",this.$characterSize=size,this.charSizes=Object.create(null),this.allowBoldFonts=boldSize&&boldSize.width===size.width&&boldSize.height===size.height,this._emit("changeCharacterSize",{data:size})}},this.$pollSizeChanges=function(){if(this.$pollSizeChangesTimer)return this.$pollSizeChangesTimer;var self=this;return this.$pollSizeChangesTimer=setInterval(function(){self.checkForSizeChanges()},500)},this.setPolling=function(val){val?this.$pollSizeChanges():this.$pollSizeChangesTimer&&(clearInterval(this.$pollSizeChangesTimer),this.$pollSizeChangesTimer=0)},this.$measureSizes=function(){if(50===CHAR_COUNT){var rect=null;try{rect=this.$measureNode.getBoundingClientRect()}catch(e){rect={width:0,height:0}}var size={height:rect.height,width:rect.width/CHAR_COUNT}}else var size={height:this.$measureNode.clientHeight,width:this.$measureNode.clientWidth/CHAR_COUNT};return 0===size.width||0===size.height?null:size},this.$measureCharWidth=function(ch){this.$main.innerHTML=lang.stringRepeat(ch,CHAR_COUNT);var rect=this.$main.getBoundingClientRect();return rect.width/CHAR_COUNT},this.getCharacterWidth=function(ch){var w=this.charSizes[ch];return void 0===w&&(w=this.charSizes[ch]=this.$measureCharWidth(ch)/this.$characterSize.width),w},this.destroy=function(){clearInterval(this.$pollSizeChangesTimer),this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)}}).call(FontMetrics.prototype)}),ace.define("ace/virtual_renderer",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/config","ace/lib/useragent","ace/layer/gutter","ace/layer/marker","ace/layer/text","ace/layer/cursor","ace/scrollbar","ace/scrollbar","ace/renderloop","ace/layer/font_metrics","ace/lib/event_emitter"],function(require,exports,module){"use strict";var oop=require("./lib/oop"),dom=require("./lib/dom"),config=require("./config"),useragent=require("./lib/useragent"),GutterLayer=require("./layer/gutter").Gutter,MarkerLayer=require("./layer/marker").Marker,TextLayer=require("./layer/text").Text,CursorLayer=require("./layer/cursor").Cursor,HScrollBar=require("./scrollbar").HScrollBar,VScrollBar=require("./scrollbar").VScrollBar,RenderLoop=require("./renderloop").RenderLoop,FontMetrics=require("./layer/font_metrics").FontMetrics,EventEmitter=require("./lib/event_emitter").EventEmitter,editorCss='.ace_editor {position: relative;overflow: hidden;font: 12px/normal \'Monaco\', \'Menlo\', \'Ubuntu Mono\', \'Consolas\', \'source-code-pro\', monospace;direction: ltr;text-align: left;}.ace_scroller {position: absolute;overflow: hidden;top: 0;bottom: 0;background-color: inherit;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;cursor: text;}.ace_content {position: absolute;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;min-width: 100%;}.ace_dragging .ace_scroller:before{position: absolute;top: 0;left: 0;right: 0;bottom: 0;content: \'\';background: rgba(250, 250, 250, 0.01);z-index: 1000;}.ace_dragging.ace_dark .ace_scroller:before{background: rgba(0, 0, 0, 0.01);}.ace_selecting, .ace_selecting * {cursor: text !important;}.ace_gutter {position: absolute;overflow : hidden;width: auto;top: 0;bottom: 0;left: 0;cursor: default;z-index: 4;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;}.ace_gutter-active-line {position: absolute;left: 0;right: 0;}.ace_scroller.ace_scroll-left {box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;}.ace_gutter-cell {padding-left: 19px;padding-right: 6px;background-repeat: no-repeat;}.ace_gutter-cell.ace_error {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: 2px center;}.ace_gutter-cell.ace_warning {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");background-position: 2px center;}.ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");background-position: 2px center;}.ace_dark .ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");}.ace_scrollbar {position: absolute;right: 0;bottom: 0;z-index: 6;}.ace_scrollbar-inner {position: absolute;cursor: text;left: 0;top: 0;}.ace_scrollbar-v{overflow-x: hidden;overflow-y: scroll;top: 0;}.ace_scrollbar-h {overflow-x: scroll;overflow-y: hidden;left: 0;}.ace_print-margin {position: absolute;height: 100%;}.ace_text-input {position: absolute;z-index: 0;width: 0.5em;height: 1em;opacity: 0;background: transparent;-moz-appearance: none;appearance: none;border: none;resize: none;outline: none;overflow: hidden;font: inherit;padding: 0 1px;margin: 0 -1px;text-indent: -1em;-ms-user-select: text;-moz-user-select: text;-webkit-user-select: text;user-select: text;white-space: pre!important;}.ace_text-input.ace_composition {background: inherit;color: inherit;z-index: 1000;opacity: 1;text-indent: 0;}.ace_layer {z-index: 1;position: absolute;overflow: hidden;word-wrap: normal;white-space: pre;height: 100%;width: 100%;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;pointer-events: none;}.ace_gutter-layer {position: relative;width: auto;text-align: right;pointer-events: auto;}.ace_text-layer {font: inherit !important;}.ace_cjk {display: inline-block;text-align: center;}.ace_cursor-layer {z-index: 4;}.ace_cursor {z-index: 4;position: absolute;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;border-left: 2px solid;transform: translatez(0);}.ace_slim-cursors .ace_cursor {border-left-width: 1px;}.ace_overwrite-cursors .ace_cursor {border-left-width: 0;border-bottom: 1px solid;}.ace_hidden-cursors .ace_cursor {opacity: 0.2;}.ace_smooth-blinking .ace_cursor {-webkit-transition: opacity 0.18s;transition: opacity 0.18s;}.ace_editor.ace_multiselect .ace_cursor {border-left-width: 1px;}.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {position: absolute;z-index: 3;}.ace_marker-layer .ace_selection {position: absolute;z-index: 5;}.ace_marker-layer .ace_bracket {position: absolute;z-index: 6;}.ace_marker-layer .ace_active-line {position: absolute;z-index: 2;}.ace_marker-layer .ace_selected-word {position: absolute;z-index: 4;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;}.ace_line .ace_fold {-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;display: inline-block;height: 11px;margin-top: -2px;vertical-align: middle;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");background-repeat: no-repeat, repeat-x;background-position: center center, top left;color: transparent;border: 1px solid black;border-radius: 2px;cursor: pointer;pointer-events: auto;}.ace_dark .ace_fold {}.ace_fold:hover{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");}.ace_tooltip {background-color: #FFF;background-image: -webkit-linear-gradient(top, transparent, rgba(0, 0, 0, 0.1));background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));border: 1px solid gray;border-radius: 1px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);color: black;max-width: 100%;padding: 3px 4px;position: fixed;z-index: 999999;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;cursor: default;white-space: pre;word-wrap: break-word;line-height: normal;font-style: normal;font-weight: normal;letter-spacing: normal;pointer-events: none;}.ace_folding-enabled > .ace_gutter-cell {padding-right: 13px;}.ace_fold-widget {-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;margin: 0 -12px 0 1px;display: none;width: 11px;vertical-align: top;background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: center;border-radius: 3px;border: 1px solid transparent;cursor: pointer;}.ace_folding-enabled .ace_fold-widget {display: inline-block;   }.ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");}.ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");}.ace_fold-widget:hover {border: 1px solid rgba(0, 0, 0, 0.3);background-color: rgba(255, 255, 255, 0.2);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);}.ace_fold-widget:active {border: 1px solid rgba(0, 0, 0, 0.4);background-color: rgba(0, 0, 0, 0.05);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);}.ace_dark .ace_fold-widget {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");}.ace_dark .ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget:hover {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);background-color: rgba(255, 255, 255, 0.1);}.ace_dark .ace_fold-widget:active {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);}.ace_fold-widget.ace_invalid {background-color: #FFB4B4;border-color: #DE5555;}.ace_fade-fold-widgets .ace_fold-widget {-webkit-transition: opacity 0.4s ease 0.05s;transition: opacity 0.4s ease 0.05s;opacity: 0;}.ace_fade-fold-widgets:hover .ace_fold-widget {-webkit-transition: opacity 0.05s ease 0.05s;transition: opacity 0.05s ease 0.05s;opacity:1;}.ace_underline {text-decoration: underline;}.ace_bold {font-weight: bold;}.ace_nobold .ace_bold {font-weight: normal;}.ace_italic {font-style: italic;}.ace_error-marker {background-color: rgba(255, 0, 0,0.2);position: absolute;z-index: 9;}.ace_highlight-marker {background-color: rgba(255, 255, 0,0.2);position: absolute;z-index: 8;}.ace_br1 {border-top-left-radius    : 3px;}.ace_br2 {border-top-right-radius   : 3px;}.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}.ace_br4 {border-bottom-right-radius: 3px;}.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}.ace_br8 {border-bottom-left-radius : 3px;}.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}';dom.importCssString(editorCss,"ace_editor.css");var VirtualRenderer=function(container,theme){var _self=this;this.container=container||dom.createElement("div"),this.$keepTextAreaAtCursor=!useragent.isOldIE,dom.addCssClass(this.container,"ace_editor"),this.setTheme(theme),this.$gutter=dom.createElement("div"),this.$gutter.className="ace_gutter",this.container.appendChild(this.$gutter),this.scroller=dom.createElement("div"),this.scroller.className="ace_scroller",this.container.appendChild(this.scroller),this.content=dom.createElement("div"),this.content.className="ace_content",this.scroller.appendChild(this.content),this.$gutterLayer=new GutterLayer(this.$gutter),this.$gutterLayer.on("changeGutterWidth",this.onGutterResize.bind(this)),this.$markerBack=new MarkerLayer(this.content);var textLayer=this.$textLayer=new TextLayer(this.content);this.canvas=textLayer.element,this.$markerFront=new MarkerLayer(this.content),this.$cursorLayer=new CursorLayer(this.content),this.$horizScroll=!1,this.$vScroll=!1,this.scrollBar=this.scrollBarV=new VScrollBar(this.container,this),this.scrollBarH=new HScrollBar(this.container,this),this.scrollBarV.addEventListener("scroll",function(e){_self.$scrollAnimation||_self.session.setScrollTop(e.data-_self.scrollMargin.top)}),this.scrollBarH.addEventListener("scroll",function(e){_self.$scrollAnimation||_self.session.setScrollLeft(e.data-_self.scrollMargin.left)}),this.scrollTop=0,this.scrollLeft=0,this.cursorPos={row:0,column:0},this.$fontMetrics=new FontMetrics(this.container),this.$textLayer.$setFontMetrics(this.$fontMetrics),this.$textLayer.addEventListener("changeCharacterSize",function(e){_self.updateCharacterSize(),_self.onResize(!0,_self.gutterWidth,_self.$size.width,_self.$size.height),_self._signal("changeCharacterSize",e)}),this.$size={width:0,height:0,scrollerHeight:0,scrollerWidth:0,$dirty:!0},this.layerConfig={width:1,padding:0,firstRow:0,firstRowScreen:0,lastRow:0,lineHeight:0,characterWidth:0,minHeight:1,maxHeight:1,offset:0,height:1,gutterOffset:1},this.scrollMargin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.$loop=new RenderLoop(this.$renderChanges.bind(this),this.container.ownerDocument.defaultView),this.$loop.schedule(this.CHANGE_FULL),this.updateCharacterSize(),this.setPadding(4),config.resetOptions(this),config._emit("renderer",this)};(function(){this.CHANGE_CURSOR=1,this.CHANGE_MARKER=2,this.CHANGE_GUTTER=4,this.CHANGE_SCROLL=8,this.CHANGE_LINES=16,this.CHANGE_TEXT=32,this.CHANGE_SIZE=64,this.CHANGE_MARKER_BACK=128,this.CHANGE_MARKER_FRONT=256,this.CHANGE_FULL=512,this.CHANGE_H_SCROLL=1024,oop.implement(this,EventEmitter),this.updateCharacterSize=function(){this.$textLayer.allowBoldFonts!=this.$allowBoldFonts&&(this.$allowBoldFonts=this.$textLayer.allowBoldFonts,this.setStyle("ace_nobold",!this.$allowBoldFonts)),this.layerConfig.characterWidth=this.characterWidth=this.$textLayer.getCharacterWidth(),this.layerConfig.lineHeight=this.lineHeight=this.$textLayer.getLineHeight(),this.$updatePrintMargin()},this.setSession=function(session){this.session&&this.session.doc.off("changeNewLineMode",this.onChangeNewLineMode),this.session=session,session&&this.scrollMargin.top&&session.getScrollTop()<=0&&session.setScrollTop(-this.scrollMargin.top),this.$cursorLayer.setSession(session),this.$markerBack.setSession(session),this.$markerFront.setSession(session),this.$gutterLayer.setSession(session),this.$textLayer.setSession(session),session&&(this.$loop.schedule(this.CHANGE_FULL),this.session.$setFontMetrics(this.$fontMetrics),this.scrollBarV.scrollLeft=this.scrollBarV.scrollTop=null,this.onChangeNewLineMode=this.onChangeNewLineMode.bind(this),this.onChangeNewLineMode(),this.session.doc.on("changeNewLineMode",this.onChangeNewLineMode))},this.updateLines=function(firstRow,lastRow,force){if(void 0===lastRow&&(lastRow=1/0),this.$changedLines?(this.$changedLines.firstRow>firstRow&&(this.$changedLines.firstRow=firstRow),this.$changedLines.lastRow<lastRow&&(this.$changedLines.lastRow=lastRow)):this.$changedLines={firstRow:firstRow,lastRow:lastRow},this.$changedLines.lastRow<this.layerConfig.firstRow){if(!force)return;this.$changedLines.lastRow=this.layerConfig.lastRow}this.$changedLines.firstRow>this.layerConfig.lastRow||this.$loop.schedule(this.CHANGE_LINES)},this.onChangeNewLineMode=function(){this.$loop.schedule(this.CHANGE_TEXT),this.$textLayer.$updateEolChar()},this.onChangeTabSize=function(){this.$loop.schedule(this.CHANGE_TEXT|this.CHANGE_MARKER),this.$textLayer.onChangeTabSize()},this.updateText=function(){this.$loop.schedule(this.CHANGE_TEXT)},this.updateFull=function(force){force?this.$renderChanges(this.CHANGE_FULL,!0):this.$loop.schedule(this.CHANGE_FULL)},this.updateFontSize=function(){this.$textLayer.checkForSizeChanges()},this.$changes=0,this.$updateSizeAsync=function(){this.$loop.pending?this.$size.$dirty=!0:this.onResize()},this.onResize=function(force,gutterWidth,width,height){if(!(this.resizing>2)){this.resizing>0?this.resizing++:this.resizing=force?1:0;var el=this.container;height||(height=el.clientHeight||el.scrollHeight),width||(width=el.clientWidth||el.scrollWidth);var changes=this.$updateCachedSize(force,gutterWidth,width,height);if(!this.$size.scrollerHeight||!width&&!height)return this.resizing=0;force&&(this.$gutterLayer.$padding=null),force?this.$renderChanges(changes|this.$changes,!0):this.$loop.schedule(changes|this.$changes),this.resizing&&(this.resizing=0),this.scrollBarV.scrollLeft=this.scrollBarV.scrollTop=null}},this.$updateCachedSize=function(force,gutterWidth,width,height){height-=this.$extraHeight||0;var changes=0,size=this.$size,oldSize={width:size.width,height:size.height,scrollerHeight:size.scrollerHeight,scrollerWidth:size.scrollerWidth};return height&&(force||size.height!=height)&&(size.height=height,changes|=this.CHANGE_SIZE,size.scrollerHeight=size.height,this.$horizScroll&&(size.scrollerHeight-=this.scrollBarH.getHeight()),this.scrollBarV.element.style.bottom=this.scrollBarH.getHeight()+"px",changes|=this.CHANGE_SCROLL),width&&(force||size.width!=width)&&(changes|=this.CHANGE_SIZE,size.width=width,null==gutterWidth&&(gutterWidth=this.$showGutter?this.$gutter.offsetWidth:0),
this.gutterWidth=gutterWidth,this.scrollBarH.element.style.left=this.scroller.style.left=gutterWidth+"px",size.scrollerWidth=Math.max(0,width-gutterWidth-this.scrollBarV.getWidth()),this.scrollBarH.element.style.right=this.scroller.style.right=this.scrollBarV.getWidth()+"px",this.scroller.style.bottom=this.scrollBarH.getHeight()+"px",(this.session&&this.session.getUseWrapMode()&&this.adjustWrapLimit()||force)&&(changes|=this.CHANGE_FULL)),size.$dirty=!width||!height,changes&&this._signal("resize",oldSize),changes},this.onGutterResize=function(){var gutterWidth=this.$showGutter?this.$gutter.offsetWidth:0;gutterWidth!=this.gutterWidth&&(this.$changes|=this.$updateCachedSize(!0,gutterWidth,this.$size.width,this.$size.height)),this.session.getUseWrapMode()&&this.adjustWrapLimit()?this.$loop.schedule(this.CHANGE_FULL):this.$size.$dirty?this.$loop.schedule(this.CHANGE_FULL):(this.$computeLayerConfig(),this.$loop.schedule(this.CHANGE_MARKER))},this.adjustWrapLimit=function(){var availableWidth=this.$size.scrollerWidth-2*this.$padding,limit=Math.floor(availableWidth/this.characterWidth);return this.session.adjustWrapLimit(limit,this.$showPrintMargin&&this.$printMarginColumn)},this.setAnimatedScroll=function(shouldAnimate){this.setOption("animatedScroll",shouldAnimate)},this.getAnimatedScroll=function(){return this.$animatedScroll},this.setShowInvisibles=function(showInvisibles){this.setOption("showInvisibles",showInvisibles)},this.getShowInvisibles=function(){return this.getOption("showInvisibles")},this.getDisplayIndentGuides=function(){return this.getOption("displayIndentGuides")},this.setDisplayIndentGuides=function(display){this.setOption("displayIndentGuides",display)},this.setShowPrintMargin=function(showPrintMargin){this.setOption("showPrintMargin",showPrintMargin)},this.getShowPrintMargin=function(){return this.getOption("showPrintMargin")},this.setPrintMarginColumn=function(showPrintMargin){this.setOption("printMarginColumn",showPrintMargin)},this.getPrintMarginColumn=function(){return this.getOption("printMarginColumn")},this.getShowGutter=function(){return this.getOption("showGutter")},this.setShowGutter=function(show){return this.setOption("showGutter",show)},this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},this.setFadeFoldWidgets=function(show){this.setOption("fadeFoldWidgets",show)},this.setHighlightGutterLine=function(shouldHighlight){this.setOption("highlightGutterLine",shouldHighlight)},this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},this.$updateGutterLineHighlight=function(){var pos=this.$cursorLayer.$pixelPos,height=this.layerConfig.lineHeight;if(this.session.getUseWrapMode()){var cursor=this.session.selection.getCursor();cursor.column=0,pos=this.$cursorLayer.getPixelPosition(cursor,!0),height*=this.session.getRowLength(cursor.row)}this.$gutterLineHighlight.style.top=pos.top-this.layerConfig.offset+"px",this.$gutterLineHighlight.style.height=height+"px"},this.$updatePrintMargin=function(){if(this.$showPrintMargin||this.$printMarginEl){if(!this.$printMarginEl){var containerEl=dom.createElement("div");containerEl.className="ace_layer ace_print-margin-layer",this.$printMarginEl=dom.createElement("div"),this.$printMarginEl.className="ace_print-margin",containerEl.appendChild(this.$printMarginEl),this.content.insertBefore(containerEl,this.content.firstChild)}var style=this.$printMarginEl.style;style.left=this.characterWidth*this.$printMarginColumn+this.$padding+"px",style.visibility=this.$showPrintMargin?"visible":"hidden",this.session&&-1==this.session.$wrap&&this.adjustWrapLimit()}},this.getContainerElement=function(){return this.container},this.getMouseEventTarget=function(){return this.scroller},this.getTextAreaContainer=function(){return this.container},this.$moveTextAreaToCursor=function(){if(this.$keepTextAreaAtCursor){var config=this.layerConfig,posTop=this.$cursorLayer.$pixelPos.top,posLeft=this.$cursorLayer.$pixelPos.left;posTop-=config.offset;var style=this.textarea.style,h=this.lineHeight;if(0>posTop||posTop>config.height-h)return void(style.top=style.left="0");var w=this.characterWidth;if(this.$composition){var val=this.textarea.value.replace(/^\x01+/,"");w*=this.session.$getStringScreenWidth(val)[0]+2,h+=2}posLeft-=this.scrollLeft,posLeft>this.$size.scrollerWidth-w&&(posLeft=this.$size.scrollerWidth-w),posLeft+=this.gutterWidth,style.height=h+"px",style.width=w+"px",style.left=Math.min(posLeft,this.$size.scrollerWidth-w)+"px",style.top=Math.min(posTop,this.$size.height-h)+"px"}},this.getFirstVisibleRow=function(){return this.layerConfig.firstRow},this.getFirstFullyVisibleRow=function(){return this.layerConfig.firstRow+(0===this.layerConfig.offset?0:1)},this.getLastFullyVisibleRow=function(){var config=this.layerConfig,lastRow=config.lastRow,top=this.session.documentToScreenRow(lastRow,0)*config.lineHeight;return top-this.session.getScrollTop()>config.height-config.lineHeight?lastRow-1:lastRow},this.getLastVisibleRow=function(){return this.layerConfig.lastRow},this.$padding=null,this.setPadding=function(padding){this.$padding=padding,this.$textLayer.setPadding(padding),this.$cursorLayer.setPadding(padding),this.$markerFront.setPadding(padding),this.$markerBack.setPadding(padding),this.$loop.schedule(this.CHANGE_FULL),this.$updatePrintMargin()},this.setScrollMargin=function(top,bottom,left,right){var sm=this.scrollMargin;sm.top=0|top,sm.bottom=0|bottom,sm.right=0|right,sm.left=0|left,sm.v=sm.top+sm.bottom,sm.h=sm.left+sm.right,sm.top&&this.scrollTop<=0&&this.session&&this.session.setScrollTop(-sm.top),this.updateFull()},this.getHScrollBarAlwaysVisible=function(){return this.$hScrollBarAlwaysVisible},this.setHScrollBarAlwaysVisible=function(alwaysVisible){this.setOption("hScrollBarAlwaysVisible",alwaysVisible)},this.getVScrollBarAlwaysVisible=function(){return this.$vScrollBarAlwaysVisible},this.setVScrollBarAlwaysVisible=function(alwaysVisible){this.setOption("vScrollBarAlwaysVisible",alwaysVisible)},this.$updateScrollBarV=function(){var scrollHeight=this.layerConfig.maxHeight,scrollerHeight=this.$size.scrollerHeight;!this.$maxLines&&this.$scrollPastEnd&&(scrollHeight-=(scrollerHeight-this.lineHeight)*this.$scrollPastEnd,this.scrollTop>scrollHeight-scrollerHeight&&(scrollHeight=this.scrollTop+scrollerHeight,this.scrollBarV.scrollTop=null)),this.scrollBarV.setScrollHeight(scrollHeight+this.scrollMargin.v),this.scrollBarV.setScrollTop(this.scrollTop+this.scrollMargin.top)},this.$updateScrollBarH=function(){this.scrollBarH.setScrollWidth(this.layerConfig.width+2*this.$padding+this.scrollMargin.h),this.scrollBarH.setScrollLeft(this.scrollLeft+this.scrollMargin.left)},this.$frozen=!1,this.freeze=function(){this.$frozen=!0},this.unfreeze=function(){this.$frozen=!1},this.$renderChanges=function(changes,force){if(this.$changes&&(changes|=this.$changes,this.$changes=0),!this.session||!this.container.offsetWidth||this.$frozen||!changes&&!force)return void(this.$changes|=changes);if(this.$size.$dirty)return this.$changes|=changes,this.onResize(!0);this.lineHeight||this.$textLayer.checkForSizeChanges(),this._signal("beforeRender");var config=this.layerConfig;if(changes&this.CHANGE_FULL||changes&this.CHANGE_SIZE||changes&this.CHANGE_TEXT||changes&this.CHANGE_LINES||changes&this.CHANGE_SCROLL||changes&this.CHANGE_H_SCROLL){if(changes|=this.$computeLayerConfig(),config.firstRow!=this.layerConfig.firstRow&&config.firstRowScreen==this.layerConfig.firstRowScreen){var st=this.scrollTop+(config.firstRow-this.layerConfig.firstRow)*this.lineHeight;st>0&&(this.scrollTop=st,changes|=this.CHANGE_SCROLL,changes|=this.$computeLayerConfig())}config=this.layerConfig,this.$updateScrollBarV(),changes&this.CHANGE_H_SCROLL&&this.$updateScrollBarH(),this.$gutterLayer.element.style.marginTop=-config.offset+"px",this.content.style.marginTop=-config.offset+"px",this.content.style.width=config.width+2*this.$padding+"px",this.content.style.height=config.minHeight+"px"}return changes&this.CHANGE_H_SCROLL&&(this.content.style.marginLeft=-this.scrollLeft+"px",this.scroller.className=this.scrollLeft<=0?"ace_scroller":"ace_scroller ace_scroll-left"),changes&this.CHANGE_FULL?(this.$textLayer.update(config),this.$showGutter&&this.$gutterLayer.update(config),this.$markerBack.update(config),this.$markerFront.update(config),this.$cursorLayer.update(config),this.$moveTextAreaToCursor(),this.$highlightGutterLine&&this.$updateGutterLineHighlight(),void this._signal("afterRender")):changes&this.CHANGE_SCROLL?(changes&this.CHANGE_TEXT||changes&this.CHANGE_LINES?this.$textLayer.update(config):this.$textLayer.scrollLines(config),this.$showGutter&&this.$gutterLayer.update(config),this.$markerBack.update(config),this.$markerFront.update(config),this.$cursorLayer.update(config),this.$highlightGutterLine&&this.$updateGutterLineHighlight(),this.$moveTextAreaToCursor(),void this._signal("afterRender")):(changes&this.CHANGE_TEXT?(this.$textLayer.update(config),this.$showGutter&&this.$gutterLayer.update(config)):changes&this.CHANGE_LINES?(this.$updateLines()||changes&this.CHANGE_GUTTER&&this.$showGutter)&&this.$gutterLayer.update(config):(changes&this.CHANGE_TEXT||changes&this.CHANGE_GUTTER)&&this.$showGutter&&this.$gutterLayer.update(config),changes&this.CHANGE_CURSOR&&(this.$cursorLayer.update(config),this.$moveTextAreaToCursor(),this.$highlightGutterLine&&this.$updateGutterLineHighlight()),changes&(this.CHANGE_MARKER|this.CHANGE_MARKER_FRONT)&&this.$markerFront.update(config),changes&(this.CHANGE_MARKER|this.CHANGE_MARKER_BACK)&&this.$markerBack.update(config),void this._signal("afterRender"))},this.$autosize=function(){var height=this.session.getScreenLength()*this.lineHeight,maxHeight=this.$maxLines*this.lineHeight,desiredHeight=Math.min(maxHeight,Math.max((this.$minLines||1)*this.lineHeight,height))+this.scrollMargin.v+(this.$extraHeight||0);this.$horizScroll&&(desiredHeight+=this.scrollBarH.getHeight()),this.$maxPixelHeight&&desiredHeight>this.$maxPixelHeight&&(desiredHeight=this.$maxPixelHeight);var vScroll=height>maxHeight;if(desiredHeight!=this.desiredHeight||this.$size.height!=this.desiredHeight||vScroll!=this.$vScroll){vScroll!=this.$vScroll&&(this.$vScroll=vScroll,this.scrollBarV.setVisible(vScroll));var w=this.container.clientWidth;this.container.style.height=desiredHeight+"px",this.$updateCachedSize(!0,this.$gutterWidth,w,desiredHeight),this.desiredHeight=desiredHeight,this._signal("autosize")}},this.$computeLayerConfig=function(){var session=this.session,size=this.$size,hideScrollbars=size.height<=2*this.lineHeight,screenLines=this.session.getScreenLength(),maxHeight=screenLines*this.lineHeight,longestLine=this.$getLongestLine(),horizScroll=!hideScrollbars&&(this.$hScrollBarAlwaysVisible||size.scrollerWidth-longestLine-2*this.$padding<0),hScrollChanged=this.$horizScroll!==horizScroll;hScrollChanged&&(this.$horizScroll=horizScroll,this.scrollBarH.setVisible(horizScroll));var vScrollBefore=this.$vScroll;this.$maxLines&&this.lineHeight>1&&this.$autosize();var offset=this.scrollTop%this.lineHeight,minHeight=size.scrollerHeight+this.lineHeight,scrollPastEnd=!this.$maxLines&&this.$scrollPastEnd?(size.scrollerHeight-this.lineHeight)*this.$scrollPastEnd:0;maxHeight+=scrollPastEnd;var sm=this.scrollMargin;this.session.setScrollTop(Math.max(-sm.top,Math.min(this.scrollTop,maxHeight-size.scrollerHeight+sm.bottom))),this.session.setScrollLeft(Math.max(-sm.left,Math.min(this.scrollLeft,longestLine+2*this.$padding-size.scrollerWidth+sm.right)));var vScroll=!hideScrollbars&&(this.$vScrollBarAlwaysVisible||size.scrollerHeight-maxHeight+scrollPastEnd<0||this.scrollTop>sm.top),vScrollChanged=vScrollBefore!==vScroll;vScrollChanged&&(this.$vScroll=vScroll,this.scrollBarV.setVisible(vScroll));var firstRowScreen,firstRowHeight,lineCount=Math.ceil(minHeight/this.lineHeight)-1,firstRow=Math.max(0,Math.round((this.scrollTop-offset)/this.lineHeight)),lastRow=firstRow+lineCount,lineHeight=this.lineHeight;firstRow=session.screenToDocumentRow(firstRow,0);var foldLine=session.getFoldLine(firstRow);foldLine&&(firstRow=foldLine.start.row),firstRowScreen=session.documentToScreenRow(firstRow,0),firstRowHeight=session.getRowLength(firstRow)*lineHeight,lastRow=Math.min(session.screenToDocumentRow(lastRow,0),session.getLength()-1),minHeight=size.scrollerHeight+session.getRowLength(lastRow)*lineHeight+firstRowHeight,offset=this.scrollTop-firstRowScreen*lineHeight;var changes=0;return this.layerConfig.width!=longestLine&&(changes=this.CHANGE_H_SCROLL),(hScrollChanged||vScrollChanged)&&(changes=this.$updateCachedSize(!0,this.gutterWidth,size.width,size.height),this._signal("scrollbarVisibilityChanged"),vScrollChanged&&(longestLine=this.$getLongestLine())),this.layerConfig={width:longestLine,padding:this.$padding,firstRow:firstRow,firstRowScreen:firstRowScreen,lastRow:lastRow,lineHeight:lineHeight,characterWidth:this.characterWidth,minHeight:minHeight,maxHeight:maxHeight,offset:offset,gutterOffset:lineHeight?Math.max(0,Math.ceil((offset+size.height-size.scrollerHeight)/lineHeight)):0,height:this.$size.scrollerHeight},changes},this.$updateLines=function(){var firstRow=this.$changedLines.firstRow,lastRow=this.$changedLines.lastRow;this.$changedLines=null;var layerConfig=this.layerConfig;return firstRow>layerConfig.lastRow+1||lastRow<layerConfig.firstRow?void 0:lastRow===1/0?(this.$showGutter&&this.$gutterLayer.update(layerConfig),void this.$textLayer.update(layerConfig)):(this.$textLayer.updateLines(layerConfig,firstRow,lastRow),!0)},this.$getLongestLine=function(){var charCount=this.session.getScreenWidth();return this.showInvisibles&&!this.session.$useWrapMode&&(charCount+=1),Math.max(this.$size.scrollerWidth-2*this.$padding,Math.round(charCount*this.characterWidth))},this.updateFrontMarkers=function(){this.$markerFront.setMarkers(this.session.getMarkers(!0)),this.$loop.schedule(this.CHANGE_MARKER_FRONT)},this.updateBackMarkers=function(){this.$markerBack.setMarkers(this.session.getMarkers()),this.$loop.schedule(this.CHANGE_MARKER_BACK)},this.addGutterDecoration=function(row,className){this.$gutterLayer.addGutterDecoration(row,className)},this.removeGutterDecoration=function(row,className){this.$gutterLayer.removeGutterDecoration(row,className)},this.updateBreakpoints=function(rows){this.$loop.schedule(this.CHANGE_GUTTER)},this.setAnnotations=function(annotations){this.$gutterLayer.setAnnotations(annotations),this.$loop.schedule(this.CHANGE_GUTTER)},this.updateCursor=function(){this.$loop.schedule(this.CHANGE_CURSOR)},this.hideCursor=function(){this.$cursorLayer.hideCursor()},this.showCursor=function(){this.$cursorLayer.showCursor()},this.scrollSelectionIntoView=function(anchor,lead,offset){this.scrollCursorIntoView(anchor,offset),this.scrollCursorIntoView(lead,offset)},this.scrollCursorIntoView=function(cursor,offset,$viewMargin){if(0!==this.$size.scrollerHeight){var pos=this.$cursorLayer.getPixelPosition(cursor),left=pos.left,top=pos.top,topMargin=$viewMargin&&$viewMargin.top||0,bottomMargin=$viewMargin&&$viewMargin.bottom||0,scrollTop=this.$scrollAnimation?this.session.getScrollTop():this.scrollTop;scrollTop+topMargin>top?(offset&&scrollTop+topMargin>top+this.lineHeight&&(top-=offset*this.$size.scrollerHeight),0===top&&(top=-this.scrollMargin.top),this.session.setScrollTop(top)):scrollTop+this.$size.scrollerHeight-bottomMargin<top+this.lineHeight&&(offset&&scrollTop+this.$size.scrollerHeight-bottomMargin<top-this.lineHeight&&(top+=offset*this.$size.scrollerHeight),this.session.setScrollTop(top+this.lineHeight-this.$size.scrollerHeight));var scrollLeft=this.scrollLeft;scrollLeft>left?(left<this.$padding+2*this.layerConfig.characterWidth&&(left=-this.scrollMargin.left),this.session.setScrollLeft(left)):scrollLeft+this.$size.scrollerWidth<left+this.characterWidth?this.session.setScrollLeft(Math.round(left+this.characterWidth-this.$size.scrollerWidth)):scrollLeft<=this.$padding&&left-scrollLeft<this.characterWidth&&this.session.setScrollLeft(0)}},this.getScrollTop=function(){return this.session.getScrollTop()},this.getScrollLeft=function(){return this.session.getScrollLeft()},this.getScrollTopRow=function(){return this.scrollTop/this.lineHeight},this.getScrollBottomRow=function(){return Math.max(0,Math.floor((this.scrollTop+this.$size.scrollerHeight)/this.lineHeight)-1)},this.scrollToRow=function(row){this.session.setScrollTop(row*this.lineHeight)},this.alignCursor=function(cursor,alignment){"number"==typeof cursor&&(cursor={row:cursor,column:0});var pos=this.$cursorLayer.getPixelPosition(cursor),h=this.$size.scrollerHeight-this.lineHeight,offset=pos.top-h*(alignment||0);return this.session.setScrollTop(offset),offset},this.STEPS=8,this.$calcSteps=function(fromValue,toValue){var i=0,l=this.STEPS,steps=[],func=function(t,x_min,dx){return dx*(Math.pow(t-1,3)+1)+x_min};for(i=0;l>i;++i)steps.push(func(i/this.STEPS,fromValue,toValue-fromValue));return steps},this.scrollToLine=function(line,center,animate,callback){var pos=this.$cursorLayer.getPixelPosition({row:line,column:0}),offset=pos.top;center&&(offset-=this.$size.scrollerHeight/2);var initialScroll=this.scrollTop;this.session.setScrollTop(offset),animate!==!1&&this.animateScrolling(initialScroll,callback)},this.animateScrolling=function(fromValue,callback){var toValue=this.scrollTop;if(this.$animatedScroll){var _self=this;if(fromValue!=toValue){if(this.$scrollAnimation){var oldSteps=this.$scrollAnimation.steps;if(oldSteps.length&&(fromValue=oldSteps[0],fromValue==toValue))return}var steps=_self.$calcSteps(fromValue,toValue);this.$scrollAnimation={from:fromValue,to:toValue,steps:steps},clearInterval(this.$timer),_self.session.setScrollTop(steps.shift()),_self.session.$scrollTop=toValue,this.$timer=setInterval(function(){steps.length?(_self.session.setScrollTop(steps.shift()),_self.session.$scrollTop=toValue):null!=toValue?(_self.session.$scrollTop=-1,_self.session.setScrollTop(toValue),toValue=null):(_self.$timer=clearInterval(_self.$timer),_self.$scrollAnimation=null,callback&&callback())},10)}}},this.scrollToY=function(scrollTop){this.scrollTop!==scrollTop&&(this.$loop.schedule(this.CHANGE_SCROLL),this.scrollTop=scrollTop)},this.scrollToX=function(scrollLeft){this.scrollLeft!==scrollLeft&&(this.scrollLeft=scrollLeft),this.$loop.schedule(this.CHANGE_H_SCROLL)},this.scrollTo=function(x,y){this.session.setScrollTop(y),this.session.setScrollLeft(y)},this.scrollBy=function(deltaX,deltaY){deltaY&&this.session.setScrollTop(this.session.getScrollTop()+deltaY),deltaX&&this.session.setScrollLeft(this.session.getScrollLeft()+deltaX)},this.isScrollableBy=function(deltaX,deltaY){return 0>deltaY&&this.session.getScrollTop()>=1-this.scrollMargin.top?!0:deltaY>0&&this.session.getScrollTop()+this.$size.scrollerHeight-this.layerConfig.maxHeight<-1+this.scrollMargin.bottom?!0:0>deltaX&&this.session.getScrollLeft()>=1-this.scrollMargin.left?!0:deltaX>0&&this.session.getScrollLeft()+this.$size.scrollerWidth-this.layerConfig.width<-1+this.scrollMargin.right?!0:void 0},this.pixelToScreenCoordinates=function(x,y){var canvasPos=this.scroller.getBoundingClientRect(),offset=(x+this.scrollLeft-canvasPos.left-this.$padding)/this.characterWidth,row=Math.floor((y+this.scrollTop-canvasPos.top)/this.lineHeight),col=Math.round(offset);return{row:row,column:col,side:offset-col>0?1:-1}},this.screenToTextCoordinates=function(x,y){var canvasPos=this.scroller.getBoundingClientRect(),col=Math.round((x+this.scrollLeft-canvasPos.left-this.$padding)/this.characterWidth),row=(y+this.scrollTop-canvasPos.top)/this.lineHeight;return this.session.screenToDocumentPosition(row,Math.max(col,0))},this.textToScreenCoordinates=function(row,column){var canvasPos=this.scroller.getBoundingClientRect(),pos=this.session.documentToScreenPosition(row,column),x=this.$padding+Math.round(pos.column*this.characterWidth),y=pos.row*this.lineHeight;return{pageX:canvasPos.left+x-this.scrollLeft,pageY:canvasPos.top+y-this.scrollTop}},this.visualizeFocus=function(){dom.addCssClass(this.container,"ace_focus")},this.visualizeBlur=function(){dom.removeCssClass(this.container,"ace_focus")},this.showComposition=function(position){this.$composition||(this.$composition={keepTextAreaAtCursor:this.$keepTextAreaAtCursor,cssText:this.textarea.style.cssText}),this.$keepTextAreaAtCursor=!0,dom.addCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText="",this.$moveTextAreaToCursor()},this.setCompositionText=function(text){this.$moveTextAreaToCursor()},this.hideComposition=function(){this.$composition&&(dom.removeCssClass(this.textarea,"ace_composition"),this.$keepTextAreaAtCursor=this.$composition.keepTextAreaAtCursor,this.textarea.style.cssText=this.$composition.cssText,this.$composition=null)},this.setTheme=function(theme,cb){function afterLoad(module){if(_self.$themeId!=theme)return cb&&cb();if(!module||!module.cssClass)throw new Error("couldn't load module "+theme+" or it didn't call define");dom.importCssString(module.cssText,module.cssClass,_self.container.ownerDocument),_self.theme&&dom.removeCssClass(_self.container,_self.theme.cssClass);var padding="padding"in module?module.padding:"padding"in(_self.theme||{})?4:_self.$padding;_self.$padding&&padding!=_self.$padding&&_self.setPadding(padding),_self.$theme=module.cssClass,_self.theme=module,dom.addCssClass(_self.container,module.cssClass),dom.setCssClass(_self.container,"ace_dark",module.isDark),_self.$size&&(_self.$size.width=0,_self.$updateSizeAsync()),_self._dispatchEvent("themeLoaded",{theme:module}),cb&&cb()}var _self=this;if(this.$themeId=theme,_self._dispatchEvent("themeChange",{theme:theme}),theme&&"string"!=typeof theme)afterLoad(theme);else{var moduleName=theme||this.$options.theme.initialValue;config.loadModule(["theme",moduleName],afterLoad)}},this.getTheme=function(){return this.$themeId},this.setStyle=function(style,include){dom.setCssClass(this.container,style,include!==!1)},this.unsetStyle=function(style){dom.removeCssClass(this.container,style)},this.setCursorStyle=function(style){this.scroller.style.cursor!=style&&(this.scroller.style.cursor=style)},this.setMouseCursor=function(cursorStyle){this.scroller.style.cursor=cursorStyle},this.destroy=function(){this.$textLayer.destroy(),this.$cursorLayer.destroy()}}).call(VirtualRenderer.prototype),config.defineOptions(VirtualRenderer.prototype,"renderer",{animatedScroll:{initialValue:!1},showInvisibles:{set:function(value){this.$textLayer.setShowInvisibles(value)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!1},showPrintMargin:{set:function(){this.$updatePrintMargin()},initialValue:!0},printMarginColumn:{set:function(){this.$updatePrintMargin()},initialValue:80},printMargin:{set:function(val){"number"==typeof val&&(this.$printMarginColumn=val),this.$showPrintMargin=!!val,this.$updatePrintMargin()},get:function(){return this.$showPrintMargin&&this.$printMarginColumn}},showGutter:{set:function(show){this.$gutter.style.display=show?"block":"none",this.$loop.schedule(this.CHANGE_FULL),this.onGutterResize()},initialValue:!0},fadeFoldWidgets:{set:function(show){dom.setCssClass(this.$gutter,"ace_fade-fold-widgets",show)},initialValue:!1},showFoldWidgets:{set:function(show){this.$gutterLayer.setShowFoldWidgets(show)},initialValue:!0},showLineNumbers:{set:function(show){this.$gutterLayer.setShowLineNumbers(show),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},displayIndentGuides:{set:function(show){this.$textLayer.setDisplayIndentGuides(show)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!0},highlightGutterLine:{set:function(shouldHighlight){return this.$gutterLineHighlight?(this.$gutterLineHighlight.style.display=shouldHighlight?"":"none",void(this.$cursorLayer.$pixelPos&&this.$updateGutterLineHighlight())):(this.$gutterLineHighlight=dom.createElement("div"),this.$gutterLineHighlight.className="ace_gutter-active-line",void this.$gutter.appendChild(this.$gutterLineHighlight))},initialValue:!1,value:!0},hScrollBarAlwaysVisible:{set:function(val){this.$hScrollBarAlwaysVisible&&this.$horizScroll||this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},vScrollBarAlwaysVisible:{set:function(val){this.$vScrollBarAlwaysVisible&&this.$vScroll||this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},fontSize:{set:function(size){"number"==typeof size&&(size+="px"),this.container.style.fontSize=size,this.updateFontSize()},initialValue:12},fontFamily:{set:function(name){this.container.style.fontFamily=name,this.updateFontSize()}},maxLines:{set:function(val){this.updateFull()}},minLines:{set:function(val){this.updateFull()}},maxPixelHeight:{set:function(val){this.updateFull()},initialValue:0},scrollPastEnd:{set:function(val){val=+val||0,this.$scrollPastEnd!=val&&(this.$scrollPastEnd=val,this.$loop.schedule(this.CHANGE_SCROLL))},initialValue:0,handlesSet:!0},fixedWidthGutter:{set:function(val){this.$gutterLayer.$fixedWidth=!!val,this.$loop.schedule(this.CHANGE_GUTTER)}},theme:{set:function(val){this.setTheme(val)},get:function(){return this.$themeId||this.theme},initialValue:"./theme/textmate",handlesSet:!0}}),exports.VirtualRenderer=VirtualRenderer}),ace.define("ace/worker/worker_client",["require","exports","module","ace/lib/oop","ace/lib/net","ace/lib/event_emitter","ace/config"],function(require,exports,module){"use strict";var oop=require("../lib/oop"),net=require("../lib/net"),EventEmitter=require("../lib/event_emitter").EventEmitter,config=require("../config"),WorkerClient=function(topLevelNamespaces,mod,classname,workerUrl){if(this.$sendDeltaQueue=this.$sendDeltaQueue.bind(this),this.changeListener=this.changeListener.bind(this),this.onMessage=this.onMessage.bind(this),require.nameToUrl&&!require.toUrl&&(require.toUrl=require.nameToUrl),config.get("packaged")||!require.toUrl)workerUrl=workerUrl||config.moduleUrl(mod,"worker");else{var normalizePath=this.$normalizePath;workerUrl=workerUrl||normalizePath(require.toUrl("ace/worker/worker.js",null,"_"));var tlns={};topLevelNamespaces.forEach(function(ns){tlns[ns]=normalizePath(require.toUrl(ns,null,"_").replace(/(\.js)?(\?.*)?$/,""))})}try{this.$worker=new Worker(workerUrl)}catch(e){if(!(e instanceof window.DOMException))throw e;var blob=this.$workerBlob(workerUrl),URL=window.URL||window.webkitURL,blobURL=URL.createObjectURL(blob);this.$worker=new Worker(blobURL),URL.revokeObjectURL(blobURL)}this.$worker.postMessage({init:!0,tlns:tlns,module:mod,classname:classname}),this.callbackId=1,this.callbacks={},this.$worker.onmessage=this.onMessage};(function(){oop.implement(this,EventEmitter),this.onMessage=function(e){var msg=e.data;switch(msg.type){case"event":this._signal(msg.name,{data:msg.data});break;case"call":var callback=this.callbacks[msg.id];callback&&(callback(msg.data),delete this.callbacks[msg.id]);break;case"error":this.reportError(msg.data);break;case"log":window.console&&console.log&&console.log.apply(console,msg.data)}},this.reportError=function(err){window.console&&console.error&&console.error(err)},this.$normalizePath=function(path){return net.qualifyURL(path)},this.terminate=function(){this._signal("terminate",{}),this.deltaQueue=null,this.$worker.terminate(),this.$worker=null,this.$doc&&this.$doc.off("change",this.changeListener),this.$doc=null},this.send=function(cmd,args){this.$worker.postMessage({command:cmd,args:args})},this.call=function(cmd,args,callback){if(callback){var id=this.callbackId++;this.callbacks[id]=callback,args.push(id)}this.send(cmd,args)},this.emit=function(event,data){try{this.$worker.postMessage({event:event,data:{data:data.data}})}catch(ex){console.error(ex.stack)}},this.attachToDocument=function(doc){this.$doc&&this.terminate(),this.$doc=doc,this.call("setValue",[doc.getValue()]),doc.on("change",this.changeListener)},this.changeListener=function(delta){this.deltaQueue||(this.deltaQueue=[],setTimeout(this.$sendDeltaQueue,0)),"insert"==delta.action?this.deltaQueue.push(delta.start,delta.lines):this.deltaQueue.push(delta.start,delta.end)},this.$sendDeltaQueue=function(){var q=this.deltaQueue;q&&(this.deltaQueue=null,q.length>50&&q.length>this.$doc.getLength()>>1?this.call("setValue",[this.$doc.getValue()]):this.emit("change",{data:q}))},this.$workerBlob=function(workerUrl){var script="importScripts('"+net.qualifyURL(workerUrl)+"');";try{return new Blob([script],{type:"application/javascript"})}catch(e){var BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,blobBuilder=new BlobBuilder;return blobBuilder.append(script),blobBuilder.getBlob("application/javascript")}}}).call(WorkerClient.prototype);var UIWorkerClient=function(topLevelNamespaces,mod,classname){this.$sendDeltaQueue=this.$sendDeltaQueue.bind(this),this.changeListener=this.changeListener.bind(this),this.callbackId=1,this.callbacks={},this.messageBuffer=[];var main=null,emitSync=!1,sender=Object.create(EventEmitter),_self=this;this.$worker={},this.$worker.terminate=function(){},this.$worker.postMessage=function(e){_self.messageBuffer.push(e),main&&(emitSync?setTimeout(processNext):processNext())},this.setEmitSync=function(val){emitSync=val};var processNext=function(){var msg=_self.messageBuffer.shift();msg.command?main[msg.command].apply(main,msg.args):msg.event&&sender._signal(msg.event,msg.data)};sender.postMessage=function(msg){_self.onMessage({data:msg})},sender.callback=function(data,callbackId){this.postMessage({type:"call",id:callbackId,data:data})},sender.emit=function(name,data){this.postMessage({type:"event",name:name,data:data})},config.loadModule(["worker",mod],function(Main){for(main=new Main[classname](sender);_self.messageBuffer.length;)processNext()})};UIWorkerClient.prototype=WorkerClient.prototype,exports.UIWorkerClient=UIWorkerClient,exports.WorkerClient=WorkerClient}),ace.define("ace/placeholder",["require","exports","module","ace/range","ace/lib/event_emitter","ace/lib/oop"],function(require,exports,module){"use strict";var Range=require("./range").Range,EventEmitter=require("./lib/event_emitter").EventEmitter,oop=require("./lib/oop"),PlaceHolder=function(session,length,pos,others,mainClass,othersClass){var _self=this;this.length=length,this.session=session,this.doc=session.getDocument(),this.mainClass=mainClass,this.othersClass=othersClass,this.$onUpdate=this.onUpdate.bind(this),this.doc.on("change",this.$onUpdate),this.$others=others,this.$onCursorChange=function(){setTimeout(function(){_self.onCursorChange()})},this.$pos=pos;var undoStack=session.getUndoManager().$undoStack||session.getUndoManager().$undostack||{length:-1};this.$undoStackDepth=undoStack.length,this.setup(),session.selection.on("changeCursor",this.$onCursorChange)};(function(){oop.implement(this,EventEmitter),this.setup=function(){var _self=this,doc=this.doc,session=this.session;this.selectionBefore=session.selection.toJSON(),session.selection.inMultiSelectMode&&session.selection.toSingleRange(),this.pos=doc.createAnchor(this.$pos.row,this.$pos.column);var pos=this.pos;pos.$insertRight=!0,pos.detach(),pos.markerId=session.addMarker(new Range(pos.row,pos.column,pos.row,pos.column+this.length),this.mainClass,null,!1),this.others=[],this.$others.forEach(function(other){var anchor=doc.createAnchor(other.row,other.column);anchor.$insertRight=!0,anchor.detach(),_self.others.push(anchor)}),session.setUndoSelect(!1)},this.showOtherMarkers=function(){if(!this.othersActive){var session=this.session,_self=this;this.othersActive=!0,this.others.forEach(function(anchor){anchor.markerId=session.addMarker(new Range(anchor.row,anchor.column,anchor.row,anchor.column+_self.length),_self.othersClass,null,!1)})}},this.hideOtherMarkers=function(){if(this.othersActive){this.othersActive=!1;for(var i=0;i<this.others.length;i++)this.session.removeMarker(this.others[i].markerId)}},this.onUpdate=function(delta){if(this.$updating)return this.updateAnchors(delta);var range=delta;if(range.start.row===range.end.row&&range.start.row===this.pos.row){this.$updating=!0;var lengthDiff="insert"===delta.action?range.end.column-range.start.column:range.start.column-range.end.column,inMainRange=range.start.column>=this.pos.column&&range.start.column<=this.pos.column+this.length+1,distanceFromStart=range.start.column-this.pos.column;
if(this.updateAnchors(delta),inMainRange&&(this.length+=lengthDiff),inMainRange&&!this.session.$fromUndo)if("insert"===delta.action)for(var i=this.others.length-1;i>=0;i--){var otherPos=this.others[i],newPos={row:otherPos.row,column:otherPos.column+distanceFromStart};this.doc.insertMergedLines(newPos,delta.lines)}else if("remove"===delta.action)for(var i=this.others.length-1;i>=0;i--){var otherPos=this.others[i],newPos={row:otherPos.row,column:otherPos.column+distanceFromStart};this.doc.remove(new Range(newPos.row,newPos.column,newPos.row,newPos.column-lengthDiff))}this.$updating=!1,this.updateMarkers()}},this.updateAnchors=function(delta){this.pos.onChange(delta);for(var i=this.others.length;i--;)this.others[i].onChange(delta);this.updateMarkers()},this.updateMarkers=function(){if(!this.$updating){var _self=this,session=this.session,updateMarker=function(pos,className){session.removeMarker(pos.markerId),pos.markerId=session.addMarker(new Range(pos.row,pos.column,pos.row,pos.column+_self.length),className,null,!1)};updateMarker(this.pos,this.mainClass);for(var i=this.others.length;i--;)updateMarker(this.others[i],this.othersClass)}},this.onCursorChange=function(event){if(!this.$updating&&this.session){var pos=this.session.selection.getCursor();pos.row===this.pos.row&&pos.column>=this.pos.column&&pos.column<=this.pos.column+this.length?(this.showOtherMarkers(),this._emit("cursorEnter",event)):(this.hideOtherMarkers(),this._emit("cursorLeave",event))}},this.detach=function(){this.session.removeMarker(this.pos&&this.pos.markerId),this.hideOtherMarkers(),this.doc.removeEventListener("change",this.$onUpdate),this.session.selection.removeEventListener("changeCursor",this.$onCursorChange),this.session.setUndoSelect(!0),this.session=null},this.cancel=function(){if(-1!==this.$undoStackDepth){for(var undoManager=this.session.getUndoManager(),undosRequired=(undoManager.$undoStack||undoManager.$undostack).length-this.$undoStackDepth,i=0;undosRequired>i;i++)undoManager.undo(!0);this.selectionBefore&&this.session.selection.fromJSON(this.selectionBefore)}}}).call(PlaceHolder.prototype),exports.PlaceHolder=PlaceHolder}),ace.define("ace/mouse/multi_select_handler",["require","exports","module","ace/lib/event","ace/lib/useragent"],function(require,exports,module){function isSamePoint(p1,p2){return p1.row==p2.row&&p1.column==p2.column}function onMouseDown(e){var ev=e.domEvent,alt=ev.altKey,shift=ev.shiftKey,ctrl=ev.ctrlKey,accel=e.getAccelKey(),button=e.getButton();if(ctrl&&useragent.isMac&&(button=ev.button),e.editor.inMultiSelectMode&&2==button)return void e.editor.textInput.onContextMenu(e.domEvent);if(!ctrl&&!alt&&!accel)return void(0===button&&e.editor.inMultiSelectMode&&e.editor.exitMultiSelectMode());if(0===button){var selectionMode,editor=e.editor,selection=editor.selection,isMultiSelect=editor.inMultiSelectMode,pos=e.getDocumentPosition(),cursor=selection.getCursor(),inSelection=e.inSelection()||selection.isEmpty()&&isSamePoint(pos,cursor),mouseX=e.x,mouseY=e.y,onMouseSelection=function(e){mouseX=e.clientX,mouseY=e.clientY},session=editor.session,screenAnchor=editor.renderer.pixelToScreenCoordinates(mouseX,mouseY),screenCursor=screenAnchor;if(editor.$mouseHandler.$enableJumpToDef)ctrl&&alt||accel&&alt?selectionMode=shift?"block":"add":alt&&editor.$blockSelectEnabled&&(selectionMode="block");else if(accel&&!alt){if(selectionMode="add",!isMultiSelect&&shift)return}else alt&&editor.$blockSelectEnabled&&(selectionMode="block");if(selectionMode&&useragent.isMac&&ev.ctrlKey&&editor.$mouseHandler.cancelContextMenu(),"add"==selectionMode){if(!isMultiSelect&&inSelection)return;if(!isMultiSelect){var range=selection.toOrientedRange();editor.addSelectionMarker(range)}var oldRange=selection.rangeList.rangeAtPoint(pos);editor.$blockScrolling++,editor.inVirtualSelectionMode=!0,shift&&(oldRange=null,range=selection.ranges[0]||range,editor.removeSelectionMarker(range)),editor.once("mouseup",function(){var tmpSel=selection.toOrientedRange();oldRange&&tmpSel.isEmpty()&&isSamePoint(oldRange.cursor,tmpSel.cursor)?selection.substractPoint(tmpSel.cursor):(shift?selection.substractPoint(range.cursor):range&&(editor.removeSelectionMarker(range),selection.addRange(range)),selection.addRange(tmpSel)),editor.$blockScrolling--,editor.inVirtualSelectionMode=!1})}else if("block"==selectionMode){e.stop(),editor.inVirtualSelectionMode=!0;var initialRange,rectSel=[],blockSelect=function(){var newCursor=editor.renderer.pixelToScreenCoordinates(mouseX,mouseY),cursor=session.screenToDocumentPosition(newCursor.row,newCursor.column);isSamePoint(screenCursor,newCursor)&&isSamePoint(cursor,selection.lead)||(screenCursor=newCursor,editor.$blockScrolling++,editor.selection.moveToPosition(cursor),editor.renderer.scrollCursorIntoView(),editor.removeSelectionMarkers(rectSel),rectSel=selection.rectangularRangeBlock(screenCursor,screenAnchor),editor.$mouseHandler.$clickSelection&&1==rectSel.length&&rectSel[0].isEmpty()&&(rectSel[0]=editor.$mouseHandler.$clickSelection.clone()),rectSel.forEach(editor.addSelectionMarker,editor),editor.updateSelectionMarkers(),editor.$blockScrolling--)};editor.$blockScrolling++,isMultiSelect&&!accel?selection.toSingleRange():!isMultiSelect&&accel&&(initialRange=selection.toOrientedRange(),editor.addSelectionMarker(initialRange)),shift?screenAnchor=session.documentToScreenPosition(selection.lead):selection.moveToPosition(pos),editor.$blockScrolling--,screenCursor={row:-1,column:-1};var onMouseSelectionEnd=function(e){clearInterval(timerId),editor.removeSelectionMarkers(rectSel),rectSel.length||(rectSel=[selection.toOrientedRange()]),editor.$blockScrolling++,initialRange&&(editor.removeSelectionMarker(initialRange),selection.toSingleRange(initialRange));for(var i=0;i<rectSel.length;i++)selection.addRange(rectSel[i]);editor.inVirtualSelectionMode=!1,editor.$mouseHandler.$clickSelection=null,editor.$blockScrolling--},onSelectionInterval=blockSelect;event.capture(editor.container,onMouseSelection,onMouseSelectionEnd);var timerId=setInterval(function(){onSelectionInterval()},20);return e.preventDefault()}}}var event=require("../lib/event"),useragent=require("../lib/useragent");exports.onMouseDown=onMouseDown}),ace.define("ace/commands/multi_select_commands",["require","exports","module","ace/keyboard/hash_handler"],function(require,exports,module){exports.defaultCommands=[{name:"addCursorAbove",exec:function(editor){editor.selectMoreLines(-1)},bindKey:{win:"Ctrl-Alt-Up",mac:"Ctrl-Alt-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelow",exec:function(editor){editor.selectMoreLines(1)},bindKey:{win:"Ctrl-Alt-Down",mac:"Ctrl-Alt-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorAboveSkipCurrent",exec:function(editor){editor.selectMoreLines(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Up",mac:"Ctrl-Alt-Shift-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelowSkipCurrent",exec:function(editor){editor.selectMoreLines(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Down",mac:"Ctrl-Alt-Shift-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreBefore",exec:function(editor){editor.selectMore(-1)},bindKey:{win:"Ctrl-Alt-Left",mac:"Ctrl-Alt-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreAfter",exec:function(editor){editor.selectMore(1)},bindKey:{win:"Ctrl-Alt-Right",mac:"Ctrl-Alt-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextBefore",exec:function(editor){editor.selectMore(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Left",mac:"Ctrl-Alt-Shift-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextAfter",exec:function(editor){editor.selectMore(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Right",mac:"Ctrl-Alt-Shift-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"splitIntoLines",exec:function(editor){editor.multiSelect.splitIntoLines()},bindKey:{win:"Ctrl-Alt-L",mac:"Ctrl-Alt-L"},readOnly:!0},{name:"alignCursors",exec:function(editor){editor.alignCursors()},bindKey:{win:"Ctrl-Alt-A",mac:"Ctrl-Alt-A"},scrollIntoView:"cursor"},{name:"findAll",exec:function(editor){editor.findAll()},bindKey:{win:"Ctrl-Alt-K",mac:"Ctrl-Alt-G"},scrollIntoView:"cursor",readOnly:!0}],exports.multiSelectCommands=[{name:"singleSelection",bindKey:"esc",exec:function(editor){editor.exitMultiSelectMode()},scrollIntoView:"cursor",readOnly:!0,isAvailable:function(editor){return editor&&editor.inMultiSelectMode}}];var HashHandler=require("../keyboard/hash_handler").HashHandler;exports.keyboardHandler=new HashHandler(exports.multiSelectCommands)}),ace.define("ace/multi_select",["require","exports","module","ace/range_list","ace/range","ace/selection","ace/mouse/multi_select_handler","ace/lib/event","ace/lib/lang","ace/commands/multi_select_commands","ace/search","ace/edit_session","ace/editor","ace/config"],function(require,exports,module){function find(session,needle,dir){return search.$options.wrap=!0,search.$options.needle=needle,search.$options.backwards=-1==dir,search.find(session)}function isSamePoint(p1,p2){return p1.row==p2.row&&p1.column==p2.column}function MultiSelect(editor){editor.$multiselectOnSessionChange||(editor.$onAddRange=editor.$onAddRange.bind(editor),editor.$onRemoveRange=editor.$onRemoveRange.bind(editor),editor.$onMultiSelect=editor.$onMultiSelect.bind(editor),editor.$onSingleSelect=editor.$onSingleSelect.bind(editor),editor.$multiselectOnSessionChange=exports.onSessionChange.bind(editor),editor.$checkMultiselectChange=editor.$checkMultiselectChange.bind(editor),editor.$multiselectOnSessionChange(editor),editor.on("changeSession",editor.$multiselectOnSessionChange),editor.on("mousedown",onMouseDown),editor.commands.addCommands(commands.defaultCommands),addAltCursorListeners(editor))}function addAltCursorListeners(editor){function reset(e){altCursor&&(editor.renderer.setMouseCursor(""),altCursor=!1)}var el=editor.textInput.getElement(),altCursor=!1;event.addListener(el,"keydown",function(e){var altDown=18==e.keyCode&&!(e.ctrlKey||e.shiftKey||e.metaKey);editor.$blockSelectEnabled&&altDown?altCursor||(editor.renderer.setMouseCursor("crosshair"),altCursor=!0):altCursor&&reset()}),event.addListener(el,"keyup",reset),event.addListener(el,"blur",reset)}var RangeList=require("./range_list").RangeList,Range=require("./range").Range,Selection=require("./selection").Selection,onMouseDown=require("./mouse/multi_select_handler").onMouseDown,event=require("./lib/event"),lang=require("./lib/lang"),commands=require("./commands/multi_select_commands");exports.commands=commands.defaultCommands.concat(commands.multiSelectCommands);var Search=require("./search").Search,search=new Search,EditSession=require("./edit_session").EditSession;(function(){this.getSelectionMarkers=function(){return this.$selectionMarkers}}).call(EditSession.prototype),function(){this.ranges=null,this.rangeList=null,this.addRange=function(range,$blockChangeEvents){if(range){if(!this.inMultiSelectMode&&0===this.rangeCount){var oldRange=this.toOrientedRange();if(this.rangeList.add(oldRange),this.rangeList.add(range),2!=this.rangeList.ranges.length)return this.rangeList.removeAll(),$blockChangeEvents||this.fromOrientedRange(range);this.rangeList.removeAll(),this.rangeList.add(oldRange),this.$onAddRange(oldRange)}range.cursor||(range.cursor=range.end);var removed=this.rangeList.add(range);return this.$onAddRange(range),removed.length&&this.$onRemoveRange(removed),this.rangeCount>1&&!this.inMultiSelectMode&&(this._signal("multiSelect"),this.inMultiSelectMode=!0,this.session.$undoSelect=!1,this.rangeList.attach(this.session)),$blockChangeEvents||this.fromOrientedRange(range)}},this.toSingleRange=function(range){range=range||this.ranges[0];var removed=this.rangeList.removeAll();removed.length&&this.$onRemoveRange(removed),range&&this.fromOrientedRange(range)},this.substractPoint=function(pos){var removed=this.rangeList.substractPoint(pos);return removed?(this.$onRemoveRange(removed),removed[0]):void 0},this.mergeOverlappingRanges=function(){var removed=this.rangeList.merge();removed.length?this.$onRemoveRange(removed):this.ranges[0]&&this.fromOrientedRange(this.ranges[0])},this.$onAddRange=function(range){this.rangeCount=this.rangeList.ranges.length,this.ranges.unshift(range),this._signal("addRange",{range:range})},this.$onRemoveRange=function(removed){if(this.rangeCount=this.rangeList.ranges.length,1==this.rangeCount&&this.inMultiSelectMode){var lastRange=this.rangeList.ranges.pop();removed.push(lastRange),this.rangeCount=0}for(var i=removed.length;i--;){var index=this.ranges.indexOf(removed[i]);this.ranges.splice(index,1)}this._signal("removeRange",{ranges:removed}),0===this.rangeCount&&this.inMultiSelectMode&&(this.inMultiSelectMode=!1,this._signal("singleSelect"),this.session.$undoSelect=!0,this.rangeList.detach(this.session)),lastRange=lastRange||this.ranges[0],lastRange&&!lastRange.isEqual(this.getRange())&&this.fromOrientedRange(lastRange)},this.$initRangeList=function(){this.rangeList||(this.rangeList=new RangeList,this.ranges=[],this.rangeCount=0)},this.getAllRanges=function(){return this.rangeCount?this.rangeList.ranges.concat():[this.getRange()]},this.splitIntoLines=function(){if(this.rangeCount>1){var ranges=this.rangeList.ranges,lastRange=ranges[ranges.length-1],range=Range.fromPoints(ranges[0].start,lastRange.end);this.toSingleRange(),this.setSelectionRange(range,lastRange.cursor==lastRange.start)}else{var range=this.getRange(),isBackwards=this.isBackwards(),startRow=range.start.row,endRow=range.end.row;if(startRow==endRow){if(isBackwards)var start=range.end,end=range.start;else var start=range.start,end=range.end;return this.addRange(Range.fromPoints(end,end)),void this.addRange(Range.fromPoints(start,start))}var rectSel=[],r=this.getLineRange(startRow,!0);r.start.column=range.start.column,rectSel.push(r);for(var i=startRow+1;endRow>i;i++)rectSel.push(this.getLineRange(i,!0));r=this.getLineRange(endRow,!0),r.end.column=range.end.column,rectSel.push(r),rectSel.forEach(this.addRange,this)}},this.toggleBlockSelection=function(){if(this.rangeCount>1){var ranges=this.rangeList.ranges,lastRange=ranges[ranges.length-1],range=Range.fromPoints(ranges[0].start,lastRange.end);this.toSingleRange(),this.setSelectionRange(range,lastRange.cursor==lastRange.start)}else{var cursor=this.session.documentToScreenPosition(this.selectionLead),anchor=this.session.documentToScreenPosition(this.selectionAnchor),rectSel=this.rectangularRangeBlock(cursor,anchor);rectSel.forEach(this.addRange,this)}},this.rectangularRangeBlock=function(screenCursor,screenAnchor,includeEmptyLines){var rectSel=[],xBackwards=screenCursor.column<screenAnchor.column;if(xBackwards)var startColumn=screenCursor.column,endColumn=screenAnchor.column;else var startColumn=screenAnchor.column,endColumn=screenCursor.column;var yBackwards=screenCursor.row<screenAnchor.row;if(yBackwards)var startRow=screenCursor.row,endRow=screenAnchor.row;else var startRow=screenAnchor.row,endRow=screenCursor.row;0>startColumn&&(startColumn=0),0>startRow&&(startRow=0),startRow==endRow&&(includeEmptyLines=!0);for(var row=startRow;endRow>=row;row++){var range=Range.fromPoints(this.session.screenToDocumentPosition(row,startColumn),this.session.screenToDocumentPosition(row,endColumn));if(range.isEmpty()){if(docEnd&&isSamePoint(range.end,docEnd))break;var docEnd=range.end}range.cursor=xBackwards?range.start:range.end,rectSel.push(range)}if(yBackwards&&rectSel.reverse(),!includeEmptyLines){for(var end=rectSel.length-1;rectSel[end].isEmpty()&&end>0;)end--;if(end>0)for(var start=0;rectSel[start].isEmpty();)start++;for(var i=end;i>=start;i--)rectSel[i].isEmpty()&&rectSel.splice(i,1)}return rectSel}}.call(Selection.prototype);var Editor=require("./editor").Editor;(function(){this.updateSelectionMarkers=function(){this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.addSelectionMarker=function(orientedRange){orientedRange.cursor||(orientedRange.cursor=orientedRange.end);var style=this.getSelectionStyle();return orientedRange.marker=this.session.addMarker(orientedRange,"ace_selection",style),this.session.$selectionMarkers.push(orientedRange),this.session.selectionMarkerCount=this.session.$selectionMarkers.length,orientedRange},this.removeSelectionMarker=function(range){if(range.marker){this.session.removeMarker(range.marker);var index=this.session.$selectionMarkers.indexOf(range);-1!=index&&this.session.$selectionMarkers.splice(index,1),this.session.selectionMarkerCount=this.session.$selectionMarkers.length}},this.removeSelectionMarkers=function(ranges){for(var markerList=this.session.$selectionMarkers,i=ranges.length;i--;){var range=ranges[i];if(range.marker){this.session.removeMarker(range.marker);var index=markerList.indexOf(range);-1!=index&&markerList.splice(index,1)}}this.session.selectionMarkerCount=markerList.length},this.$onAddRange=function(e){this.addSelectionMarker(e.range),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onRemoveRange=function(e){this.removeSelectionMarkers(e.ranges),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onMultiSelect=function(e){this.inMultiSelectMode||(this.inMultiSelectMode=!0,this.setStyle("ace_multiselect"),this.keyBinding.addKeyboardHandler(commands.keyboardHandler),this.commands.setDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers())},this.$onSingleSelect=function(e){this.session.multiSelect.inVirtualMode||(this.inMultiSelectMode=!1,this.unsetStyle("ace_multiselect"),this.keyBinding.removeKeyboardHandler(commands.keyboardHandler),this.commands.removeDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers(),this._emit("changeSelection"))},this.$onMultiSelectExec=function(e){var command=e.command,editor=e.editor;if(editor.multiSelect){if(command.multiSelectAction)"forEach"==command.multiSelectAction?result=editor.forEachSelection(command,e.args):"forEachLine"==command.multiSelectAction?result=editor.forEachSelection(command,e.args,!0):"single"==command.multiSelectAction?(editor.exitMultiSelectMode(),result=command.exec(editor,e.args||{})):result=command.multiSelectAction(editor,e.args||{});else{var result=command.exec(editor,e.args||{});editor.multiSelect.addRange(editor.multiSelect.toOrientedRange()),editor.multiSelect.mergeOverlappingRanges()}return result}},this.forEachSelection=function(cmd,args,options){if(!this.inVirtualSelectionMode){var result,keepOrder=options&&options.keepOrder,$byLines=1==options||options&&options.$byLines,session=this.session,selection=this.selection,rangeList=selection.rangeList,ranges=(keepOrder?selection:rangeList).ranges;if(!ranges.length)return cmd.exec?cmd.exec(this,args||{}):cmd(this,args||{});var reg=selection._eventRegistry;selection._eventRegistry={};var tmpSel=new Selection(session);this.inVirtualSelectionMode=!0;for(var i=ranges.length;i--;){if($byLines)for(;i>0&&ranges[i].start.row==ranges[i-1].end.row;)i--;tmpSel.fromOrientedRange(ranges[i]),tmpSel.index=i,this.selection=session.selection=tmpSel;var cmdResult=cmd.exec?cmd.exec(this,args||{}):cmd(this,args||{});result||void 0===cmdResult||(result=cmdResult),tmpSel.toOrientedRange(ranges[i])}tmpSel.detach(),this.selection=session.selection=selection,this.inVirtualSelectionMode=!1,selection._eventRegistry=reg,selection.mergeOverlappingRanges();var anim=this.renderer.$scrollAnimation;return this.onCursorChange(),this.onSelectionChange(),anim&&anim.from==anim.to&&this.renderer.animateScrolling(anim.from),result}},this.exitMultiSelectMode=function(){this.inMultiSelectMode&&!this.inVirtualSelectionMode&&this.multiSelect.toSingleRange()},this.getSelectedText=function(){var text="";if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){for(var ranges=this.multiSelect.rangeList.ranges,buf=[],i=0;i<ranges.length;i++)buf.push(this.session.getTextRange(ranges[i]));var nl=this.session.getDocument().getNewLineCharacter();text=buf.join(nl),text.length==(buf.length-1)*nl.length&&(text="")}else this.selection.isEmpty()||(text=this.session.getTextRange(this.getSelectionRange()));return text},this.$checkMultiselectChange=function(e,anchor){if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){var range=this.multiSelect.ranges[0];if(this.multiSelect.isEmpty()&&anchor==this.multiSelect.anchor)return;var pos=anchor==this.multiSelect.anchor?range.cursor==range.start?range.end:range.start:range.cursor;(pos.row!=anchor.row||this.session.$clipPositionToDocument(pos.row,pos.column).column!=anchor.column)&&this.multiSelect.toSingleRange(this.multiSelect.toOrientedRange())}},this.findAll=function(needle,options,additive){if(options=options||{},options.needle=needle||options.needle,void 0==options.needle){var range=this.selection.isEmpty()?this.selection.getWordRange():this.selection.getRange();options.needle=this.session.getTextRange(range)}this.$search.set(options);var ranges=this.$search.findAll(this.session);if(!ranges.length)return 0;this.$blockScrolling+=1;var selection=this.multiSelect;additive||selection.toSingleRange(ranges[0]);for(var i=ranges.length;i--;)selection.addRange(ranges[i],!0);return range&&selection.rangeList.rangeAtPoint(range.start)&&selection.addRange(range,!0),this.$blockScrolling-=1,ranges.length},this.selectMoreLines=function(dir,skip){var range=this.selection.toOrientedRange(),isBackwards=range.cursor==range.end,screenLead=this.session.documentToScreenPosition(range.cursor);this.selection.$desiredColumn&&(screenLead.column=this.selection.$desiredColumn);var lead=this.session.screenToDocumentPosition(screenLead.row+dir,screenLead.column);if(range.isEmpty())var anchor=lead;else var screenAnchor=this.session.documentToScreenPosition(isBackwards?range.end:range.start),anchor=this.session.screenToDocumentPosition(screenAnchor.row+dir,screenAnchor.column);if(isBackwards){var newRange=Range.fromPoints(lead,anchor);newRange.cursor=newRange.start}else{var newRange=Range.fromPoints(anchor,lead);newRange.cursor=newRange.end}if(newRange.desiredColumn=screenLead.column,this.selection.inMultiSelectMode){if(skip)var toRemove=range.cursor}else this.selection.addRange(range);this.selection.addRange(newRange),toRemove&&this.selection.substractPoint(toRemove)},this.transposeSelections=function(dir){for(var session=this.session,sel=session.multiSelect,all=sel.ranges,i=all.length;i--;){var range=all[i];if(range.isEmpty()){var tmp=session.getWordRange(range.start.row,range.start.column);range.start.row=tmp.start.row,range.start.column=tmp.start.column,range.end.row=tmp.end.row,range.end.column=tmp.end.column}}sel.mergeOverlappingRanges();for(var words=[],i=all.length;i--;){var range=all[i];words.unshift(session.getTextRange(range))}0>dir?words.unshift(words.pop()):words.push(words.shift());for(var i=all.length;i--;){var range=all[i],tmp=range.clone();session.replace(range,words[i]),range.start.row=tmp.start.row,range.start.column=tmp.start.column}},this.selectMore=function(dir,skip,stopAtFirst){var session=this.session,sel=session.multiSelect,range=sel.toOrientedRange();if(!range.isEmpty()||(range=session.getWordRange(range.start.row,range.start.column),range.cursor=-1==dir?range.start:range.end,this.multiSelect.addRange(range),!stopAtFirst)){var needle=session.getTextRange(range),newRange=find(session,needle,dir);newRange&&(newRange.cursor=-1==dir?newRange.start:newRange.end,this.$blockScrolling+=1,this.session.unfold(newRange),this.multiSelect.addRange(newRange),this.$blockScrolling-=1,this.renderer.scrollCursorIntoView(null,.5)),skip&&this.multiSelect.substractPoint(range.cursor)}},this.alignCursors=function(){var session=this.session,sel=session.multiSelect,ranges=sel.ranges,row=-1,sameRowRanges=ranges.filter(function(r){return r.cursor.row==row?!0:void(row=r.cursor.row)});if(ranges.length&&sameRowRanges.length!=ranges.length-1){sameRowRanges.forEach(function(r){sel.substractPoint(r.cursor)});var maxCol=0,minSpace=1/0,spaceOffsets=ranges.map(function(r){var p=r.cursor,line=session.getLine(p.row),spaceOffset=line.substr(p.column).search(/\S/g);return-1==spaceOffset&&(spaceOffset=0),p.column>maxCol&&(maxCol=p.column),minSpace>spaceOffset&&(minSpace=spaceOffset),spaceOffset});ranges.forEach(function(r,i){var p=r.cursor,l=maxCol-p.column,d=spaceOffsets[i]-minSpace;l>d?session.insert(p,lang.stringRepeat(" ",l-d)):session.remove(new Range(p.row,p.column,p.row,p.column-l+d)),r.start.column=r.end.column=maxCol,r.start.row=r.end.row=p.row,r.cursor=r.end}),sel.fromOrientedRange(ranges[0]),this.renderer.updateCursor(),this.renderer.updateBackMarkers()}else{var range=this.selection.getRange(),fr=range.start.row,lr=range.end.row,guessRange=fr==lr;if(guessRange){var line,max=this.session.getLength();do line=this.session.getLine(lr);while(/[=:]/.test(line)&&++lr<max);do line=this.session.getLine(fr);while(/[=:]/.test(line)&&--fr>0);0>fr&&(fr=0),lr>=max&&(lr=max-1)}var lines=this.session.removeFullLines(fr,lr);lines=this.$reAlignText(lines,guessRange),this.session.insert({row:fr,column:0},lines.join("\n")+"\n"),guessRange||(range.start.column=0,range.end.column=lines[lines.length-1].length),this.selection.setRange(range)}},this.$reAlignText=function(lines,forceLeft){function spaces(n){return lang.stringRepeat(" ",n)}function alignLeft(m){return m[2]?spaces(startW)+m[2]+spaces(textW-m[2].length+endW)+m[4].replace(/^([=:])\s+/,"$1 "):m[0]}function alignRight(m){return m[2]?spaces(startW+textW-m[2].length)+m[2]+spaces(endW," ")+m[4].replace(/^([=:])\s+/,"$1 "):m[0]}function unAlign(m){return m[2]?spaces(startW)+m[2]+spaces(endW)+m[4].replace(/^([=:])\s+/,"$1 "):m[0]}var startW,textW,endW,isLeftAligned=!0,isRightAligned=!0;return lines.map(function(line){var m=line.match(/(\s*)(.*?)(\s*)([=:].*)/);return m?null==startW?(startW=m[1].length,textW=m[2].length,endW=m[3].length,m):(startW+textW+endW!=m[1].length+m[2].length+m[3].length&&(isRightAligned=!1),startW!=m[1].length&&(isLeftAligned=!1),startW>m[1].length&&(startW=m[1].length),textW<m[2].length&&(textW=m[2].length),endW>m[3].length&&(endW=m[3].length),m):[line]}).map(forceLeft?alignLeft:isLeftAligned?isRightAligned?alignRight:alignLeft:unAlign)}}).call(Editor.prototype),exports.onSessionChange=function(e){var session=e.session;session&&!session.multiSelect&&(session.$selectionMarkers=[],session.selection.$initRangeList(),session.multiSelect=session.selection),this.multiSelect=session&&session.multiSelect;var oldSession=e.oldSession;oldSession&&(oldSession.multiSelect.off("addRange",this.$onAddRange),oldSession.multiSelect.off("removeRange",this.$onRemoveRange),oldSession.multiSelect.off("multiSelect",this.$onMultiSelect),oldSession.multiSelect.off("singleSelect",this.$onSingleSelect),oldSession.multiSelect.lead.off("change",this.$checkMultiselectChange),oldSession.multiSelect.anchor.off("change",this.$checkMultiselectChange)),session&&(session.multiSelect.on("addRange",this.$onAddRange),session.multiSelect.on("removeRange",this.$onRemoveRange),session.multiSelect.on("multiSelect",this.$onMultiSelect),session.multiSelect.on("singleSelect",this.$onSingleSelect),session.multiSelect.lead.on("change",this.$checkMultiselectChange),session.multiSelect.anchor.on("change",this.$checkMultiselectChange)),session&&this.inMultiSelectMode!=session.selection.inMultiSelectMode&&(session.selection.inMultiSelectMode?this.$onMultiSelect():this.$onSingleSelect())},exports.MultiSelect=MultiSelect,require("./config").defineOptions(Editor.prototype,"editor",{enableMultiselect:{set:function(val){MultiSelect(this),val?(this.on("changeSession",this.$multiselectOnSessionChange),this.on("mousedown",onMouseDown)):(this.off("changeSession",this.$multiselectOnSessionChange),this.off("mousedown",onMouseDown))},value:!0},enableBlockSelect:{set:function(val){this.$blockSelectEnabled=val},value:!0}})}),ace.define("ace/mode/folding/fold_mode",["require","exports","module","ace/range"],function(require,exports,module){"use strict";var Range=require("../../range").Range,FoldMode=exports.FoldMode=function(){};(function(){this.foldingStartMarker=null,this.foldingStopMarker=null,this.getFoldWidget=function(session,foldStyle,row){var line=session.getLine(row);return this.foldingStartMarker.test(line)?"start":"markbeginend"==foldStyle&&this.foldingStopMarker&&this.foldingStopMarker.test(line)?"end":""},this.getFoldWidgetRange=function(session,foldStyle,row){return null},this.indentationBlock=function(session,row,column){var re=/\S/,line=session.getLine(row),startLevel=line.search(re);if(-1!=startLevel){for(var startColumn=column||line.length,maxRow=session.getLength(),startRow=row,endRow=row;++row<maxRow;){var level=session.getLine(row).search(re);if(-1!=level){if(startLevel>=level)break;endRow=row}}if(endRow>startRow){var endColumn=session.getLine(endRow).length;return new Range(startRow,startColumn,endRow,endColumn)}}},this.openingBracketBlock=function(session,bracket,row,column,typeRe){var start={row:row,column:column+1},end=session.$findClosingBracket(bracket,start,typeRe);if(end){var fw=session.foldWidgets[end.row];return null==fw&&(fw=session.getFoldWidget(end.row)),"start"==fw&&end.row>start.row&&(end.row--,end.column=session.getLine(end.row).length),Range.fromPoints(start,end)}},this.closingBracketBlock=function(session,bracket,row,column,typeRe){var end={row:row,column:column},start=session.$findOpeningBracket(bracket,end);return start?(start.column++,end.column--,Range.fromPoints(start,end)):void 0}}).call(FoldMode.prototype)}),ace.define("ace/theme/textmate",["require","exports","module","ace/lib/dom"],function(require,exports,module){"use strict";exports.isDark=!1,exports.cssClass="ace-tm",exports.cssText='.ace-tm .ace_gutter {background: #f0f0f0;color: #333;}.ace-tm .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-tm .ace_fold {background-color: #6B72E6;}.ace-tm {background-color: #FFFFFF;color: black;}.ace-tm .ace_cursor {color: black;}.ace-tm .ace_invisible {color: rgb(191, 191, 191);}.ace-tm .ace_storage,.ace-tm .ace_keyword {color: blue;}.ace-tm .ace_constant {color: rgb(197, 6, 11);}.ace-tm .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-tm .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-tm .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-tm .ace_invalid {background-color: rgba(255, 0, 0, 0.1);color: red;}.ace-tm .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-tm .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-tm .ace_support.ace_type,.ace-tm .ace_support.ace_class {color: rgb(109, 121, 222);}.ace-tm .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-tm .ace_string {color: rgb(3, 106, 7);}.ace-tm .ace_comment {color: rgb(76, 136, 107);}.ace-tm .ace_comment.ace_doc {color: rgb(0, 102, 255);}.ace-tm .ace_comment.ace_doc.ace_tag {color: rgb(128, 159, 191);}.ace-tm .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-tm .ace_variable {color: rgb(49, 132, 149);}.ace-tm .ace_xml-pe {color: rgb(104, 104, 91);}.ace-tm .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-tm .ace_heading {color: rgb(12, 7, 255);}.ace-tm .ace_list {color:rgb(185, 6, 144);}.ace-tm .ace_meta.ace_tag {color:rgb(0, 22, 142);}.ace-tm .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-tm .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-tm.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;}.ace-tm .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-tm .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-tm .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-tm .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-tm .ace_gutter-active-line {background-color : #dcdcdc;}.ace-tm .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-tm .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}';var dom=require("../lib/dom");dom.importCssString(exports.cssText,exports.cssClass)}),ace.define("ace/line_widgets",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/range"],function(require,exports,module){
"use strict";function LineWidgets(session){this.session=session,this.session.widgetManager=this,this.session.getRowLength=this.getRowLength,this.session.$getWidgetScreenLength=this.$getWidgetScreenLength,this.updateOnChange=this.updateOnChange.bind(this),this.renderWidgets=this.renderWidgets.bind(this),this.measureWidgets=this.measureWidgets.bind(this),this.session._changedWidgets=[],this.$onChangeEditor=this.$onChangeEditor.bind(this),this.session.on("change",this.updateOnChange),this.session.on("changeFold",this.updateOnFold),this.session.on("changeEditor",this.$onChangeEditor)}var dom=(require("./lib/oop"),require("./lib/dom"));require("./range").Range;(function(){this.getRowLength=function(row){var h;return h=this.lineWidgets?this.lineWidgets[row]&&this.lineWidgets[row].rowCount||0:0,this.$useWrapMode&&this.$wrapData[row]?this.$wrapData[row].length+1+h:1+h},this.$getWidgetScreenLength=function(){var screenRows=0;return this.lineWidgets.forEach(function(w){w&&w.rowCount&&!w.hidden&&(screenRows+=w.rowCount)}),screenRows},this.$onChangeEditor=function(e){this.attach(e.editor)},this.attach=function(editor){editor&&editor.widgetManager&&editor.widgetManager!=this&&editor.widgetManager.detach(),this.editor!=editor&&(this.detach(),this.editor=editor,editor&&(editor.widgetManager=this,editor.renderer.on("beforeRender",this.measureWidgets),editor.renderer.on("afterRender",this.renderWidgets)))},this.detach=function(e){var editor=this.editor;if(editor){this.editor=null,editor.widgetManager=null,editor.renderer.off("beforeRender",this.measureWidgets),editor.renderer.off("afterRender",this.renderWidgets);var lineWidgets=this.session.lineWidgets;lineWidgets&&lineWidgets.forEach(function(w){w&&w.el&&w.el.parentNode&&(w._inDocument=!1,w.el.parentNode.removeChild(w.el))})}},this.updateOnFold=function(e,session){var lineWidgets=session.lineWidgets;if(lineWidgets&&e.action){for(var fold=e.data,start=fold.start.row,end=fold.end.row,hide="add"==e.action,i=start+1;end>i;i++)lineWidgets[i]&&(lineWidgets[i].hidden=hide);lineWidgets[end]&&(hide?lineWidgets[start]?lineWidgets[end].hidden=hide:lineWidgets[start]=lineWidgets[end]:(lineWidgets[start]==lineWidgets[end]&&(lineWidgets[start]=void 0),lineWidgets[end].hidden=hide))}},this.updateOnChange=function(delta){var lineWidgets=this.session.lineWidgets;if(lineWidgets){var startRow=delta.start.row,len=delta.end.row-startRow;if(0===len);else if("remove"==delta.action){var removed=lineWidgets.splice(startRow+1,len);removed.forEach(function(w){w&&this.removeLineWidget(w)},this),this.$updateRows()}else{var args=new Array(len);args.unshift(startRow,0),lineWidgets.splice.apply(lineWidgets,args),this.$updateRows()}}},this.$updateRows=function(){var lineWidgets=this.session.lineWidgets;if(lineWidgets){var noWidgets=!0;lineWidgets.forEach(function(w,i){if(w)for(noWidgets=!1,w.row=i;w.$oldWidget;)w.$oldWidget.row=i,w=w.$oldWidget}),noWidgets&&(this.session.lineWidgets=null)}},this.addLineWidget=function(w){this.session.lineWidgets||(this.session.lineWidgets=new Array(this.session.getLength()));var old=this.session.lineWidgets[w.row];old&&(w.$oldWidget=old,old.el&&old.el.parentNode&&(old.el.parentNode.removeChild(old.el),old._inDocument=!1)),this.session.lineWidgets[w.row]=w,w.session=this.session;var renderer=this.editor.renderer;w.html&&!w.el&&(w.el=dom.createElement("div"),w.el.innerHTML=w.html),w.el&&(dom.addCssClass(w.el,"ace_lineWidgetContainer"),w.el.style.position="absolute",w.el.style.zIndex=5,renderer.container.appendChild(w.el),w._inDocument=!0),w.coverGutter||(w.el.style.zIndex=3),null==w.pixelHeight&&(w.pixelHeight=w.el.offsetHeight),null==w.rowCount&&(w.rowCount=w.pixelHeight/renderer.layerConfig.lineHeight);var fold=this.session.getFoldAt(w.row,0);if(w.$fold=fold,fold){var lineWidgets=this.session.lineWidgets;w.row!=fold.end.row||lineWidgets[fold.start.row]?w.hidden=!0:lineWidgets[fold.start.row]=w}return this.session._emit("changeFold",{data:{start:{row:w.row}}}),this.$updateRows(),this.renderWidgets(null,renderer),this.onWidgetChanged(w),w},this.removeLineWidget=function(w){if(w._inDocument=!1,w.session=null,w.el&&w.el.parentNode&&w.el.parentNode.removeChild(w.el),w.editor&&w.editor.destroy)try{w.editor.destroy()}catch(e){}if(this.session.lineWidgets){var w1=this.session.lineWidgets[w.row];if(w1==w)this.session.lineWidgets[w.row]=w.$oldWidget,w.$oldWidget&&this.onWidgetChanged(w.$oldWidget);else for(;w1;){if(w1.$oldWidget==w){w1.$oldWidget=w.$oldWidget;break}w1=w1.$oldWidget}}this.session._emit("changeFold",{data:{start:{row:w.row}}}),this.$updateRows()},this.getWidgetsAtRow=function(row){for(var lineWidgets=this.session.lineWidgets,w=lineWidgets&&lineWidgets[row],list=[];w;)list.push(w),w=w.$oldWidget;return list},this.onWidgetChanged=function(w){this.session._changedWidgets.push(w),this.editor&&this.editor.renderer.updateFull()},this.measureWidgets=function(e,renderer){var changedWidgets=this.session._changedWidgets,config=renderer.layerConfig;if(changedWidgets&&changedWidgets.length){for(var min=1/0,i=0;i<changedWidgets.length;i++){var w=changedWidgets[i];if(w&&w.el&&w.session==this.session){if(!w._inDocument){if(this.session.lineWidgets[w.row]!=w)continue;w._inDocument=!0,renderer.container.appendChild(w.el)}w.h=w.el.offsetHeight,w.fixedWidth||(w.w=w.el.offsetWidth,w.screenWidth=Math.ceil(w.w/config.characterWidth));var rowCount=w.h/config.lineHeight;w.coverLine&&(rowCount-=this.session.getRowLineCount(w.row),0>rowCount&&(rowCount=0)),w.rowCount!=rowCount&&(w.rowCount=rowCount,w.row<min&&(min=w.row))}}min!=1/0&&(this.session._emit("changeFold",{data:{start:{row:min}}}),this.session.lineWidgetWidth=null),this.session._changedWidgets=[]}},this.renderWidgets=function(e,renderer){var config=renderer.layerConfig,lineWidgets=this.session.lineWidgets;if(lineWidgets){for(var first=Math.min(this.firstRow,config.firstRow),last=Math.max(this.lastRow,config.lastRow,lineWidgets.length);first>0&&!lineWidgets[first];)first--;this.firstRow=config.firstRow,this.lastRow=config.lastRow,renderer.$cursorLayer.config=config;for(var i=first;last>=i;i++){var w=lineWidgets[i];if(w&&w.el)if(w.hidden)w.el.style.top=-100-(w.pixelHeight||0)+"px";else{w._inDocument||(w._inDocument=!0,renderer.container.appendChild(w.el));var top=renderer.$cursorLayer.getPixelPosition({row:i,column:0},!0).top;w.coverLine||(top+=config.lineHeight*this.session.getRowLineCount(w.row)),w.el.style.top=top-config.offset+"px";var left=w.coverGutter?0:renderer.gutterWidth;w.fixedWidth||(left-=renderer.scrollLeft),w.el.style.left=left+"px",w.fullWidth&&w.screenWidth&&(w.el.style.minWidth=config.width+2*config.padding+"px"),w.fixedWidth?w.el.style.right=renderer.scrollBar.getWidth()+"px":w.el.style.right=""}}}}}).call(LineWidgets.prototype),exports.LineWidgets=LineWidgets}),ace.define("ace/ext/error_marker",["require","exports","module","ace/line_widgets","ace/lib/dom","ace/range"],function(require,exports,module){"use strict";function binarySearch(array,needle,comparator){for(var first=0,last=array.length-1;last>=first;){var mid=first+last>>1,c=comparator(needle,array[mid]);if(c>0)first=mid+1;else{if(!(0>c))return mid;last=mid-1}}return-(first+1)}function findAnnotations(session,row,dir){var annotations=session.getAnnotations().sort(Range.comparePoints);if(annotations.length){var i=binarySearch(annotations,{row:row,column:-1},Range.comparePoints);0>i&&(i=-i-1),i>=annotations.length?i=dir>0?0:annotations.length-1:0===i&&0>dir&&(i=annotations.length-1);var annotation=annotations[i];if(annotation&&dir){if(annotation.row===row){do annotation=annotations[i+=dir];while(annotation&&annotation.row===row);if(!annotation)return annotations.slice()}var matched=[];row=annotation.row;do matched[0>dir?"unshift":"push"](annotation),annotation=annotations[i+=dir];while(annotation&&annotation.row==row);return matched.length&&matched}}}var LineWidgets=require("../line_widgets").LineWidgets,dom=require("../lib/dom"),Range=require("../range").Range;exports.showErrorMarker=function(editor,dir){var session=editor.session;session.widgetManager||(session.widgetManager=new LineWidgets(session),session.widgetManager.attach(editor));var pos=editor.getCursorPosition(),row=pos.row,oldWidget=session.widgetManager.getWidgetsAtRow(row).filter(function(w){return"errorMarker"==w.type})[0];oldWidget?oldWidget.destroy():row-=dir;var gutterAnno,annotations=findAnnotations(session,row,dir);if(annotations){var annotation=annotations[0];pos.column=(annotation.pos&&"number"!=typeof annotation.column?annotation.pos.sc:annotation.column)||0,pos.row=annotation.row,gutterAnno=editor.renderer.$gutterLayer.$annotations[pos.row]}else{if(oldWidget)return;gutterAnno={text:["Looks good!"],className:"ace_ok"}}editor.session.unfold(pos.row),editor.selection.moveToPosition(pos);var w={row:pos.row,fixedWidth:!0,coverGutter:!0,el:dom.createElement("div"),type:"errorMarker"},el=w.el.appendChild(dom.createElement("div")),arrow=w.el.appendChild(dom.createElement("div"));arrow.className="error_widget_arrow "+gutterAnno.className;var left=editor.renderer.$cursorLayer.getPixelPosition(pos).left;arrow.style.left=left+editor.renderer.gutterWidth-5+"px",w.el.className="error_widget_wrapper",el.className="error_widget "+gutterAnno.className,el.innerHTML=gutterAnno.text.join("<br>"),el.appendChild(dom.createElement("div"));var kb=function(_,hashId,keyString){return 0!==hashId||"esc"!==keyString&&"return"!==keyString?void 0:(w.destroy(),{command:"null"})};w.destroy=function(){editor.$mouseHandler.isMousePressed||(editor.keyBinding.removeKeyboardHandler(kb),session.widgetManager.removeLineWidget(w),editor.off("changeSelection",w.destroy),editor.off("changeSession",w.destroy),editor.off("mouseup",w.destroy),editor.off("change",w.destroy))},editor.keyBinding.addKeyboardHandler(kb),editor.on("changeSelection",w.destroy),editor.on("changeSession",w.destroy),editor.on("mouseup",w.destroy),editor.on("change",w.destroy),editor.session.widgetManager.addLineWidget(w),w.el.onmousedown=editor.focus.bind(editor),editor.renderer.scrollCursorIntoView(null,.5,{bottom:w.el.offsetHeight})},dom.importCssString("    .error_widget_wrapper {        background: inherit;        color: inherit;        border:none    }    .error_widget {        border-top: solid 2px;        border-bottom: solid 2px;        margin: 5px 0;        padding: 10px 40px;        white-space: pre-wrap;    }    .error_widget.ace_error, .error_widget_arrow.ace_error{        border-color: #ff5a5a    }    .error_widget.ace_warning, .error_widget_arrow.ace_warning{        border-color: #F1D817    }    .error_widget.ace_info, .error_widget_arrow.ace_info{        border-color: #5a5a5a    }    .error_widget.ace_ok, .error_widget_arrow.ace_ok{        border-color: #5aaa5a    }    .error_widget_arrow {        position: absolute;        border: solid 5px;        border-top-color: transparent!important;        border-right-color: transparent!important;        border-left-color: transparent!important;        top: -5px;    }","")}),ace.define("ace/ace",["require","exports","module","ace/lib/fixoldbrowsers","ace/lib/dom","ace/lib/event","ace/editor","ace/edit_session","ace/undomanager","ace/virtual_renderer","ace/worker/worker_client","ace/keyboard/hash_handler","ace/placeholder","ace/multi_select","ace/mode/folding/fold_mode","ace/theme/textmate","ace/ext/error_marker","ace/config"],function(require,exports,module){"use strict";require("./lib/fixoldbrowsers");var dom=require("./lib/dom"),event=require("./lib/event"),Editor=require("./editor").Editor,EditSession=require("./edit_session").EditSession,UndoManager=require("./undomanager").UndoManager,Renderer=require("./virtual_renderer").VirtualRenderer;require("./worker/worker_client"),require("./keyboard/hash_handler"),require("./placeholder"),require("./multi_select"),require("./mode/folding/fold_mode"),require("./theme/textmate"),require("./ext/error_marker"),exports.config=require("./config"),exports.require=require,"function"==typeof define&&(exports.define=define),exports.edit=function(el){if("string"==typeof el){var _id=el;if(el=document.getElementById(_id),!el)throw new Error("ace.edit can't find div #"+_id)}if(el&&el.env&&el.env.editor instanceof Editor)return el.env.editor;var value="";if(el&&/input|textarea/i.test(el.tagName)){var oldNode=el;value=oldNode.value,el=dom.createElement("pre"),oldNode.parentNode.replaceChild(el,oldNode)}else el&&(value=dom.getInnerText(el),el.innerHTML="");var doc=exports.createEditSession(value),editor=new Editor(new Renderer(el));editor.setSession(doc);var env={document:doc,editor:editor,onResize:editor.resize.bind(editor,null)};return oldNode&&(env.textarea=oldNode),event.addListener(window,"resize",env.onResize),editor.on("destroy",function(){event.removeListener(window,"resize",env.onResize),env.editor.container.env=null}),editor.container.env=editor.env=env,editor},exports.createEditSession=function(text,mode){var doc=new EditSession(text,mode);return doc.setUndoManager(new UndoManager),doc},exports.EditSession=EditSession,exports.UndoManager=UndoManager,exports.version="1.2.5"}),function(){ace.require(["ace/ace"],function(a){a&&(a.config.init(!0),a.define=ace.define),window.ace||(window.ace=a);for(var key in a)a.hasOwnProperty(key)&&(window.ace[key]=a[key])})}(),define("ace/ace",function(){}),define("libs/sharejs",["ace/ace"],function(){return function(){var Doc,MicroEvent,Range,WEB,append,applyAceToShareJS,applyCMToShareJS,bootstrapTransform,checkValidComponent,checkValidOp,cloneAndModify,exports,invertComponent,nextTick,strInject,text,transformComponent,transformPosition,types,slice=[].slice,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};WEB=!0,window.sharejs=exports={},types=exports.types={},exports._bt=bootstrapTransform=function(type,transformComponent,checkValidOp,append){var transformComponentX,transformX;return transformComponentX=function(left,right,destLeft,destRight){return transformComponent(destLeft,left,right,"left"),transformComponent(destRight,right,left,"right")},type.transformX=type.transformX=transformX=function(leftOp,rightOp){var j,k,l,l_,len,len1,len2,len3,m,n,newLeftOp,newRightOp,nextC,o,r,r_,ref,ref1,rightComponent;for(checkValidOp(leftOp),checkValidOp(rightOp),newRightOp=[],j=0,len=rightOp.length;len>j;j++){for(rightComponent=rightOp[j],newLeftOp=[],k=0;k<leftOp.length;){if(nextC=[],transformComponentX(leftOp[k],rightComponent,newLeftOp,nextC),k++,1!==nextC.length){if(0===nextC.length){for(ref=leftOp.slice(k),m=0,len1=ref.length;len1>m;m++)l=ref[m],append(newLeftOp,l);rightComponent=null;break}for(ref1=transformX(leftOp.slice(k),nextC),l_=ref1[0],r_=ref1[1],n=0,len2=l_.length;len2>n;n++)l=l_[n],append(newLeftOp,l);for(o=0,len3=r_.length;len3>o;o++)r=r_[o],append(newRightOp,r);rightComponent=null;break}rightComponent=nextC[0]}null!=rightComponent&&append(newRightOp,rightComponent),leftOp=newLeftOp}return[leftOp,newRightOp]},type.transform=type.transform=function(op,otherOp,type){var _,left,ref,ref1,right;if("left"!==type&&"right"!==type)throw new Error("type must be 'left' or 'right'");return 0===otherOp.length?op:1===op.length&&1===otherOp.length?transformComponent([],op[0],otherOp[0],type):"left"===type?(ref=transformX(op,otherOp),left=ref[0],_=ref[1],left):(ref1=transformX(otherOp,op),_=ref1[0],right=ref1[1],right)}},"undefined"==typeof WEB&&(exports.bootstrapTransform=bootstrapTransform),text={},text.name="text",text.create=function(){return""},strInject=function(s1,pos,s2){return s1.slice(0,pos)+s2+s1.slice(pos)},checkValidComponent=function(c){var c_type,d_type,i_type;if("number"!=typeof c.p)throw new Error("component missing position field");if(i_type=typeof c.i,d_type=typeof c.d,c_type=typeof c.c,!("string"===i_type^"string"===d_type^"string"===c_type))throw new Error("component needs an i, d or c field");if(!(c.p>=0))throw new Error("position cannot be negative")},checkValidOp=function(op){var c,j,len;for(j=0,len=op.length;len>j;j++)c=op[j],checkValidComponent(c);return!0},text.apply=function(snapshot,op){var comment,component,deleted,j,len;for(checkValidOp(op),j=0,len=op.length;len>j;j++)if(component=op[j],null!=component.i)snapshot=strInject(snapshot,component.p,component.i);else if(null!=component.d){if(deleted=snapshot.slice(component.p,component.p+component.d.length),component.d!==deleted)throw new Error("Delete component '"+component.d+"' does not match deleted text '"+deleted+"'");snapshot=snapshot.slice(0,component.p)+snapshot.slice(component.p+component.d.length)}else{if(null==component.c)throw new Error("Unknown op type");if(comment=snapshot.slice(component.p,component.p+component.c.length),component.c!==comment)throw new Error("Comment component '"+component.c+"' does not match commented text '"+comment+"'")}return snapshot},cloneAndModify=function(op,modifications){var k,newOp,v;newOp={};for(k in op)v=op[k],newOp[k]=v;for(k in modifications)v=modifications[k],newOp[k]=v;return newOp},text._append=append=function(newOp,c){var last,ref,ref1;if(""!==c.i&&""!==c.d)return 0===newOp.length?newOp.push(c):(last=newOp[newOp.length-1],null!=last.i&&null!=c.i&&last.p<=(ref=c.p)&&ref<=last.p+last.i.length&&last.u===c.u?newOp[newOp.length-1]=cloneAndModify(last,{i:strInject(last.i,c.p-last.p,c.i)}):null!=last.d&&null!=c.d&&c.p<=(ref1=last.p)&&ref1<=c.p+c.d.length&&last.u===c.u?newOp[newOp.length-1]=cloneAndModify(last,{d:strInject(c.d,last.p-c.p,last.d),p:c.p}):newOp.push(c))},text.compose=function(op1,op2){var c,j,len,newOp;for(checkValidOp(op1),checkValidOp(op2),newOp=op1.slice(),j=0,len=op2.length;len>j;j++)c=op2[j],append(newOp,c);return newOp},text.compress=function(op){return text.compose([],op)},text.normalize=function(op){var c,j,len,newOp;for(newOp=[],(null!=op.i||null!=op.p)&&(op=[op]),j=0,len=op.length;len>j;j++)c=op[j],null==c.p&&(c.p=0),append(newOp,c);return newOp},transformPosition=function(pos,c,insertAfter){if(null!=c.i)return c.p<pos||c.p===pos&&insertAfter?pos+c.i.length:pos;if(null!=c.d)return pos<=c.p?pos:pos<=c.p+c.d.length?c.p:pos-c.d.length;if(null!=c.c)return pos;throw new Error("unknown op type")},text.transformCursor=function(position,op,side){var c,insertAfter,j,len;for(insertAfter="right"===side,j=0,len=op.length;len>j;j++)c=op[j],position=transformPosition(position,c,insertAfter);return position},text._tc=transformComponent=function(dest,c,otherC,side){var cIntersect,intersectEnd,intersectStart,newC,new_c,offset,otherIntersect,ref,s;if(checkValidOp([c]),checkValidOp([otherC]),null!=c.i)append(dest,cloneAndModify(c,{p:transformPosition(c.p,otherC,"right"===side)}));else if(null!=c.d)if(null!=otherC.i)s=c.d,c.p<otherC.p&&(append(dest,cloneAndModify(c,{d:s.slice(0,otherC.p-c.p)})),s=s.slice(otherC.p-c.p)),""!==s&&append(dest,cloneAndModify(c,{d:s,p:c.p+otherC.i.length}));else if(null!=otherC.d)if(c.p>=otherC.p+otherC.d.length)append(dest,cloneAndModify(c,{p:c.p-otherC.d.length}));else if(c.p+c.d.length<=otherC.p)append(dest,c);else{if(newC=cloneAndModify(c,{d:""}),c.p<otherC.p&&(newC.d=c.d.slice(0,otherC.p-c.p)),c.p+c.d.length>otherC.p+otherC.d.length&&(newC.d+=c.d.slice(otherC.p+otherC.d.length-c.p)),intersectStart=Math.max(c.p,otherC.p),intersectEnd=Math.min(c.p+c.d.length,otherC.p+otherC.d.length),cIntersect=c.d.slice(intersectStart-c.p,intersectEnd-c.p),otherIntersect=otherC.d.slice(intersectStart-otherC.p,intersectEnd-otherC.p),cIntersect!==otherIntersect)throw new Error("Delete ops delete different text in the same region of the document");""!==newC.d&&(newC.p=transformPosition(newC.p,otherC),append(dest,newC))}else{if(null==otherC.c)throw new Error("unknown op type");append(dest,c)}else if(null!=c.c)if(null!=otherC.i)c.p<(ref=otherC.p)&&ref<c.p+c.c.length?(offset=otherC.p-c.p,new_c=c.c.slice(0,+(offset-1)+1||9e9)+otherC.i+c.c.slice(offset),append(dest,cloneAndModify(c,{c:new_c}))):append(dest,cloneAndModify(c,{p:transformPosition(c.p,otherC,!0)}));else if(null!=otherC.d)if(c.p>=otherC.p+otherC.d.length)append(dest,cloneAndModify(c,{p:c.p-otherC.d.length}));else if(c.p+c.c.length<=otherC.p)append(dest,c);else{if(newC=cloneAndModify(c,{c:""}),c.p<otherC.p&&(newC.c=c.c.slice(0,otherC.p-c.p)),c.p+c.c.length>otherC.p+otherC.d.length&&(newC.c+=c.c.slice(otherC.p+otherC.d.length-c.p)),intersectStart=Math.max(c.p,otherC.p),intersectEnd=Math.min(c.p+c.c.length,otherC.p+otherC.d.length),cIntersect=c.c.slice(intersectStart-c.p,intersectEnd-c.p),otherIntersect=otherC.d.slice(intersectStart-otherC.p,intersectEnd-otherC.p),cIntersect!==otherIntersect)throw new Error("Delete ops delete different text in the same region of the document");newC.p=transformPosition(newC.p,otherC),append(dest,newC)}else{if(null==otherC.c)throw new Error("unknown op type");append(dest,c)}return dest},invertComponent=function(c){return null!=c.i?{d:c.i,p:c.p}:{i:c.d,p:c.p}},text.invert=function(op){var c,j,len,ref,results;for(ref=op.slice().reverse(),results=[],j=0,len=ref.length;len>j;j++)c=ref[j],results.push(invertComponent(c));return results},null!=WEB?(exports.types||(exports.types={}),bootstrapTransform(text,transformComponent,checkValidOp,append),exports.types.text=text):(module.exports=text,require("./helpers").bootstrapTransform(text,transformComponent,checkValidOp,append)),"undefined"==typeof WEB&&(text=require("./text")),text.api={provides:{text:!0},getLength:function(){return this.snapshot.length},getText:function(){return this.snapshot},insert:function(pos,text,fromUndo,callback){var op;return op={p:pos,i:text},fromUndo&&(op.u=!0),op=[op],this.submitOp(op,callback),op},del:function(pos,length,fromUndo,callback){var op;return op={p:pos,d:this.snapshot.slice(pos,pos+length)},fromUndo&&(op.u=!0),op=[op],this.submitOp(op,callback),op},_register:function(){return this.on("remoteop",function(op){var component,j,len,results;for(results=[],j=0,len=op.length;len>j;j++)component=op[j],void 0!==component.i?results.push(this.emit("insert",component.p,component.i)):void 0!==component.d?results.push(this.emit("delete",component.p,component.d)):results.push(void 0);return results})}},nextTick=null!=WEB?function(fn){return setTimeout(fn,0)}:process.nextTick,MicroEvent=function(){function MicroEvent(){}return MicroEvent.prototype.on=function(event,fct){var base;return this._events||(this._events={}),(base=this._events)[event]||(base[event]=[]),this._events[event].push(fct),this},MicroEvent.prototype.removeListener=function(event,fct){var base,i,listeners;for(this._events||(this._events={}),listeners=(base=this._events)[event]||(base[event]=[]),i=0;i<listeners.length;)listeners[i]===fct&&(listeners[i]=void 0),i++;return nextTick(function(_this){return function(){var x;return _this._events[event]=function(){var j,len,ref,results;for(ref=this._events[event],results=[],j=0,len=ref.length;len>j;j++)x=ref[j],x&&results.push(x);return results}.call(_this)}}(this)),this},MicroEvent.prototype.emit=function(){var args,event,fn,j,len,ref,ref1;if(event=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],!(null!=(ref=this._events)?ref[event]:void 0))return this;for(ref1=this._events[event],j=0,len=ref1.length;len>j;j++)fn=ref1[j],fn&&fn.apply(this,args);return this},MicroEvent}(),MicroEvent.mixin=function(obj){var proto;return proto=obj.prototype||obj,proto.on=MicroEvent.prototype.on,proto.removeListener=MicroEvent.prototype.removeListener,proto.emit=MicroEvent.prototype.emit,obj},null==WEB&&(module.exports=MicroEvent),null==WEB&&(types=require("../types")),null!=WEB&&(exports.extendDoc=function(name,fn){return Doc.prototype[name]=fn}),Doc=function(){function Doc(connection,name1,openData){this.connection=connection,this.name=name1,this.shout=bind(this.shout,this),this.setFlushDelay=bind(this.setFlushDelay,this),this.flush=bind(this.flush,this),openData||(openData={}),this.version=openData.v,this.snapshot=openData.snaphot,openData.type&&this._setType(openData.type),this.state="closed",this.autoOpen=!1,this._create=openData.create,this.inflightOp=null,this.inflightCallbacks=[],this.inflightSubmittedIds=[],this.pendingOp=null,this.pendingCallbacks=[],this.serverOps={}}return Doc.prototype._xf=function(client,server){var client_,server_;return this.type.transformX?this.type.transformX(client,server):(client_=this.type.transform(client,server,"left"),server_=this.type.transform(server,client,"right"),[client_,server_])},Doc.prototype._otApply=function(docOp,isRemote,msg){var oldSnapshot;return oldSnapshot=this.snapshot,this.snapshot=this.type.apply(this.snapshot,docOp),this.emit("change",docOp,oldSnapshot,msg),isRemote?this.emit("remoteop",docOp,oldSnapshot,msg):void 0},Doc.prototype._connectionStateChanged=function(state,data){switch(state){case"disconnected":this.state="closed",this.inflightOp&&this.inflightSubmittedIds.push(this.connection.id),this.emit("closed");break;case"ok":this.autoOpen&&this.open();break;case"stopped":"function"==typeof this._openCallback&&this._openCallback(data)}return this.emit(state,data)},Doc.prototype._setType=function(type){var k,ref,v;if("string"==typeof type&&(type=types[type]),!type||!type.compose)throw new Error("Support for types without compose() is not implemented");if(this.type=type,type.api){ref=type.api;for(k in ref)v=ref[k],this[k]=v;return"function"==typeof this._register?this._register():void 0}return this.provides={}},Doc.prototype._onMessage=function(msg){var callback,docOp,error,j,len,len1,m,oldInflightOp,op,path,ref,ref1,ref2,ref3,ref4,ref5,ref6,response,undo,value;if(msg.open===!0)return this.state="open",this._create=!1,null==this.created&&(this.created=!!msg.create),msg.type&&this._setType(msg.type),msg.create?(this.created=!0,this.snapshot=this.type.create()):(this.created!==!0&&(this.created=!1),void 0!==msg.snapshot&&(this.snapshot=msg.snapshot)),null!=msg.v&&(this.version=msg.v),this.inflightOp?(response={doc:this.name,op:this.inflightOp,v:this.version},this.inflightSubmittedIds.length&&(response.dupIfSource=this.inflightSubmittedIds),this.connection.send(response)):this.flush(),this.emit("open"),"function"==typeof this._openCallback?this._openCallback(null):void 0;if(msg.open===!1)return msg.error&&("undefined"!=typeof console&&null!==console&&console.error("Could not open document: "+msg.error),this.emit("error",msg.error),"function"==typeof this._openCallback&&this._openCallback(msg.error)),this.state="closed",this.emit("closed"),"function"==typeof this._closeCallback&&this._closeCallback(),this._closeCallback=null;if(null===msg.op&&"Op already submitted"===error);else{if(void 0===msg.op&&void 0!==msg.v||msg.op&&(ref=msg.meta.source,indexOf.call(this.inflightSubmittedIds,ref)>=0)){if(oldInflightOp=this.inflightOp,this.inflightOp=null,this.inflightSubmittedIds.length=0,null===this.pendingOp&&this.emit("saved"),error=msg.error)for(this.type.invert?(undo=this.type.invert(oldInflightOp),this.pendingOp&&(ref1=this._xf(this.pendingOp,undo),this.pendingOp=ref1[0],undo=ref1[1]),this._otApply(undo,!0,msg)):this.emit("error","Op apply failed ("+error+") and the op could not be reverted"),ref2=this.inflightCallbacks,j=0,len=ref2.length;len>j;j++)(callback=ref2[j])(error);else{if(msg.v<this.version)return;if(msg.v!==this.version)throw new Error("Invalid version from server");for(this.serverOps[this.version]=oldInflightOp,this.version++,this.emit("acknowledge",oldInflightOp),ref3=this.inflightCallbacks,m=0,len1=ref3.length;len1>m;m++)(callback=ref3[m])(null,oldInflightOp)}return this.delayedFlush()}if(msg.op){if(msg.v<this.version)return;return msg.doc!==this.name?this.emit("error","Expected docName '"+this.name+"' but got "+msg.doc):msg.v!==this.version?this.emit("error","Expected version "+this.version+" but got "+msg.v):(op=msg.op,this.serverOps[this.version]=op,docOp=op,null!==this.inflightOp&&(ref4=this._xf(this.inflightOp,docOp),this.inflightOp=ref4[0],docOp=ref4[1]),null!==this.pendingOp&&(ref5=this._xf(this.pendingOp,docOp),this.pendingOp=ref5[0],docOp=ref5[1]),this.version++,this._otApply(docOp,!0,msg))}if(!msg.meta)return"undefined"!=typeof console&&null!==console?console.warn("Unhandled document message:",msg):void 0;switch(ref6=msg.meta,path=ref6.path,value=ref6.value,null!=path?path[0]:void 0){case"shout":return this.emit("shout",value);default:return"undefined"!=typeof console&&null!==console?console.warn("Unhandled meta op:",msg):void 0}}},Doc.prototype.flush=function(){return this.flushTimeout=null,"ok"===this.connection.state&&null===this.inflightOp&&null!==this.pendingOp?(this.inflightOp=this.pendingOp,this.inflightCallbacks=this.pendingCallbacks,this.pendingOp=null,this.pendingCallbacks=[],this.emit("flipped_pending_to_inflight"),this.connection.send({doc:this.name,op:this.inflightOp,v:this.version})):void 0},Doc.prototype.submitOp=function(op,callback){var oldSnapshot;return null!=this.type.normalize&&(op=this.type.normalize(op)),oldSnapshot=this.snapshot,this.snapshot=this.type.apply(this.snapshot,op),null!==this.pendingOp?this.pendingOp=this.type.compose(this.pendingOp,op):this.pendingOp=op,callback&&this.pendingCallbacks.push(callback),this.emit("change",op,oldSnapshot),this.delayedFlush()},Doc.prototype.delayedFlush=function(){return null==this.flushTimeout?this.flushTimeout=setTimeout(this.flush,this._flushDelay||0):void 0},Doc.prototype.setFlushDelay=function(delay){return this._flushDelay=delay},Doc.prototype.shout=function(msg){return this.connection.send({doc:this.name,meta:{path:["shout"],value:msg}})},Doc.prototype.open=function(callback){var message;return this.autoOpen=!0,"closed"===this.state?(message={doc:this.name,open:!0},void 0===this.snapshot&&(message.snapshot=null),this.type&&(message.type=this.type.name),null!=this.version&&(message.v=this.version),this._create&&(message.create=!0),this.connection.send(message),this.state="opening",this._openCallback=function(_this){return function(error){return _this._openCallback=null,"function"==typeof callback?callback(error):void 0}}(this)):void 0},Doc.prototype.close=function(callback){return this.autoOpen=!1,"closed"===this.state?"function"==typeof callback?callback():void 0:(this.connection.send({doc:this.name,open:!1}),this.state="closed",this.emit("closing"),this._closeCallback=callback)},Doc}(),null==WEB&&(MicroEvent=require("./microevent")),MicroEvent.mixin(Doc),exports.Doc=Doc,Range=ace.require("ace/range").Range,applyAceToShareJS=function(editorDoc,delta,doc,fromUndo){var getStartOffsetPosition,pos;switch(getStartOffsetPosition=function(start){var i,j,len,line,lines,offset;for(lines=editorDoc.getLines(0,start.row),offset=0,i=j=0,len=lines.length;len>j;i=++j)line=lines[i],offset+=i<start.row?line.length:start.column;return offset+start.row},pos=getStartOffsetPosition(delta.start),delta.action){case"insert":text=delta.lines.join("\n"),doc.insert(pos,text,fromUndo);break;case"remove":text=delta.lines.join("\n"),doc.del(pos,text.length,fromUndo);break;default:throw new Error("unknown action: "+delta.action)}},window.sharejs.extendDoc("attach_ace",function(editor,keepEditorContents,maxDocLength){var check,doc,editorDoc,editorListener,offsetToPos,onDelete,onInsert,suppress;if(!this.provides.text)throw new Error("Only text documents can be attached to ace");doc=this,editorDoc=editor.getSession().getDocument(),editorDoc.setNewLineMode("unix"),check=function(){return window.setTimeout(function(){var editorText,otText;return editorText=editorDoc.getValue(),otText=doc.getText(),editorText!==otText?(console.error("Text does not match!"),console.error("editor: "+editorText),console.error("ot:     "+otText)):void 0},0)},keepEditorContents?(doc.del(0,doc.getText().length),doc.insert(0,editorDoc.getValue())):editorDoc.setValue(doc.getText()),check(),suppress=!1,editorListener=function(change){var fromUndo;if(!suppress)return null!=maxDocLength&&editorDoc.getValue().length>maxDocLength?void doc.emit("error",new Error("document length is greater than maxDocLength")):(fromUndo=!(!editor.getSession().$fromUndo&&!editor.getSession().$fromReject),applyAceToShareJS(editorDoc,change,doc,fromUndo),
check())},editorDoc.on("change",editorListener),offsetToPos=function(offset){var j,len,line,lines,row;for(lines=editorDoc.getAllLines(),row=0,row=j=0,len=lines.length;len>j&&(line=lines[row],!(offset<=line.length));row=++j)offset-=lines[row].length+1;return{row:row,column:offset}},onInsert=function(pos,text){var end,lines,position,start;return editorDoc.getLength()<=1&&editorDoc.$detectNewLine(text),lines=editorDoc.$split(text),position=offsetToPos(pos),start=editorDoc.clippedPos(position.row,position.column),end={row:start.row+lines.length-1,column:(1===lines.length?start.column:0)+lines[lines.length-1].length},suppress=!0,editorDoc.applyDelta({start:start,end:end,action:"insert",lines:lines,remote:!0}),suppress=!1,check()},onDelete=function(pos,text){var end,range,start;return range=Range.fromPoints(offsetToPos(pos),offsetToPos(pos+text.length)),start=editorDoc.clippedPos(range.start.row,range.start.column),end=editorDoc.clippedPos(range.end.row,range.end.column),suppress=!0,editorDoc.applyDelta({start:start,end:end,action:"remove",lines:editorDoc.getLinesForRange({start:start,end:end}),remote:!0}),suppress=!1,check()},doc.on("insert",onInsert),doc.on("delete",onDelete),doc.detach_ace=function(){return doc.removeListener("insert",onInsert),doc.removeListener("delete",onDelete),editorDoc.removeListener("change",editorListener),delete doc.detach_ace}}),applyCMToShareJS=function(editorDoc,delta,doc){var i,startPos;for(startPos=0,i=0;i<delta.from.line;)startPos+=editorDoc.lineInfo(i).text.length+1,i++;return startPos+=delta.from.ch,delta.removed&&doc.del(startPos,delta.removed.join("\n").length),delta.text?doc.insert(startPos,delta.text.join("\n")):void 0},window.sharejs.extendDoc("attach_cm",function(editor,keepEditorContents){var check,editorDoc,editorListener,onDelete,onInsert,sharedoc,suppress;if(!this.provides.text)throw new Error("Only text documents can be attached to CodeMirror2");sharedoc=this,editorDoc=editor.getDoc(),check=function(){return window.setTimeout(function(){var editorText,otText;return editorText=editor.getValue(),otText=sharedoc.getText(),editorText!==otText?(console.error("Text does not match!"),console.error("editor: "+editorText),console.error("ot:     "+otText)):void 0},0)},keepEditorContents?(this.del(0,sharedoc.getText().length),this.insert(0,editor.getValue())):editor.setValue(sharedoc.getText()),check(),suppress=!1,editorListener=function(ed,change){return suppress?void 0:(applyCMToShareJS(editorDoc,change,sharedoc),check())},editorDoc.on("change",editorListener),onInsert=function(pos,text){return suppress=!0,editor.replaceRange(text,editor.posFromIndex(pos)),suppress=!1,check()},onDelete=function(pos,text){var from,to;return suppress=!0,from=editor.posFromIndex(pos),to=editor.posFromIndex(pos+text.length),editor.replaceRange("",from,to),suppress=!1,check()},this.on("insert",onInsert),this.on("delete",onDelete),this.detach_cm=function(){return this.removeListener("insert",onInsert),this.removeListener("delete",onDelete),editorDoc.off("change",editorListener),delete this.detach_cm}})}.call(this),window.sharejs}),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,slice=[].slice;define("ide/editor/ShareJsDoc",["utils/EventEmitter","libs/sharejs"],function(EventEmitter,ShareJs){var SINGLE_USER_FLUSH_DELAY,ShareJsDoc;return SINGLE_USER_FLUSH_DELAY=1e3,ShareJsDoc=function(superClass){function ShareJsDoc(doc_id,docLines,version,socket){var line,snapshot;this.doc_id=doc_id,this.socket=socket,this.type="text",docLines=function(){var j,len,results;for(results=[],j=0,len=docLines.length;len>j;j++)line=docLines[j],results.push(decodeURIComponent(escape(line)));return results}(),snapshot=docLines.join("\n"),this.track_changes=!1,this.connection={send:function(_this){return function(update){return _this._startInflightOpTimeout(update),null!=window.disconnectOnUpdate&&Math.random()<window.disconnectOnUpdate&&(sl_console.log("Disconnecting on update",update),window._ide.socket.socket.disconnect()),null!=window.dropUpdates&&Math.random()<window.dropUpdates?void sl_console.log("Simulating a lost update",update):(_this.track_changes&&(null==update.meta&&(update.meta={}),update.meta.tc=_this.track_changes_id_seeds.inflight),_this.socket.emit("applyOtUpdate",_this.doc_id,update,function(error){return null!=error?_this._handleError(error):void 0}))}}(this),state:"ok",id:this.socket.socket.sessionid},this._doc=new ShareJs.Doc(this.connection,this.doc_id,{type:this.type}),this._doc.setFlushDelay(SINGLE_USER_FLUSH_DELAY),this._doc.on("change",function(_this){return function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],_this.trigger.apply(_this,["change"].concat(slice.call(args)))}}(this)),this._doc.on("acknowledge",function(_this){return function(){return _this.lastAcked=new Date,_this.trigger("acknowledge")}}(this)),this._doc.on("remoteop",function(_this){return function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],_this._doc.setFlushDelay(0),_this.trigger.apply(_this,["remoteop"].concat(slice.call(args)))}}(this)),this._doc.on("flipped_pending_to_inflight",function(_this){return function(){return _this.trigger("flipped_pending_to_inflight")}}(this)),this._doc.on("saved",function(_this){return function(){return _this.trigger("saved")}}(this)),this._doc.on("error",function(_this){return function(e){return _this._handleError(e)}}(this)),this._bindToDocChanges(this._doc),this.processUpdateFromServer({open:!0,v:version,snapshot:snapshot})}return extend(ShareJsDoc,superClass),ShareJsDoc.prototype.submitOp=function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=this._doc).submitOp.apply(ref,args)},ShareJsDoc.prototype.processUpdateFromServer=function(message){var error,ref;try{this._doc._onMessage(message)}catch(error1){error=error1,console.log(error),this._handleError(error)}return"external"===(null!=message&&null!=(ref=message.meta)?ref.type:void 0)?this.trigger("externalUpdate",message):void 0},ShareJsDoc.prototype.catchUp=function(updates){var i,j,len,results,update;for(results=[],i=j=0,len=updates.length;len>j;i=++j)update=updates[i],update.v=this._doc.version,update.doc=this.doc_id,results.push(this.processUpdateFromServer(update));return results},ShareJsDoc.prototype.getSnapshot=function(){return this._doc.snapshot},ShareJsDoc.prototype.getVersion=function(){return this._doc.version},ShareJsDoc.prototype.getType=function(){return this.type},ShareJsDoc.prototype.clearInflightAndPendingOps=function(){return this._doc.inflightOp=null,this._doc.inflightCallbacks=[],this._doc.pendingOp=null,this._doc.pendingCallbacks=[]},ShareJsDoc.prototype.flushPendingOps=function(){return this._doc.flush()},ShareJsDoc.prototype.updateConnectionState=function(state){return sl_console.log("[updateConnectionState] Setting state to "+state),this.connection.state=state,this.connection.id=this.socket.socket.sessionid,this._doc.autoOpen=!1,this._doc._connectionStateChanged(state),this.lastAcked=null},ShareJsDoc.prototype.hasBufferedOps=function(){return null!=this._doc.inflightOp||null!=this._doc.pendingOp},ShareJsDoc.prototype.getInflightOp=function(){return this._doc.inflightOp},ShareJsDoc.prototype.getPendingOp=function(){return this._doc.pendingOp},ShareJsDoc.prototype.getRecentAck=function(){return null!=this.lastAcked&&new Date-this.lastAcked<2*SINGLE_USER_FLUSH_DELAY},ShareJsDoc.prototype.getOpSize=function(op){var component,j,len,ref,size;for(size=0,ref=op||[],j=0,len=ref.length;len>j;j++)component=ref[j],null!=(null!=component?component.i:void 0)&&(size+=component.i.length),null!=(null!=component?component.d:void 0)&&(size+=component.d.length);return size},ShareJsDoc.prototype.attachToAce=function(ace){return this._doc.attach_ace(ace,!1,window.maxDocLength)},ShareJsDoc.prototype.detachFromAce=function(){var base;return"function"==typeof(base=this._doc).detach_ace?base.detach_ace():void 0},ShareJsDoc.prototype.attachToCM=function(cm){return this._doc.attach_cm(cm,!1)},ShareJsDoc.prototype.detachFromCM=function(){var base;return"function"==typeof(base=this._doc).detach_cm?base.detach_cm():void 0},ShareJsDoc.prototype.INFLIGHT_OP_TIMEOUT=5e3,ShareJsDoc.prototype.WAIT_FOR_CONNECTION_TIMEOUT=500,ShareJsDoc.prototype._startInflightOpTimeout=function(update){var retryOp,timer;return this._startFatalTimeoutTimer(update),retryOp=function(_this){return function(){var timer;return sl_console.log("[inflightOpTimeout] Trying op again"),null!=_this._doc.inflightOp?(update.dupIfSource=[_this.connection.id].concat(slice.call(_this._doc.inflightSubmittedIds)),"ok"!==_this.connection.state?(sl_console.log("[inflightOpTimeout] Not connected, retrying in 0.5s"),timer=setTimeout(retryOp,_this.WAIT_FOR_CONNECTION_TIMEOUT)):(sl_console.log("[inflightOpTimeout] Sending"),_this.connection.send(update))):void 0}}(this),timer=setTimeout(retryOp,this.INFLIGHT_OP_TIMEOUT),this._doc.inflightCallbacks.push(function(_this){return function(){return _this._clearFatalTimeoutTimer(),clearTimeout(timer)}}(this))},ShareJsDoc.prototype.FATAL_OP_TIMEOUT=3e4,ShareJsDoc.prototype._startFatalTimeoutTimer=function(update){return null==this._timeoutTimer?this._timeoutTimer=setTimeout(function(_this){return function(){return _this._clearFatalTimeoutTimer(),_this.trigger("op:timeout",update)}}(this),this.FATAL_OP_TIMEOUT):void 0},ShareJsDoc.prototype._clearFatalTimeoutTimer=function(){return null!=this._timeoutTimer?(clearTimeout(this._timeoutTimer),this._timeoutTimer=null):void 0},ShareJsDoc.prototype._handleError=function(error,meta){return null==meta&&(meta={}),this.trigger("error",error,meta)},ShareJsDoc.prototype._bindToDocChanges=function(doc){var flush,submitOp;return submitOp=doc.submitOp,doc.submitOp=function(_this){return function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],_this.trigger.apply(_this,["op:sent"].concat(slice.call(args))),doc.pendingCallbacks.push(function(){return _this.trigger.apply(_this,["op:acknowledged"].concat(slice.call(args)))}),submitOp.apply(doc,args)}}(this),flush=doc.flush,doc.flush=function(_this){return function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],_this.trigger("flush",doc.inflightOp,doc.pendingOp,doc.version),flush.apply(doc,args)}}(this)},ShareJsDoc}(EventEmitter)})}.call(this),function(){var load;load=function(){var RangesTracker;return RangesTracker=function(){function RangesTracker(changes,comments){this.changes=null!=changes?changes:[],this.comments=null!=comments?comments:[],this.setIdSeed(RangesTracker.generateIdSeed()),this.resetDirtyState()}return RangesTracker.prototype.getIdSeed=function(){return this.id_seed},RangesTracker.prototype.setIdSeed=function(seed){return this.id_seed=seed,this.id_increment=0},RangesTracker.generateIdSeed=function(){var machine,pid,timestamp;return pid=Math.floor(32767*Math.random()).toString(16),machine=Math.floor(16777216*Math.random()).toString(16),timestamp=Math.floor((new Date).valueOf()/1e3).toString(16),"00000000".substr(0,8-timestamp.length)+timestamp+"000000".substr(0,6-machine.length)+machine+"0000".substr(0,4-pid.length)+pid},RangesTracker.generateId=function(){return this.generateIdSeed()+"000001"},RangesTracker.prototype.newId=function(){var id,increment;return this.id_increment++,increment=this.id_increment.toString(16),id=this.id_seed+"000000".substr(0,6-increment.length)+increment},RangesTracker.prototype.getComment=function(comment_id){var c,comment,j,len,ref;for(comment=null,ref=this.comments,j=0,len=ref.length;len>j;j++)if(c=ref[j],c.id===comment_id){comment=c;break}return comment},RangesTracker.prototype.removeCommentId=function(comment_id){var comment;return comment=this.getComment(comment_id),null!=comment?(this.comments=this.comments.filter(function(c){return c.id!==comment_id}),this._markAsDirty(comment,"comment","removed")):void 0},RangesTracker.prototype.moveCommentId=function(comment_id,position,text){var comment,j,len,ref,results1;for(ref=this.comments,results1=[],j=0,len=ref.length;len>j;j++)comment=ref[j],comment.id===comment_id?(comment.op.p=position,comment.op.c=text,results1.push(this._markAsDirty(comment,"comment","moved"))):results1.push(void 0);return results1},RangesTracker.prototype.getChange=function(change_id){var c,change,j,len,ref;for(change=null,ref=this.changes,j=0,len=ref.length;len>j;j++)if(c=ref[j],c.id===change_id){change=c;break}return change},RangesTracker.prototype.getChanges=function(change_ids){var change,change_id,changes_response,ids_map,j,l,len,len1,ref;for(changes_response=[],ids_map={},j=0,len=change_ids.length;len>j;j++)change_id=change_ids[j],ids_map[change_id]=!0;for(ref=this.changes,l=0,len1=ref.length;len1>l;l++)change=ref[l],ids_map[change.id]&&(delete ids_map[change.id],changes_response.push(change));return changes_response},RangesTracker.prototype.removeChangeId=function(change_id){var change;return change=this.getChange(change_id),null!=change?this._removeChange(change):void 0},RangesTracker.prototype.removeChangeIds=function(change_to_remove_ids){var change,change_id,i,j,l,len,len1,ref,remaining_changes,remove_change_id;if(!(!(null!=change_to_remove_ids?change_to_remove_ids.length:void 0)>0)){for(i=this.changes.length,remove_change_id={},j=0,len=change_to_remove_ids.length;len>j;j++)change_id=change_to_remove_ids[j],remove_change_id[change_id]=!0;for(remaining_changes=[],ref=this.changes,l=0,len1=ref.length;len1>l;l++)change=ref[l],remove_change_id[change.id]?(delete remove_change_id[change.id],this._markAsDirty(change,"change","removed")):remaining_changes.push(change);return this.changes=remaining_changes}},RangesTracker.prototype.validate=function(text){var change,comment,content,j,l,len,len1,ref,ref1;for(ref=this.changes,j=0,len=ref.length;len>j;j++)if(change=ref[j],null!=change.op.i&&(content=text.slice(change.op.p,change.op.p+change.op.i.length),content!==change.op.i))throw new Error("Change ("+JSON.stringify(change)+") doesn't match text ("+JSON.stringify(content)+")");for(ref1=this.comments,l=0,len1=ref1.length;len1>l;l++)if(comment=ref1[l],content=text.slice(comment.op.p,comment.op.p+comment.op.c.length),content!==comment.op.c)throw new Error("Comment ("+JSON.stringify(comment)+") doesn't match text ("+JSON.stringify(content)+")");return!0},RangesTracker.prototype.applyOp=function(op,metadata){if(null==metadata&&(metadata={}),null==metadata.ts&&(metadata.ts=new Date),null!=op.i)return this.applyInsertToChanges(op,metadata),this.applyInsertToComments(op);if(null!=op.d)return this.applyDeleteToChanges(op,metadata),this.applyDeleteToComments(op);if(null!=op.c)return this.addComment(op,metadata);throw new Error("unknown op type")},RangesTracker.prototype.applyOps=function(ops,metadata){var j,len,op,results1;for(null==metadata&&(metadata={}),results1=[],j=0,len=ops.length;len>j;j++)op=ops[j],results1.push(this.applyOp(op,metadata));return results1},RangesTracker.prototype.addComment=function(op,metadata){var comment,existing;return existing=this.getComment(op.t),null!=existing?(this.moveCommentId(op.t,op.p,op.c),existing):(this.comments.push(comment={id:op.t||this.newId(),op:{c:op.c,p:op.p,t:op.t},metadata:metadata}),this._markAsDirty(comment,"comment","added"),comment)},RangesTracker.prototype.applyInsertToComments=function(op){var comment,j,len,offset,ref,results1;for(ref=this.comments,results1=[],j=0,len=ref.length;len>j;j++)comment=ref[j],op.p<=comment.op.p?(comment.op.p+=op.i.length,results1.push(this._markAsDirty(comment,"comment","moved"))):op.p<comment.op.p+comment.op.c.length?(offset=op.p-comment.op.p,comment.op.c=comment.op.c.slice(0,+(offset-1)+1||9e9)+op.i+comment.op.c.slice(offset),results1.push(this._markAsDirty(comment,"comment","moved"))):results1.push(void 0);return results1},RangesTracker.prototype.applyDeleteToComments=function(op){var comment,comment_end,comment_length,comment_start,deleted_comment,deleted_op_content,j,len,offset,op_end,op_length,op_start,ref,remaining_after,remaining_before,results1;for(op_start=op.p,op_length=op.d.length,op_end=op.p+op_length,ref=this.comments,results1=[],j=0,len=ref.length;len>j;j++)if(comment=ref[j],comment_start=comment.op.p,comment_end=comment.op.p+comment.op.c.length,comment_length=comment_end-comment_start,comment_start>=op_end)comment.op.p-=op_length,results1.push(this._markAsDirty(comment,"comment","moved"));else if(op_start>=comment_end);else{if(remaining_before=comment_start>=op_start?"":comment.op.c.slice(0,op_start-comment_start),remaining_after=op_end>=comment_end?"":comment.op.c.slice(op_end-comment_start),deleted_comment=comment.op.c.slice(remaining_before.length,comment_length-remaining_after.length),offset=Math.max(0,comment_start-op_start),deleted_op_content=op.d.slice(offset).slice(0,deleted_comment.length),deleted_comment!==deleted_op_content)throw new Error("deleted content does not match comment content");comment.op.p=Math.min(comment_start,op_start),comment.op.c=remaining_before+remaining_after,results1.push(this._markAsDirty(comment,"comment","moved"))}return results1},RangesTracker.prototype.applyInsertToChanges=function(op,metadata){var after_change,after_content,already_merged,before_content,change,change_end,change_start,i,is_change_overlapping,is_insert_blocked_by_delete,is_op_adjacent_to_next_delete,is_same_user,j,key,l,len,len1,len2,len3,m,moved_changes,n,new_changes,next_change,offset,op_end,op_length,op_start,previous_change,ref,ref1,ref2,remove_changes,results1,undoing,value,will_op_cancel_next_delete;for(op_start=op.p,op_length=op.i.length,op_end=op.p+op_length,undoing=!!op.u,already_merged=!1,previous_change=null,moved_changes=[],remove_changes=[],new_changes=[],ref=this.changes,i=j=0,len=ref.length;len>j;i=++j){if(change=ref[i],change_start=change.op.p,null!=change.op.d)change_start>op_start?(change.op.p+=op_length,moved_changes.push(change)):op_start===change_start&&(undoing&&change.op.d.length>=op.i.length&&change.op.d.slice(0,op.i.length)===op.i?(change.op.d=change.op.d.slice(op.i.length),change.op.p+=op.i.length,""===change.op.d?remove_changes.push(change):moved_changes.push(change),already_merged=!0):(change.op.p+=op_length,moved_changes.push(change)));else if(null!=change.op.i)if(change_end=change_start+change.op.i.length,is_change_overlapping=op_start>=change_start&&change_end>=op_start,is_same_user=metadata.user_id===change.metadata.user_id,next_change=this.changes[i+1],is_op_adjacent_to_next_delete=null!=next_change&&null!=next_change.op.d&&op.p===change_end&&next_change.op.p===op.p,will_op_cancel_next_delete=undoing&&is_op_adjacent_to_next_delete&&next_change.op.d.slice(0,op.i.length)===op.i,is_insert_blocked_by_delete=null!=previous_change&&null!=previous_change.op.d&&previous_change.op.p===op_end,this.track_changes&&is_change_overlapping&&!is_insert_blocked_by_delete&&!already_merged&&!will_op_cancel_next_delete&&is_same_user)offset=op_start-change_start,change.op.i=change.op.i.slice(0,offset)+op.i+change.op.i.slice(offset),change.metadata.ts=metadata.ts,already_merged=!0,moved_changes.push(change);else if(change_start>=op_start)change.op.p+=op_length,moved_changes.push(change);else if((!is_same_user||!this.track_changes)&&op_start>change_start&&change_end>op_start){offset=op_start-change_start,before_content=change.op.i.slice(0,offset),after_content=change.op.i.slice(offset),change.op.i=before_content,moved_changes.push(change),after_change={op:{i:after_content,p:change_start+offset+op_length},metadata:{}},ref1=change.metadata;for(key in ref1)value=ref1[key],after_change.metadata[key]=value;new_changes.push(after_change)}previous_change=change}for(this.track_changes&&!already_merged&&this._addOp(op,metadata),l=0,len1=new_changes.length;len1>l;l++)ref2=new_changes[l],op=ref2.op,metadata=ref2.metadata,this._addOp(op,metadata);for(m=0,len2=remove_changes.length;len2>m;m++)change=remove_changes[m],this._removeChange(change);for(results1=[],n=0,len3=moved_changes.length;len3>n;n++)change=moved_changes[n],results1.push(this._markAsDirty(change,"change","moved"));return results1},RangesTracker.prototype.applyDeleteToChanges=function(op,metadata){var change,change_end,change_start,delete_remaining_after,delete_remaining_before,delete_removed_length,delete_removed_start,insert_remaining,insert_remaining_after,insert_remaining_before,j,l,len,len1,len2,len3,m,modification,moved_changes,n,offset,op_end,op_length,op_modifications,op_start,ref,ref1,ref2,remove_changes,results,results1;for(op_start=op.p,op_length=op.d.length,op_end=op.p+op_length,remove_changes=[],moved_changes=[],op_modifications=[],ref=this.changes,j=0,len=ref.length;len>j;j++)change=ref[j],null!=change.op.i?(change_start=change.op.p,change_end=change_start+change.op.i.length,change_start>=op_end?(change.op.p-=op_length,moved_changes.push(change)):op_start>=change_end||(op_start>=change_start?(delete_remaining_before="",insert_remaining_before=change.op.i.slice(0,op_start-change_start)):(delete_remaining_before=op.d.slice(0,change_start-op_start),insert_remaining_before=""),change_end>=op_end?(delete_remaining_after="",insert_remaining_after=change.op.i.slice(op_end-change_start)):(delete_remaining_after=op.d.slice(change_end-op_start),insert_remaining_after=""),insert_remaining=insert_remaining_before+insert_remaining_after,insert_remaining.length>0?(change.op.i=insert_remaining,change.op.p=Math.min(change_start,op_start),change.metadata.ts=metadata.ts,moved_changes.push(change)):remove_changes.push(change),delete_removed_length=op.d.length-delete_remaining_before.length-delete_remaining_after.length,delete_removed_start=delete_remaining_before.length,modification={d:op.d.slice(delete_removed_start,delete_removed_start+delete_removed_length),p:delete_removed_start},modification.d.length>0&&op_modifications.push(modification))):null!=change.op.d&&(change_start=change.op.p,change_start>op_end||!this.track_changes&&op_end===change_start?(change.op.p-=op_length,moved_changes.push(change)):change_start>=op_start&&op_end>=change_start&&(this.track_changes?(offset=change_start-op_start,op_modifications.push({i:change.op.d,p:offset}),remove_changes.push(change)):(change.op.p=op_start,moved_changes.push(change))));for(op={p:op.p,d:this._applyOpModifications(op.d,op_modifications)},l=0,len1=remove_changes.length;len1>l;l++)change=remove_changes[l],op.d.length>0&&null!=change.op.d&&op.p<=(ref1=change.op.p)&&ref1<=op.p+op.d.length?(change.op.p=op.p,change.op.d=op.d,change.metadata=metadata,moved_changes.push(change),op.d=""):this._removeChange(change);if(this.track_changes&&op.d.length>0)this._addOp(op,metadata);else for(results=this._scanAndMergeAdjacentUpdates(),moved_changes=moved_changes.concat(results.moved_changes),ref2=results.remove_changes,m=0,len2=ref2.length;len2>m;m++)change=ref2[m],this._removeChange(change),moved_changes=moved_changes.filter(function(c){return c!==change});for(results1=[],n=0,len3=moved_changes.length;len3>n;n++)change=moved_changes[n],results1.push(this._markAsDirty(change,"change","moved"));return results1},RangesTracker.prototype._addOp=function(op,metadata){var change;return change={id:this.newId(),op:this._clone(op),metadata:this._clone(metadata)},this.changes.push(change),this.changes.sort(function(c1,c2){var result;return result=c1.op.p-c2.op.p,0!==result?result:null!=c1.op.i&&null!=c2.op.d?1:-1}),this._markAsDirty(change,"change","added")},RangesTracker.prototype._removeChange=function(change){return this.changes=this.changes.filter(function(c){return c.id!==change.id}),this._markAsDirty(change,"change","removed")},RangesTracker.prototype._applyOpModifications=function(content,op_modifications){var j,len,modification;for(op_modifications.sort(function(a,b){var result;return result=b.p-a.p,0!==result?result:null!=a.i&&null!=b.d?1:-1}),j=0,len=op_modifications.length;len>j;j++)if(modification=op_modifications[j],null!=modification.i)content=content.slice(0,modification.p)+modification.i+content.slice(modification.p);else if(null!=modification.d){if(content.slice(modification.p,modification.p+modification.d.length)!==modification.d)throw new Error("deleted content does not match. content: "+JSON.stringify(content)+"; modification: "+JSON.stringify(modification));content=content.slice(0,modification.p)+content.slice(modification.p+modification.d.length)}return content},RangesTracker.prototype._scanAndMergeAdjacentUpdates=function(){var change,change_start,change_user_id,j,len,moved_changes,previous_change,previous_change_end,previous_change_user_id,ref,remove_changes;for(previous_change=null,remove_changes=[],moved_changes=[],ref=this.changes,j=0,len=ref.length;len>j;j++)change=ref[j],null!=(null!=previous_change?previous_change.op.i:void 0)&&null!=change.op.i?(previous_change_end=previous_change.op.p+previous_change.op.i.length,previous_change_user_id=previous_change.metadata.user_id,change_start=change.op.p,change_user_id=change.metadata.user_id,previous_change_end===change_start&&previous_change_user_id===change_user_id&&(remove_changes.push(change),previous_change.op.i+=change.op.i,moved_changes.push(previous_change))):null!=(null!=previous_change?previous_change.op.d:void 0)&&null!=change.op.d&&previous_change.op.p===change.op.p?(previous_change.op.d+=change.op.d,remove_changes.push(change),moved_changes.push(previous_change)):previous_change=change;return{moved_changes:moved_changes,remove_changes:remove_changes}},RangesTracker.prototype.resetDirtyState=function(){return this._dirtyState={comment:{moved:{},removed:{},added:{}},change:{moved:{},removed:{},added:{}}}},RangesTracker.prototype.getDirtyState=function(){return this._dirtyState},RangesTracker.prototype._markAsDirty=function(object,type,action){return this._dirtyState[type][action][object.id]=object},RangesTracker.prototype._clone=function(object){var clone,k,v;clone={};for(k in object)v=object[k],clone[k]=v;return clone},RangesTracker}()},"undefined"!=typeof define&&null!==define?define("ide/review-panel/RangesTracker",[],load):module.exports=load()}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,slice=[].slice;define("ide/editor/Document",["utils/EventEmitter","ide/editor/ShareJsDoc","ide/review-panel/RangesTracker"],function(EventEmitter,ShareJsDoc,RangesTracker){var Document;return Document=function(superClass){function Document(ide1,doc_id1){this.ide=ide1,this.doc_id=doc_id1,this.connected=this.ide.socket.socket.connected,this.joined=!1,this.wantToBeJoined=!1,this._checkAceConsistency=_.bind(this._checkConsistency,this,this.ace),this._checkCMConsistency=_.bind(this._checkConsistency,this,this.cm),this.inconsistentCount=0,this._bindToEditorEvents(),this._bindToSocketEvents()}return extend(Document,superClass),Document.getDocument=function(ide,doc_id){return this.openDocs||(this.openDocs={}),null==this.openDocs[doc_id]?(sl_console.log("[getDocument] Creating new document instance for "+doc_id),this.openDocs[doc_id]=new Document(ide,doc_id)):sl_console.log("[getDocument] Returning existing document instance for "+doc_id),this.openDocs[doc_id]},Document.hasUnsavedChanges=function(){var doc,doc_id,ref;ref=this.openDocs||{};for(doc_id in ref)if(doc=ref[doc_id],doc.hasBufferedOps())return!0;return!1},Document.flushAll=function(){var doc,doc_id,ref,results;ref=this.openDocs,results=[];for(doc_id in ref)doc=ref[doc_id],results.push(doc.flush());return results},Document.prototype.attachToAce=function(ace){var editorDoc,ref;return this.ace=ace,null!=(ref=this.doc)&&ref.attachToAce(this.ace),editorDoc=this.ace.getSession().getDocument(),editorDoc.on("change",this._checkAceConsistency),this.ide.$scope.$emit("document:opened",this.doc)},Document.prototype.detachFromAce=function(){var editorDoc,ref,ref1;return null!=(ref=this.doc)&&ref.detachFromAce(),editorDoc=null!=(ref1=this.ace)?ref1.getSession().getDocument():void 0,null!=editorDoc&&editorDoc.off("change",this._checkAceConsistency),this.ide.$scope.$emit("document:closed",this.doc)},Document.prototype.attachToCM=function(cm){var ref,ref1;return this.cm=cm,null!=(ref=this.doc)&&ref.attachToCM(this.cm),null!=(ref1=this.cm)&&ref1.on("change",this._checkCMConsistency),this.ide.$scope.$emit("document:opened",this.doc)},Document.prototype.detachFromCM=function(){var ref,ref1;return null!=(ref=this.doc)&&ref.detachFromCM(),null!=(ref1=this.cm)&&ref1.off("change",this._checkCMConsistency),this.ide.$scope.$emit("document:closed",this.doc)},Document.prototype.submitOp=function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],null!=(ref=this.doc)?ref.submitOp.apply(ref,args):void 0},Document.prototype._checkConsistency=function(editor){return function(_this){return function(){return setTimeout(function(){var editorValue,ref,sharejsValue;return editorValue=null!=editor?editor.getValue():void 0,sharejsValue=null!=(ref=_this.doc)?ref.getSnapshot():void 0,editorValue!==sharejsValue?_this.inconsistentCount++:_this.inconsistentCount=0,_this.inconsistentCount>=3?_this._onError(new Error("Editor text does not match server text")):void 0},0)}}(this)},Document.prototype.getSnapshot=function(){var ref;return null!=(ref=this.doc)?ref.getSnapshot():void 0},Document.prototype.getType=function(){var ref;return null!=(ref=this.doc)?ref.getType():void 0},Document.prototype.getInflightOp=function(){var ref;return null!=(ref=this.doc)?ref.getInflightOp():void 0},Document.prototype.getPendingOp=function(){var ref;return null!=(ref=this.doc)?ref.getPendingOp():void 0},Document.prototype.getRecentAck=function(){var ref;return null!=(ref=this.doc)?ref.getRecentAck():void 0},Document.prototype.getOpSize=function(op){var ref;return null!=(ref=this.doc)?ref.getOpSize(op):void 0},Document.prototype.hasBufferedOps=function(){var ref;return null!=(ref=this.doc)?ref.hasBufferedOps():void 0},Document.prototype.setTrackingChanges=function(track_changes){return this.doc.track_changes=track_changes},Document.prototype.getTrackingChanges=function(){return!!this.doc.track_changes},Document.prototype.setTrackChangesIdSeeds=function(id_seeds){return this.doc.track_changes_id_seeds=id_seeds},Document.prototype._bindToSocketEvents=function(){return this._onUpdateAppliedHandler=function(_this){return function(update){return _this._onUpdateApplied(update)}}(this),this.ide.socket.on("otUpdateApplied",this._onUpdateAppliedHandler),this._onErrorHandler=function(_this){return function(error,update){return _this._onError(error,update)}}(this),this.ide.socket.on("otUpdateError",this._onErrorHandler),this._onDisconnectHandler=function(_this){return function(error){return _this._onDisconnect(error)}}(this),this.ide.socket.on("disconnect",this._onDisconnectHandler)},Document.prototype._bindToEditorEvents=function(){var onReconnectHandler;return onReconnectHandler=function(_this){return function(update){return _this._onReconnect(update)}}(this),this._unsubscribeReconnectHandler=this.ide.$scope.$on("project:joined",onReconnectHandler)},Document.prototype._unBindFromEditorEvents=function(){return this._unsubscribeReconnectHandler()},Document.prototype._unBindFromSocketEvents=function(){return this.ide.socket.removeListener("otUpdateApplied",this._onUpdateAppliedHandler),this.ide.socket.removeListener("otUpdateError",this._onErrorHandler),this.ide.socket.removeListener("disconnect",this._onDisconnectHandler)},Document.prototype.leaveAndCleanUp=function(){return this.leave(function(_this){return function(error){return _this._cleanUp()}}(this))},Document.prototype.join=function(callback){return null==callback&&(callback=function(error){}),this.wantToBeJoined=!0,this._cancelLeave(),this.connected?this._joinDoc(callback):(this._joinCallbacks||(this._joinCallbacks=[]),
this._joinCallbacks.push(callback))},Document.prototype.leave=function(callback){return null==callback&&(callback=function(error){}),this.wantToBeJoined=!1,this._cancelJoin(),null!=this.doc&&this.doc.hasBufferedOps()?(sl_console.log("[leave] Doc has buffered ops, pushing callback for later"),this._leaveCallbacks||(this._leaveCallbacks=[]),this._leaveCallbacks.push(callback)):this.connected?(sl_console.log("[leave] Leaving now"),this._leaveDoc(callback)):(sl_console.log("[leave] Not connected, returning now"),callback())},Document.prototype.flush=function(){var ref;return null!=(ref=this.doc)?ref.flushPendingOps():void 0},Document.prototype.chaosMonkey=function(line,char){var copy,orig,pos,timer;return null==line&&(line=0),null==char&&(char="a"),orig=char,copy=null,pos=0,timer=function(_this){return function(){return null!=copy&&copy.length||(copy=orig.slice()+" "+new Date+"\n",line+=Math.random()>.1?1:-2,0>line&&(line=0),pos=0),char=copy[0],copy=copy.slice(1),_this.ace.session.insert({row:line,column:pos},char),pos+=1,_this._cm=setTimeout(timer,100+(Math.random()<.1?1e3:0))}}(this),this._cm=timer()},Document.prototype.clearChaosMonkey=function(){return clearTimeout(this._cm)},Document.prototype.MAX_PENDING_OP_SIZE=64,Document.prototype.pollSavedStatus=function(){var inflightOp,pendingOp,pendingOpSize,recentAck,saved;return inflightOp=this.getInflightOp(),pendingOp=this.getPendingOp(),recentAck=this.getRecentAck(),pendingOpSize=null!=pendingOp&&this.getOpSize(pendingOp),null==inflightOp&&null==pendingOp?(saved=!0,sl_console.log("[pollSavedStatus] no inflight or pending ops")):null!=inflightOp&&inflightOp===this.oldInflightOp?(saved=!1,sl_console.log("[pollSavedStatus] inflight op is same as before")):null!=pendingOp&&recentAck&&pendingOpSize<this.MAX_PENDING_OP_SIZE?(saved=!0,sl_console.log("[pollSavedStatus] pending op (small with recent ack) assume ok",pendingOp,pendingOpSize)):(saved=!1,sl_console.log("[pollSavedStatus] assuming not saved (inflightOp?: "+(null!=inflightOp)+", pendingOp?: "+(null!=pendingOp)+")")),this.oldInflightOp=inflightOp,saved},Document.prototype._cancelLeave=function(){return null!=this._leaveCallbacks?delete this._leaveCallbacks:void 0},Document.prototype._cancelJoin=function(){return null!=this._joinCallbacks?delete this._joinCallbacks:void 0},Document.prototype._onUpdateApplied=function(update){return this.ide.pushEvent("received-update",{doc_id:this.doc_id,remote_doc_id:null!=update?update.doc:void 0,wantToBeJoined:this.wantToBeJoined,update:update}),null!=window.disconnectOnAck&&Math.random()<window.disconnectOnAck?(sl_console.log("Disconnecting on ack",update),void window._ide.socket.socket.disconnect()):null!=window.dropAcks&&Math.random()<window.dropAcks&&null==update.op?void sl_console.log("Simulating a lost ack",update):(null!=update?update.doc:void 0)!==this.doc_id||null==this.doc||(this.doc.processUpdateFromServer(update),this.wantToBeJoined)?void 0:this.leave()},Document.prototype._onDisconnect=function(){var ref;return sl_console.log("[onDisconnect] disconnecting"),this.connected=!1,this.joined=!1,null!=(ref=this.doc)?ref.updateConnectionState("disconnected"):void 0},Document.prototype._onReconnect=function(){var ref,ref1;return sl_console.log("[onReconnect] reconnected (joined project)"),this.ide.pushEvent("reconnected:afterJoinProject"),this.connected=!0,this.wantToBeJoined||(null!=(ref=this.doc)?ref.hasBufferedOps():void 0)?(sl_console.log("[onReconnect] Rejoining (wantToBeJoined: "+this.wantToBeJoined+" OR hasBufferedOps: "+(null!=(ref1=this.doc)?ref1.hasBufferedOps():void 0)+")"),this._joinDoc(function(_this){return function(error){return null!=error?_this._onError(error):(_this.doc.updateConnectionState("ok"),_this.doc.flushPendingOps(),_this._callJoinCallbacks())}}(this))):void 0},Document.prototype._callJoinCallbacks=function(){var callback,i,len,ref;for(ref=this._joinCallbacks||[],i=0,len=ref.length;len>i;i++)(callback=ref[i])();return delete this._joinCallbacks},Document.prototype._joinDoc=function(callback){return null==callback&&(callback=function(error){}),null!=this.doc?this.ide.socket.emit("joinDoc",this.doc_id,this.doc.getVersion(),{encodeRanges:!0},function(_this){return function(error,docLines,version,updates,ranges){return null!=error?callback(error):(_this.joined=!0,_this.doc.catchUp(updates),_this._decodeRanges(ranges),_this._catchUpRanges(null!=ranges?ranges.changes:void 0,null!=ranges?ranges.comments:void 0),callback())}}(this)):this.ide.socket.emit("joinDoc",this.doc_id,{encodeRanges:!0},function(_this){return function(error,docLines,version,updates,ranges){return null!=error?callback(error):(_this.joined=!0,_this.doc=new ShareJsDoc(_this.doc_id,docLines,version,_this.ide.socket),_this._decodeRanges(ranges),_this.ranges=new RangesTracker(null!=ranges?ranges.changes:void 0,null!=ranges?ranges.comments:void 0),_this._bindToShareJsDocEvents(),callback())}}(this))},Document.prototype._decodeRanges=function(ranges){var change,comment,decodeFromWebsockets,err,i,j,len,len1,ref,ref1,results;decodeFromWebsockets=function(text){return decodeURIComponent(escape(text))};try{for(ref=ranges.changes||[],i=0,len=ref.length;len>i;i++)change=ref[i],null!=change.op.i&&(change.op.i=decodeFromWebsockets(change.op.i)),null!=change.op.d&&(change.op.d=decodeFromWebsockets(change.op.d));for(ref1=ranges.comments||[],results=[],j=0,len1=ref1.length;len1>j;j++)comment=ref1[j],null!=comment.op.c?results.push(comment.op.c=decodeFromWebsockets(comment.op.c)):results.push(void 0);return results}catch(error1){return err=error1,console.log(err)}},Document.prototype._leaveDoc=function(callback){return null==callback&&(callback=function(error){}),sl_console.log("[_leaveDoc] Sending leaveDoc request"),this.ide.socket.emit("leaveDoc",this.doc_id,function(_this){return function(error){var i,len,ref;if(null!=error)return callback(error);for(_this.joined=!1,ref=_this._leaveCallbacks||[],i=0,len=ref.length;len>i;i++)callback=ref[i],sl_console.log("[_leaveDoc] Calling buffered callback",callback),callback(error);return delete _this._leaveCallbacks,callback(error)}}(this))},Document.prototype._cleanUp=function(){return Document.openDocs[this.doc_id]===this?(sl_console.log("[_cleanUp] Removing self ("+this.doc_id+") from in openDocs"),delete Document.openDocs[this.doc_id]):sl_console.log("[_cleanUp] New instance of ("+this.doc_id+") created. Not removing"),this._unBindFromEditorEvents(),this._unBindFromSocketEvents()},Document.prototype._bindToShareJsDocEvents=function(){return this.doc.on("error",function(_this){return function(error,meta){return _this._onError(error,meta)}}(this)),this.doc.on("externalUpdate",function(_this){return function(update){return _this.ide.pushEvent("externalUpdate",{doc_id:_this.doc_id}),_this.trigger("externalUpdate",update)}}(this)),this.doc.on("remoteop",function(_this){return function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],_this.ide.pushEvent("remoteop",{doc_id:_this.doc_id}),_this.trigger.apply(_this,["remoteop"].concat(slice.call(args)))}}(this)),this.doc.on("op:sent",function(_this){return function(op){return _this.ide.pushEvent("op:sent",{doc_id:_this.doc_id,op:op}),_this.trigger("op:sent")}}(this)),this.doc.on("op:acknowledged",function(_this){return function(op){return _this.ide.pushEvent("op:acknowledged",{doc_id:_this.doc_id,op:op}),_this.ide.$scope.$emit("ide:opAcknowledged",{doc_id:_this.doc_id,op:op}),_this.trigger("op:acknowledged")}}(this)),this.doc.on("op:timeout",function(_this){return function(op){return _this.ide.pushEvent("op:timeout",{doc_id:_this.doc_id,op:op}),_this.trigger("op:timeout"),_this._onError(new Error("op timed out"),{op:op})}}(this)),this.doc.on("flush",function(_this){return function(inflightOp,pendingOp,version){return _this.ide.pushEvent("flush",{doc_id:_this.doc_id,inflightOp:inflightOp,pendingOp:pendingOp,v:version})}}(this)),this.doc.on("change",function(_this){return function(ops,oldSnapshot,msg){return _this._applyOpsToRanges(ops,oldSnapshot,msg),_this.ide.$scope.$emit("doc:changed",{doc_id:_this.doc_id})}}(this)),this.doc.on("flipped_pending_to_inflight",function(_this){return function(){return _this.trigger("flipped_pending_to_inflight")}}(this)),this.doc.on("saved",function(_this){return function(){return _this.ide.$scope.$emit("doc:saved",{doc_id:_this.doc_id})}}(this))},Document.prototype._onError=function(error,meta){var ref;return null==meta&&(meta={}),meta.doc_id=this.doc_id,sl_console.log("ShareJS error",error,meta),"function"==typeof ga&&ga("send","event","error","shareJsError",error.message+" - "+this.ide.socket.socket.transport.name),null!=(ref=this.doc)&&ref.clearInflightAndPendingOps(),this.trigger("error",error,meta),this._cleanUp()},Document.prototype._applyOpsToRanges=function(ops,oldSnapshot,msg){var i,len,old_id_seed,op,ref,ref1,remote_op,track_changes_as;for(null==ops&&(ops=[]),track_changes_as=null,remote_op=null!=msg,null!=(null!=msg&&null!=(ref=msg.meta)?ref.tc:void 0)&&(old_id_seed=this.ranges.getIdSeed(),this.ranges.setIdSeed(msg.meta.tc)),remote_op&&(null!=(ref1=msg.meta)?ref1.tc:void 0)?track_changes_as=msg.meta.user_id:remote_op||null==this.track_changes_as||(track_changes_as=this.track_changes_as),this.ranges.track_changes=null!=track_changes_as,i=0,len=ops.length;len>i;i++)op=ops[i],this.ranges.applyOp(op,{user_id:track_changes_as});return null!=old_id_seed&&this.ranges.setIdSeed(old_id_seed),remote_op?setTimeout(function(_this){return function(){return _this.emit("ranges:dirty")}}(this)):this.emit("ranges:dirty")},Document.prototype._catchUpRanges=function(changes,comments){var i,j,len,len1,op,ref,ref1;for(null==changes&&(changes=[]),null==comments&&(comments=[]),this.emit("ranges:clear"),this.ranges.changes=changes,this.ranges.comments=comments,this.ranges.track_changes=this.doc.track_changes,ref=this.doc.getInflightOp()||[],i=0,len=ref.length;len>i;i++)op=ref[i],this.ranges.setIdSeed(this.doc.track_changes_id_seeds.inflight),this.ranges.applyOp(op,{user_id:this.track_changes_as});for(ref1=this.doc.getPendingOp()||[],j=0,len1=ref1.length;len1>j;j++)op=ref1[j],this.ranges.setIdSeed(this.doc.track_changes_id_seeds.pending),this.ranges.applyOp(op,{user_id:this.track_changes_as});return this.emit("ranges:redraw")},Document}(EventEmitter)})}.call(this),function(){define("ide/editor/components/spellMenu",["base"],function(App){return App.component("spellMenu",{bindings:{open:"<",top:"<",left:"<",layoutFromBottom:"<",highlight:"<",replaceWord:"&",learnWord:"&"},template:'<div\n  class="dropdown context-menu spell-check-menu"\n  ng-show="$ctrl.open"\n  ng-style="{top: $ctrl.top, left: $ctrl.left}"\n  ng-class="{open: $ctrl.open, \'spell-check-menu-from-bottom\': $ctrl.layoutFromBottom}"\n>\n  <ul class="dropdown-menu">\n    <li ng-repeat="suggestion in $ctrl.highlight.suggestions | limitTo:8">\n      <a\n        href\n        ng-click="$ctrl.replaceWord({ highlight: $ctrl.highlight, suggestion: suggestion })"\n      >\n        {{ suggestion }}\n      </a>\n    </li>\n    <li class="divider"></li>\n    <li>\n      <a href ng-click="$ctrl.learnWord({ highlight: $ctrl.highlight })">Add to Dictionary</a>\n    </li>\n  </ul>\n</div>'})})}.call(this),ace.define("ace/ext/searchbox",["require","exports","module","ace/lib/dom","ace/lib/lang","ace/lib/event","ace/keyboard/hash_handler","ace/lib/keys"],function(require,exports,module){"use strict";var dom=require("../lib/dom"),lang=require("../lib/lang"),event=require("../lib/event"),searchboxCss=".ace_search {background-color: #ddd;border: 1px solid #cbcbcb;border-top: 0 none;max-width: 325px;overflow: hidden;margin: 0;padding: 4px;padding-right: 6px;padding-bottom: 0;position: absolute;top: 0px;z-index: 99;white-space: normal;}.ace_search.left {border-left: 0 none;border-radius: 0px 0px 5px 0px;left: 0;}.ace_search.right {border-radius: 0px 0px 0px 5px;border-right: 0 none;right: 0;}.ace_search_form, .ace_replace_form {border-radius: 3px;border: 1px solid #cbcbcb;float: left;margin-bottom: 4px;overflow: hidden;}.ace_search_form.ace_nomatch {outline: 1px solid red;}.ace_search_field {background-color: white;border-right: 1px solid #cbcbcb;border: 0 none;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;float: left;height: 22px;outline: 0;padding: 0 7px;width: 214px;margin: 0;}.ace_searchbtn,.ace_replacebtn {background: #fff;border: 0 none;border-left: 1px solid #dcdcdc;cursor: pointer;float: left;height: 22px;margin: 0;position: relative;}.ace_searchbtn:last-child,.ace_replacebtn:last-child {border-top-right-radius: 3px;border-bottom-right-radius: 3px;}.ace_searchbtn:disabled {background: none;cursor: default;}.ace_searchbtn {background-position: 50% 50%;background-repeat: no-repeat;width: 27px;}.ace_searchbtn.prev {background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADFJREFUeNpiSU1NZUAC/6E0I0yACYskCpsJiySKIiY0SUZk40FyTEgCjGgKwTRAgAEAQJUIPCE+qfkAAAAASUVORK5CYII=);    }.ace_searchbtn.next {background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADRJREFUeNpiTE1NZQCC/0DMyIAKwGJMUAYDEo3M/s+EpvM/mkKwCQxYjIeLMaELoLMBAgwAU7UJObTKsvAAAAAASUVORK5CYII=);    }.ace_searchbtn_close {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAcCAYAAABRVo5BAAAAZ0lEQVR42u2SUQrAMAhDvazn8OjZBilCkYVVxiis8H4CT0VrAJb4WHT3C5xU2a2IQZXJjiQIRMdkEoJ5Q2yMqpfDIo+XY4k6h+YXOyKqTIj5REaxloNAd0xiKmAtsTHqW8sR2W5f7gCu5nWFUpVjZwAAAABJRU5ErkJggg==) no-repeat 50% 0;border-radius: 50%;border: 0 none;color: #656565;cursor: pointer;float: right;font: 16px/16px Arial;height: 14px;margin: 5px 1px 9px 5px;padding: 0;text-align: center;width: 14px;}.ace_searchbtn_close:hover {background-color: #656565;background-position: 50% 100%;color: white;}.ace_replacebtn.prev {width: 54px}.ace_replacebtn.next {width: 27px}.ace_button {margin-left: 2px;cursor: pointer;-webkit-user-select: none;-moz-user-select: none;-o-user-select: none;-ms-user-select: none;user-select: none;overflow: hidden;opacity: 0.7;border: 1px solid rgba(100,100,100,0.23);padding: 1px;-moz-box-sizing: border-box;box-sizing:    border-box;color: black;}.ace_button:hover {background-color: #eee;opacity:1;}.ace_button:active {background-color: #ddd;}.ace_button.checked {border-color: #3399ff;opacity:1;}.ace_search_options{margin-bottom: 3px;text-align: right;-webkit-user-select: none;-moz-user-select: none;-o-user-select: none;-ms-user-select: none;user-select: none;}",HashHandler=require("../keyboard/hash_handler").HashHandler,keyUtil=require("../lib/keys");dom.importCssString(searchboxCss,"ace_searchbox");var html='<div class="ace_search right">    <button type="button" action="hide" class="ace_searchbtn_close"></button>    <div class="ace_search_form">        <input class="ace_search_field" placeholder="Search for" spellcheck="false"></input>        <button type="button" action="findNext" class="ace_searchbtn next"></button>        <button type="button" action="findPrev" class="ace_searchbtn prev"></button>        <button type="button" action="findAll" class="ace_searchbtn" title="Alt-Enter">All</button>    </div>    <div class="ace_replace_form">        <input class="ace_search_field" placeholder="Replace with" spellcheck="false"></input>        <button type="button" action="replaceAndFindNext" class="ace_replacebtn">Replace</button>        <button type="button" action="replaceAll" class="ace_replacebtn">All</button>    </div>    <div class="ace_search_options">        <span action="toggleRegexpMode" class="ace_button" title="RegExp Search">.*</span>        <span action="toggleCaseSensitive" class="ace_button" title="CaseSensitive Search">Aa</span>        <span action="toggleWholeWords" class="ace_button" title="Whole Word Search">\\b</span>    </div></div>'.replace(/>\s+/g,">"),SearchBox=function(editor,range,showReplaceForm){var div=dom.createElement("div");div.innerHTML=html,this.element=div.firstChild,this.$init(),this.setEditor(editor)};(function(){this.setEditor=function(editor){editor.searchBox=this,editor.container.appendChild(this.element),this.editor=editor},this.$initElements=function(sb){this.searchBox=sb.querySelector(".ace_search_form"),this.replaceBox=sb.querySelector(".ace_replace_form"),this.searchOptions=sb.querySelector(".ace_search_options"),this.regExpOption=sb.querySelector("[action=toggleRegexpMode]"),this.caseSensitiveOption=sb.querySelector("[action=toggleCaseSensitive]"),this.wholeWordOption=sb.querySelector("[action=toggleWholeWords]"),this.searchInput=this.searchBox.querySelector(".ace_search_field"),this.replaceInput=this.replaceBox.querySelector(".ace_search_field")},this.$init=function(){var sb=this.element;this.$initElements(sb);var _this=this;event.addListener(sb,"mousedown",function(e){setTimeout(function(){_this.activeInput.focus()},0),event.stopPropagation(e)}),event.addListener(sb,"click",function(e){var t=e.target||e.srcElement,action=t.getAttribute("action");action&&_this[action]?_this[action]():_this.$searchBarKb.commands[action]&&_this.$searchBarKb.commands[action].exec(_this),event.stopPropagation(e)}),event.addCommandKeyListener(sb,function(e,hashId,keyCode){var keyString=keyUtil.keyCodeToString(keyCode),command=_this.$searchBarKb.findKeyCommand(hashId,keyString);command&&command.exec&&(command.exec(_this),event.stopEvent(e))}),this.$onChange=lang.delayedCall(function(){_this.find(!1,!1)}),event.addListener(this.searchInput,"input",function(){_this.$onChange.schedule(20)}),event.addListener(this.searchInput,"focus",function(){_this.activeInput=_this.searchInput,_this.searchInput.value&&_this.highlight()}),event.addListener(this.replaceInput,"focus",function(){_this.activeInput=_this.replaceInput,_this.searchInput.value&&_this.highlight()})},this.$closeSearchBarKb=new HashHandler([{bindKey:"Esc",name:"closeSearchBar",exec:function(editor){editor.searchBox.hide()}}]),this.$searchBarKb=new HashHandler,this.$searchBarKb.bindKeys({"Ctrl-f|Command-f":function(sb){var isReplace=sb.isReplace=!sb.isReplace;sb.replaceBox.style.display=isReplace?"":"none",sb.searchInput.focus()},"Ctrl-H|Command-Option-F":function(sb){sb.replaceBox.style.display="",sb.replaceInput.focus()},"Ctrl-G|Command-G":function(sb){sb.findNext()},"Ctrl-Shift-G|Command-Shift-G":function(sb){sb.findPrev()},esc:function(sb){setTimeout(function(){sb.hide()})},Return:function(sb){sb.activeInput==sb.replaceInput&&sb.replace(),sb.findNext()},"Shift-Return":function(sb){sb.activeInput==sb.replaceInput&&sb.replace(),sb.findPrev()},"Alt-Return":function(sb){sb.activeInput==sb.replaceInput&&sb.replaceAll(),sb.findAll()},Tab:function(sb){(sb.activeInput==sb.replaceInput?sb.searchInput:sb.replaceInput).focus()}}),this.$searchBarKb.addCommands([{name:"toggleRegexpMode",bindKey:{win:"Alt-R|Alt-/",mac:"Ctrl-Alt-R|Ctrl-Alt-/"},exec:function(sb){sb.regExpOption.checked=!sb.regExpOption.checked,sb.$syncOptions()}},{name:"toggleCaseSensitive",bindKey:{win:"Alt-C|Alt-I",mac:"Ctrl-Alt-R|Ctrl-Alt-I"},exec:function(sb){sb.caseSensitiveOption.checked=!sb.caseSensitiveOption.checked,sb.$syncOptions()}},{name:"toggleWholeWords",bindKey:{win:"Alt-B|Alt-W",mac:"Ctrl-Alt-B|Ctrl-Alt-W"},exec:function(sb){sb.wholeWordOption.checked=!sb.wholeWordOption.checked,sb.$syncOptions()}}]),this.$syncOptions=function(){dom.setCssClass(this.regExpOption,"checked",this.regExpOption.checked),dom.setCssClass(this.wholeWordOption,"checked",this.wholeWordOption.checked),dom.setCssClass(this.caseSensitiveOption,"checked",this.caseSensitiveOption.checked),this.find(!1,!1)},this.highlight=function(re){this.editor.session.highlight(re||this.editor.$search.$options.re),this.editor.renderer.updateBackMarkers()},this.find=function(skipCurrent,backwards,preventScroll){var range=this.editor.find(this.searchInput.value,{skipCurrent:skipCurrent,backwards:backwards,wrap:!0,regExp:this.regExpOption.checked,caseSensitive:this.caseSensitiveOption.checked,wholeWord:this.wholeWordOption.checked,preventScroll:preventScroll});dom.setCssClass(this.searchBox,"ace_nomatch",!range&&this.searchInput.value),this.highlight()},this.findNext=function(){this.find(!0,!1)},this.findPrev=function(){this.find(!0,!0)},this.findAll=function(){var range=this.editor.findAll(this.searchInput.value,{regExp:this.regExpOption.checked,caseSensitive:this.caseSensitiveOption.checked,wholeWord:this.wholeWordOption.checked}),noMatch=!range&&this.searchInput.value;dom.setCssClass(this.searchBox,"ace_nomatch",noMatch),this.editor._emit("findSearchBox",{match:!noMatch}),this.highlight(),this.hide()},this.replace=function(){this.editor.getReadOnly()||this.editor.replace(this.replaceInput.value)},this.replaceAndFindNext=function(){this.editor.getReadOnly()||(this.editor.replace(this.replaceInput.value),this.findNext())},this.replaceAll=function(){this.editor.getReadOnly()||this.editor.replaceAll(this.replaceInput.value)},this.hide=function(){this.element.style.display="none",this.editor.keyBinding.removeKeyboardHandler(this.$closeSearchBarKb),this.editor.focus()},this.show=function(value,isReplace){this.element.style.display="",this.replaceBox.style.display=isReplace?"":"none",this.isReplace=isReplace,value&&(this.searchInput.value=value),this.find(!1,!1,!0),this.searchInput.focus(),this.searchInput.select(),this.editor.keyBinding.addKeyboardHandler(this.$closeSearchBarKb)},this.isFocused=function(){var el=document.activeElement;return el==this.searchInput||el==this.replaceInput}}).call(SearchBox.prototype),exports.SearchBox=SearchBox,exports.Search=function(editor,isReplace){var sb=editor.searchBox||new SearchBox(editor);sb.show(editor.session.getTextRange(),isReplace)}}),function(){ace.require(["ace/ext/searchbox"],function(){})}(),define("ace/ext-searchbox",function(){}),ace.define("ace/ext/modelist",["require","exports","module"],function(require,exports,module){"use strict";function getModeForPath(path){for(var mode=modesByName.text,fileName=path.split(/[\/\\]/).pop(),i=0;i<modes.length;i++)if(modes[i].supportsFile(fileName)){mode=modes[i];break}return mode}var modes=[],Mode=function(name,caption,extensions){this.name=name,this.caption=caption,this.mode="ace/mode/"+name,this.extensions=extensions;var re;re=/\^/.test(extensions)?extensions.replace(/\|(\^)?/g,function(a,b){return"$|"+(b?"^":"^.*\\.")})+"$":"^.*\\.("+extensions+")$",this.extRe=new RegExp(re,"gi")};Mode.prototype.supportsFile=function(filename){return filename.match(this.extRe)};var supportedModes={ABAP:["abap"],ABC:["abc"],ActionScript:["as"],ADA:["ada|adb"],Apache_Conf:["^htaccess|^htgroups|^htpasswd|^conf|htaccess|htgroups|htpasswd"],AsciiDoc:["asciidoc|adoc"],Assembly_x86:["asm|a"],AutoHotKey:["ahk"],BatchFile:["bat|cmd"],C_Cpp:["cpp|c|cc|cxx|h|hh|hpp|ino"],C9Search:["c9search_results"],Cirru:["cirru|cr"],Clojure:["clj|cljs"],Cobol:["CBL|COB"],coffee:["coffee|cf|cson|^Cakefile"],ColdFusion:["cfm"],CSharp:["cs"],CSS:["css"],Curly:["curly"],D:["d|di"],Dart:["dart"],Diff:["diff|patch"],Dockerfile:["^Dockerfile"],Dot:["dot"],Drools:["drl"],Dummy:["dummy"],DummySyntax:["dummy"],Eiffel:["e|ge"],EJS:["ejs"],Elixir:["ex|exs"],Elm:["elm"],Erlang:["erl|hrl"],Forth:["frt|fs|ldr|fth|4th"],Fortran:["f|f90"],FTL:["ftl"],Gcode:["gcode"],Gherkin:["feature"],Gitignore:["^.gitignore"],Glsl:["glsl|frag|vert"],Gobstones:["gbs"],golang:["go"],Groovy:["groovy"],HAML:["haml"],Handlebars:["hbs|handlebars|tpl|mustache"],Haskell:["hs"],Haskell_Cabal:["cabal"],haXe:["hx"],HTML:["html|htm|xhtml"],HTML_Elixir:["eex|html.eex"],HTML_Ruby:["erb|rhtml|html.erb"],INI:["ini|conf|cfg|prefs"],Io:["io"],Jack:["jack"],Jade:["jade"],Java:["java"],JavaScript:["js|jsm|jsx"],JSON:["json"],JSONiq:["jq"],JSP:["jsp"],JSX:["jsx"],Julia:["jl"],Kotlin:["kt|kts"],LaTeX:["tex|latex|ltx|bib"],LESS:["less"],Liquid:["liquid"],Lisp:["lisp"],LiveScript:["ls"],LogiQL:["logic|lql"],LSL:["lsl"],Lua:["lua"],LuaPage:["lp"],Lucene:["lucene"],Makefile:["^Makefile|^GNUmakefile|^makefile|^OCamlMakefile|make"],Markdown:["md|markdown"],Mask:["mask"],MATLAB:["matlab"],Maze:["mz"],MEL:["mel"],MUSHCode:["mc|mush"],MySQL:["mysql"],Nix:["nix"],NSIS:["nsi|nsh"],ObjectiveC:["m|mm"],OCaml:["ml|mli"],Pascal:["pas|p"],Perl:["pl|pm"],pgSQL:["pgsql"],PHP:["php|phtml|shtml|php3|php4|php5|phps|phpt|aw|ctp|module"],Powershell:["ps1"],Praat:["praat|praatscript|psc|proc"],Prolog:["plg|prolog"],Properties:["properties"],Protobuf:["proto"],Python:["py"],R:["r"],Razor:["cshtml|asp"],RDoc:["Rd"],RHTML:["Rhtml"],RST:["rst"],Ruby:["rb|ru|gemspec|rake|^Guardfile|^Rakefile|^Gemfile"],Rust:["rs"],SASS:["sass"],SCAD:["scad"],Scala:["scala"],Scheme:["scm|sm|rkt|oak|scheme"],SCSS:["scss"],SH:["sh|bash|^.bashrc"],SJS:["sjs"],Smarty:["smarty|tpl"],snippets:["snippets"],Soy_Template:["soy"],Space:["space"],SQL:["sql"],SQLServer:["sqlserver"],Stylus:["styl|stylus"],SVG:["svg"],Swift:["swift"],Tcl:["tcl"],Tex:["tex"],Text:["txt"],Textile:["textile"],Toml:["toml"],Twig:["twig|swig"],Typescript:["ts|typescript|str"],TSX:["tsx"],Vala:["vala"],VBScript:["vbs|vb"],Velocity:["vm"],Verilog:["v|vh|sv|svh"],VHDL:["vhd|vhdl"],Wollok:["wlk|wpgm|wtest"],XML:["xml|rdf|rss|wsdl|xslt|atom|mathml|mml|xul|xbl|xaml"],XQuery:["xq"],YAML:["yaml|yml"],Django:["html"]},nameOverrides={ObjectiveC:"Objective-C",CSharp:"C#",golang:"Go",C_Cpp:"C and C++",coffee:"CoffeeScript",HTML_Ruby:"HTML (Ruby)",HTML_Elixir:"HTML (Elixir)",FTL:"FreeMarker"},modesByName={};for(var name in supportedModes){var data=supportedModes[name],displayName=(nameOverrides[name]||name).replace(/_/g," "),filename=name.toLowerCase(),mode=new Mode(filename,displayName,data[0]);modesByName[filename]=mode,modes.push(mode)}module.exports={getModeForPath:getModeForPath,modes:modes,modesByName:modesByName}}),function(){ace.require(["ace/ext/modelist"],function(){})}(),define("ace/ext-modelist",function(){}),ace.define("ace/keyboard/vim",["require","exports","module","ace/range","ace/lib/event_emitter","ace/lib/dom","ace/lib/oop","ace/lib/keys","ace/lib/event","ace/search","ace/lib/useragent","ace/search_highlight","ace/commands/multi_select_commands","ace/mode/text","ace/multi_select"],function(require,exports,module){"use strict";function toAcePos(cmPos){return{row:cmPos.line,column:cmPos.ch}}function toCmPos(acePos){return new Pos(acePos.row,acePos.column)}function enterVimMode(cm){cm.setOption("disableInput",!0),cm.setOption("showCursorWhenSelecting",!1),CodeMirror.signal(cm,"vim-mode-change",{mode:"normal"}),cm.on("cursorActivity",onCursorActivity),maybeInitVimState(cm),CodeMirror.on(cm.getInputField(),"paste",getOnPasteFn(cm))}function leaveVimMode(cm){cm.setOption("disableInput",!1),cm.off("cursorActivity",onCursorActivity),CodeMirror.off(cm.getInputField(),"paste",getOnPasteFn(cm)),cm.state.vim=null}function detachVimMap(cm,next){this==CodeMirror.keyMap.vim&&CodeMirror.rmClass(cm.getWrapperElement(),"cm-fat-cursor"),next&&next.attach==attachVimMap||leaveVimMode(cm,!1)}function attachVimMap(cm,prev){this==CodeMirror.keyMap.vim&&CodeMirror.addClass(cm.getWrapperElement(),"cm-fat-cursor"),prev&&prev.attach==attachVimMap||enterVimMode(cm)}function cmKey(key,cm){if(cm){var vimKey=cmKeyToVimKey(key);if(!vimKey)return!1;var cmd=CodeMirror.Vim.findKey(cm,vimKey);return"function"==typeof cmd&&CodeMirror.signal(cm,"vim-keypress",vimKey),cmd}}function cmKeyToVimKey(key){if("'"==key.charAt(0))return key.charAt(1);var pieces=key.split(/-(?!$)/),lastPiece=pieces[pieces.length-1];if(1==pieces.length&&1==pieces[0].length)return!1;if(2==pieces.length&&"Shift"==pieces[0]&&1==lastPiece.length)return!1;for(var hasCharacter=!1,i=0;i<pieces.length;i++){var piece=pieces[i];piece in modifiers?pieces[i]=modifiers[piece]:hasCharacter=!0,piece in specialKeys&&(pieces[i]=specialKeys[piece])}return hasCharacter?(isUpperCase(lastPiece)&&(pieces[pieces.length-1]=lastPiece.toLowerCase()),"<"+pieces.join("-")+">"):!1}function getOnPasteFn(cm){var vim=cm.state.vim;return vim.onPasteFn||(vim.onPasteFn=function(){vim.insertMode||(cm.setCursor(offsetCursor(cm.getCursor(),0,1)),actions.enterInsertMode(cm,{},vim))}),vim.onPasteFn}function makeKeyRange(start,size){for(var keys=[],i=start;start+size>i;i++)keys.push(String.fromCharCode(i));return keys}function isLine(cm,line){return line>=cm.firstLine()&&line<=cm.lastLine()}function isLowerCase(k){return/^[a-z]$/.test(k)}function isMatchableSymbol(k){return-1!="()[]{}".indexOf(k)}function isNumber(k){return numberRegex.test(k)}function isUpperCase(k){return/^[A-Z]$/.test(k)}function isWhiteSpaceString(k){return/^\s*$/.test(k)}function inArray(val,arr){for(var i=0;i<arr.length;i++)if(arr[i]==val)return!0;return!1}function defineOption(name,defaultValue,type,aliases,callback){if(void 0===defaultValue&&!callback)throw Error("defaultValue is required unless callback is provided");if(type||(type="string"),options[name]={type:type,defaultValue:defaultValue,callback:callback},aliases)for(var i=0;i<aliases.length;i++)options[aliases[i]]=options[name];defaultValue&&setOption(name,defaultValue)}function setOption(name,value,cm,cfg){var option=options[name];cfg=cfg||{};var scope=cfg.scope;if(!option)throw Error("Unknown option: "+name);if("boolean"==option.type){if(value&&value!==!0)throw Error("Invalid argument: "+name+"="+value);value!==!1&&(value=!0)}option.callback?("local"!==scope&&option.callback(value,void 0),"global"!==scope&&cm&&option.callback(value,cm)):("local"!==scope&&(option.value="boolean"==option.type?!!value:value),"global"!==scope&&cm&&(cm.state.vim.options[name]={value:value}))}function getOption(name,cm,cfg){var option=options[name];cfg=cfg||{};var scope=cfg.scope;if(!option)throw Error("Unknown option: "+name);{if(!option.callback){var local="global"!==scope&&cm&&cm.state.vim.options[name];return(local||"local"!==scope&&option||{}).value}var local=cm&&option.callback(void 0,cm);if("global"!==scope&&void 0!==local)return local;if("local"!==scope)return option.callback()}}function MacroModeState(){this.latestRegister=void 0,this.isPlaying=!1,this.isRecording=!1,this.replaySearchQueries=[],this.onRecordingDone=void 0,this.lastInsertModeChanges=createInsertModeChanges()}function maybeInitVimState(cm){return cm.state.vim||(cm.state.vim={inputState:new InputState,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},fakeCursor:null,insertMode:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,lastPastedText:null,sel:{},options:{}}),cm.state.vim}function resetVimGlobalState(){vimGlobalState={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:createCircularJumpList(),macroModeState:new MacroModeState,lastChararacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new RegisterController({}),searchHistoryController:new HistoryController({}),exCommandHistoryController:new HistoryController({})};for(var optionName in options){var option=options[optionName];option.value=option.defaultValue}}function InputState(){this.prefixRepeat=[],this.motionRepeat=[],this.operator=null,this.operatorArgs=null,this.motion=null,this.motionArgs=null,this.keyBuffer=[],this.registerName=null}function clearInputState(cm,reason){cm.state.vim.inputState=new InputState,CodeMirror.signal(cm,"vim-command-done",reason)}function Register(text,linewise,blockwise){this.clear(),this.keyBuffer=[text||""],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!!linewise,this.blockwise=!!blockwise}function defineRegister(name,register){var registers=vimGlobalState.registerController.registers[name];if(!name||1!=name.length)throw Error("Register name must be 1 character");registers[name]=register,validRegisters.push(name)}function RegisterController(registers){this.registers=registers,this.unnamedRegister=registers['"']=new Register,registers["."]=new Register,registers[":"]=new Register,registers["/"]=new Register}function HistoryController(){this.historyBuffer=[],this.iterator,this.initialPrefix=null}function defineMotion(name,fn){
motions[name]=fn}function fillArray(val,times){for(var arr=[],i=0;times>i;i++)arr.push(val);return arr}function defineOperator(name,fn){operators[name]=fn}function defineAction(name,fn){actions[name]=fn}function clipCursorToContent(cm,cur,includeLineBreak){var line=Math.min(Math.max(cm.firstLine(),cur.line),cm.lastLine()),maxCh=lineLength(cm,line)-1;maxCh=includeLineBreak?maxCh+1:maxCh;var ch=Math.min(Math.max(0,cur.ch),maxCh);return Pos(line,ch)}function copyArgs(args){var ret={};for(var prop in args)args.hasOwnProperty(prop)&&(ret[prop]=args[prop]);return ret}function offsetCursor(cur,offsetLine,offsetCh){return"object"==typeof offsetLine&&(offsetCh=offsetLine.ch,offsetLine=offsetLine.line),Pos(cur.line+offsetLine,cur.ch+offsetCh)}function getOffset(anchor,head){return{line:head.line-anchor.line,ch:head.line-anchor.line}}function commandMatches(keys,keyMap,context,inputState){for(var match,partial=[],full=[],i=0;i<keyMap.length;i++){var command=keyMap[i];"insert"==context&&"insert"!=command.context||command.context&&command.context!=context||inputState.operator&&"action"==command.type||!(match=commandMatch(keys,command.keys))||("partial"==match&&partial.push(command),"full"==match&&full.push(command))}return{partial:partial.length&&partial,full:full.length&&full}}function commandMatch(pressed,mapped){if("<character>"==mapped.slice(-11)){var prefixLen=mapped.length-11,pressedPrefix=pressed.slice(0,prefixLen),mappedPrefix=mapped.slice(0,prefixLen);return pressedPrefix==mappedPrefix&&pressed.length>prefixLen?"full":0==mappedPrefix.indexOf(pressedPrefix)?"partial":!1}return pressed==mapped?"full":0==mapped.indexOf(pressed)?"partial":!1}function lastChar(keys){var match=/^.*(<[\w\-]+>)$/.exec(keys),selectedCharacter=match?match[1]:keys.slice(-1);if(selectedCharacter.length>1)switch(selectedCharacter){case"<CR>":selectedCharacter="\n";break;case"<Space>":selectedCharacter=" "}return selectedCharacter}function repeatFn(cm,fn,repeat){return function(){for(var i=0;repeat>i;i++)fn(cm)}}function copyCursor(cur){return Pos(cur.line,cur.ch)}function cursorEqual(cur1,cur2){return cur1.ch==cur2.ch&&cur1.line==cur2.line}function cursorIsBefore(cur1,cur2){return cur1.line<cur2.line?!0:cur1.line==cur2.line&&cur1.ch<cur2.ch?!0:!1}function cursorMin(cur1,cur2){return arguments.length>2&&(cur2=cursorMin.apply(void 0,Array.prototype.slice.call(arguments,1))),cursorIsBefore(cur1,cur2)?cur1:cur2}function cursorMax(cur1,cur2){return arguments.length>2&&(cur2=cursorMax.apply(void 0,Array.prototype.slice.call(arguments,1))),cursorIsBefore(cur1,cur2)?cur2:cur1}function cursorIsBetween(cur1,cur2,cur3){var cur1before2=cursorIsBefore(cur1,cur2),cur2before3=cursorIsBefore(cur2,cur3);return cur1before2&&cur2before3}function lineLength(cm,lineNum){return cm.getLine(lineNum).length}function trim(s){return s.trim?s.trim():s.replace(/^\s+|\s+$/g,"")}function escapeRegex(s){return s.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function extendLineToColumn(cm,lineNum,column){var endCh=lineLength(cm,lineNum),spaces=new Array(column-endCh+1).join(" ");cm.setCursor(Pos(lineNum,endCh)),cm.replaceRange(spaces,cm.getCursor())}function selectBlock(cm,selectionEnd){var selections=[],ranges=cm.listSelections(),head=copyCursor(cm.clipPos(selectionEnd)),isClipped=!cursorEqual(selectionEnd,head),curHead=cm.getCursor("head"),primIndex=getIndex(ranges,curHead),wasClipped=cursorEqual(ranges[primIndex].head,ranges[primIndex].anchor),max=ranges.length-1,index=max-primIndex>primIndex?max:0,base=ranges[index].anchor,firstLine=Math.min(base.line,head.line),lastLine=Math.max(base.line,head.line),baseCh=base.ch,headCh=head.ch,dir=ranges[index].head.ch-baseCh,newDir=headCh-baseCh;dir>0&&0>=newDir?(baseCh++,isClipped||headCh--):0>dir&&newDir>=0?(baseCh--,wasClipped||headCh++):0>dir&&-1==newDir&&(baseCh--,headCh++);for(var line=firstLine;lastLine>=line;line++){var range={anchor:new Pos(line,baseCh),head:new Pos(line,headCh)};selections.push(range)}return primIndex=head.line==lastLine?selections.length-1:0,cm.setSelections(selections),selectionEnd.ch=headCh,base.ch=baseCh,base}function selectForInsert(cm,head,height){for(var sel=[],i=0;height>i;i++){var lineHead=offsetCursor(head,i,0);sel.push({anchor:lineHead,head:lineHead})}cm.setSelections(sel,0)}function getIndex(ranges,cursor,end){for(var i=0;i<ranges.length;i++){var atAnchor="head"!=end&&cursorEqual(ranges[i].anchor,cursor),atHead="anchor"!=end&&cursorEqual(ranges[i].head,cursor);if(atAnchor||atHead)return i}return-1}function getSelectedAreaRange(cm,vim){var lastSelection=vim.lastSelection,getCurrentSelectedAreaRange=function(){var selections=cm.listSelections(),start=selections[0],end=selections[selections.length-1],selectionStart=cursorIsBefore(start.anchor,start.head)?start.anchor:start.head,selectionEnd=cursorIsBefore(end.anchor,end.head)?end.head:end.anchor;return[selectionStart,selectionEnd]},getLastSelectedAreaRange=function(){var selectionStart=cm.getCursor(),selectionEnd=cm.getCursor(),block=lastSelection.visualBlock;if(block){var width=block.width,height=block.height;selectionEnd=Pos(selectionStart.line+height,selectionStart.ch+width);for(var selections=[],i=selectionStart.line;i<selectionEnd.line;i++){var anchor=Pos(i,selectionStart.ch),head=Pos(i,selectionEnd.ch),range={anchor:anchor,head:head};selections.push(range)}cm.setSelections(selections)}else{var start=lastSelection.anchorMark.find(),end=lastSelection.headMark.find(),line=end.line-start.line,ch=end.ch-start.ch;selectionEnd={line:selectionEnd.line+line,ch:line?selectionEnd.ch:ch+selectionEnd.ch},lastSelection.visualLine&&(selectionStart=Pos(selectionStart.line,0),selectionEnd=Pos(selectionEnd.line,lineLength(cm,selectionEnd.line))),cm.setSelection(selectionStart,selectionEnd)}return[selectionStart,selectionEnd]};return vim.visualMode?getCurrentSelectedAreaRange():getLastSelectedAreaRange()}function updateLastSelection(cm,vim){var anchor=vim.sel.anchor,head=vim.sel.head;vim.lastPastedText&&(head=cm.posFromIndex(cm.indexFromPos(anchor)+vim.lastPastedText.length),vim.lastPastedText=null),vim.lastSelection={anchorMark:cm.setBookmark(anchor),headMark:cm.setBookmark(head),anchor:copyCursor(anchor),head:copyCursor(head),visualMode:vim.visualMode,visualLine:vim.visualLine,visualBlock:vim.visualBlock}}function expandSelection(cm,start,end){var tmp,sel=cm.state.vim.sel,head=sel.head,anchor=sel.anchor;return cursorIsBefore(end,start)&&(tmp=end,end=start,start=tmp),cursorIsBefore(head,anchor)?(head=cursorMin(start,head),anchor=cursorMax(anchor,end)):(anchor=cursorMin(start,anchor),head=cursorMax(head,end),head=offsetCursor(head,0,-1),-1==head.ch&&head.line!=cm.firstLine()&&(head=Pos(head.line-1,lineLength(cm,head.line-1)))),[anchor,head]}function updateCmSelection(cm,sel,mode){var vim=cm.state.vim;sel=sel||vim.sel;var mode=mode||vim.visualLine?"line":vim.visualBlock?"block":"char",cmSel=makeCmSelection(cm,sel,mode);cm.setSelections(cmSel.ranges,cmSel.primary),updateFakeCursor(cm)}function makeCmSelection(cm,sel,mode,exclusive){var head=copyCursor(sel.head),anchor=copyCursor(sel.anchor);if("char"==mode){var headOffset=exclusive||cursorIsBefore(sel.head,sel.anchor)?0:1,anchorOffset=cursorIsBefore(sel.head,sel.anchor)?1:0;return head=offsetCursor(sel.head,0,headOffset),anchor=offsetCursor(sel.anchor,0,anchorOffset),{ranges:[{anchor:anchor,head:head}],primary:0}}if("line"==mode){if(cursorIsBefore(sel.head,sel.anchor))head.ch=0,anchor.ch=lineLength(cm,anchor.line);else{anchor.ch=0;var lastLine=cm.lastLine();head.line>lastLine&&(head.line=lastLine),head.ch=lineLength(cm,head.line)}return{ranges:[{anchor:anchor,head:head}],primary:0}}if("block"==mode){for(var top=Math.min(anchor.line,head.line),left=Math.min(anchor.ch,head.ch),bottom=Math.max(anchor.line,head.line),right=Math.max(anchor.ch,head.ch)+1,height=bottom-top+1,primary=head.line==top?0:height-1,ranges=[],i=0;height>i;i++)ranges.push({anchor:Pos(top+i,left),head:Pos(top+i,right)});return{ranges:ranges,primary:primary}}}function getHead(cm){var cur=cm.getCursor("head");return 1==cm.getSelection().length&&(cur=cursorMin(cur,cm.getCursor("anchor"))),cur}function exitVisualMode(cm,moveHead){var vim=cm.state.vim;moveHead!==!1&&cm.setCursor(clipCursorToContent(cm,vim.sel.head)),updateLastSelection(cm,vim),vim.visualMode=!1,vim.visualLine=!1,vim.visualBlock=!1,CodeMirror.signal(cm,"vim-mode-change",{mode:"normal"}),vim.fakeCursor&&vim.fakeCursor.clear()}function clipToLine(cm,curStart,curEnd){var selection=cm.getRange(curStart,curEnd);if(/\n\s*$/.test(selection)){var lines=selection.split("\n");lines.pop();for(var line,line=lines.pop();lines.length>0&&line&&isWhiteSpaceString(line);line=lines.pop())curEnd.line--,curEnd.ch=0;line?(curEnd.line--,curEnd.ch=lineLength(cm,curEnd.line)):curEnd.ch=0}}function expandSelectionToLine(_cm,curStart,curEnd){curStart.ch=0,curEnd.ch=0,curEnd.line++}function findFirstNonWhiteSpaceCharacter(text){if(!text)return 0;var firstNonWS=text.search(/\S/);return-1==firstNonWS?text.length:firstNonWS}function expandWordUnderCursor(cm,inclusive,_forward,bigWord,noSymbol){for(var cur=getHead(cm),line=cm.getLine(cur.line),idx=cur.ch,test=noSymbol?wordCharTest[0]:bigWordCharTest[0];!test(line.charAt(idx));)if(idx++,idx>=line.length)return null;bigWord?test=bigWordCharTest[0]:(test=wordCharTest[0],test(line.charAt(idx))||(test=wordCharTest[1]));for(var end=idx,start=idx;test(line.charAt(end))&&end<line.length;)end++;for(;test(line.charAt(start))&&start>=0;)start--;if(start++,inclusive){for(var wordEnd=end;/\s/.test(line.charAt(end))&&end<line.length;)end++;if(wordEnd==end){for(var wordStart=start;/\s/.test(line.charAt(start-1))&&start>0;)start--;start||(start=wordStart)}}return{start:Pos(cur.line,start),end:Pos(cur.line,end)}}function recordJumpPosition(cm,oldCur,newCur){cursorEqual(oldCur,newCur)||vimGlobalState.jumpList.add(cm,oldCur,newCur)}function recordLastCharacterSearch(increment,args){vimGlobalState.lastChararacterSearch.increment=increment,vimGlobalState.lastChararacterSearch.forward=args.forward,vimGlobalState.lastChararacterSearch.selectedCharacter=args.selectedCharacter}function findSymbol(cm,repeat,forward,symb){var cur=copyCursor(cm.getCursor()),increment=forward?1:-1,endLine=forward?cm.lineCount():-1,curCh=cur.ch,line=cur.line,lineText=cm.getLine(line),state={lineText:lineText,nextCh:lineText.charAt(curCh),lastCh:null,index:curCh,symb:symb,reverseSymb:(forward?{")":"(","}":"{"}:{"(":")","{":"}"})[symb],forward:forward,depth:0,curMoveThrough:!1},mode=symbolToMode[symb];if(!mode)return cur;var init=findSymbolModes[mode].init,isComplete=findSymbolModes[mode].isComplete;for(init&&init(state);line!==endLine&&repeat;){if(state.index+=increment,state.nextCh=state.lineText.charAt(state.index),!state.nextCh){if(line+=increment,state.lineText=cm.getLine(line)||"",increment>0)state.index=0;else{var lineLen=state.lineText.length;state.index=lineLen>0?lineLen-1:0}state.nextCh=state.lineText.charAt(state.index)}isComplete(state)&&(cur.line=line,cur.ch=state.index,repeat--)}return state.nextCh||state.curMoveThrough?Pos(line,state.index):cur}function findWord(cm,cur,forward,bigWord,emptyLineIsWord){var lineNum=cur.line,pos=cur.ch,line=cm.getLine(lineNum),dir=forward?1:-1,charTests=bigWord?bigWordCharTest:wordCharTest;if(emptyLineIsWord&&""==line){if(lineNum+=dir,line=cm.getLine(lineNum),!isLine(cm,lineNum))return null;pos=forward?0:line.length}for(;;){if(emptyLineIsWord&&""==line)return{from:0,to:0,line:lineNum};for(var stop=dir>0?line.length:-1,wordStart=stop,wordEnd=stop;pos!=stop;){for(var foundWord=!1,i=0;i<charTests.length&&!foundWord;++i)if(charTests[i](line.charAt(pos))){for(wordStart=pos;pos!=stop&&charTests[i](line.charAt(pos));)pos+=dir;if(wordEnd=pos,foundWord=wordStart!=wordEnd,wordStart==cur.ch&&lineNum==cur.line&&wordEnd==wordStart+dir)continue;return{from:Math.min(wordStart,wordEnd+1),to:Math.max(wordStart,wordEnd),line:lineNum}}foundWord||(pos+=dir)}if(lineNum+=dir,!isLine(cm,lineNum))return null;line=cm.getLine(lineNum),pos=dir>0?0:line.length}throw new Error("The impossible happened.")}function moveToWord(cm,cur,repeat,forward,wordEnd,bigWord){var curStart=copyCursor(cur),words=[];(forward&&!wordEnd||!forward&&wordEnd)&&repeat++;for(var emptyLineIsWord=!(forward&&wordEnd),i=0;repeat>i;i++){var word=findWord(cm,cur,forward,bigWord,emptyLineIsWord);if(!word){var eodCh=lineLength(cm,cm.lastLine());words.push(forward?{line:cm.lastLine(),from:eodCh,to:eodCh}:{line:0,from:0,to:0});break}words.push(word),cur=Pos(word.line,forward?word.to-1:word.from)}var shortCircuit=words.length!=repeat,firstWord=words[0],lastWord=words.pop();return forward&&!wordEnd?(shortCircuit||firstWord.from==curStart.ch&&firstWord.line==curStart.line||(lastWord=words.pop()),Pos(lastWord.line,lastWord.from)):forward&&wordEnd?Pos(lastWord.line,lastWord.to-1):!forward&&wordEnd?(shortCircuit||firstWord.to==curStart.ch&&firstWord.line==curStart.line||(lastWord=words.pop()),Pos(lastWord.line,lastWord.to)):Pos(lastWord.line,lastWord.from)}function moveToCharacter(cm,repeat,forward,character){for(var idx,cur=cm.getCursor(),start=cur.ch,i=0;repeat>i;i++){var line=cm.getLine(cur.line);if(idx=charIdxInLine(start,line,character,forward,!0),-1==idx)return null;start=idx}return Pos(cm.getCursor().line,idx)}function moveToColumn(cm,repeat){var line=cm.getCursor().line;return clipCursorToContent(cm,Pos(line,repeat-1))}function updateMark(cm,vim,markName,pos){inArray(markName,validMarks)&&(vim.marks[markName]&&vim.marks[markName].clear(),vim.marks[markName]=cm.setBookmark(pos))}function charIdxInLine(start,line,character,forward,includeChar){var idx;return forward?(idx=line.indexOf(character,start+1),-1==idx||includeChar||(idx-=1)):(idx=line.lastIndexOf(character,start-1),-1==idx||includeChar||(idx+=1)),idx}function findParagraph(cm,head,repeat,dir,inclusive){function isEmpty(i){return!/\S/.test(cm.getLine(i))}function isBoundary(i,dir,any){return any?isEmpty(i)!=isEmpty(i+dir):!isEmpty(i)&&isEmpty(i+dir)}function skipFold(i){dir=dir>0?1:-1;var foldLine=cm.ace.session.getFoldLine(i);foldLine&&i+dir>foldLine.start.row&&i+dir<foldLine.end.row&&(dir=(dir>0?foldLine.end.row:foldLine.start.row)-i)}var start,end,line=head.line,min=cm.firstLine(),max=cm.lastLine(),i=line;if(dir){for(;i>=min&&max>=i&&repeat>0;)skipFold(i),isBoundary(i,dir)&&repeat--,i+=dir;return new Pos(i,0)}var vim=cm.state.vim;if(vim.visualLine&&isBoundary(line,1,!0)){var anchor=vim.sel.anchor;isBoundary(anchor.line,-1,!0)&&(inclusive&&anchor.line==line||(line+=1))}var startState=isEmpty(line);for(i=line;max>=i&&repeat;i++)isBoundary(i,1,!0)&&(inclusive&&isEmpty(i)==startState||repeat--);for(end=new Pos(i,0),i>max&&!startState?startState=!0:inclusive=!1,i=line;i>min&&(inclusive&&isEmpty(i)!=startState&&i!=line||!isBoundary(i,-1,!0));i--);return start=new Pos(i,0),{start:start,end:end}}function selectCompanionObject(cm,head,symb,inclusive){var start,end,cur=head,bracketRegexp={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/}[symb],openSym={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{"}[symb],curChar=cm.getLine(cur.line).charAt(cur.ch),offset=curChar===openSym?1:0;if(start=cm.scanForBracket(Pos(cur.line,cur.ch+offset),-1,null,{bracketRegex:bracketRegexp}),end=cm.scanForBracket(Pos(cur.line,cur.ch+offset),1,null,{bracketRegex:bracketRegexp}),!start||!end)return{start:cur,end:cur};if(start=start.pos,end=end.pos,start.line==end.line&&start.ch>end.ch||start.line>end.line){var tmp=start;start=end,end=tmp}return inclusive?end.ch+=1:start.ch+=1,{start:start,end:end}}function findBeginningAndEnd(cm,head,symb,inclusive){var start,end,i,len,cur=copyCursor(head),line=cm.getLine(cur.line),chars=line.split(""),firstIndex=chars.indexOf(symb);if(cur.ch<firstIndex?cur.ch=firstIndex:firstIndex<cur.ch&&chars[cur.ch]==symb&&(end=cur.ch,--cur.ch),chars[cur.ch]!=symb||end)for(i=cur.ch;i>-1&&!start;i--)chars[i]==symb&&(start=i+1);else start=cur.ch+1;if(start&&!end)for(i=start,len=chars.length;len>i&&!end;i++)chars[i]==symb&&(end=i);return start&&end?(inclusive&&(--start,++end),{start:Pos(cur.line,start),end:Pos(cur.line,end)}):{start:cur,end:cur}}function SearchState(){}function getSearchState(cm){var vim=cm.state.vim;return vim.searchState_||(vim.searchState_=new SearchState)}function dialog(cm,template,shortText,onClose,options){cm.openDialog?cm.openDialog(template,onClose,{bottom:!0,value:options.value,onKeyDown:options.onKeyDown,onKeyUp:options.onKeyUp,selectValueOnOpen:!1}):onClose(prompt(shortText,""))}function splitBySlash(argString){var slashes=findUnescapedSlashes(argString)||[];if(!slashes.length)return[];var tokens=[];if(0===slashes[0]){for(var i=0;i<slashes.length;i++)"number"==typeof slashes[i]&&tokens.push(argString.substring(slashes[i]+1,slashes[i+1]));return tokens}}function findUnescapedSlashes(str){for(var escapeNextChar=!1,slashes=[],i=0;i<str.length;i++){var c=str.charAt(i);escapeNextChar||"/"!=c||slashes.push(i),escapeNextChar=!escapeNextChar&&"\\"==c}return slashes}function translateRegex(str){for(var specials="|(){",unescape="}",escapeNextChar=!1,out=[],i=-1;i<str.length;i++){var c=str.charAt(i)||"",n=str.charAt(i+1)||"",specialComesNext=n&&-1!=specials.indexOf(n);escapeNextChar?("\\"===c&&specialComesNext||out.push(c),escapeNextChar=!1):"\\"===c?(escapeNextChar=!0,n&&-1!=unescape.indexOf(n)&&(specialComesNext=!0),specialComesNext&&"\\"!==n||out.push(c)):(out.push(c),specialComesNext&&"\\"!==n&&out.push("\\"))}return out.join("")}function translateRegexReplace(str){for(var escapeNextChar=!1,out=[],i=-1;i<str.length;i++){var c=str.charAt(i)||"",n=str.charAt(i+1)||"";charUnescapes[c+n]?(out.push(charUnescapes[c+n]),i++):escapeNextChar?(out.push(c),escapeNextChar=!1):"\\"===c?(escapeNextChar=!0,isNumber(n)||"$"===n?out.push("$"):"/"!==n&&"\\"!==n&&out.push("\\")):("$"===c&&out.push("$"),out.push(c),"/"===n&&out.push("\\"))}return out.join("")}function unescapeRegexReplace(str){for(var stream=new CodeMirror.StringStream(str),output=[];!stream.eol();){for(;stream.peek()&&"\\"!=stream.peek();)output.push(stream.next());var matched=!1;for(var matcher in unescapes)if(stream.match(matcher,!0)){matched=!0,output.push(unescapes[matcher]);break}matched||output.push(stream.next())}return output.join("")}function parseQuery(query,ignoreCase,smartCase){var lastSearchRegister=vimGlobalState.registerController.getRegister("/");if(lastSearchRegister.setText(query),query instanceof RegExp)return query;var regexPart,forceIgnoreCase,slashes=findUnescapedSlashes(query);if(slashes.length){regexPart=query.substring(0,slashes[0]);var flagsPart=query.substring(slashes[0]);forceIgnoreCase=-1!=flagsPart.indexOf("i")}else regexPart=query;if(!regexPart)return null;getOption("pcre")||(regexPart=translateRegex(regexPart)),smartCase&&(ignoreCase=/^[^A-Z]*$/.test(regexPart));var regexp=new RegExp(regexPart,ignoreCase||forceIgnoreCase?"i":void 0);return regexp}function showConfirm(cm,text){cm.openNotification?cm.openNotification('<span style="color: red">'+text+"</span>",{bottom:!0,duration:5e3}):alert(text)}function makePrompt(prefix,desc){var raw="";return prefix&&(raw+='<span style="font-family: monospace">'+prefix+"</span>"),raw+='<input type="text"/> <span style="color: #888">',desc&&(raw+='<span style="color: #888">',raw+=desc,raw+="</span>"),raw}function showPrompt(cm,options){var shortText=(options.prefix||"")+" "+(options.desc||""),prompt=makePrompt(options.prefix,options.desc);dialog(cm,prompt,shortText,options.onClose,options)}function regexEqual(r1,r2){if(r1 instanceof RegExp&&r2 instanceof RegExp){for(var props=["global","multiline","ignoreCase","source"],i=0;i<props.length;i++){var prop=props[i];if(r1[prop]!==r2[prop])return!1}return!0}return!1}function updateSearchQuery(cm,rawQuery,ignoreCase,smartCase){if(rawQuery){var state=getSearchState(cm),query=parseQuery(rawQuery,!!ignoreCase,!!smartCase);if(query)return highlightSearchMatches(cm,query),regexEqual(query,state.getQuery())?query:(state.setQuery(query),query)}}function searchOverlay(query){if("^"==query.source.charAt(0))var matchSol=!0;return{token:function(stream){if(matchSol&&!stream.sol())return void stream.skipToEnd();var match=stream.match(query,!1);if(match)return 0==match[0].length?(stream.next(),"searching"):stream.sol()||(stream.backUp(1),query.exec(stream.next()+match[0]))?(stream.match(query),"searching"):(stream.next(),null);for(;!stream.eol()&&(stream.next(),!stream.match(query,!1)););},query:query}}function highlightSearchMatches(cm,query){var searchState=getSearchState(cm),overlay=searchState.getOverlay();overlay&&query==overlay.query||(overlay&&cm.removeOverlay(overlay),overlay=searchOverlay(query),cm.addOverlay(overlay),cm.showMatchesOnScrollbar&&(searchState.getScrollbarAnnotate()&&searchState.getScrollbarAnnotate().clear(),searchState.setScrollbarAnnotate(cm.showMatchesOnScrollbar(query))),searchState.setOverlay(overlay))}function findNext(cm,prev,query,repeat){return void 0===repeat&&(repeat=1),cm.operation(function(){for(var pos=cm.getCursor(),cursor=cm.getSearchCursor(query,pos),i=0;repeat>i;i++){var found=cursor.find(prev);if(0==i&&found&&cursorEqual(cursor.from(),pos)&&(found=cursor.find(prev)),!found&&(cursor=cm.getSearchCursor(query,prev?Pos(cm.lastLine()):Pos(cm.firstLine(),0)),!cursor.find(prev)))return}return cursor.from()})}function clearSearchHighlight(cm){var state=getSearchState(cm);cm.removeOverlay(getSearchState(cm).getOverlay()),state.setOverlay(null),state.getScrollbarAnnotate()&&(state.getScrollbarAnnotate().clear(),state.setScrollbarAnnotate(null))}function isInRange(pos,start,end){return"number"!=typeof pos&&(pos=pos.line),start instanceof Array?inArray(pos,start):end?pos>=start&&end>=pos:pos==start}function getUserVisibleLines(cm){var renderer=cm.ace.renderer;return{top:renderer.getFirstFullyVisibleRow(),bottom:renderer.getLastFullyVisibleRow()}}function doReplace(cm,confirm,global,lineStart,lineEnd,searchCursor,query,replaceWith,callback){function replaceAll(){cm.operation(function(){for(;!done;)replace(),next();stop()})}function replace(){var text=cm.getRange(searchCursor.from(),searchCursor.to()),newText=text.replace(query,replaceWith);searchCursor.replace(newText)}function next(){for(;searchCursor.findNext()&&isInRange(searchCursor.from(),lineStart,lineEnd);)if(global||!lastPos||searchCursor.from().line!=lastPos.line)return cm.scrollIntoView(searchCursor.from(),30),cm.setSelection(searchCursor.from(),searchCursor.to()),lastPos=searchCursor.from(),void(done=!1);done=!0}function stop(close){if(close&&close(),cm.focus(),lastPos){cm.setCursor(lastPos);var vim=cm.state.vim;vim.exMode=!1,vim.lastHPos=vim.lastHSPos=lastPos.ch}callback&&callback()}function onPromptKeyDown(e,_value,close){CodeMirror.e_stop(e);var keyName=CodeMirror.keyName(e);switch(keyName){case"Y":replace(),next();break;case"N":next();break;case"A":var savedCallback=callback;callback=void 0,cm.operation(replaceAll),callback=savedCallback;break;case"L":replace();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":stop(close)}return done&&stop(close),!0}cm.state.vim.exMode=!0;var done=!1,lastPos=searchCursor.from();return next(),done?void showConfirm(cm,"No matches for "+query.source):confirm?void showPrompt(cm,{prefix:"replace with <strong>"+replaceWith+"</strong> (y/n/a/q/l)",onKeyDown:onPromptKeyDown}):(replaceAll(),void(callback&&callback()))}function exitInsertMode(cm){var vim=cm.state.vim,macroModeState=vimGlobalState.macroModeState,insertModeChangeRegister=vimGlobalState.registerController.getRegister("."),isPlaying=macroModeState.isPlaying,lastChange=macroModeState.lastInsertModeChanges,text=[];if(!isPlaying){for(var selLength=lastChange.inVisualBlock?vim.lastSelection.visualBlock.height:1,changes=lastChange.changes,text=[],i=0;i<changes.length;)text.push(changes[i]),changes[i]instanceof InsertModeKey?i++:i+=selLength;lastChange.changes=text,cm.off("change",onChange),CodeMirror.off(cm.getInputField(),"keydown",onKeyEventTargetKeyDown)}!isPlaying&&vim.insertModeRepeat>1&&(repeatLastEdit(cm,vim,vim.insertModeRepeat-1,!0),vim.lastEditInputState.repeatOverride=vim.insertModeRepeat),delete vim.insertModeRepeat,vim.insertMode=!1,cm.setCursor(cm.getCursor().line,cm.getCursor().ch-1),cm.setOption("keyMap","vim"),cm.setOption("disableInput",!0),cm.toggleOverwrite(!1),insertModeChangeRegister.setText(lastChange.changes.join("")),CodeMirror.signal(cm,"vim-mode-change",{mode:"normal"}),macroModeState.isRecording&&logInsertModeChange(macroModeState)}function _mapCommand(command){defaultKeymap.unshift(command)}function mapCommand(keys,type,name,args,extra){var command={keys:keys,type:type};command[type]=name,command[type+"Args"]=args;for(var key in extra)command[key]=extra[key];_mapCommand(command)}function executeMacroRegister(cm,vim,macroModeState,registerName){var register=vimGlobalState.registerController.getRegister(registerName);if(":"==registerName)return register.keyBuffer[0]&&exCommandDispatcher.processCommand(cm,register.keyBuffer[0]),void(macroModeState.isPlaying=!1);var keyBuffer=register.keyBuffer,imc=0;macroModeState.isPlaying=!0,macroModeState.replaySearchQueries=register.searchQueries.slice(0);for(var i=0;i<keyBuffer.length;i++)for(var match,key,text=keyBuffer[i];text;)if(match=/<\w+-.+?>|<\w+>|./.exec(text),key=match[0],text=text.substring(match.index+key.length),CodeMirror.Vim.handleKey(cm,key,"macro"),vim.insertMode){var changes=register.insertModeChanges[imc++].changes;vimGlobalState.macroModeState.lastInsertModeChanges.changes=changes,repeatInsertModeChanges(cm,changes,1),exitInsertMode(cm)}macroModeState.isPlaying=!1}function logKey(macroModeState,key){if(!macroModeState.isPlaying){var registerName=macroModeState.latestRegister,register=vimGlobalState.registerController.getRegister(registerName);register&&register.pushText(key)}}function logInsertModeChange(macroModeState){if(!macroModeState.isPlaying){var registerName=macroModeState.latestRegister,register=vimGlobalState.registerController.getRegister(registerName);register&&register.pushInsertModeChanges&&register.pushInsertModeChanges(macroModeState.lastInsertModeChanges)}}function logSearchQuery(macroModeState,query){if(!macroModeState.isPlaying){var registerName=macroModeState.latestRegister,register=vimGlobalState.registerController.getRegister(registerName);register&&register.pushSearchQuery&&register.pushSearchQuery(query)}}function onChange(_cm,changeObj){var macroModeState=vimGlobalState.macroModeState,lastChange=macroModeState.lastInsertModeChanges;if(!macroModeState.isPlaying)for(;changeObj;){if(lastChange.expectCursorActivityForChange=!0,"+input"==changeObj.origin||"paste"==changeObj.origin||void 0===changeObj.origin){var text=changeObj.text.join("\n");lastChange.maybeReset&&(lastChange.changes=[],lastChange.maybeReset=!1),lastChange.changes.push(text)}changeObj=changeObj.next}}function onCursorActivity(cm){var vim=cm.state.vim;if(vim.insertMode){var macroModeState=vimGlobalState.macroModeState;if(macroModeState.isPlaying)return;var lastChange=macroModeState.lastInsertModeChanges;lastChange.expectCursorActivityForChange?lastChange.expectCursorActivityForChange=!1:lastChange.maybeReset=!0}else cm.curOp.isVimOp||handleExternalSelection(cm,vim);vim.visualMode&&updateFakeCursor(cm)}function updateFakeCursor(cm){var vim=cm.state.vim,from=clipCursorToContent(cm,copyCursor(vim.sel.head)),to=offsetCursor(from,0,1);vim.fakeCursor&&vim.fakeCursor.clear(),vim.fakeCursor=cm.markText(from,to,{className:"cm-animate-fat-cursor"})}function handleExternalSelection(cm,vim){var anchor=cm.getCursor("anchor"),head=cm.getCursor("head");if(vim.visualMode&&!cm.somethingSelected()?exitVisualMode(cm,!1):vim.visualMode||vim.insertMode||!cm.somethingSelected()||(vim.visualMode=!0,vim.visualLine=!1,CodeMirror.signal(cm,"vim-mode-change",{mode:"visual"})),vim.visualMode){var headOffset=cursorIsBefore(head,anchor)?0:-1,anchorOffset=cursorIsBefore(head,anchor)?-1:0;head=offsetCursor(head,0,headOffset),anchor=offsetCursor(anchor,0,anchorOffset),vim.sel={anchor:anchor,head:head},updateMark(cm,vim,"<",cursorMin(head,anchor)),updateMark(cm,vim,">",cursorMax(head,anchor))}else vim.insertMode||(vim.lastHPos=cm.getCursor().ch)}function InsertModeKey(keyName){this.keyName=keyName}function onKeyEventTargetKeyDown(e){function onKeyFound(){return lastChange.maybeReset&&(lastChange.changes=[],lastChange.maybeReset=!1),lastChange.changes.push(new InsertModeKey(keyName)),!0}var macroModeState=vimGlobalState.macroModeState,lastChange=macroModeState.lastInsertModeChanges,keyName=CodeMirror.keyName(e);keyName&&(-1!=keyName.indexOf("Delete")||-1!=keyName.indexOf("Backspace"))&&CodeMirror.lookupKey(keyName,"vim-insert",onKeyFound)}function repeatLastEdit(cm,vim,repeat,repeatForInsert){function repeatCommand(){isAction?commandDispatcher.processAction(cm,vim,vim.lastEditActionCommand):commandDispatcher.evalInput(cm,vim)}function repeatInsert(repeat){if(macroModeState.lastInsertModeChanges.changes.length>0){repeat=vim.lastEditActionCommand?repeat:1;var changeObject=macroModeState.lastInsertModeChanges;repeatInsertModeChanges(cm,changeObject.changes,repeat)}}var macroModeState=vimGlobalState.macroModeState;macroModeState.isPlaying=!0;var isAction=!!vim.lastEditActionCommand,cachedInputState=vim.inputState;if(vim.inputState=vim.lastEditInputState,isAction&&vim.lastEditActionCommand.interlaceInsertRepeat)for(var i=0;repeat>i;i++)repeatCommand(),repeatInsert(1);else repeatForInsert||repeatCommand(),repeatInsert(repeat);vim.inputState=cachedInputState,vim.insertMode&&!repeatForInsert&&exitInsertMode(cm),macroModeState.isPlaying=!1}function repeatInsertModeChanges(cm,changes,repeat){function keyHandler(binding){return"string"==typeof binding?CodeMirror.commands[binding](cm):binding(cm),!0}var head=cm.getCursor("head"),inVisualBlock=vimGlobalState.macroModeState.lastInsertModeChanges.inVisualBlock;if(inVisualBlock){var vim=cm.state.vim,lastSel=vim.lastSelection,offset=getOffset(lastSel.anchor,lastSel.head);selectForInsert(cm,head,offset.line+1),repeat=cm.listSelections().length,cm.setCursor(head)}for(var i=0;repeat>i;i++){inVisualBlock&&cm.setCursor(offsetCursor(head,i,0));for(var j=0;j<changes.length;j++){var change=changes[j];if(change instanceof InsertModeKey)CodeMirror.lookupKey(change.keyName,"vim-insert",keyHandler);else{var cur=cm.getCursor();cm.replaceRange(change,cur,cur)}}}inVisualBlock&&cm.setCursor(offsetCursor(head,0,1))}function lookupKey(hashId,key,e){key.length>1&&"n"==key[0]&&(key=key.replace("numpad","")),key=specialKey[key]||key;var name="";return e.ctrlKey&&(name+="C-"),e.altKey&&(name+="A-"),e.shiftKey&&(name+="S-"),name+=key,name.length>1&&(name="<"+name+">"),name}function cloneVimState(state){var n=new state.constructor;return Object.keys(state).forEach(function(key){var o=state[key];Array.isArray(o)?o=o.slice():o&&"object"==typeof o&&o.constructor!=Object&&(o=cloneVimState(o)),n[key]=o}),state.sel&&(n.sel={head:state.sel.head&&copyCursor(state.sel.head),anchor:state.sel.anchor&&copyCursor(state.sel.anchor)}),n}function multiSelectHandleKey(cm,key,origin){var isHandled=!1,vim=Vim.maybeInitVimState_(cm),visualBlock=vim.visualBlock||vim.wasInVisualBlock;if(vim.wasInVisualBlock&&!cm.ace.inMultiSelectMode?vim.wasInVisualBlock=!1:cm.ace.inMultiSelectMode&&vim.visualBlock&&(vim.wasInVisualBlock=!0),"<Esc>"!=key||vim.insertMode||vim.visualMode||!cm.ace.inMultiSelectMode)if(visualBlock||!cm.ace.inMultiSelectMode||cm.ace.inVirtualSelectionMode)isHandled=Vim.handleKey(cm,key,origin);else{var old=cloneVimState(vim);cm.operation(function(){cm.ace.forEachSelection(function(){var sel=cm.ace.selection;cm.state.vim.lastHPos=null==sel.$desiredColumn?sel.lead.column:sel.$desiredColumn;var head=cm.getCursor("head"),anchor=cm.getCursor("anchor"),headOffset=cursorIsBefore(head,anchor)?0:-1,anchorOffset=cursorIsBefore(head,anchor)?-1:0;head=offsetCursor(head,0,headOffset),anchor=offsetCursor(anchor,0,anchorOffset),cm.state.vim.sel.head=head,cm.state.vim.sel.anchor=anchor,isHandled=handleKey(cm,key,origin),sel.$desiredColumn=-1==cm.state.vim.lastHPos?null:cm.state.vim.lastHPos,
cm.virtualSelectionMode()&&(cm.state.vim=cloneVimState(old))}),cm.curOp.cursorActivity&&!isHandled&&(cm.curOp.cursorActivity=!1)},!0)}else cm.ace.exitMultiSelectMode();return isHandled}function delayedExecAceCommand(op,ace){ace.off("beforeEndOperation",delayedExecAceCommand);var cmd=ace.state.cm.vimCmd;cmd&&ace.execCommand(cmd.exec?cmd:cmd.name,cmd.args),ace.curOp=ace.prevOp}var Range=require("../range").Range,EventEmitter=require("../lib/event_emitter").EventEmitter,dom=require("../lib/dom"),oop=require("../lib/oop"),KEYS=require("../lib/keys"),event=require("../lib/event"),Search=require("../search").Search,useragent=require("../lib/useragent"),SearchHighlight=require("../search_highlight").SearchHighlight,multiSelectCommands=require("../commands/multi_select_commands"),TextModeTokenRe=require("../mode/text").Mode.prototype.tokenRe;require("../multi_select");var CodeMirror=function(ace){this.ace=ace,this.state={},this.marks={},this.$uid=0,this.onChange=this.onChange.bind(this),this.onSelectionChange=this.onSelectionChange.bind(this),this.onBeforeEndOperation=this.onBeforeEndOperation.bind(this),this.ace.on("change",this.onChange),this.ace.on("changeSelection",this.onSelectionChange),this.ace.on("beforeEndOperation",this.onBeforeEndOperation)};CodeMirror.Pos=function(line,ch){return this instanceof Pos?(this.line=line,void(this.ch=ch)):new Pos(line,ch)},CodeMirror.defineOption=function(name,val,setter){},CodeMirror.commands={redo:function(cm){cm.ace.redo()},undo:function(cm){cm.ace.undo()},newlineAndIndent:function(cm){cm.ace.insert("\n")}},CodeMirror.keyMap={},CodeMirror.addClass=CodeMirror.rmClass=CodeMirror.e_stop=function(){},CodeMirror.keyName=function(e){if(e.key)return e.key;var key=KEYS[e.keyCode]||"";return 1==key.length&&(key=key.toUpperCase()),key=event.getModifierString(e).replace(/(^|-)\w/g,function(m){return m.toUpperCase()})+key},CodeMirror.keyMap["default"]=function(key){return function(cm){var cmd=cm.ace.commands.commandKeyBinding[key.toLowerCase()];return cmd&&cm.ace.execCommand(cmd)!==!1}},CodeMirror.lookupKey=function lookupKey(key,map,handle){"string"==typeof map&&(map=CodeMirror.keyMap[map]);var found="function"==typeof map?map(key):map[key];if(found===!1)return"nothing";if("..."===found)return"multi";if(null!=found&&handle(found))return"handled";if(map.fallthrough){if(!Array.isArray(map.fallthrough))return lookupKey(key,map.fallthrough,handle);for(var i=0;i<map.fallthrough.length;i++){var result=lookupKey(key,map.fallthrough[i],handle);if(result)return result}}},CodeMirror.signal=function(o,name,e){return o._signal(name,e)},CodeMirror.on=event.addListener,CodeMirror.off=event.removeListener,CodeMirror.isWordChar=function(ch){return"">ch?/^\w$/.test(ch):(TextModeTokenRe.lastIndex=0,TextModeTokenRe.test(ch))},function(){oop.implement(CodeMirror.prototype,EventEmitter),this.destroy=function(){this.ace.off("change",this.onChange),this.ace.off("changeSelection",this.onSelectionChange),this.ace.off("beforeEndOperation",this.onBeforeEndOperation),this.removeOverlay()},this.virtualSelectionMode=function(){return this.ace.inVirtualSelectionMode&&this.ace.selection.index},this.onChange=function(delta){var change={text:"i"==delta.action[0]?delta.lines:[]},curOp=this.curOp=this.curOp||{};curOp.changeHandlers||(curOp.changeHandlers=this._eventRegistry.change&&this._eventRegistry.change.slice()),this.virtualSelectionMode()||(curOp.lastChange?curOp.lastChange.next=curOp.lastChange=change:curOp.lastChange=curOp.change=change,this.$updateMarkers(delta))},this.onSelectionChange=function(){var curOp=this.curOp=this.curOp||{};curOp.cursorActivityHandlers||(curOp.cursorActivityHandlers=this._eventRegistry.cursorActivity&&this._eventRegistry.cursorActivity.slice()),this.curOp.cursorActivity=!0,this.ace.inMultiSelectMode&&this.ace.keyBinding.removeKeyboardHandler(multiSelectCommands.keyboardHandler)},this.operation=function(fn,force){if(!force&&this.curOp||force&&this.curOp&&this.curOp.force)return fn();if((force||!this.ace.curOp)&&this.curOp&&this.onBeforeEndOperation(),!this.ace.curOp){var prevOp=this.ace.prevOp;this.ace.startOperation({command:{name:"vim",scrollIntoView:"cursor"}})}var curOp=this.curOp=this.curOp||{};this.curOp.force=force;var result=fn();return this.ace.curOp&&"vim"==this.ace.curOp.command.name&&(this.ace.endOperation(),curOp.cursorActivity||curOp.lastChange||!prevOp||(this.ace.prevOp=prevOp)),(force||!this.ace.curOp)&&this.curOp&&this.onBeforeEndOperation(),result},this.onBeforeEndOperation=function(){var op=this.curOp;op&&(op.change&&this.signal("change",op.change,op),op&&op.cursorActivity&&this.signal("cursorActivity",null,op),this.curOp=null)},this.signal=function(eventName,e,handlers){var listeners=handlers?handlers[eventName+"Handlers"]:(this._eventRegistry||{})[eventName];if(listeners){listeners=listeners.slice();for(var i=0;i<listeners.length;i++)listeners[i](this,e)}},this.firstLine=function(){return 0},this.lastLine=function(){return this.ace.session.getLength()-1},this.lineCount=function(){return this.ace.session.getLength()},this.setCursor=function(line,ch){"object"==typeof line&&(ch=line.ch,line=line.line),this.ace.inVirtualSelectionMode||this.ace.exitMultiSelectMode(),this.ace.session.unfold({row:line,column:ch}),this.ace.selection.moveTo(line,ch)},this.getCursor=function(p){var sel=this.ace.selection,pos="anchor"==p?sel.isEmpty()?sel.lead:sel.anchor:"head"!=p&&p?sel.getRange()[p]:sel.lead;return toCmPos(pos)},this.listSelections=function(p){var ranges=this.ace.multiSelect.rangeList.ranges;return!ranges.length||this.ace.inVirtualSelectionMode?[{anchor:this.getCursor("anchor"),head:this.getCursor("head")}]:ranges.map(function(r){return{anchor:this.clipPos(toCmPos(r.cursor==r.end?r.start:r.end)),head:this.clipPos(toCmPos(r.cursor))}},this)},this.setSelections=function(p,primIndex){var sel=this.ace.multiSelect,ranges=p.map(function(x){var anchor=toAcePos(x.anchor),head=toAcePos(x.head),r=Range.comparePoints(anchor,head)<0?new Range.fromPoints(anchor,head):new Range.fromPoints(head,anchor);return r.cursor=Range.comparePoints(r.start,head)?r.end:r.start,r});if(this.ace.inVirtualSelectionMode)return void this.ace.selection.fromOrientedRange(ranges[0]);primIndex?ranges[primIndex]&&ranges.push(ranges.splice(primIndex,1)[0]):ranges=ranges.reverse(),sel.toSingleRange(ranges[0].clone());for(var session=this.ace.session,i=0;i<ranges.length;i++){var range=session.$clipRangeToDocument(ranges[i]);sel.addRange(range)}},this.setSelection=function(a,h,options){var sel=this.ace.selection;sel.moveTo(a.line,a.ch),sel.selectTo(h.line,h.ch),options&&"*mouse"==options.origin&&this.onBeforeEndOperation()},this.somethingSelected=function(p){return!this.ace.selection.isEmpty()},this.clipPos=function(p){var pos=this.ace.session.$clipPositionToDocument(p.line,p.ch);return toCmPos(pos)},this.markText=function(cursor){return{clear:function(){},find:function(){}}},this.$updateMarkers=function(delta){var isInsert="insert"==delta.action,start=delta.start,end=delta.end,rowShift=(end.row-start.row)*(isInsert?1:-1),colShift=(end.column-start.column)*(isInsert?1:-1);isInsert&&(end=start);for(var i in this.marks){var point=this.marks[i],cmp=Range.comparePoints(point,start);if(!(0>cmp)){if(0===cmp&&isInsert){if(1!=point.bias){-1==point.bias;continue}cmp=1}var cmp2=isInsert?cmp:Range.comparePoints(point,end);cmp2>0?(point.row+=rowShift,point.column+=point.row==end.row?colShift:0):!isInsert&&0>=cmp2&&(point.row=start.row,point.column=start.column,0===cmp2&&(point.bias=1))}}};var Marker=function(cm,id,row,column){this.cm=cm,this.id=id,this.row=row,this.column=column,cm.marks[this.id]=this};Marker.prototype.clear=function(){delete this.cm.marks[this.id]},Marker.prototype.find=function(){return toCmPos(this)},this.setBookmark=function(cursor,options){var bm=new Marker(this,this.$uid++,cursor.line,cursor.ch);return options&&options.insertLeft||(bm.$insertRight=!0),this.marks[bm.id]=bm,bm},this.moveH=function(increment,unit){if("char"==unit){var sel=this.ace.selection;sel.clearSelection(),sel.moveCursorBy(0,increment)}},this.findPosV=function(start,amount,unit,goalColumn){if("page"==unit){var renderer=this.ace.renderer,config=renderer.layerConfig;amount*=Math.floor(config.height/config.lineHeight),unit="line"}if("line"==unit){var screenPos=this.ace.session.documentToScreenPosition(start.line,start.ch);null!=goalColumn&&(screenPos.column=goalColumn),screenPos.row+=amount,screenPos.row=Math.min(Math.max(0,screenPos.row),this.ace.session.getScreenLength()-1);var pos=this.ace.session.screenToDocumentPosition(screenPos.row,screenPos.column);return toCmPos(pos)}},this.charCoords=function(pos,mode){if("div"==mode||!mode){var sc=this.ace.session.documentToScreenPosition(pos.line,pos.ch);return{left:sc.column,top:sc.row}}if("local"==mode){var renderer=this.ace.renderer,sc=this.ace.session.documentToScreenPosition(pos.line,pos.ch),lh=renderer.layerConfig.lineHeight,cw=renderer.layerConfig.characterWidth,top=lh*sc.row;return{left:sc.column*cw,top:top,bottom:top+lh}}},this.coordsChar=function(pos,mode){var renderer=this.ace.renderer;if("local"==mode){var row=Math.max(0,Math.floor(pos.top/renderer.lineHeight)),col=Math.max(0,Math.floor(pos.left/renderer.characterWidth)),ch=renderer.session.screenToDocumentPosition(row,col);return toCmPos(ch)}if("div"==mode)throw"not implemented"},this.getSearchCursor=function(query,pos,caseFold){var caseSensitive=!1,isRegexp=!1;query instanceof RegExp&&!query.global&&(caseSensitive=!query.ignoreCase,query=query.source,isRegexp=!0);var search=new Search;void 0==pos.ch&&(pos.ch=Number.MAX_VALUE);var acePos={row:pos.line,column:pos.ch},cm=this,last=null;return{findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(back){search.setOptions({needle:query,caseSensitive:caseSensitive,wrap:!1,backwards:back,regExp:isRegexp,start:last||acePos});var range=search.find(cm.ace.session);return range&&range.isEmpty()&&cm.getLine(range.start.row).length==range.start.column&&(search.$options.start=range,range=search.find(cm.ace.session)),last=range},from:function(){return last&&toCmPos(last.start)},to:function(){return last&&toCmPos(last.end)},replace:function(text){last&&(last.end=cm.ace.session.doc.replace(last,text))}}},this.scrollTo=function(x,y){var renderer=this.ace.renderer,config=renderer.layerConfig,maxHeight=config.maxHeight;maxHeight-=(renderer.$size.scrollerHeight-renderer.lineHeight)*renderer.$scrollPastEnd,null!=y&&this.ace.session.setScrollTop(Math.max(0,Math.min(y,maxHeight))),null!=x&&this.ace.session.setScrollLeft(Math.max(0,Math.min(x,config.width)))},this.scrollInfo=function(){return 0},this.scrollIntoView=function(pos,margin){if(pos){var renderer=this.ace.renderer,viewMargin={top:0,bottom:margin};renderer.scrollCursorIntoView(toAcePos(pos),2*renderer.lineHeight/renderer.$size.scrollerHeight,viewMargin)}},this.getLine=function(row){return this.ace.session.getLine(row)},this.getRange=function(s,e){return this.ace.session.getTextRange(new Range(s.line,s.ch,e.line,e.ch))},this.replaceRange=function(text,s,e){return e||(e=s),this.ace.session.replace(new Range(s.line,s.ch,e.line,e.ch),text)},this.replaceSelections=function(p){var sel=this.ace.selection;if(this.ace.inVirtualSelectionMode)return void this.ace.session.replace(sel.getRange(),p[0]||"");sel.inVirtualSelectionMode=!0;var ranges=sel.rangeList.ranges;ranges.length||(ranges=[this.ace.multiSelect.getRange()]);for(var i=ranges.length;i--;)this.ace.session.replace(ranges[i],p[i]||"");sel.inVirtualSelectionMode=!1},this.getSelection=function(){return this.ace.getSelectedText()},this.getSelections=function(){return this.listSelections().map(function(x){return this.getRange(x.anchor,x.head)},this)},this.getInputField=function(){return this.ace.textInput.getElement()},this.getWrapperElement=function(){return this.ace.containter};var optMap={indentWithTabs:"useSoftTabs",indentUnit:"tabSize",tabSize:"tabSize",firstLineNumber:"firstLineNumber",readOnly:"readOnly"};this.setOption=function(name,val){switch(this.state[name]=val,name){case"indentWithTabs":name=optMap[name],val=!val;break;default:name=optMap[name]}name&&this.ace.setOption(name,val)},this.getOption=function(name,val){var aceOpt=optMap[name];switch(aceOpt&&(val=this.ace.getOption(aceOpt)),name){case"indentWithTabs":return name=optMap[name],!val}return aceOpt?val:this.state[name]},this.toggleOverwrite=function(on){return this.state.overwrite=on,this.ace.setOverwrite(on)},this.addOverlay=function(o){if(!this.$searchHighlight||!this.$searchHighlight.session){var highlight=new SearchHighlight(null,"ace_highlight-marker","text"),marker=this.ace.session.addDynamicMarker(highlight);highlight.id=marker.id,highlight.session=this.ace.session,highlight.destroy=function(o){highlight.session.off("change",highlight.updateOnChange),highlight.session.off("changeEditor",highlight.destroy),highlight.session.removeMarker(highlight.id),highlight.session=null},highlight.updateOnChange=function(delta){var row=delta.start.row;row==delta.end.row?highlight.cache[row]=void 0:highlight.cache.splice(row,highlight.cache.length)},highlight.session.on("changeEditor",highlight.destroy),highlight.session.on("change",highlight.updateOnChange)}var re=new RegExp(o.query.source,"gmi");this.$searchHighlight=o.highlight=highlight,this.$searchHighlight.setRegexp(re),this.ace.renderer.updateBackMarkers()},this.removeOverlay=function(o){this.$searchHighlight&&this.$searchHighlight.session&&this.$searchHighlight.destroy()},this.getScrollInfo=function(){var renderer=this.ace.renderer,config=renderer.layerConfig;return{left:renderer.scrollLeft,top:renderer.scrollTop,height:config.maxHeight,width:config.width,clientHeight:config.height,clientWidth:config.width}},this.getValue=function(){return this.ace.getValue()},this.setValue=function(v){return this.ace.setValue(v)},this.getTokenTypeAt=function(pos){var token=this.ace.session.getTokenAt(pos.line,pos.ch);return token&&/comment|string/.test(token.type)?"string":""},this.findMatchingBracket=function(pos){var m=this.ace.session.findMatchingBracket(toAcePos(pos));return{to:m&&toCmPos(m)}},this.indentLine=function(line,method){method===!0?this.ace.session.indentRows(line,line,"	"):method===!1&&this.ace.session.outdentRows(new Range(line,0,line,0))},this.indexFromPos=function(pos){return this.ace.session.doc.positionToIndex(toAcePos(pos))},this.posFromIndex=function(index){return toCmPos(this.ace.session.doc.indexToPosition(index))},this.focus=function(index){return this.ace.focus()},this.blur=function(index){return this.ace.blur()},this.defaultTextHeight=function(index){return this.ace.renderer.layerConfig.lineHeight},this.scanForBracket=function(pos,dir,_,options){var re=options.bracketRegex.source;if(1==dir)var m=this.ace.session.$findClosingBracket(re.slice(1,2),toAcePos(pos),/paren|text/);else var m=this.ace.session.$findOpeningBracket(re.slice(-2,-1),{row:pos.line,column:pos.ch+1},/paren|text/);return m&&{pos:toCmPos(m)}},this.refresh=function(){return this.ace.resize(!0)},this.getMode=function(){return{name:this.getOption("mode")}}}.call(CodeMirror.prototype);var StringStream=CodeMirror.StringStream=function(string,tabSize){this.pos=this.start=0,this.string=string,this.tabSize=tabSize||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};StringStream.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(match){var ch=this.string.charAt(this.pos);if("string"==typeof match)var ok=ch==match;else var ok=ch&&(match.test?match.test(ch):match(ch));return ok?(++this.pos,ch):void 0},eatWhile:function(match){for(var start=this.pos;this.eat(match););return this.pos>start},eatSpace:function(){for(var start=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>start},skipToEnd:function(){this.pos=this.string.length},skipTo:function(ch){var found=this.string.indexOf(ch,this.pos);return found>-1?(this.pos=found,!0):void 0},backUp:function(n){this.pos-=n},column:function(){throw"not implemented"},indentation:function(){throw"not implemented"},match:function(pattern,consume,caseInsensitive){if("string"!=typeof pattern){var match=this.string.slice(this.pos).match(pattern);return match&&match.index>0?null:(match&&consume!==!1&&(this.pos+=match[0].length),match)}var cased=function(str){return caseInsensitive?str.toLowerCase():str},substr=this.string.substr(this.pos,pattern.length);return cased(substr)==cased(pattern)?(consume!==!1&&(this.pos+=pattern.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(n,inner){this.lineStart+=n;try{return inner()}finally{this.lineStart-=n}}},CodeMirror.defineExtension=function(name,fn){CodeMirror.prototype[name]=fn},dom.importCssString(".normal-mode .ace_cursor{  border: 1px solid red;  background-color: red;  opacity: 0.5;}.normal-mode .ace_hidden-cursors .ace_cursor{  background-color: transparent;}.ace_dialog {  position: absolute;  left: 0; right: 0;  background: white;  z-index: 15;  padding: .1em .8em;  overflow: hidden;  color: #333;}.ace_dialog-top {  border-bottom: 1px solid #eee;  top: 0;}.ace_dialog-bottom {  border-top: 1px solid #eee;  bottom: 0;}.ace_dialog input {  border: none;  outline: none;  background: transparent;  width: 20em;  color: inherit;  font-family: monospace;}","vimMode"),function(){function dialogDiv(cm,template,bottom){var dialog,wrap=cm.ace.container;return dialog=wrap.appendChild(document.createElement("div")),bottom?dialog.className="ace_dialog ace_dialog-bottom":dialog.className="ace_dialog ace_dialog-top","string"==typeof template?dialog.innerHTML=template:dialog.appendChild(template),dialog}function closeNotification(cm,newVal){cm.state.currentNotificationClose&&cm.state.currentNotificationClose(),cm.state.currentNotificationClose=newVal}CodeMirror.defineExtension("openDialog",function(template,callback,options){function close(newVal){if("string"==typeof newVal)inp.value=newVal;else{if(closed)return;closed=!0,dialog.parentNode.removeChild(dialog),me.focus(),options.onClose&&options.onClose(dialog)}}if(!this.virtualSelectionMode()){options||(options={}),closeNotification(this,null);var button,dialog=dialogDiv(this,template,options.bottom),closed=!1,me=this,inp=dialog.getElementsByTagName("input")[0];return inp?(options.value&&(inp.value=options.value,options.select!==!1&&inp.select()),options.onInput&&CodeMirror.on(inp,"input",function(e){options.onInput(e,inp.value,close)}),options.onKeyUp&&CodeMirror.on(inp,"keyup",function(e){options.onKeyUp(e,inp.value,close)}),CodeMirror.on(inp,"keydown",function(e){options&&options.onKeyDown&&options.onKeyDown(e,inp.value,close)||((27==e.keyCode||options.closeOnEnter!==!1&&13==e.keyCode)&&(inp.blur(),CodeMirror.e_stop(e),close()),13==e.keyCode&&callback(inp.value))}),options.closeOnBlur!==!1&&CodeMirror.on(inp,"blur",close),inp.focus()):(button=dialog.getElementsByTagName("button")[0])&&(CodeMirror.on(button,"click",function(){close(),me.focus()}),options.closeOnBlur!==!1&&CodeMirror.on(button,"blur",close),button.focus()),close}}),CodeMirror.defineExtension("openNotification",function(template,options){function close(){closed||(closed=!0,clearTimeout(doneTimer),dialog.parentNode.removeChild(dialog))}if(!this.virtualSelectionMode()){closeNotification(this,close);var doneTimer,dialog=dialogDiv(this,template,options&&options.bottom),closed=!1,duration=options&&"undefined"!=typeof options.duration?options.duration:5e3;return CodeMirror.on(dialog,"click",function(e){CodeMirror.e_preventDefault(e),close()}),duration&&(doneTimer=setTimeout(close,duration)),close}})}();var defaultKeymap=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0}},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}],defaultExCommandMap=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0
},{name:"nohlsearch",shortName:"noh"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"global",shortName:"g"}],Pos=CodeMirror.Pos,Vim=function(){return vimApi};CodeMirror.defineOption("vimMode",!1,function(cm,val,prev){val&&"vim"!=cm.getOption("keyMap")?cm.setOption("keyMap","vim"):!val&&prev!=CodeMirror.Init&&/^vim/.test(cm.getOption("keyMap"))&&cm.setOption("keyMap","default")});var modifiers={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A"},specialKeys={Enter:"CR",Backspace:"BS",Delete:"Del"},numberRegex=/[\d]/,wordCharTest=[CodeMirror.isWordChar,function(ch){return ch&&!CodeMirror.isWordChar(ch)&&!/\s/.test(ch)}],bigWordCharTest=[function(ch){return/\S/.test(ch)}],upperCaseAlphabet=makeKeyRange(65,26),lowerCaseAlphabet=makeKeyRange(97,26),numbers=makeKeyRange(48,10),validMarks=[].concat(upperCaseAlphabet,lowerCaseAlphabet,numbers,["<",">"]),validRegisters=[].concat(upperCaseAlphabet,lowerCaseAlphabet,numbers,["-",'"',".",":","/"]),options={};defineOption("filetype",void 0,"string",["ft"],function(name,cm){if(void 0!==cm){if(void 0===name){var mode=cm.getOption("mode");return"null"==mode?"":mode}var mode=""==name?"null":name;cm.setOption("mode",mode)}});var createCircularJumpList=function(){function add(cm,oldCur,newCur){function useNextSlot(cursor){var next=++pointer%size,trashMark=buffer[next];trashMark&&trashMark.clear(),buffer[next]=cm.setBookmark(cursor)}var current=pointer%size,curMark=buffer[current];if(curMark){var markPos=curMark.find();markPos&&!cursorEqual(markPos,oldCur)&&useNextSlot(oldCur)}else useNextSlot(oldCur);useNextSlot(newCur),head=pointer,tail=pointer-size+1,0>tail&&(tail=0)}function move(cm,offset){pointer+=offset,pointer>head?pointer=head:tail>pointer&&(pointer=tail);var mark=buffer[(size+pointer)%size];if(mark&&!mark.find()){var newCur,inc=offset>0?1:-1,oldCur=cm.getCursor();do if(pointer+=inc,mark=buffer[(size+pointer)%size],mark&&(newCur=mark.find())&&!cursorEqual(oldCur,newCur))break;while(head>pointer&&pointer>tail)}return mark}var size=100,pointer=-1,head=0,tail=0,buffer=new Array(size);return{cachedCursor:void 0,add:add,move:move}},createInsertModeChanges=function(c){return c?{changes:c.changes,expectCursorActivityForChange:c.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};MacroModeState.prototype={exitMacroRecordMode:function(){var macroModeState=vimGlobalState.macroModeState;macroModeState.onRecordingDone&&macroModeState.onRecordingDone(),macroModeState.onRecordingDone=void 0,macroModeState.isRecording=!1},enterMacroRecordMode:function(cm,registerName){var register=vimGlobalState.registerController.getRegister(registerName);register&&(register.clear(),this.latestRegister=registerName,cm.openDialog&&(this.onRecordingDone=cm.openDialog("(recording)["+registerName+"]",null,{bottom:!0})),this.isRecording=!0)}};var vimGlobalState,lastInsertModeKeyTimer,vimApi={buildKeyMap:function(){},getRegisterController:function(){return vimGlobalState.registerController},resetVimGlobalState_:resetVimGlobalState,getVimGlobalState_:function(){return vimGlobalState},maybeInitVimState_:maybeInitVimState,suppressErrorLogging:!1,InsertModeKey:InsertModeKey,map:function(lhs,rhs,ctx){exCommandDispatcher.map(lhs,rhs,ctx)},unmap:function(lhs,ctx){exCommandDispatcher.unmap(lhs,ctx)},setOption:setOption,getOption:getOption,defineOption:defineOption,defineEx:function(name,prefix,func){if(prefix){if(0!==name.indexOf(prefix))throw new Error('(Vim.defineEx) "'+prefix+'" is not a prefix of "'+name+'", command not registered')}else prefix=name;exCommands[name]=func,exCommandDispatcher.commandMap_[prefix]={name:name,shortName:prefix,type:"api"}},handleKey:function(cm,key,origin){var command=this.findKey(cm,key,origin);return"function"==typeof command?command():void 0},findKey:function(cm,key,origin){function handleMacroRecording(){var macroModeState=vimGlobalState.macroModeState;if(macroModeState.isRecording){if("q"==key)return macroModeState.exitMacroRecordMode(),clearInputState(cm),!0;"mapping"!=origin&&logKey(macroModeState,key)}}function handleEsc(){return"<Esc>"==key?(clearInputState(cm),vim.visualMode?exitVisualMode(cm):vim.insertMode&&exitInsertMode(cm),!0):void 0}function doKeyToKey(keys){for(var match;keys;)match=/<\w+-.+?>|<\w+>|./.exec(keys),key=match[0],keys=keys.substring(match.index+key.length),CodeMirror.Vim.handleKey(cm,key,"mapping")}function handleKeyInsertMode(){if(handleEsc())return!0;for(var keys=vim.inputState.keyBuffer=vim.inputState.keyBuffer+key,keysAreChars=1==key.length,match=commandDispatcher.matchCommand(keys,defaultKeymap,vim.inputState,"insert");keys.length>1&&"full"!=match.type;){var keys=vim.inputState.keyBuffer=keys.slice(1),thisMatch=commandDispatcher.matchCommand(keys,defaultKeymap,vim.inputState,"insert");"none"!=thisMatch.type&&(match=thisMatch)}if("none"==match.type)return clearInputState(cm),!1;if("partial"==match.type)return lastInsertModeKeyTimer&&window.clearTimeout(lastInsertModeKeyTimer),lastInsertModeKeyTimer=window.setTimeout(function(){vim.insertMode&&vim.inputState.keyBuffer&&clearInputState(cm)},getOption("insertModeEscKeysTimeout")),!keysAreChars;if(lastInsertModeKeyTimer&&window.clearTimeout(lastInsertModeKeyTimer),keysAreChars){var here=cm.getCursor();cm.replaceRange("",offsetCursor(here,0,-(keys.length-1)),here,"+input")}return clearInputState(cm),match.command}function handleKeyNonInsertMode(){if(handleMacroRecording()||handleEsc())return!0;var keys=vim.inputState.keyBuffer=vim.inputState.keyBuffer+key;if(/^[1-9]\d*$/.test(keys))return!0;var keysMatcher=/^(\d*)(.*)$/.exec(keys);if(!keysMatcher)return clearInputState(cm),!1;var context=vim.visualMode?"visual":"normal",match=commandDispatcher.matchCommand(keysMatcher[2]||keysMatcher[1],defaultKeymap,vim.inputState,context);if("none"==match.type)return clearInputState(cm),!1;if("partial"==match.type)return!0;vim.inputState.keyBuffer="";var keysMatcher=/^(\d*)(.*)$/.exec(keys);return keysMatcher[1]&&"0"!=keysMatcher[1]&&vim.inputState.pushRepeatDigit(keysMatcher[1]),match.command}var command,vim=maybeInitVimState(cm);return command=vim.insertMode?handleKeyInsertMode():handleKeyNonInsertMode(),command===!1?void 0:command===!0?function(){return!0}:function(){return(command.operator||command.isEdit)&&cm.getOption("readOnly")?void 0:cm.operation(function(){cm.curOp.isVimOp=!0;try{"keyToKey"==command.type?doKeyToKey(command.toKeys):commandDispatcher.processCommand(cm,vim,command)}catch(e){throw cm.state.vim=void 0,maybeInitVimState(cm),CodeMirror.Vim.suppressErrorLogging||console.log(e),e}return!0})}},handleEx:function(cm,input){exCommandDispatcher.processCommand(cm,input)},defineMotion:defineMotion,defineAction:defineAction,defineOperator:defineOperator,mapCommand:mapCommand,_mapCommand:_mapCommand,defineRegister:defineRegister,exitVisualMode:exitVisualMode,exitInsertMode:exitInsertMode};InputState.prototype.pushRepeatDigit=function(n){this.operator?this.motionRepeat=this.motionRepeat.concat(n):this.prefixRepeat=this.prefixRepeat.concat(n)},InputState.prototype.getRepeat=function(){var repeat=0;return(this.prefixRepeat.length>0||this.motionRepeat.length>0)&&(repeat=1,this.prefixRepeat.length>0&&(repeat*=parseInt(this.prefixRepeat.join(""),10)),this.motionRepeat.length>0&&(repeat*=parseInt(this.motionRepeat.join(""),10))),repeat},Register.prototype={setText:function(text,linewise,blockwise){this.keyBuffer=[text||""],this.linewise=!!linewise,this.blockwise=!!blockwise},pushText:function(text,linewise){linewise&&(this.linewise||this.keyBuffer.push("\n"),this.linewise=!0),this.keyBuffer.push(text)},pushInsertModeChanges:function(changes){this.insertModeChanges.push(createInsertModeChanges(changes))},pushSearchQuery:function(query){this.searchQueries.push(query)},clear:function(){this.keyBuffer=[],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!1},toString:function(){return this.keyBuffer.join("")}},RegisterController.prototype={pushText:function(registerName,operator,text,linewise,blockwise){linewise&&"\n"==text.charAt(0)&&(text=text.slice(1)+"\n"),linewise&&"\n"!==text.charAt(text.length-1)&&(text+="\n");var register=this.isValidRegister(registerName)?this.getRegister(registerName):null;if(!register){switch(operator){case"yank":this.registers[0]=new Register(text,linewise,blockwise);break;case"delete":case"change":-1==text.indexOf("\n")?this.registers["-"]=new Register(text,linewise):(this.shiftNumericRegisters_(),this.registers[1]=new Register(text,linewise))}return void this.unnamedRegister.setText(text,linewise,blockwise)}var append=isUpperCase(registerName);append?register.pushText(text,linewise):register.setText(text,linewise,blockwise),this.unnamedRegister.setText(register.toString(),linewise)},getRegister:function(name){return this.isValidRegister(name)?(name=name.toLowerCase(),this.registers[name]||(this.registers[name]=new Register),this.registers[name]):this.unnamedRegister},isValidRegister:function(name){return name&&inArray(name,validRegisters)},shiftNumericRegisters_:function(){for(var i=9;i>=2;i--)this.registers[i]=this.getRegister(""+(i-1))}},HistoryController.prototype={nextMatch:function(input,up){var historyBuffer=this.historyBuffer,dir=up?-1:1;null===this.initialPrefix&&(this.initialPrefix=input);for(var i=this.iterator+dir;up?i>=0:i<historyBuffer.length;i+=dir)for(var element=historyBuffer[i],j=0;j<=element.length;j++)if(this.initialPrefix==element.substring(0,j))return this.iterator=i,element;return i>=historyBuffer.length?(this.iterator=historyBuffer.length,this.initialPrefix):0>i?input:void 0},pushInput:function(input){var index=this.historyBuffer.indexOf(input);index>-1&&this.historyBuffer.splice(index,1),input.length&&this.historyBuffer.push(input)},reset:function(){this.initialPrefix=null,this.iterator=this.historyBuffer.length}};var commandDispatcher={matchCommand:function(keys,keyMap,inputState,context){var matches=commandMatches(keys,keyMap,context,inputState);if(!matches.full&&!matches.partial)return{type:"none"};if(!matches.full&&matches.partial)return{type:"partial"};for(var bestMatch,i=0;i<matches.full.length;i++){var match=matches.full[i];bestMatch||(bestMatch=match)}return"<character>"==bestMatch.keys.slice(-11)&&(inputState.selectedCharacter=lastChar(keys)),{type:"full",command:bestMatch}},processCommand:function(cm,vim,command){switch(vim.inputState.repeatOverride=command.repeatOverride,command.type){case"motion":this.processMotion(cm,vim,command);break;case"operator":this.processOperator(cm,vim,command);break;case"operatorMotion":this.processOperatorMotion(cm,vim,command);break;case"action":this.processAction(cm,vim,command);break;case"search":this.processSearch(cm,vim,command);break;case"ex":case"keyToEx":this.processEx(cm,vim,command)}},processMotion:function(cm,vim,command){vim.inputState.motion=command.motion,vim.inputState.motionArgs=copyArgs(command.motionArgs),this.evalInput(cm,vim)},processOperator:function(cm,vim,command){var inputState=vim.inputState;if(inputState.operator){if(inputState.operator==command.operator)return inputState.motion="expandToLine",inputState.motionArgs={linewise:!0},void this.evalInput(cm,vim);clearInputState(cm)}inputState.operator=command.operator,inputState.operatorArgs=copyArgs(command.operatorArgs),vim.visualMode&&this.evalInput(cm,vim)},processOperatorMotion:function(cm,vim,command){var visualMode=vim.visualMode,operatorMotionArgs=copyArgs(command.operatorMotionArgs);operatorMotionArgs&&visualMode&&operatorMotionArgs.visualLine&&(vim.visualLine=!0),this.processOperator(cm,vim,command),visualMode||this.processMotion(cm,vim,command)},processAction:function(cm,vim,command){var inputState=vim.inputState,repeat=inputState.getRepeat(),repeatIsExplicit=!!repeat,actionArgs=copyArgs(command.actionArgs)||{};inputState.selectedCharacter&&(actionArgs.selectedCharacter=inputState.selectedCharacter),command.operator&&this.processOperator(cm,vim,command),command.motion&&this.processMotion(cm,vim,command),(command.motion||command.operator)&&this.evalInput(cm,vim),actionArgs.repeat=repeat||1,actionArgs.repeatIsExplicit=repeatIsExplicit,actionArgs.registerName=inputState.registerName,clearInputState(cm),vim.lastMotion=null,command.isEdit&&this.recordLastEdit(vim,inputState,command),actions[command.action](cm,actionArgs,vim)},processSearch:function(cm,vim,command){function handleQuery(query,ignoreCase,smartCase){vimGlobalState.searchHistoryController.pushInput(query),vimGlobalState.searchHistoryController.reset();try{updateSearchQuery(cm,query,ignoreCase,smartCase)}catch(e){return showConfirm(cm,"Invalid regex: "+query),void clearInputState(cm)}commandDispatcher.processMotion(cm,vim,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:command.searchArgs.toJumplist}})}function onPromptClose(query){cm.scrollTo(originalScrollPos.left,originalScrollPos.top),handleQuery(query,!0,!0);var macroModeState=vimGlobalState.macroModeState;macroModeState.isRecording&&logSearchQuery(macroModeState,query)}function onPromptKeyUp(e,query,close){var up,keyName=CodeMirror.keyName(e);"Up"==keyName||"Down"==keyName?(up="Up"==keyName?!0:!1,query=vimGlobalState.searchHistoryController.nextMatch(query,up)||"",close(query)):"Left"!=keyName&&"Right"!=keyName&&"Ctrl"!=keyName&&"Alt"!=keyName&&"Shift"!=keyName&&vimGlobalState.searchHistoryController.reset();var parsedQuery;try{parsedQuery=updateSearchQuery(cm,query,!0,!0)}catch(e){}parsedQuery?cm.scrollIntoView(findNext(cm,!forward,parsedQuery),30):(clearSearchHighlight(cm),cm.scrollTo(originalScrollPos.left,originalScrollPos.top))}function onPromptKeyDown(e,query,close){var keyName=CodeMirror.keyName(e);"Esc"==keyName||"Ctrl-C"==keyName||"Ctrl-["==keyName||"Backspace"==keyName&&""==query?(vimGlobalState.searchHistoryController.pushInput(query),vimGlobalState.searchHistoryController.reset(),updateSearchQuery(cm,originalQuery),clearSearchHighlight(cm),cm.scrollTo(originalScrollPos.left,originalScrollPos.top),CodeMirror.e_stop(e),clearInputState(cm),close(),cm.focus()):"Ctrl-U"==keyName&&(CodeMirror.e_stop(e),close(""))}if(cm.getSearchCursor){var forward=command.searchArgs.forward,wholeWordOnly=command.searchArgs.wholeWordOnly;getSearchState(cm).setReversed(!forward);var promptPrefix=forward?"/":"?",originalQuery=getSearchState(cm).getQuery(),originalScrollPos=cm.getScrollInfo();switch(command.searchArgs.querySrc){case"prompt":var macroModeState=vimGlobalState.macroModeState;if(macroModeState.isPlaying){var query=macroModeState.replaySearchQueries.shift();handleQuery(query,!0,!1)}else showPrompt(cm,{onClose:onPromptClose,prefix:promptPrefix,desc:searchPromptDesc,onKeyUp:onPromptKeyUp,onKeyDown:onPromptKeyDown});break;case"wordUnderCursor":var word=expandWordUnderCursor(cm,!1,!0,!1,!0),isKeyword=!0;if(word||(word=expandWordUnderCursor(cm,!1,!0,!1,!1),isKeyword=!1),!word)return;var query=cm.getLine(word.start.line).substring(word.start.ch,word.end.ch);query=isKeyword&&wholeWordOnly?"\\b"+query+"\\b":escapeRegex(query),vimGlobalState.jumpList.cachedCursor=cm.getCursor(),cm.setCursor(word.start),handleQuery(query,!0,!1)}}},processEx:function(cm,vim,command){function onPromptClose(input){vimGlobalState.exCommandHistoryController.pushInput(input),vimGlobalState.exCommandHistoryController.reset(),exCommandDispatcher.processCommand(cm,input)}function onPromptKeyDown(e,input,close){var up,keyName=CodeMirror.keyName(e);("Esc"==keyName||"Ctrl-C"==keyName||"Ctrl-["==keyName||"Backspace"==keyName&&""==input)&&(vimGlobalState.exCommandHistoryController.pushInput(input),vimGlobalState.exCommandHistoryController.reset(),CodeMirror.e_stop(e),clearInputState(cm),close(),cm.focus()),"Up"==keyName||"Down"==keyName?(up="Up"==keyName?!0:!1,input=vimGlobalState.exCommandHistoryController.nextMatch(input,up)||"",close(input)):"Ctrl-U"==keyName?(CodeMirror.e_stop(e),close("")):"Left"!=keyName&&"Right"!=keyName&&"Ctrl"!=keyName&&"Alt"!=keyName&&"Shift"!=keyName&&vimGlobalState.exCommandHistoryController.reset()}"keyToEx"==command.type?exCommandDispatcher.processCommand(cm,command.exArgs.input):vim.visualMode?showPrompt(cm,{onClose:onPromptClose,prefix:":",value:"'<,'>",onKeyDown:onPromptKeyDown}):showPrompt(cm,{onClose:onPromptClose,prefix:":",onKeyDown:onPromptKeyDown})},evalInput:function(cm,vim){var newHead,newAnchor,repeat,inputState=vim.inputState,motion=inputState.motion,motionArgs=inputState.motionArgs||{},operator=inputState.operator,operatorArgs=inputState.operatorArgs||{},registerName=inputState.registerName,sel=vim.sel,origHead=copyCursor(vim.visualMode?clipCursorToContent(cm,sel.head):cm.getCursor("head")),origAnchor=copyCursor(vim.visualMode?clipCursorToContent(cm,sel.anchor):cm.getCursor("anchor")),oldHead=copyCursor(origHead),oldAnchor=copyCursor(origAnchor);if(operator&&this.recordLastEdit(vim,inputState),repeat=void 0!==inputState.repeatOverride?inputState.repeatOverride:inputState.getRepeat(),repeat>0&&motionArgs.explicitRepeat?motionArgs.repeatIsExplicit=!0:(motionArgs.noRepeat||!motionArgs.explicitRepeat&&0===repeat)&&(repeat=1,motionArgs.repeatIsExplicit=!1),inputState.selectedCharacter&&(motionArgs.selectedCharacter=operatorArgs.selectedCharacter=inputState.selectedCharacter),motionArgs.repeat=repeat,clearInputState(cm),motion){var motionResult=motions[motion](cm,origHead,motionArgs,vim);if(vim.lastMotion=motions[motion],!motionResult)return;if(motionArgs.toJumplist){operator||null==cm.ace.curOp||(cm.ace.curOp.command.scrollIntoView="center-animate");var jumpList=vimGlobalState.jumpList,cachedCursor=jumpList.cachedCursor;cachedCursor?(recordJumpPosition(cm,cachedCursor,motionResult),delete jumpList.cachedCursor):recordJumpPosition(cm,origHead,motionResult)}motionResult instanceof Array?(newAnchor=motionResult[0],newHead=motionResult[1]):newHead=motionResult,newHead||(newHead=copyCursor(origHead)),vim.visualMode?(vim.visualBlock&&newHead.ch===1/0||(newHead=clipCursorToContent(cm,newHead,vim.visualBlock)),newAnchor&&(newAnchor=clipCursorToContent(cm,newAnchor,!0)),newAnchor=newAnchor||oldAnchor,sel.anchor=newAnchor,sel.head=newHead,updateCmSelection(cm),updateMark(cm,vim,"<",cursorIsBefore(newAnchor,newHead)?newAnchor:newHead),updateMark(cm,vim,">",cursorIsBefore(newAnchor,newHead)?newHead:newAnchor)):operator||(newHead=clipCursorToContent(cm,newHead),cm.setCursor(newHead.line,newHead.ch))}if(operator){if(operatorArgs.lastSel){newAnchor=oldAnchor;var lastSel=operatorArgs.lastSel,lineOffset=Math.abs(lastSel.head.line-lastSel.anchor.line),chOffset=Math.abs(lastSel.head.ch-lastSel.anchor.ch);newHead=lastSel.visualLine?Pos(oldAnchor.line+lineOffset,oldAnchor.ch):lastSel.visualBlock?Pos(oldAnchor.line+lineOffset,oldAnchor.ch+chOffset):lastSel.head.line==lastSel.anchor.line?Pos(oldAnchor.line,oldAnchor.ch+chOffset):Pos(oldAnchor.line+lineOffset,oldAnchor.ch),vim.visualMode=!0,vim.visualLine=lastSel.visualLine,vim.visualBlock=lastSel.visualBlock,sel=vim.sel={anchor:newAnchor,head:newHead},updateCmSelection(cm)}else vim.visualMode&&(operatorArgs.lastSel={anchor:copyCursor(sel.anchor),head:copyCursor(sel.head),visualBlock:vim.visualBlock,visualLine:vim.visualLine});var curStart,curEnd,linewise,mode,cmSel;if(vim.visualMode){if(curStart=cursorMin(sel.head,sel.anchor),curEnd=cursorMax(sel.head,sel.anchor),linewise=vim.visualLine||operatorArgs.linewise,mode=vim.visualBlock?"block":linewise?"line":"char",cmSel=makeCmSelection(cm,{anchor:curStart,head:curEnd},mode),linewise){var ranges=cmSel.ranges;if("block"==mode)for(var i=0;i<ranges.length;i++)ranges[i].head.ch=lineLength(cm,ranges[i].head.line);else"line"==mode&&(ranges[0].head=Pos(ranges[0].head.line+1,0))}}else{if(curStart=copyCursor(newAnchor||oldAnchor),curEnd=copyCursor(newHead||oldHead),cursorIsBefore(curEnd,curStart)){var tmp=curStart;curStart=curEnd,curEnd=tmp}linewise=motionArgs.linewise||operatorArgs.linewise,linewise?expandSelectionToLine(cm,curStart,curEnd):motionArgs.forward&&clipToLine(cm,curStart,curEnd),mode="char";var exclusive=!motionArgs.inclusive||linewise;cmSel=makeCmSelection(cm,{anchor:curStart,head:curEnd},mode,exclusive)}cm.setSelections(cmSel.ranges,cmSel.primary),vim.lastMotion=null,operatorArgs.repeat=repeat,operatorArgs.registerName=registerName,operatorArgs.linewise=linewise;var operatorMoveTo=operators[operator](cm,operatorArgs,cmSel.ranges,oldAnchor,newHead);vim.visualMode&&exitVisualMode(cm,null!=operatorMoveTo),operatorMoveTo&&cm.setCursor(operatorMoveTo)}},recordLastEdit:function(vim,inputState,actionCommand){var macroModeState=vimGlobalState.macroModeState;macroModeState.isPlaying||(vim.lastEditInputState=inputState,vim.lastEditActionCommand=actionCommand,macroModeState.lastInsertModeChanges.changes=[],macroModeState.lastInsertModeChanges.expectCursorActivityForChange=!1)}},motions={moveToTopLine:function(cm,_head,motionArgs){var line=getUserVisibleLines(cm).top+motionArgs.repeat-1;return Pos(line,findFirstNonWhiteSpaceCharacter(cm.getLine(line)))},moveToMiddleLine:function(cm){var range=getUserVisibleLines(cm),line=Math.floor(.5*(range.top+range.bottom));return Pos(line,findFirstNonWhiteSpaceCharacter(cm.getLine(line)))},moveToBottomLine:function(cm,_head,motionArgs){var line=getUserVisibleLines(cm).bottom-motionArgs.repeat+1;return Pos(line,findFirstNonWhiteSpaceCharacter(cm.getLine(line)))},expandToLine:function(_cm,head,motionArgs){var cur=head;return Pos(cur.line+motionArgs.repeat-1,1/0)},findNext:function(cm,_head,motionArgs){var state=getSearchState(cm),query=state.getQuery();if(query){var prev=!motionArgs.forward;return prev=state.isReversed()?!prev:prev,highlightSearchMatches(cm,query),findNext(cm,prev,query,motionArgs.repeat)}},goToMark:function(cm,_head,motionArgs,vim){var mark=vim.marks[motionArgs.selectedCharacter];if(mark){var pos=mark.find();return motionArgs.linewise?{line:pos.line,ch:findFirstNonWhiteSpaceCharacter(cm.getLine(pos.line))}:pos}return null},moveToOtherHighlightedEnd:function(cm,_head,motionArgs,vim){if(vim.visualBlock&&motionArgs.sameLine){var sel=vim.sel;return[clipCursorToContent(cm,Pos(sel.anchor.line,sel.head.ch)),clipCursorToContent(cm,Pos(sel.head.line,sel.anchor.ch))]}return[vim.sel.head,vim.sel.anchor]},jumpToMark:function(cm,head,motionArgs,vim){for(var best=head,i=0;i<motionArgs.repeat;i++){var cursor=best;for(var key in vim.marks)if(isLowerCase(key)){var mark=vim.marks[key].find(),isWrongDirection=motionArgs.forward?cursorIsBefore(mark,cursor):cursorIsBefore(cursor,mark);if(!(isWrongDirection||motionArgs.linewise&&mark.line==cursor.line)){var equal=cursorEqual(cursor,best),between=motionArgs.forward?cursorIsBetween(cursor,mark,best):cursorIsBetween(best,mark,cursor);(equal||between)&&(best=mark)}}}return motionArgs.linewise&&(best=Pos(best.line,findFirstNonWhiteSpaceCharacter(cm.getLine(best.line)))),best},moveByCharacters:function(_cm,head,motionArgs){var cur=head,repeat=motionArgs.repeat,ch=motionArgs.forward?cur.ch+repeat:cur.ch-repeat;return Pos(cur.line,ch)},moveByLines:function(cm,head,motionArgs,vim){var cur=head,endCh=cur.ch;switch(vim.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:endCh=vim.lastHPos;break;default:vim.lastHPos=endCh}var repeat=motionArgs.repeat+(motionArgs.repeatOffset||0),line=motionArgs.forward?cur.line+repeat:cur.line-repeat,first=cm.firstLine(),last=cm.lastLine();if(!(first>line&&cur.line==first||line>last&&cur.line==last)){var fold=cm.ace.session.getFoldLine(line);return fold&&(motionArgs.forward?line>fold.start.row&&(line=fold.end.row+1):line=fold.start.row),motionArgs.toFirstChar&&(endCh=findFirstNonWhiteSpaceCharacter(cm.getLine(line)),vim.lastHPos=endCh),vim.lastHSPos=cm.charCoords(Pos(line,endCh),"div").left,Pos(line,endCh)}},moveByDisplayLines:function(cm,head,motionArgs,vim){var cur=head;switch(vim.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:vim.lastHSPos=cm.charCoords(cur,"div").left}var repeat=motionArgs.repeat,res=cm.findPosV(cur,motionArgs.forward?repeat:-repeat,"line",vim.lastHSPos);if(res.hitSide)if(motionArgs.forward)var lastCharCoords=cm.charCoords(res,"div"),goalCoords={top:lastCharCoords.top+8,left:vim.lastHSPos},res=cm.coordsChar(goalCoords,"div");else{var resCoords=cm.charCoords(Pos(cm.firstLine(),0),"div");resCoords.left=vim.lastHSPos,res=cm.coordsChar(resCoords,"div")}return vim.lastHPos=res.ch,res},moveByPage:function(cm,head,motionArgs){var curStart=head,repeat=motionArgs.repeat;return cm.findPosV(curStart,motionArgs.forward?repeat:-repeat,"page")},moveByParagraph:function(cm,head,motionArgs){var dir=motionArgs.forward?1:-1;return findParagraph(cm,head,motionArgs.repeat,dir)},moveByScroll:function(cm,head,motionArgs,vim){var scrollbox=cm.getScrollInfo(),curEnd=null,repeat=motionArgs.repeat;repeat||(repeat=scrollbox.clientHeight/(2*cm.defaultTextHeight()));var orig=cm.charCoords(head,"local");motionArgs.repeat=repeat;var curEnd=motions.moveByDisplayLines(cm,head,motionArgs,vim);if(!curEnd)return null;var dest=cm.charCoords(curEnd,"local");return cm.scrollTo(null,scrollbox.top+dest.top-orig.top),curEnd},moveByWords:function(cm,head,motionArgs){return moveToWord(cm,head,motionArgs.repeat,!!motionArgs.forward,!!motionArgs.wordEnd,!!motionArgs.bigWord)},moveTillCharacter:function(cm,_head,motionArgs){var repeat=motionArgs.repeat,curEnd=moveToCharacter(cm,repeat,motionArgs.forward,motionArgs.selectedCharacter),increment=motionArgs.forward?-1:1;return recordLastCharacterSearch(increment,motionArgs),curEnd?(curEnd.ch+=increment,curEnd):null},moveToCharacter:function(cm,head,motionArgs){var repeat=motionArgs.repeat;return recordLastCharacterSearch(0,motionArgs),moveToCharacter(cm,repeat,motionArgs.forward,motionArgs.selectedCharacter)||head},moveToSymbol:function(cm,head,motionArgs){var repeat=motionArgs.repeat;return findSymbol(cm,repeat,motionArgs.forward,motionArgs.selectedCharacter)||head},moveToColumn:function(cm,head,motionArgs,vim){var repeat=motionArgs.repeat;return vim.lastHPos=repeat-1,vim.lastHSPos=cm.charCoords(head,"div").left,moveToColumn(cm,repeat)},moveToEol:function(cm,head,motionArgs,vim){var cur=head;vim.lastHPos=1/0;var retval=Pos(cur.line+motionArgs.repeat-1,1/0),end=cm.clipPos(retval);return end.ch--,vim.lastHSPos=cm.charCoords(end,"div").left,retval},moveToFirstNonWhiteSpaceCharacter:function(cm,head){var cursor=head;return Pos(cursor.line,findFirstNonWhiteSpaceCharacter(cm.getLine(cursor.line)))},moveToMatchedSymbol:function(cm,head){var symbol,cursor=head,line=cursor.line,ch=cursor.ch,lineText=cm.getLine(line);do if(symbol=lineText.charAt(ch++),symbol&&isMatchableSymbol(symbol)){var style=cm.getTokenTypeAt(Pos(line,ch));if("string"!==style&&"comment"!==style)break}while(symbol);if(symbol){var matched=cm.findMatchingBracket(Pos(line,ch));return matched.to}return cursor},moveToStartOfLine:function(_cm,head){return Pos(head.line,0)},moveToLineOrEdgeOfDocument:function(cm,_head,motionArgs){var lineNum=motionArgs.forward?cm.lastLine():cm.firstLine();return motionArgs.repeatIsExplicit&&(lineNum=motionArgs.repeat-cm.getOption("firstLineNumber")),Pos(lineNum,findFirstNonWhiteSpaceCharacter(cm.getLine(lineNum)))},textObjectManipulation:function(cm,head,motionArgs,vim){var mirroredPairs={"(":")",")":"(","{":"}","}":"{","[":"]","]":"["},selfPaired={"'":!0,'"':!0},character=motionArgs.selectedCharacter;"b"==character?character="(":"B"==character&&(character="{");var tmp,inclusive=!motionArgs.textObjectInner;if(mirroredPairs[character])tmp=selectCompanionObject(cm,head,character,inclusive);else if(selfPaired[character])tmp=findBeginningAndEnd(cm,head,character,inclusive);else if("W"===character)tmp=expandWordUnderCursor(cm,inclusive,!0,!0);else if("w"===character)tmp=expandWordUnderCursor(cm,inclusive,!0,!1);else{if("p"!==character)return null;if(tmp=findParagraph(cm,head,motionArgs.repeat,0,inclusive),motionArgs.linewise=!0,vim.visualMode)vim.visualLine||(vim.visualLine=!0);else{var operatorArgs=vim.inputState.operatorArgs;operatorArgs&&(operatorArgs.linewise=!0),tmp.end.line--}}return cm.state.vim.visualMode?expandSelection(cm,tmp.start,tmp.end):[tmp.start,tmp.end]},repeatLastCharacterSearch:function(cm,head,motionArgs){var lastSearch=vimGlobalState.lastChararacterSearch,repeat=motionArgs.repeat,forward=motionArgs.forward===lastSearch.forward,increment=(lastSearch.increment?1:0)*(forward?-1:1);cm.moveH(-increment,"char"),motionArgs.inclusive=forward?!0:!1;var curEnd=moveToCharacter(cm,repeat,forward,lastSearch.selectedCharacter);return curEnd?(curEnd.ch+=increment,curEnd):(cm.moveH(increment,"char"),head)}},operators={change:function(cm,args,ranges){var finalHead,text,vim=cm.state.vim;if(vimGlobalState.macroModeState.lastInsertModeChanges.inVisualBlock=vim.visualBlock,vim.visualMode){text=cm.getSelection();var replacement=fillArray("",ranges.length);cm.replaceSelections(replacement),finalHead=cursorMin(ranges[0].head,ranges[0].anchor)}else{var anchor=ranges[0].anchor,head=ranges[0].head;text=cm.getRange(anchor,head);var lastState=vim.lastEditInputState||{};if("moveByWords"==lastState.motion&&!isWhiteSpaceString(text)){var match=/\s+$/.exec(text);match&&lastState.motionArgs&&lastState.motionArgs.forward&&(head=offsetCursor(head,0,-match[0].length),text=text.slice(0,-match[0].length))}var prevLineEnd=new Pos(anchor.line-1,Number.MAX_VALUE),wasLastLine=cm.firstLine()==cm.lastLine();head.line>cm.lastLine()&&args.linewise&&!wasLastLine?cm.replaceRange("",prevLineEnd,head):cm.replaceRange("",anchor,head),args.linewise&&(wasLastLine||(cm.setCursor(prevLineEnd),CodeMirror.commands.newlineAndIndent(cm)),anchor.ch=Number.MAX_VALUE),finalHead=anchor}vimGlobalState.registerController.pushText(args.registerName,"change",text,args.linewise,ranges.length>1),actions.enterInsertMode(cm,{head:finalHead},cm.state.vim)},"delete":function(cm,args,ranges){var finalHead,text,vim=cm.state.vim;if(vim.visualBlock){text=cm.getSelection();var replacement=fillArray("",ranges.length);cm.replaceSelections(replacement),finalHead=ranges[0].anchor}else{var anchor=ranges[0].anchor,head=ranges[0].head;args.linewise&&head.line!=cm.firstLine()&&anchor.line==cm.lastLine()&&anchor.line==head.line-1&&(anchor.line==cm.firstLine()?anchor.ch=0:anchor=Pos(anchor.line-1,lineLength(cm,anchor.line-1))),text=cm.getRange(anchor,head),cm.replaceRange("",anchor,head),finalHead=anchor,args.linewise&&(finalHead=motions.moveToFirstNonWhiteSpaceCharacter(cm,anchor))}return vimGlobalState.registerController.pushText(args.registerName,"delete",text,args.linewise,vim.visualBlock),clipCursorToContent(cm,finalHead)},indent:function(cm,args,ranges){var vim=cm.state.vim,startLine=ranges[0].anchor.line,endLine=vim.visualBlock?ranges[ranges.length-1].anchor.line:ranges[0].head.line,repeat=vim.visualMode?args.repeat:1;args.linewise&&endLine--;for(var i=startLine;endLine>=i;i++)for(var j=0;repeat>j;j++)cm.indentLine(i,args.indentRight);return motions.moveToFirstNonWhiteSpaceCharacter(cm,ranges[0].anchor)},changeCase:function(cm,args,ranges,oldAnchor,newHead){for(var selections=cm.getSelections(),swapped=[],toLower=args.toLower,j=0;j<selections.length;j++){var toSwap=selections[j],text="";if(toLower===!0)text=toSwap.toLowerCase();else if(toLower===!1)text=toSwap.toUpperCase();else for(var i=0;i<toSwap.length;i++){var character=toSwap.charAt(i);text+=isUpperCase(character)?character.toLowerCase():character.toUpperCase()}swapped.push(text)}return cm.replaceSelections(swapped),args.shouldMoveCursor?newHead:!cm.state.vim.visualMode&&args.linewise&&ranges[0].anchor.line+1==ranges[0].head.line?motions.moveToFirstNonWhiteSpaceCharacter(cm,oldAnchor):args.linewise?oldAnchor:cursorMin(ranges[0].anchor,ranges[0].head)},yank:function(cm,args,ranges,oldAnchor){var vim=cm.state.vim,text=cm.getSelection(),endPos=vim.visualMode?cursorMin(vim.sel.anchor,vim.sel.head,ranges[0].head,ranges[0].anchor):oldAnchor;return vimGlobalState.registerController.pushText(args.registerName,"yank",text,args.linewise,vim.visualBlock),endPos}},actions={jumpListWalk:function(cm,actionArgs,vim){
if(!vim.visualMode){var repeat=actionArgs.repeat,forward=actionArgs.forward,jumpList=vimGlobalState.jumpList,mark=jumpList.move(cm,forward?repeat:-repeat),markPos=mark?mark.find():void 0;markPos=markPos?markPos:cm.getCursor(),cm.setCursor(markPos),cm.ace.curOp.command.scrollIntoView="center-animate"}},scroll:function(cm,actionArgs,vim){if(!vim.visualMode){var repeat=actionArgs.repeat||1,lineHeight=cm.defaultTextHeight(),top=cm.getScrollInfo().top,delta=lineHeight*repeat,newPos=actionArgs.forward?top+delta:top-delta,cursor=copyCursor(cm.getCursor()),cursorCoords=cm.charCoords(cursor,"local");if(actionArgs.forward)newPos>cursorCoords.top?(cursor.line+=(newPos-cursorCoords.top)/lineHeight,cursor.line=Math.ceil(cursor.line),cm.setCursor(cursor),cursorCoords=cm.charCoords(cursor,"local"),cm.scrollTo(null,cursorCoords.top)):cm.scrollTo(null,newPos);else{var newBottom=newPos+cm.getScrollInfo().clientHeight;newBottom<cursorCoords.bottom?(cursor.line-=(cursorCoords.bottom-newBottom)/lineHeight,cursor.line=Math.floor(cursor.line),cm.setCursor(cursor),cursorCoords=cm.charCoords(cursor,"local"),cm.scrollTo(null,cursorCoords.bottom-cm.getScrollInfo().clientHeight)):cm.scrollTo(null,newPos)}}},scrollToCursor:function(cm,actionArgs){var lineNum=cm.getCursor().line,charCoords=cm.charCoords(Pos(lineNum,0),"local"),height=cm.getScrollInfo().clientHeight,y=charCoords.top,lineHeight=charCoords.bottom-y;switch(actionArgs.position){case"center":y=y-height/2+lineHeight;break;case"bottom":y=y-height+1.4*lineHeight;break;case"top":y+=.4*lineHeight}cm.scrollTo(null,y)},replayMacro:function(cm,actionArgs,vim){var registerName=actionArgs.selectedCharacter,repeat=actionArgs.repeat,macroModeState=vimGlobalState.macroModeState;for("@"==registerName&&(registerName=macroModeState.latestRegister);repeat--;)executeMacroRegister(cm,vim,macroModeState,registerName)},enterMacroRecordMode:function(cm,actionArgs){var macroModeState=vimGlobalState.macroModeState,registerName=actionArgs.selectedCharacter;macroModeState.enterMacroRecordMode(cm,registerName)},enterInsertMode:function(cm,actionArgs,vim){if(!cm.getOption("readOnly")){vim.insertMode=!0,vim.insertModeRepeat=actionArgs&&actionArgs.repeat||1;var insertAt=actionArgs?actionArgs.insertAt:null,sel=vim.sel,head=actionArgs.head||cm.getCursor("head"),height=cm.listSelections().length;if("eol"==insertAt)head=Pos(head.line,lineLength(cm,head.line));else if("charAfter"==insertAt)head=offsetCursor(head,0,1);else if("firstNonBlank"==insertAt)head=motions.moveToFirstNonWhiteSpaceCharacter(cm,head);else if("startOfSelectedArea"==insertAt)vim.visualBlock?(head=Pos(Math.min(sel.head.line,sel.anchor.line),Math.min(sel.head.ch,sel.anchor.ch)),height=Math.abs(sel.head.line-sel.anchor.line)+1):head=sel.head.line<sel.anchor.line?sel.head:Pos(sel.anchor.line,0);else if("endOfSelectedArea"==insertAt)vim.visualBlock?(head=Pos(Math.min(sel.head.line,sel.anchor.line),Math.max(sel.head.ch+1,sel.anchor.ch)),height=Math.abs(sel.head.line-sel.anchor.line)+1):head=sel.head.line>=sel.anchor.line?offsetCursor(sel.head,0,1):Pos(sel.anchor.line,0);else if("inplace"==insertAt&&vim.visualMode)return;cm.setOption("keyMap","vim-insert"),cm.setOption("disableInput",!1),actionArgs&&actionArgs.replace?(cm.toggleOverwrite(!0),cm.setOption("keyMap","vim-replace"),CodeMirror.signal(cm,"vim-mode-change",{mode:"replace"})):(cm.setOption("keyMap","vim-insert"),CodeMirror.signal(cm,"vim-mode-change",{mode:"insert"})),vimGlobalState.macroModeState.isPlaying||(cm.on("change",onChange),CodeMirror.on(cm.getInputField(),"keydown",onKeyEventTargetKeyDown)),vim.visualMode&&exitVisualMode(cm),selectForInsert(cm,head,height)}},toggleVisualMode:function(cm,actionArgs,vim){var head,repeat=actionArgs.repeat,anchor=cm.getCursor();vim.visualMode?vim.visualLine^actionArgs.linewise||vim.visualBlock^actionArgs.blockwise?(vim.visualLine=!!actionArgs.linewise,vim.visualBlock=!!actionArgs.blockwise,CodeMirror.signal(cm,"vim-mode-change",{mode:"visual",subMode:vim.visualLine?"linewise":vim.visualBlock?"blockwise":""}),updateCmSelection(cm)):exitVisualMode(cm):(vim.visualMode=!0,vim.visualLine=!!actionArgs.linewise,vim.visualBlock=!!actionArgs.blockwise,head=clipCursorToContent(cm,Pos(anchor.line,anchor.ch+repeat-1),!0),vim.sel={anchor:anchor,head:head},CodeMirror.signal(cm,"vim-mode-change",{mode:"visual",subMode:vim.visualLine?"linewise":vim.visualBlock?"blockwise":""}),updateCmSelection(cm),updateMark(cm,vim,"<",cursorMin(anchor,head)),updateMark(cm,vim,">",cursorMax(anchor,head)))},reselectLastSelection:function(cm,_actionArgs,vim){var lastSelection=vim.lastSelection;if(vim.visualMode&&updateLastSelection(cm,vim),lastSelection){var anchor=lastSelection.anchorMark.find(),head=lastSelection.headMark.find();if(!anchor||!head)return;vim.sel={anchor:anchor,head:head},vim.visualMode=!0,vim.visualLine=lastSelection.visualLine,vim.visualBlock=lastSelection.visualBlock,updateCmSelection(cm),updateMark(cm,vim,"<",cursorMin(anchor,head)),updateMark(cm,vim,">",cursorMax(anchor,head)),CodeMirror.signal(cm,"vim-mode-change",{mode:"visual",subMode:vim.visualLine?"linewise":vim.visualBlock?"blockwise":""})}},joinLines:function(cm,actionArgs,vim){var curStart,curEnd;if(vim.visualMode){if(curStart=cm.getCursor("anchor"),curEnd=cm.getCursor("head"),cursorIsBefore(curEnd,curStart)){var tmp=curEnd;curEnd=curStart,curStart=tmp}curEnd.ch=lineLength(cm,curEnd.line)-1}else{var repeat=Math.max(actionArgs.repeat,2);curStart=cm.getCursor(),curEnd=clipCursorToContent(cm,Pos(curStart.line+repeat-1,1/0))}for(var finalCh=0,i=curStart.line;i<curEnd.line;i++){finalCh=lineLength(cm,curStart.line);var tmp=Pos(curStart.line+1,lineLength(cm,curStart.line+1)),text=cm.getRange(curStart,tmp);text=text.replace(/\n\s*/g," "),cm.replaceRange(text,curStart,tmp)}var curFinalPos=Pos(curStart.line,finalCh);vim.visualMode&&exitVisualMode(cm,!1),cm.setCursor(curFinalPos)},newLineAndEnterInsertMode:function(cm,actionArgs,vim){vim.insertMode=!0;var insertAt=copyCursor(cm.getCursor());if(insertAt.line!==cm.firstLine()||actionArgs.after){insertAt.line=actionArgs.after?insertAt.line:insertAt.line-1,insertAt.ch=lineLength(cm,insertAt.line),cm.setCursor(insertAt);var newlineFn=CodeMirror.commands.newlineAndIndentContinueComment||CodeMirror.commands.newlineAndIndent;newlineFn(cm)}else cm.replaceRange("\n",Pos(cm.firstLine(),0)),cm.setCursor(cm.firstLine(),0);this.enterInsertMode(cm,{repeat:actionArgs.repeat},vim)},paste:function(cm,actionArgs,vim){var cur=copyCursor(cm.getCursor()),register=vimGlobalState.registerController.getRegister(actionArgs.registerName),text=register.toString();if(text){if(actionArgs.matchIndent){var tabSize=cm.getOption("tabSize"),whitespaceLength=function(str){var tabs=str.split("	").length-1,spaces=str.split(" ").length-1;return tabs*tabSize+1*spaces},currentLine=cm.getLine(cm.getCursor().line),indent=whitespaceLength(currentLine.match(/^\s*/)[0]),chompedText=text.replace(/\n$/,""),wasChomped=text!==chompedText,firstIndent=whitespaceLength(text.match(/^\s*/)[0]),text=chompedText.replace(/^\s*/gm,function(wspace){var newIndent=indent+(whitespaceLength(wspace)-firstIndent);if(0>newIndent)return"";if(cm.getOption("indentWithTabs")){var quotient=Math.floor(newIndent/tabSize);return Array(quotient+1).join("	")}return Array(newIndent+1).join(" ")});text+=wasChomped?"\n":""}if(actionArgs.repeat>1)var text=Array(actionArgs.repeat+1).join(text);var linewise=register.linewise,blockwise=register.blockwise;if(linewise&&!blockwise)vim.visualMode?text=vim.visualLine?text.slice(0,-1):"\n"+text.slice(0,text.length-1)+"\n":actionArgs.after?(text="\n"+text.slice(0,text.length-1),cur.ch=lineLength(cm,cur.line)):cur.ch=0;else{if(blockwise){text=text.split("\n");for(var i=0;i<text.length;i++)text[i]=""==text[i]?" ":text[i]}cur.ch+=actionArgs.after?1:0}var curPosFinal,idx;if(vim.visualMode){vim.lastPastedText=text;var lastSelectionCurEnd,selectedArea=getSelectedAreaRange(cm,vim),selectionStart=selectedArea[0],selectionEnd=selectedArea[1],selectedText=cm.getSelection(),selections=cm.listSelections(),emptyStrings=new Array(selections.length).join("1").split("1");vim.lastSelection&&(lastSelectionCurEnd=vim.lastSelection.headMark.find()),vimGlobalState.registerController.unnamedRegister.setText(selectedText),blockwise?(cm.replaceSelections(emptyStrings),selectionEnd=Pos(selectionStart.line+text.length-1,selectionStart.ch),cm.setCursor(selectionStart),selectBlock(cm,selectionEnd),cm.replaceSelections(text),curPosFinal=selectionStart):vim.visualBlock?(cm.replaceSelections(emptyStrings),cm.setCursor(selectionStart),cm.replaceRange(text,selectionStart,selectionStart),curPosFinal=selectionStart):(cm.replaceRange(text,selectionStart,selectionEnd),curPosFinal=cm.posFromIndex(cm.indexFromPos(selectionStart)+text.length-1)),lastSelectionCurEnd&&(vim.lastSelection.headMark=cm.setBookmark(lastSelectionCurEnd)),linewise&&(curPosFinal.ch=0)}else if(blockwise){cm.setCursor(cur);for(var i=0;i<text.length;i++){var line=cur.line+i;line>cm.lastLine()&&cm.replaceRange("\n",Pos(line,0));var lastCh=lineLength(cm,line);lastCh<cur.ch&&extendLineToColumn(cm,line,cur.ch)}cm.setCursor(cur),selectBlock(cm,Pos(cur.line+text.length-1,cur.ch)),cm.replaceSelections(text),curPosFinal=cur}else cm.replaceRange(text,cur),linewise&&actionArgs.after?curPosFinal=Pos(cur.line+1,findFirstNonWhiteSpaceCharacter(cm.getLine(cur.line+1))):linewise&&!actionArgs.after?curPosFinal=Pos(cur.line,findFirstNonWhiteSpaceCharacter(cm.getLine(cur.line))):!linewise&&actionArgs.after?(idx=cm.indexFromPos(cur),curPosFinal=cm.posFromIndex(idx+text.length-1)):(idx=cm.indexFromPos(cur),curPosFinal=cm.posFromIndex(idx+text.length));vim.visualMode&&exitVisualMode(cm,!1),cm.setCursor(curPosFinal)}},undo:function(cm,actionArgs){cm.operation(function(){repeatFn(cm,CodeMirror.commands.undo,actionArgs.repeat)(),cm.setCursor(cm.getCursor("anchor"))})},redo:function(cm,actionArgs){repeatFn(cm,CodeMirror.commands.redo,actionArgs.repeat)()},setRegister:function(_cm,actionArgs,vim){vim.inputState.registerName=actionArgs.selectedCharacter},setMark:function(cm,actionArgs,vim){var markName=actionArgs.selectedCharacter;updateMark(cm,vim,markName,cm.getCursor())},replace:function(cm,actionArgs,vim){var replaceTo,curEnd,replaceWith=actionArgs.selectedCharacter,curStart=cm.getCursor(),selections=cm.listSelections();if(vim.visualMode)curStart=cm.getCursor("start"),curEnd=cm.getCursor("end");else{var line=cm.getLine(curStart.line);replaceTo=curStart.ch+actionArgs.repeat,replaceTo>line.length&&(replaceTo=line.length),curEnd=Pos(curStart.line,replaceTo)}if("\n"==replaceWith)vim.visualMode||cm.replaceRange("",curStart,curEnd),(CodeMirror.commands.newlineAndIndentContinueComment||CodeMirror.commands.newlineAndIndent)(cm);else{var replaceWithStr=cm.getRange(curStart,curEnd);if(replaceWithStr=replaceWithStr.replace(/[^\n]/g,replaceWith),vim.visualBlock){var spaces=new Array(cm.getOption("tabSize")+1).join(" ");replaceWithStr=cm.getSelection(),replaceWithStr=replaceWithStr.replace(/\t/g,spaces).replace(/[^\n]/g,replaceWith).split("\n"),cm.replaceSelections(replaceWithStr)}else cm.replaceRange(replaceWithStr,curStart,curEnd);vim.visualMode?(curStart=cursorIsBefore(selections[0].anchor,selections[0].head)?selections[0].anchor:selections[0].head,cm.setCursor(curStart),exitVisualMode(cm,!1)):cm.setCursor(offsetCursor(curEnd,0,-1))}},incrementNumberToken:function(cm,actionArgs){for(var match,start,end,numberStr,token,cur=cm.getCursor(),lineStr=cm.getLine(cur.line),re=/-?\d+/g;null!==(match=re.exec(lineStr))&&(token=match[0],start=match.index,end=start+token.length,!(cur.ch<end)););if((actionArgs.backtrack||!(end<=cur.ch))&&token){var increment=actionArgs.increase?1:-1,number=parseInt(token)+increment*actionArgs.repeat,from=Pos(cur.line,start),to=Pos(cur.line,end);numberStr=number.toString(),cm.replaceRange(numberStr,from,to),cm.setCursor(Pos(cur.line,start+numberStr.length-1))}},repeatLastEdit:function(cm,actionArgs,vim){var lastEditInputState=vim.lastEditInputState;if(lastEditInputState){var repeat=actionArgs.repeat;repeat&&actionArgs.repeatIsExplicit?vim.lastEditInputState.repeatOverride=repeat:repeat=vim.lastEditInputState.repeatOverride||repeat,repeatLastEdit(cm,vim,repeat,!1)}},exitInsertMode:exitInsertMode},symbolToMode={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},findSymbolModes={bracket:{isComplete:function(state){if(state.nextCh===state.symb){if(state.depth++,state.depth>=1)return!0}else state.nextCh===state.reverseSymb&&state.depth--;return!1}},section:{init:function(state){state.curMoveThrough=!0,state.symb=(state.forward?"]":"[")===state.symb?"{":"}"},isComplete:function(state){return 0===state.index&&state.nextCh===state.symb}},comment:{isComplete:function(state){var found="*"===state.lastCh&&"/"===state.nextCh;return state.lastCh=state.nextCh,found}},method:{init:function(state){state.symb="m"===state.symb?"{":"}",state.reverseSymb="{"===state.symb?"}":"{"},isComplete:function(state){return state.nextCh===state.symb?!0:!1}},preprocess:{init:function(state){state.index=0},isComplete:function(state){if("#"===state.nextCh){var token=state.lineText.match(/#(\w+)/)[1];if("endif"===token){if(state.forward&&0===state.depth)return!0;state.depth++}else if("if"===token){if(!state.forward&&0===state.depth)return!0;state.depth--}if("else"===token&&0===state.depth)return!0}return!1}}};defineOption("pcre",!0,"boolean"),SearchState.prototype={getQuery:function(){return vimGlobalState.query},setQuery:function(query){vimGlobalState.query=query},getOverlay:function(){return this.searchOverlay},setOverlay:function(overlay){this.searchOverlay=overlay},isReversed:function(){return vimGlobalState.isReversed},setReversed:function(reversed){vimGlobalState.isReversed=reversed},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(annotate){this.annotate=annotate}};var charUnescapes={"\\n":"\n","\\r":"\r","\\t":"	"},unescapes={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"	"},searchPromptDesc="(Javascript regexp)",ExCommandDispatcher=function(){this.buildCommandMap_()};ExCommandDispatcher.prototype={processCommand:function(cm,input,opt_params){var that=this;cm.operation(function(){cm.curOp.isVimOp=!0,that._processCommand(cm,input,opt_params)})},_processCommand:function(cm,input,opt_params){var vim=cm.state.vim,commandHistoryRegister=vimGlobalState.registerController.getRegister(":"),previousCommand=commandHistoryRegister.toString();vim.visualMode&&exitVisualMode(cm);var inputStream=new CodeMirror.StringStream(input);commandHistoryRegister.setText(input);var params=opt_params||{};params.input=input;try{this.parseInput_(cm,inputStream,params)}catch(e){throw showConfirm(cm,e),e}var command,commandName;if(params.commandName){if(command=this.matchCommand_(params.commandName)){if(commandName=command.name,command.excludeFromCommandHistory&&commandHistoryRegister.setText(previousCommand),this.parseCommandArgs_(inputStream,params,command),"exToKey"==command.type){for(var i=0;i<command.toKeys.length;i++)CodeMirror.Vim.handleKey(cm,command.toKeys[i],"mapping");return}if("exToEx"==command.type)return void this.processCommand(cm,command.toInput)}}else void 0!==params.line&&(commandName="move");if(!commandName)return void showConfirm(cm,'Not an editor command ":'+input+'"');try{exCommands[commandName](cm,params),command&&command.possiblyAsync||!params.callback||params.callback()}catch(e){throw showConfirm(cm,e),e}},parseInput_:function(cm,inputStream,result){inputStream.eatWhile(":"),inputStream.eat("%")?(result.line=cm.firstLine(),result.lineEnd=cm.lastLine()):(result.line=this.parseLineSpec_(cm,inputStream),void 0!==result.line&&inputStream.eat(",")&&(result.lineEnd=this.parseLineSpec_(cm,inputStream)));var commandMatch=inputStream.match(/^(\w+)/);return commandMatch?result.commandName=commandMatch[1]:result.commandName=inputStream.match(/.*/)[0],result},parseLineSpec_:function(cm,inputStream){var numberMatch=inputStream.match(/^(\d+)/);if(numberMatch)return parseInt(numberMatch[1],10)-1;switch(inputStream.next()){case".":return cm.getCursor().line;case"$":return cm.lastLine();case"'":var mark=cm.state.vim.marks[inputStream.next()];if(mark&&mark.find())return mark.find().line;throw new Error("Mark not set");default:return void inputStream.backUp(1)}},parseCommandArgs_:function(inputStream,params,command){if(!inputStream.eol()){params.argString=inputStream.match(/.*/)[0];var delim=command.argDelimiter||/\s+/,args=trim(params.argString).split(delim);args.length&&args[0]&&(params.args=args)}},matchCommand_:function(commandName){for(var i=commandName.length;i>0;i--){var prefix=commandName.substring(0,i);if(this.commandMap_[prefix]){var command=this.commandMap_[prefix];if(0===command.name.indexOf(commandName))return command}}return null},buildCommandMap_:function(){this.commandMap_={};for(var i=0;i<defaultExCommandMap.length;i++){var command=defaultExCommandMap[i],key=command.shortName||command.name;this.commandMap_[key]=command}},map:function(lhs,rhs,ctx){if(":"!=lhs&&":"==lhs.charAt(0)){if(ctx)throw Error("Mode not supported for ex mappings");var commandName=lhs.substring(1);":"!=rhs&&":"==rhs.charAt(0)?this.commandMap_[commandName]={name:commandName,type:"exToEx",toInput:rhs.substring(1),user:!0}:this.commandMap_[commandName]={name:commandName,type:"exToKey",toKeys:rhs,user:!0}}else if(":"!=rhs&&":"==rhs.charAt(0)){var mapping={keys:lhs,type:"keyToEx",exArgs:{input:rhs.substring(1)},user:!0};ctx&&(mapping.context=ctx),defaultKeymap.unshift(mapping)}else{var mapping={keys:lhs,type:"keyToKey",toKeys:rhs,user:!0};ctx&&(mapping.context=ctx),defaultKeymap.unshift(mapping)}},unmap:function(lhs,ctx){if(":"!=lhs&&":"==lhs.charAt(0)){if(ctx)throw Error("Mode not supported for ex mappings");var commandName=lhs.substring(1);if(this.commandMap_[commandName]&&this.commandMap_[commandName].user)return void delete this.commandMap_[commandName]}else for(var keys=lhs,i=0;i<defaultKeymap.length;i++)if(keys==defaultKeymap[i].keys&&defaultKeymap[i].context===ctx&&defaultKeymap[i].user)return void defaultKeymap.splice(i,1)}};var exCommands={colorscheme:function(cm,params){return!params.args||params.args.length<1?void showConfirm(cm,cm.getOption("theme")):void cm.setOption("theme",params.args[0])},map:function(cm,params,ctx){var mapArgs=params.args;return!mapArgs||mapArgs.length<2?void(cm&&showConfirm(cm,"Invalid mapping: "+params.input)):void exCommandDispatcher.map(mapArgs[0],mapArgs[1],ctx)},imap:function(cm,params){this.map(cm,params,"insert")},nmap:function(cm,params){this.map(cm,params,"normal")},vmap:function(cm,params){this.map(cm,params,"visual")},unmap:function(cm,params,ctx){var mapArgs=params.args;return!mapArgs||mapArgs.length<1?void(cm&&showConfirm(cm,"No such mapping: "+params.input)):void exCommandDispatcher.unmap(mapArgs[0],ctx)},move:function(cm,params){commandDispatcher.processCommand(cm,cm.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:params.line+1})},set:function(cm,params){var setArgs=params.args,setCfg=params.setCfg||{};if(!setArgs||setArgs.length<1)return void(cm&&showConfirm(cm,"Invalid mapping: "+params.input));var expr=setArgs[0].split("="),optionName=expr[0],value=expr[1],forceGet=!1;if("?"==optionName.charAt(optionName.length-1)){if(value)throw Error("Trailing characters: "+params.argString);optionName=optionName.substring(0,optionName.length-1),forceGet=!0}void 0===value&&"no"==optionName.substring(0,2)&&(optionName=optionName.substring(2),value=!1);var optionIsBoolean=options[optionName]&&"boolean"==options[optionName].type;if(optionIsBoolean&&void 0==value&&(value=!0),!optionIsBoolean&&void 0===value||forceGet){var oldValue=getOption(optionName,cm,setCfg);oldValue===!0||oldValue===!1?showConfirm(cm," "+(oldValue?"":"no")+optionName):showConfirm(cm,"  "+optionName+"="+oldValue)}else setOption(optionName,value,cm,setCfg)},setlocal:function(cm,params){params.setCfg={scope:"local"},this.set(cm,params)},setglobal:function(cm,params){params.setCfg={scope:"global"},this.set(cm,params)},registers:function(cm,params){var regArgs=params.args,registers=vimGlobalState.registerController.registers,regInfo="----------Registers----------<br><br>";if(regArgs){var registerName;regArgs=regArgs.join("");for(var i=0;i<regArgs.length;i++)if(registerName=regArgs.charAt(i),vimGlobalState.registerController.isValidRegister(registerName)){var register=registers[registerName]||new Register;regInfo+='"'+registerName+"    "+register.toString()+"<br>"}}else for(var registerName in registers){var text=registers[registerName].toString();text.length&&(regInfo+='"'+registerName+"    "+text+"<br>")}showConfirm(cm,regInfo)},sort:function(cm,params){function parseArgs(){if(params.argString){var args=new CodeMirror.StringStream(params.argString);if(args.eat("!")&&(reverse=!0),args.eol())return;if(!args.eatSpace())return"Invalid arguments";var opts=args.match(/[a-z]+/);if(opts){opts=opts[0],ignoreCase=-1!=opts.indexOf("i"),unique=-1!=opts.indexOf("u");var decimal=-1!=opts.indexOf("d")&&1,hex=-1!=opts.indexOf("x")&&1,octal=-1!=opts.indexOf("o")&&1;if(decimal+hex+octal>1)return"Invalid arguments";number=decimal&&"decimal"||hex&&"hex"||octal&&"octal"}if(args.match(/\/.*\//))return"patterns not supported"}}function compareFn(a,b){if(reverse){var tmp;tmp=a,a=b,b=tmp}ignoreCase&&(a=a.toLowerCase(),b=b.toLowerCase());var anum=number&&numberRegex.exec(a),bnum=number&&numberRegex.exec(b);return anum?(anum=parseInt((anum[1]+anum[2]).toLowerCase(),radix),bnum=parseInt((bnum[1]+bnum[2]).toLowerCase(),radix),anum-bnum):b>a?-1:1}var reverse,ignoreCase,unique,number,err=parseArgs();if(err)return void showConfirm(cm,err+": "+params.argString);var lineStart=params.line||cm.firstLine(),lineEnd=params.lineEnd||params.line||cm.lastLine();if(lineStart!=lineEnd){var curStart=Pos(lineStart,0),curEnd=Pos(lineEnd,lineLength(cm,lineEnd)),text=cm.getRange(curStart,curEnd).split("\n"),numberRegex="decimal"==number?/(-?)([\d]+)/:"hex"==number?/(-?)(?:0x)?([0-9a-f]+)/i:"octal"==number?/([0-7]+)/:null,radix="decimal"==number?10:"hex"==number?16:"octal"==number?8:null,numPart=[],textPart=[];if(number)for(var i=0;i<text.length;i++)numberRegex.exec(text[i])?numPart.push(text[i]):textPart.push(text[i]);else textPart=text;if(numPart.sort(compareFn),textPart.sort(compareFn),text=reverse?numPart.concat(textPart):textPart.concat(numPart),unique){var lastLine,textOld=text;text=[];for(var i=0;i<textOld.length;i++)textOld[i]!=lastLine&&text.push(textOld[i]),lastLine=textOld[i]}cm.replaceRange(text.join("\n"),curStart,curEnd)}},global:function(cm,params){var argString=params.argString;if(!argString)return void showConfirm(cm,"Regular Expression missing from global");var cmd,lineStart=void 0!==params.line?params.line:cm.firstLine(),lineEnd=params.lineEnd||params.line||cm.lastLine(),tokens=splitBySlash(argString),regexPart=argString;if(tokens.length&&(regexPart=tokens[0],cmd=tokens.slice(1,tokens.length).join("/")),regexPart)try{updateSearchQuery(cm,regexPart,!0,!0)}catch(e){return void showConfirm(cm,"Invalid regex: "+regexPart)}for(var query=getSearchState(cm).getQuery(),matchedLines=[],content="",i=lineStart;lineEnd>=i;i++){var matched=query.test(cm.getLine(i));matched&&(matchedLines.push(i+1),content+=cm.getLine(i)+"<br>")}if(!cmd)return void showConfirm(cm,content);var index=0,nextCommand=function(){if(index<matchedLines.length){var command=matchedLines[index]+cmd;exCommandDispatcher.processCommand(cm,command,{callback:nextCommand})}index++};nextCommand()},substitute:function(cm,params){if(!cm.getSearchCursor)throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var regexPart,trailing,flagsPart,count,argString=params.argString,tokens=argString?splitBySlash(argString):[],replacePart="",confirm=!1,global=!1;if(tokens.length)regexPart=tokens[0],replacePart=tokens[1],void 0!==replacePart&&(replacePart=getOption("pcre")?unescapeRegexReplace(replacePart):translateRegexReplace(replacePart),vimGlobalState.lastSubstituteReplacePart=replacePart),trailing=tokens[2]?tokens[2].split(" "):[];else if(argString&&argString.length)return void showConfirm(cm,"Substitutions should be of the form :s/pattern/replace/");if(trailing&&(flagsPart=trailing[0],count=parseInt(trailing[1]),flagsPart&&(-1!=flagsPart.indexOf("c")&&(confirm=!0,flagsPart.replace("c","")),-1!=flagsPart.indexOf("g")&&(global=!0,flagsPart.replace("g","")),regexPart=regexPart+"/"+flagsPart)),regexPart)try{updateSearchQuery(cm,regexPart,!0,!0)}catch(e){return void showConfirm(cm,"Invalid regex: "+regexPart)}if(replacePart=replacePart||vimGlobalState.lastSubstituteReplacePart,void 0===replacePart)return void showConfirm(cm,"No previous substitute regular expression");var state=getSearchState(cm),query=state.getQuery(),lineStart=void 0!==params.line?params.line:cm.getCursor().line,lineEnd=params.lineEnd||lineStart;lineStart==cm.firstLine()&&lineEnd==cm.lastLine()&&(lineEnd=1/0),count&&(lineStart=lineEnd,lineEnd=lineStart+count-1);var startPos=clipCursorToContent(cm,Pos(lineStart,0)),cursor=cm.getSearchCursor(query,startPos);doReplace(cm,confirm,global,lineStart,lineEnd,cursor,query,replacePart,params.callback)},redo:CodeMirror.commands.redo,undo:CodeMirror.commands.undo,write:function(cm){CodeMirror.commands.save?CodeMirror.commands.save(cm):cm.save()},nohlsearch:function(cm){clearSearchHighlight(cm)},delmarks:function(cm,params){if(!params.argString||!trim(params.argString))return void showConfirm(cm,"Argument required");for(var state=cm.state.vim,stream=new CodeMirror.StringStream(trim(params.argString));!stream.eol();){stream.eatSpace();var count=stream.pos;if(!stream.match(/[a-zA-Z]/,!1))return void showConfirm(cm,"Invalid argument: "+params.argString.substring(count));var sym=stream.next();if(stream.match("-",!0)){if(!stream.match(/[a-zA-Z]/,!1))return void showConfirm(cm,"Invalid argument: "+params.argString.substring(count));var startMark=sym,finishMark=stream.next();if(!(isLowerCase(startMark)&&isLowerCase(finishMark)||isUpperCase(startMark)&&isUpperCase(finishMark)))return void showConfirm(cm,"Invalid argument: "+startMark+"-");var start=startMark.charCodeAt(0),finish=finishMark.charCodeAt(0);if(start>=finish)return void showConfirm(cm,"Invalid argument: "+params.argString.substring(count));for(var j=0;finish-start>=j;j++){var mark=String.fromCharCode(start+j);delete state.marks[mark]}}else delete state.marks[sym]}}},exCommandDispatcher=new ExCommandDispatcher;CodeMirror.keyMap.vim={attach:attachVimMap,detach:detachVimMap,call:cmKey},defineOption("insertModeEscKeysTimeout",200,"number"),CodeMirror.keyMap["vim-insert"]={"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete",Enter:function(cm){var fn=CodeMirror.commands.newlineAndIndentContinueComment||CodeMirror.commands.newlineAndIndent;fn(cm)},fallthrough:["default"],attach:attachVimMap,detach:detachVimMap,call:cmKey},CodeMirror.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:attachVimMap,detach:detachVimMap,call:cmKey},resetVimGlobalState(),CodeMirror.Vim=Vim(),Vim=CodeMirror.Vim;var specialKey={"return":"CR",backspace:"BS","delete":"Del",esc:"Esc",left:"Left",right:"Right",up:"Up",down:"Down",space:"Space",home:"Home",end:"End",pageup:"PageUp",pagedown:"PageDown",enter:"CR"},handleKey=Vim.handleKey.bind(Vim);Vim.handleKey=function(cm,key,origin){return cm.operation(function(){return handleKey(cm,key,origin)},!0)},exports.CodeMirror=CodeMirror;var getVim=Vim.maybeInitVimState_;exports.handler={$id:"ace/keyboard/vim",drawCursor:function(style,pixelPos,config,sel,session){var vim=this.state.vim||{},w=config.characterWidth,h=config.lineHeight,top=pixelPos.top,left=pixelPos.left;if(!vim.insertMode){var isbackwards=sel.cursor?Range.comparePoints(sel.cursor,sel.start)<=0:session.selection.isBackwards()||session.selection.isEmpty();!isbackwards&&left>w&&(left-=w)}!vim.insertMode&&vim.status&&(h/=2,top+=h),style.left=left+"px",style.top=top+"px",style.width=w+"px",style.height=h+"px"},handleKeyboard:function(data,hashId,key,keyCode,e){var editor=data.editor,cm=editor.state.cm,vim=getVim(cm);if(-1!=keyCode){if("c"==key&&1==hashId){if(!useragent.isMac&&editor.getCopyText())return editor.once("copy",function(){editor.selection.clearSelection()}),{command:"null",passEvent:!0}}else vim.insertMode||useragent.isMac&&this.handleMacRepeat(data,hashId,key)&&(hashId=-1,key=data.inputChar);if(-1==hashId||1&hashId||0===hashId&&key.length>1){var insertMode=vim.insertMode,name=lookupKey(hashId,key,e||{});null==vim.status&&(vim.status="");var isHandled=multiSelectHandleKey(cm,name,"user");if(vim=getVim(cm),isHandled&&null!=vim.status?vim.status+=name:null==vim.status&&(vim.status=""),cm._signal("changeStatus"),!isHandled&&(-1!=hashId||insertMode))return;return{command:"null",passEvent:!isHandled}}}},attach:function(editor){editor.state||(editor.state={});var cm=new CodeMirror(editor);editor.state.cm=cm,editor.$vimModeHandler=this,CodeMirror.keyMap.vim.attach(cm),getVim(cm).status=null,cm.on("vim-command-done",function(){cm.virtualSelectionMode()||(getVim(cm).status=null,cm.ace._signal("changeStatus"),cm.ace.session.markUndoGroup())}),cm.on("changeStatus",function(){cm.ace.renderer.updateCursor(),cm.ace._signal("changeStatus")}),cm.on("vim-mode-change",function(){cm.virtualSelectionMode()||(cm.ace.renderer.setStyle("normal-mode",!getVim(cm).insertMode),cm._signal("changeStatus"))}),cm.ace.renderer.setStyle("normal-mode",!getVim(cm).insertMode),editor.renderer.$cursorLayer.drawCursor=this.drawCursor.bind(cm),this.updateMacCompositionHandlers(editor,!0)},detach:function(editor){var cm=editor.state.cm;CodeMirror.keyMap.vim.detach(cm),cm.destroy(),editor.state.cm=null,editor.$vimModeHandler=null,editor.renderer.$cursorLayer.drawCursor=null,editor.renderer.setStyle("normal-mode",!1),this.updateMacCompositionHandlers(editor,!1)},getStatusText:function(editor){var cm=editor.state.cm,vim=getVim(cm);if(vim.insertMode)return"INSERT";var status="";return vim.visualMode&&(status+="VISUAL",vim.visualLine&&(status+=" LINE"),vim.visualBlock&&(status+=" BLOCK")),vim.status&&(status+=(status?" ":"")+vim.status),status},handleMacRepeat:function(data,hashId,key){if(-1==hashId)data.inputChar=key,data.lastEvent="input";else if(data.inputChar&&data.$lastHash==hashId&&data.$lastKey==key){if("input"==data.lastEvent)data.lastEvent="input1";else if("input1"==data.lastEvent)return!0}else data.$lastHash=hashId,data.$lastKey=key,data.lastEvent="keypress"},updateMacCompositionHandlers:function(editor,enable){var onCompositionUpdateOverride=function(text){var cm=editor.state.cm,vim=getVim(cm);if(vim.insertMode)this.onCompositionUpdateOrig(text);else{var el=this.textInput.getElement();el.blur(),el.focus(),el.value=text}},onCompositionStartOverride=function(text){var cm=editor.state.cm,vim=getVim(cm);vim.insertMode||this.onCompositionStartOrig(text)};enable?editor.onCompositionUpdateOrig||(editor.onCompositionUpdateOrig=editor.onCompositionUpdate,editor.onCompositionUpdate=onCompositionUpdateOverride,editor.onCompositionStartOrig=editor.onCompositionStart,editor.onCompositionStart=onCompositionStartOverride):editor.onCompositionUpdateOrig&&(editor.onCompositionUpdate=editor.onCompositionUpdateOrig,editor.onCompositionUpdateOrig=null,editor.onCompositionStart=editor.onCompositionStartOrig,editor.onCompositionStartOrig=null)}};Vim.defineOption({name:"wrap",set:function(value,cm){cm&&cm.ace.setOption("wrap",value)},type:"boolean"},!1),Vim.defineEx("write","w",function(){console.log(":write is not implemented")}),defaultKeymap.push({keys:"zc",type:"action",action:"fold",actionArgs:{open:!1}},{keys:"zC",type:"action",action:"fold",actionArgs:{open:!1,all:!0}},{keys:"zo",type:"action",action:"fold",actionArgs:{open:!0}},{keys:"zO",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"za",type:"action",action:"fold",
actionArgs:{toggle:!0}},{keys:"zA",type:"action",action:"fold",actionArgs:{toggle:!0,all:!0}},{keys:"zf",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"zd",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"<C-A-k>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorAbove"}},{keys:"<C-A-j>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorBelow"}},{keys:"<C-A-S-k>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorAboveSkipCurrent"}},{keys:"<C-A-S-j>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorBelowSkipCurrent"}},{keys:"<C-A-h>",type:"action",action:"aceCommand",actionArgs:{name:"selectMoreBefore"}},{keys:"<C-A-l>",type:"action",action:"aceCommand",actionArgs:{name:"selectMoreAfter"}},{keys:"<C-A-S-h>",type:"action",action:"aceCommand",actionArgs:{name:"selectNextBefore"}},{keys:"<C-A-S-l>",type:"action",action:"aceCommand",actionArgs:{name:"selectNextAfter"}}),actions.aceCommand=function(cm,actionArgs,vim){cm.vimCmd=actionArgs,cm.ace.inVirtualSelectionMode?cm.ace.on("beforeEndOperation",delayedExecAceCommand):delayedExecAceCommand(null,cm.ace)},actions.fold=function(cm,actionArgs,vim){cm.ace.execCommand(["toggleFoldWidget","toggleFoldWidget","foldOther","unfoldall"][(actionArgs.all?2:0)+(actionArgs.open?1:0)])},exports.handler.defaultKeymap=defaultKeymap,exports.handler.actions=actions,exports.Vim=Vim,Vim.map("Y","yy","normal")}),define("ace/keybinding-vim",function(){}),function(){define("ide/editor/directives/aceEditor/undo/UndoManager",["ace/ace"],function(){var Doc,EditSession,Range,UndoManager;return Range=ace.require("ace/range").Range,EditSession=ace.require("ace/edit_session").EditSession,Doc=ace.require("ace/document").Document,UndoManager=function(){function UndoManager($scope,editor){this.$scope=$scope,this.editor=editor,this.$scope.undo={show_remote_warning:!1},this.reset(),this.editor.on("changeSession",function(_this){return function(e){return _this.reset(),_this.session=e.session,e.session.setUndoManager(_this)}}(this))}return UndoManager.prototype.showUndoConflictWarning=function(){return this.$scope.$apply(function(_this){return function(){return _this.$scope.undo.show_remote_warning=!0}}(this)),setTimeout(function(_this){return function(){return _this.$scope.$apply(function(){return _this.$scope.undo.show_remote_warning=!1})}}(this),4e3)},UndoManager.prototype.reset=function(){return this.firstUpdate=!0,this.undoStack=[],this.redoStack=[]},UndoManager.prototype.execute=function(options){var aceDeltaSets,currentDeltaSet,currentRemoteState,delta,deltaSet,docLines,frame,i,j,l,len,len1,len2,newDeltaSet,ref,ref1,ref2,simpleDeltaSet,splitDeltaSets;if(this.firstUpdate)return void(this.firstUpdate=!1);if(aceDeltaSets=options.args[0],null!=aceDeltaSets){for(this.session=options.args[1],splitDeltaSets=[],currentDeltaSet=null,(newDeltaSet=function(){return currentDeltaSet={group:"doc",deltas:[]},splitDeltaSets.push(currentDeltaSet)})(),currentRemoteState=null,ref=aceDeltaSets||[],i=0,len=ref.length;len>i;i++)if(deltaSet=ref[i],"doc"===deltaSet.group)for(ref1=deltaSet.deltas,j=0,len1=ref1.length;len1>j;j++)delta=ref1[j],null!=currentDeltaSet.remote&&currentDeltaSet.remote!==!!delta.remote&&newDeltaSet(),currentDeltaSet.deltas.push(delta),currentDeltaSet.remote=!!delta.remote;for(docLines=this.session.getDocument().getAllLines(),docLines=this._revertAceDeltaSetsOnDocLines(aceDeltaSets,docLines),l=0,len2=splitDeltaSets.length;len2>l;l++)deltaSet=splitDeltaSets[l],ref2=this._aceDeltaSetToSimpleDeltaSet(deltaSet,docLines),simpleDeltaSet=ref2.simpleDeltaSet,docLines=ref2.docLines,frame={deltaSets:[simpleDeltaSet],remote:deltaSet.remote},this.undoStack.push(frame);return this.redoStack=[]}},UndoManager.prototype.undo=function(dontSelect){var deltaSets,lines,linesBeforeDelta,localUpdatesMade,selectionRange,update;return this.session.$syncInformUndoManager(),localUpdatesMade=this._shiftLocalChangeToTopOfUndoStack(),localUpdatesMade&&(update=this.undoStack.pop(),null!=update)?(update.remote&&this.showUndoConflictWarning(),lines=this.session.getDocument().getAllLines(),linesBeforeDelta=this._revertSimpleDeltaSetsOnDocLines(update.deltaSets,lines),deltaSets=this._simpleDeltaSetsToAceDeltaSets(update.deltaSets,linesBeforeDelta),selectionRange=this.session.undoChanges(deltaSets,dontSelect),this.redoStack.push(update),selectionRange):void 0},UndoManager.prototype.redo=function(dontSelect){var deltaSets,lines,selectionRange,update;return update=this.redoStack.pop(),null!=update?(lines=this.session.getDocument().getAllLines(),deltaSets=this._simpleDeltaSetsToAceDeltaSets(update.deltaSets,lines),selectionRange=this.session.redoChanges(deltaSets,dontSelect),this.undoStack.push(update),selectionRange):void 0},UndoManager.prototype._shiftLocalChangeToTopOfUndoStack=function(){var head,localChange,localChangeExists,remoteChange,reorderedHead,result,update;for(head=[],localChangeExists=!1;this.undoStack.length>0;)if(update=this.undoStack.pop(),head.unshift(update),!update.remote){localChangeExists=!0;break}if(localChangeExists){for(localChange=head.shift(),reorderedHead=[localChange];head.length>0;){if(remoteChange=head.shift(),localChange=reorderedHead.pop(),result=this._swapSimpleDeltaSetsOrder(localChange.deltaSets,remoteChange.deltaSets),null==result){reorderedHead.push(localChange),reorderedHead.push(remoteChange);break}remoteChange.deltaSets=result[0],localChange.deltaSets=result[1],reorderedHead.push(remoteChange),reorderedHead.push(localChange)}return this.undoStack=this.undoStack.concat(reorderedHead).concat(head),!0}return this.undoStack=this.undoStack.concat(head),!1},UndoManager.prototype._swapSimpleDeltaSetsOrder=function(firstDeltaSets,secondDeltaSets){var firstDelta,firstDeltaSet,i,j,l,len,len1,len2,len3,m,newFirstDeltaSets,newSecondDeltaSets,ref,ref1,ref2,secondDelta,secondDeltaSet,success;for(newFirstDeltaSets=this._copyDeltaSets(firstDeltaSets),newSecondDeltaSets=this._copyDeltaSets(secondDeltaSets),ref=newFirstDeltaSets.slice(0).reverse(),i=0,len=ref.length;len>i;i++)for(firstDeltaSet=ref[i],ref1=firstDeltaSet.deltas.slice(0).reverse(),j=0,len1=ref1.length;len1>j;j++)for(firstDelta=ref1[j],l=0,len2=newSecondDeltaSets.length;len2>l;l++)for(secondDeltaSet=newSecondDeltaSets[l],ref2=secondDeltaSet.deltas,m=0,len3=ref2.length;len3>m;m++)if(secondDelta=ref2[m],success=this._swapSimpleDeltaOrderInPlace(firstDelta,secondDelta),!success)return null;return[newSecondDeltaSets,newFirstDeltaSets]},UndoManager.prototype._copyDeltaSets=function(deltaSets){var delta,deltaSet,i,j,len,len1,newDelta,newDeltaSet,newDeltaSets,ref;for(newDeltaSets=[],i=0,len=deltaSets.length;len>i;i++)for(deltaSet=deltaSets[i],newDeltaSet={deltas:[],group:deltaSet.group},newDeltaSets.push(newDeltaSet),ref=deltaSet.deltas,j=0,len1=ref.length;len1>j;j++)delta=ref[j],newDelta={position:delta.position},null!=delta.insert&&(newDelta.insert=delta.insert),null!=delta.remove&&(newDelta.remove=delta.remove),newDeltaSet.deltas.push(newDelta);return newDeltaSets},UndoManager.prototype._swapSimpleDeltaOrderInPlace=function(firstDelta,secondDelta){var result;return result=this._swapSimpleDeltaOrder(firstDelta,secondDelta),null==result?!1:(firstDelta.position=result[1].position,secondDelta.position=result[0].position,!0)},UndoManager.prototype._swapSimpleDeltaOrder=function(firstDelta,secondDelta){if(null!=firstDelta.insert&&null!=secondDelta.insert)return secondDelta.position>=firstDelta.position+firstDelta.insert.length?(secondDelta.position-=firstDelta.insert.length,[secondDelta,firstDelta]):secondDelta.position>firstDelta.position?null:(firstDelta.position+=secondDelta.insert.length,[secondDelta,firstDelta]);if(null!=firstDelta.remove&&null!=secondDelta.remove)return secondDelta.position>=firstDelta.position?(secondDelta.position+=firstDelta.remove.length,[secondDelta,firstDelta]):secondDelta.position+secondDelta.remove.length>firstDelta.position?null:(firstDelta.position-=secondDelta.remove.length,[secondDelta,firstDelta]);if(null!=firstDelta.insert&&null!=secondDelta.remove)return secondDelta.position>=firstDelta.position+firstDelta.insert.length?(secondDelta.position-=firstDelta.insert.length,[secondDelta,firstDelta]):secondDelta.position+secondDelta.remove.length>firstDelta.position?null:(firstDelta.position-=secondDelta.remove.length,[secondDelta,firstDelta]);if(null!=firstDelta.remove&&null!=secondDelta.insert)return secondDelta.position>=firstDelta.position?(secondDelta.position+=firstDelta.remove.length,[secondDelta,firstDelta]):(firstDelta.position+=secondDelta.insert.length,[secondDelta,firstDelta]);throw"Unknown delta types"},UndoManager.prototype._applyAceDeltasToDocLines=function(deltas,docLines){var doc;return doc=new Doc(docLines.join("\n")),doc.applyDeltas(deltas),doc.getAllLines()},UndoManager.prototype._revertAceDeltaSetsOnDocLines=function(deltaSets,docLines){var session;return session=new EditSession(docLines.join("\n")),session.undoChanges(deltaSets),session.getDocument().getAllLines()},UndoManager.prototype._revertSimpleDeltaSetsOnDocLines=function(deltaSets,docLines){var delta,deltaSet,doc,i,j,len,len1,ref,ref1;for(doc=docLines.join("\n"),ref=deltaSets.slice(0).reverse(),i=0,len=ref.length;len>i;i++)for(deltaSet=ref[i],ref1=deltaSet.deltas.slice(0).reverse(),j=0,len1=ref1.length;len1>j;j++)if(delta=ref1[j],null!=delta.remove)doc=doc.slice(0,delta.position)+delta.remove+doc.slice(delta.position);else{if(null==delta.insert)throw"Unknown delta type";doc=doc.slice(0,delta.position)+doc.slice(delta.position+delta.insert.length)}return doc.split("\n")},UndoManager.prototype._aceDeltaSetToSimpleDeltaSet=function(deltaSet,docLines){var delta,i,len,ref,simpleDeltaSet,simpleDeltas;for(simpleDeltas=[],ref=deltaSet.deltas,i=0,len=ref.length;len>i;i++)delta=ref[i],simpleDeltas.push(this._aceDeltaToSimpleDelta(delta,docLines)),docLines=this._applyAceDeltasToDocLines([delta],docLines);return simpleDeltaSet={deltas:simpleDeltas,group:deltaSet.group},{simpleDeltaSet:simpleDeltaSet,docLines:docLines}},UndoManager.prototype._simpleDeltaSetsToAceDeltaSets=function(simpleDeltaSets,docLines){var aceDeltas,delta,deltaSet,i,j,len,len1,newAceDeltas,ref,results;for(results=[],i=0,len=simpleDeltaSets.length;len>i;i++){for(deltaSet=simpleDeltaSets[i],aceDeltas=[],ref=deltaSet.deltas,j=0,len1=ref.length;len1>j;j++)delta=ref[j],newAceDeltas=this._simpleDeltaToAceDeltas(delta,docLines),docLines=this._applyAceDeltasToDocLines(newAceDeltas,docLines),aceDeltas=aceDeltas.concat(newAceDeltas);results.push({deltas:aceDeltas,group:deltaSet.group})}return results},UndoManager.prototype._aceDeltaToSimpleDelta=function(aceDelta,docLines){var JSONstringifyWithCycles,error,linesBefore,position,simpleDelta,start;if(start=aceDelta.start,null==start)throw JSONstringifyWithCycles=function(o){var seen;return seen=[],JSON.stringify(o,function(k,v){if("object"==typeof v){if(seen.indexOf(v)>=0)return"__cycle__";seen.push(v)}return v})},error=new Error("aceDelta had no start event: "+JSONstringifyWithCycles(aceDelta));switch(linesBefore=docLines.slice(0,start.row),position=linesBefore.join("").length+linesBefore.length+start.column,aceDelta.action){case"insert":simpleDelta={position:position,insert:aceDelta.lines.join("\n")};break;case"remove":simpleDelta={position:position,remove:aceDelta.lines.join("\n")};break;default:throw new Error("Unknown Ace action: "+aceDelta.action)}return simpleDelta},UndoManager.prototype._simplePositionToAcePosition=function(position,docLines){var column,i,len,line,row;for(column=0,row=0,i=0,len=docLines.length;len>i;i++){if(line=docLines[i],!(position>line.length)){column=position;break}row++,position-=(line+"\n").length}return{row:row,column:column}},UndoManager.prototype._simpleDeltaToAceDeltas=function(simpleDelta,docLines){var aceDelta,column,end,lines,ref,row,start;if(ref=this._simplePositionToAcePosition(simpleDelta.position,docLines),row=ref.row,column=ref.column,lines=(simpleDelta.insert||simpleDelta.remove||"").split("\n"),start={column:column,row:row},end=lines.length>1?{row:row+lines.length-1,column:lines[lines.length-1].length}:{row:row,column:column+lines[0].length},null!=simpleDelta.insert)aceDelta={action:"insert",lines:lines,start:start,end:end};else{if(null==simpleDelta.remove)throw"Unknown simple delta: "+simpleDelta;aceDelta={action:"remove",lines:lines,start:start,end:end}}return[aceDelta]},UndoManager.prototype._concatSimpleDeltas=function(deltas){var concattedDeltas,delta,i,len,previousDelta;if(0===deltas.length)return[];for(concattedDeltas=[],previousDelta=deltas.shift(),i=0,len=deltas.length;len>i;i++)delta=deltas[i],null!=delta.insert&&null!=previousDelta.insert?previousDelta.position+previousDelta.insert.length===delta.position?previousDelta={insert:previousDelta.insert+delta.insert,position:previousDelta.position}:(concattedDeltas.push(previousDelta),previousDelta=delta):null!=delta.remove&&null!=previousDelta.remove&&previousDelta.position===delta.position?previousDelta={remove:previousDelta.remove+delta.remove,position:delta.position}:(concattedDeltas.push(previousDelta),previousDelta=delta);return concattedDeltas.push(previousDelta),concattedDeltas},UndoManager.prototype.hasUndo=function(){return this.undoStack.length>0},UndoManager.prototype.hasRedo=function(){return this.redoStack.length>0},UndoManager}()})}.call(this),function(){define("ide/editor/directives/aceEditor/auto-complete/snippets/TopHundredSnippets",[],function(){return[{caption:"\\begin{}",snippet:"\\begin{$1}",meta:"env",score:7.849662248028187},{caption:"\\begin{}[]",snippet:"\\begin{$1}[$2]",meta:"env",score:7.849662248028187},{caption:"\\begin{}{}",snippet:"\\begin{$1}{$2}",meta:"env",score:7.849662248028187},{caption:"\\end{}",snippet:"\\end{$1}",meta:"env",score:7.847906405228455},{caption:"\\usepackage[]{}",snippet:"\\usepackage[$1]{$2}",meta:"pkg",score:5.427890758130527},{caption:"\\item",snippet:"\\item",meta:"cmd",score:3.800886892251021},{caption:"\\item[]",snippet:"\\item[$1]",meta:"cmd",score:3.800886892251021},{caption:"\\section{}",snippet:"\\section{$1}",meta:"cmd",score:3.0952612541683835},{caption:"\\textbf{}",snippet:"\\textbf{$1}",meta:"cmd",score:2.627755982816738},{caption:"\\cite{}",snippet:"\\cite{$1}",meta:"cmd",score:2.341195220791228},{caption:"\\label{}",snippet:"\\label{$1}",meta:"cmd",score:1.897791904799601},{caption:"\\textit{}",snippet:"\\textit{$1}",meta:"cmd",score:1.6842996195493385},{caption:"\\includegraphics[]{}",snippet:"\\includegraphics[$1]{$2}",meta:"cmd",score:1.4595731795525781},{caption:"\\documentclass[]{}",snippet:"\\documentclass[$1]{$2}",meta:"cmd",score:1.4425339817971206},{caption:"\\documentclass{}",snippet:"\\documentclass{$1}",meta:"cmd",score:1.4425339817971206},{caption:"\\ref{}",snippet:"\\ref{$1}",meta:"cross-reference",score:.014379554883991673},{caption:"\\frac{}{}",snippet:"\\frac{$1}{$2}",meta:"cmd",score:1.4341091141105058},{caption:"\\subsection{}",snippet:"\\subsection{$1}",meta:"cmd",score:1.3890912739512353},{caption:"\\hline",snippet:"\\hline",meta:"cmd",score:1.3209538327406387},{caption:"\\caption{}",snippet:"\\caption{$1}",meta:"cmd",score:1.2569477427490174},{caption:"\\centering",snippet:"\\centering",meta:"cmd",score:1.1642881814937829},{caption:"\\vspace{}",snippet:"\\vspace{$1}",meta:"cmd",score:.9533807826673939},{caption:"\\title{}",snippet:"\\title{$1}",meta:"cmd",score:.9202908262245683},{caption:"\\author{}",snippet:"\\author{$1}",meta:"cmd",score:.8973590434087177},{caption:"\\author[]{}",snippet:"\\author[$1]{$2}",meta:"cmd",score:.8973590434087177},{caption:"\\maketitle",snippet:"\\maketitle",meta:"cmd",score:.7504160124360846},{caption:"\\textwidth",snippet:"\\textwidth",meta:"cmd",score:.7355328080889112},{caption:"\\newcommand{}{}",snippet:"\\newcommand{$1}{$2}",meta:"cmd",score:.7264891987129375},{caption:"\\newcommand{}[]{}",snippet:"\\newcommand{$1}[$2]{$3}",meta:"cmd",score:.7264891987129375},{caption:"\\date{}",snippet:"\\date{$1}",meta:"cmd",score:.7225518453076786},{caption:"\\emph{}",snippet:"\\emph{$1}",meta:"cmd",score:.7060308784832261},{caption:"\\textsc{}",snippet:"\\textsc{$1}",meta:"cmd",score:.6926466355384758},{caption:"\\multicolumn{}{}{}",snippet:"\\multicolumn{$1}{$2}{$3}",meta:"cmd",score:.5473606021405326},{caption:"\\input{}",snippet:"\\input{$1}",meta:"cmd",score:.4966021927742672},{caption:"\\alpha",snippet:"\\alpha",meta:"cmd",score:.49520006391384913},{caption:"\\in",snippet:"\\in",meta:"cmd",score:.4716039670146658},{caption:"\\mathbf{}",snippet:"\\mathbf{$1}",meta:"cmd",score:.4682018419466319},{caption:"\\right",snippet:"\\right",meta:"cmd",score:.4299239459457309},{caption:"\\left",snippet:"\\left",meta:"cmd",score:.42937815279867964},{caption:"\\left[]",snippet:"\\left[$1]",meta:"cmd",score:.42937815279867964},{caption:"\\sum",snippet:"\\sum",meta:"cmd",score:.42607994509619934},{caption:"\\noindent",snippet:"\\noindent",meta:"cmd",score:.42355747798114207},{caption:"\\chapter{}",snippet:"\\chapter{$1}",meta:"cmd",score:.422097569591803},{caption:"\\par",snippet:"\\par",meta:"cmd",score:.413853376001159},{caption:"\\lambda",snippet:"\\lambda",meta:"cmd",score:.39389600578684125},{caption:"\\subsubsection{}",snippet:"\\subsubsection{$1}",meta:"cmd",score:.3727781330132016},{caption:"\\bibitem{}",snippet:"\\bibitem{$1}",meta:"cmd",score:.3689547570562042},{caption:"\\bibitem[]{}",snippet:"\\bibitem[$1]{$2}",meta:"cmd",score:.3689547570562042},{caption:"\\text{}",snippet:"\\text{$1}",meta:"cmd",score:.3608680734736821},{caption:"\\setlength{}{}",snippet:"\\setlength{$1}{$2}",meta:"cmd",score:.354445763583904},{caption:"\\setlength",snippet:"\\setlength",meta:"cmd",score:.354445763583904},{caption:"\\mathcal{}",snippet:"\\mathcal{$1}",meta:"cmd",score:.35084018920966636},{caption:"\\newline",snippet:"\\newline",meta:"cmd",score:.3311721696201715},{caption:"\\newpage",snippet:"\\newpage",meta:"cmd",score:.3277033727934986},{caption:"\\renewcommand{}{}",snippet:"\\renewcommand{$1}{$2}",meta:"cmd",score:.3267437011085663},{caption:"\\renewcommand",snippet:"\\renewcommand",meta:"cmd",score:.3267437011085663},{caption:"\\theta",snippet:"\\theta",meta:"cmd",score:.3210417159232142},{caption:"\\hspace{}",snippet:"\\hspace{$1}",meta:"cmd",score:.3147206476372336},{caption:"\\beta",snippet:"\\beta",meta:"cmd",score:.3061799530337638},{caption:"\\texttt{}",snippet:"\\texttt{$1}",meta:"cmd",score:.3019066753744355},{caption:"\\times",snippet:"\\times",meta:"cmd",score:.2957960629411553},{caption:"\\citep{}",snippet:"\\citep{$1}",meta:"cmd",score:.2941882834697057},{caption:"\\color[]{}",snippet:"\\color[$1]{$2}",meta:"cmd",score:.2864294797053033},{caption:"\\color{}",snippet:"\\color{$1}",meta:"cmd",score:.2864294797053033},{caption:"\\mu",snippet:"\\mu",meta:"cmd",score:.27635652476799255},{caption:"\\bibliography{}",snippet:"\\bibliography{$1}",meta:"cmd",score:.2659628337907604},{caption:"\\linewidth",snippet:"\\linewidth",meta:"cmd",score:.2639498312518439},{caption:"\\delta",snippet:"\\delta",meta:"cmd",score:.2620578600722735},{caption:"\\sigma",snippet:"\\sigma",meta:"cmd",score:.25940147926344487},{caption:"\\pi",snippet:"\\pi",meta:"cmd",score:.25920934567729714},{caption:"\\hat{}",snippet:"\\hat{$1}",meta:"cmd",score:.25264309033778715},{caption:"\\hat",snippet:"\\hat",meta:"cmd",score:.25264309033778715},{caption:"\\bibliographystyle{}",snippet:"\\bibliographystyle{$1}",meta:"cmd",score:.25122317941387773},{caption:"\\small",snippet:"\\small",meta:"cmd",score:.2447632045426295},{caption:"\\small{}",snippet:"\\small{$1}",meta:"cmd",score:.2447632045426295},{caption:"\\LaTeX",snippet:"\\LaTeX",meta:"cmd",score:.2334089308452787},{caption:"\\LaTeX{}",snippet:"\\LaTeX{$1}",meta:"cmd",score:.2334089308452787},{caption:"\\cdot",snippet:"\\cdot",meta:"cmd",score:.23029085545522762},{caption:"\\footnote{}",snippet:"\\footnote{$1}",meta:"cmd",score:.2253056071787701},{caption:"\\newtheorem{}[]{}",snippet:"\\newtheorem{$1}[$2]{$3}",meta:"cmd",score:.215689795055434},{caption:"\\newtheorem{}{}",snippet:"\\newtheorem{$1}{$2}",meta:"cmd",score:.215689795055434},{caption:"\\newtheorem{}{}[]",snippet:"\\newtheorem{$1}{$2}[$3]",meta:"cmd",score:.215689795055434},{caption:"\\Delta",snippet:"\\Delta",meta:"cmd",score:.21386475063892618},{caption:"\\tau",snippet:"\\tau",meta:"cmd",score:.21236188205859796},{caption:"\\hfill",snippet:"\\hfill",meta:"cmd",score:.2058248088519886},{caption:"\\leq",snippet:"\\leq",meta:"cmd",score:.20498894440637172},{caption:"\\footnotesize",snippet:"\\footnotesize",meta:"cmd",score:.2038592081252624},{caption:"\\footnotesize{}",snippet:"\\footnotesize{$1}",meta:"cmd",score:.2038592081252624},{caption:"\\large",snippet:"\\large",meta:"cmd",score:.20377416734108866},{caption:"\\large{}",snippet:"\\large{$1}",meta:"cmd",score:.20377416734108866},{caption:"\\sqrt{}",snippet:"\\sqrt{$1}",meta:"cmd",score:.20240160977404634},{caption:"\\epsilon",snippet:"\\epsilon",meta:"cmd",score:.2005136761359043},{caption:"\\Large",snippet:"\\Large",meta:"cmd",score:.1987771081149759},{caption:"\\Large{}",snippet:"\\Large{$1}",meta:"cmd",score:.1987771081149759},{caption:"\\cvitem{}{}",snippet:"\\cvitem{$1}{$2}",meta:"cmd",score:.19605476980016281},{caption:"\\rho",snippet:"\\rho",meta:"cmd",score:.1959287380541684},{caption:"\\omega",snippet:"\\omega",meta:"cmd",score:.19326783415115262},{caption:"\\mathrm{}",snippet:"\\mathrm{$1}",meta:"cmd",score:.19117752976172653},{caption:"\\boldsymbol{}",snippet:"\\boldsymbol{$1}",meta:"cmd",score:.18137737738638837},{caption:"\\boldsymbol",snippet:"\\boldsymbol",meta:"cmd",score:.18137737738638837},{caption:"\\gamma",snippet:"\\gamma",meta:"cmd",score:.17940276535431304},{caption:"\\clearpage",snippet:"\\clearpage",meta:"cmd",score:.1789117552185788},{caption:"\\infty",snippet:"\\infty",meta:"cmd",score:.17837290019711305},{caption:"\\phi",snippet:"\\phi",meta:"cmd",score:.17405809173097808},{caption:"\\partial",snippet:"\\partial",meta:"cmd",score:.17168102367966637},{caption:"\\include{}",snippet:"\\include{$1}",meta:"cmd",score:.1547080054979312},{caption:"\\address{}",snippet:"\\address{$1}",meta:"cmd",score:.1525055392611109},{caption:"\\address[]{}",snippet:"\\address[$1]{$2}",meta:"cmd",score:.1525055392611109},{caption:"\\address{}{}{}",snippet:"\\address{$1}{$2}{$3}",meta:"cmd",score:.1525055392611109},{caption:"\\quad",snippet:"\\quad",meta:"cmd",score:.15242755832392743},{caption:"\\email{}",snippet:"\\email{$1}",meta:"cmd",score:.1522294670109857},{caption:"\\paragraph{}",snippet:"\\paragraph{$1}",meta:"cmd",score:.152074250347974},{caption:"\\varepsilon",snippet:"\\varepsilon",meta:"cmd",score:.05411564201390573},{caption:"\\zeta",snippet:"\\zeta",meta:"cmd",score:.023330249803752954},{caption:"\\eta",snippet:"\\eta",meta:"cmd",score:.11088718379889091},{caption:"\\vartheta",snippet:"\\vartheta",meta:"cmd",score:.0025822992078068712},{caption:"\\iota",snippet:"\\iota",meta:"cmd",score:.0024774003791525486},{caption:"\\kappa",snippet:"\\kappa",meta:"cmd",score:.04887876299369008},{caption:"\\nu",snippet:"\\nu",meta:"cmd",score:.09206962821059342},{caption:"\\xi",snippet:"\\xi",meta:"cmd",score:.06496042899265699},{caption:"\\varpi",snippet:"\\varpi",meta:"cmd",score:.0007039358167790341},{caption:"\\varrho",snippet:"\\varrho",meta:"cmd",score:.0011279491613898612},{caption:"\\varsigma",snippet:"\\varsigma",meta:"cmd",score:.0010424880711234978},{caption:"\\varsigma{}",snippet:"\\varsigma{$1}",meta:"cmd",score:.0010424880711234978},{caption:"\\upsilon",snippet:"\\upsilon",meta:"cmd",score:.00420715572598688},{caption:"\\varphi",snippet:"\\varphi",meta:"cmd",score:.03351251516668212},{caption:"\\chi",snippet:"\\chi",meta:"cmd",score:.043373492287805675},{caption:"\\psi",snippet:"\\psi",meta:"cmd",score:.09994508706163642},{caption:"\\Gamma",snippet:"\\Gamma",meta:"cmd",score:.04801549269801977},{caption:"\\Theta",snippet:"\\Theta",meta:"cmd",score:.038090902146599444},{caption:"\\Lambda",snippet:"\\Lambda",meta:"cmd",score:.032206594305977686},{caption:"\\Xi",snippet:"\\Xi",meta:"cmd",score:.01060997225400494},{caption:"\\Pi",snippet:"\\Pi",meta:"cmd",score:.021264671817473237},{caption:"\\Sigma",snippet:"\\Sigma",meta:"cmd",score:.05769642802079917},{caption:"\\Upsilon",snippet:"\\Upsilon",meta:"cmd",score:.00032875192955749566},{caption:"\\Phi",snippet:"\\Phi",meta:"cmd",score:.0538724950042562},{caption:"\\Psi",snippet:"\\Psi",meta:"cmd",score:.03056589143021648},{caption:"\\Omega",snippet:"\\Omega",meta:"cmd",score:.09490387997853639}]})}.call(this),function(){define("ide/editor/directives/aceEditor/auto-complete/CommandManager",["./snippets/TopHundredSnippets"],function(topHundred){var CommandManager,Parser;return Parser=function(){function Parser(doc1,prefix1){this.doc=doc1,this.prefix=prefix1}return Parser.prototype.parse=function(){var args,bestMatch,command,commandHash,docState,incidentalCommands,iterations,limit,optionalArgs,realCommands,ref,seen;for(limit=null,("undefined"!=typeof window&&null!==window&&null!=(ref=window._ide)?ref.browserIsSafari:void 0)&&(limit=5e3),realCommands=[],incidentalCommands=[],seen={},iterations=0;command=this.nextCommand();){if(iterations+=1,limit&&iterations>limit)return realCommands;for(docState=this.doc,optionalArgs=0;this.consumeArgument("[","]");)optionalArgs++;for(args=0;this.consumeArgument("{","}");)args++;commandHash=command+"\\"+optionalArgs+"\\"+args,null!=this.prefix&&"\\"+command===this.prefix?incidentalCommands.push([command,optionalArgs,args]):null==seen[commandHash]&&(seen[commandHash]=!0,realCommands.push([command,optionalArgs,args])),this.doc=docState}return incidentalCommands.length>1&&(bestMatch=incidentalCommands.sort(function(_this){return function(a,b){return a[1]+a[2]<b[1]+b[2]}}(this))[0],realCommands.push(bestMatch)),realCommands},Parser.prototype.commandRegex=/\\([a-zA-Z]{2,})/,Parser.prototype.nextCommand=function(){var i,match;return i=this.doc.search(this.commandRegex),-1===i?!1:(match=this.doc.match(this.commandRegex)[1],this.doc=this.doc.substr(i+match.length+1),match)},Parser.prototype.consumeWhitespace=function(){var match;return match=this.doc.match(/^[ \t\n]*/m)[0],this.doc=this.doc.substr(match.length)},Parser.prototype.consumeArgument=function(openingBracket,closingBracket){var bracketParity,i;if(this.consumeWhitespace(),this.doc[0]===openingBracket){for(i=1,bracketParity=1;bracketParity>0&&i<this.doc.length;)this.doc[i]===openingBracket?bracketParity++:this.doc[i]===closingBracket&&bracketParity--,i++;return 0===bracketParity?(this.doc=this.doc.substr(i),!0):!1}return!1},Parser}(),CommandManager=function(){function CommandManager(metadataManager){this.metadataManager=metadataManager}return CommandManager.prototype.getCompletions=function(editor,session,pos,prefix,callback){var caption,command,commandNames,commands,completions,doc,i,j,k,l,len,len1,len2,packageCommands,packages,parser,pkg,score,snippet,snippets;for(commandNames={},j=0,len=topHundred.length;len>j;j++)snippet=topHundred[j],commandNames[snippet.caption.match(/\w+/)[0]]=!0;packages=this.metadataManager.getAllPackages(),packageCommands=[];for(pkg in packages)for(snippets=packages[pkg],k=0,len1=snippets.length;len1>k;k++)snippet=snippets[k],packageCommands.push(snippet),commandNames[snippet.caption.match(/\w+/)[0]]=!0;for(doc=session.getValue(),parser=new Parser(doc,prefix),commands=parser.parse(),completions=[],l=0,len2=commands.length;len2>l;l++)command=commands[l],commandNames[command[0]]||(caption="\\"+command[0],score=caption===prefix?99:50,snippet=caption,i=1,_.times(command[1],function(){return snippet+="[${"+i+"}]",caption+="[]",i++}),_.times(command[2],function(){return snippet+="{${"+i+"}}",caption+="{}",i++}),completions.push({caption:caption,snippet:snippet,meta:"cmd",score:score}));return completions=completions.concat(topHundred,packageCommands),callback(null,completions)},CommandManager.prototype.loadCommandsFromDoc=function(doc){var parser;return parser=new Parser(doc),this.commands=parser.parse()},CommandManager.prototype.getSuggestions=function(commandFragment){var matchingCommands;return matchingCommands=_.filter(this.commands,function(command){return command[0].slice(0,commandFragment.length)===commandFragment}),_.map(matchingCommands,function(command){var args,base,completionAfterCursor,completionBase,completionBeforeCursor,curlyArgsNo,squareArgsNo,totalArgs;return base="\\"+commandFragment,args="",_.times(command[1],function(){return args+="[]"}),_.times(command[2],function(){return args+="{}"}),completionBase=command[0].slice(commandFragment.length),squareArgsNo=command[1],curlyArgsNo=command[2],totalArgs=squareArgsNo+curlyArgsNo,0===totalArgs?(completionBeforeCursor=completionBase,completionAfterCursor=""):(completionBeforeCursor=completionBase+args[0],completionAfterCursor=args.slice(1)),{base:base,completion:completionBase+args,completionBeforeCursor:completionBeforeCursor,completionAfterCursor:completionAfterCursor}})},CommandManager}()})}.call(this),function(){define("ide/editor/directives/aceEditor/auto-complete/snippets/Environments",[],function(){var envs,envsWithSnippets;return envs=["abstract","align","align*","equation","equation*","gather","gather*","multline","multline*","split","verbatim","quote","center"],envsWithSnippets=["array","figure","tabular","table","list","enumerate","itemize","frame","thebibliography"],{all:envs.concat(envsWithSnippets),withoutSnippets:envs}})}.call(this),function(){var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};define("ide/editor/directives/aceEditor/auto-complete/EnvironmentManager",["ide/editor/directives/aceEditor/auto-complete/snippets/Environments"],function(Environments){var EnvironmentManager,bibliographySnippet,documentSnippet,env,hasBibliographyEnvironment,hasDocumentEnvironment,parseBeginCommands,parseCustomEnvironments,staticSnippets;return staticSnippets=function(){var i,len,ref,results;for(ref=Environments.withoutSnippets,results=[],i=0,len=ref.length;len>i;i++)env=ref[i],results.push({caption:"\\begin{"+env+"}...",snippet:"\\begin{"+env+"}\n	$1\n\\end{"+env+"}",meta:"env"});return results}(),staticSnippets=staticSnippets.concat([{caption:"\\begin{array}...",snippet:"\\begin{array}{${1:cc}}\n	$2 & $3 \\\\\\\\\n	$4 & $5\n\\end{array}",meta:"env"},{caption:"\\begin{figure}...",snippet:"\\begin{figure}\n	\\centering\n	\\includegraphics{$1}\n	\\caption{${2:Caption}}\n	\\label{${3:fig:my_label}}\n\\end{figure}",meta:"env"},{caption:"\\begin{tabular}...",snippet:"\\begin{tabular}{${1:c|c}}\n	$2 & $3 \\\\\\\\\n	$4 & $5\n\\end{tabular}",meta:"env"},{caption:"\\begin{table}...",snippet:"\\begin{table}[$1]\n	\\centering\n	\\begin{tabular}{${2:c|c}}\n		$3 & $4 \\\\\\\\\n		$5 & $6\n	\\end{tabular}\n	\\caption{${7:Caption}}\n	\\label{${8:tab:my_label}}\n\\end{table}",meta:"env"},{caption:"\\begin{list}...",snippet:"\\begin{list}\n	\\item $1\n\\end{list}",meta:"env"},{caption:"\\begin{enumerate}...",snippet:"\\begin{enumerate}\n	\\item $1\n\\end{enumerate}",meta:"env"},{caption:"\\begin{itemize}...",snippet:"\\begin{itemize}\n	\\item $1\n\\end{itemize}",meta:"env"},{caption:"\\begin{frame}...",snippet:"\\begin{frame}{${1:Frame Title}}\n	$2\n\\end{frame}",meta:"env"}]),documentSnippet={caption:"\\begin{document}...",snippet:"\\begin{document}\n$1\n\\end{document}",meta:"env"},bibliographySnippet={caption:"\\begin{thebibliography}...",snippet:"\\begin{thebibliography}{$1}\n\\bibitem{$2}\n$3\n\\end{thebibliography}",meta:"env"},staticSnippets.push(documentSnippet),parseCustomEnvironments=function(text){var iterations,match,re,result;for(re=/^\\newenvironment{(\w+)}.*$/gm,result=[],iterations=0;match=re.exec(text);)if(result.push({name:match[1],whitespace:null}),iterations+=1,iterations>=1e3)return result;return result},parseBeginCommands=function(text){var iterations,match,re,ref,result;for(re=/^\\begin{(\w+)}.*\n([\t ]*).*$/gm,result=[],iterations=0;match=re.exec(text);)if(ref=match[1],indexOf.call(Environments.all,ref)<0&&"document"!==match[1]&&(result.push({
name:match[1],whitespace:match[2]}),iterations+=1,iterations>=1e3))return result;return result},hasDocumentEnvironment=function(text){var re;return re=/^\\begin{document}/m,null!==re.exec(text)},hasBibliographyEnvironment=function(text){var re;return re=/^\\begin{thebibliography}/m,null!==re.exec(text)},EnvironmentManager=function(){function EnvironmentManager(){}return EnvironmentManager.prototype.getCompletions=function(editor,session,pos,prefix,callback){var beginCommands,command,customEnvironments,docText,environment,i,ind,j,len,len1,parsedItems,parsedItemsMap,snippets;for(docText=session.getValue(),customEnvironments=parseCustomEnvironments(docText),beginCommands=parseBeginCommands(docText),hasDocumentEnvironment(docText)?(ind=staticSnippets.indexOf(documentSnippet),-1!==ind&&staticSnippets.splice(ind,1)):staticSnippets.push(documentSnippet),hasBibliographyEnvironment(docText)?(ind=staticSnippets.indexOf(bibliographySnippet),-1!==ind&&staticSnippets.splice(ind,1)):staticSnippets.push(bibliographySnippet),parsedItemsMap={},i=0,len=customEnvironments.length;len>i;i++)environment=customEnvironments[i],parsedItemsMap[environment.name]=environment;for(j=0,len1=beginCommands.length;len1>j;j++)command=beginCommands[j],parsedItemsMap[command.name]=command;return parsedItems=_.values(parsedItemsMap),snippets=staticSnippets.concat(parsedItems.map(function(item){return{caption:"\\begin{"+item.name+"}...",snippet:"\\begin{"+item.name+"}\n"+(item.whitespace||"")+"$0\n\\end{"+item.name+"}",meta:"env"}})).concat(parsedItems.map(function(item){return{caption:"\\end{"+item.name+"}",value:"\\end{"+item.name+"}",meta:"env"}})),callback(null,snippets)},EnvironmentManager}()})}.call(this),function(){var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};define("ide/editor/directives/aceEditor/auto-complete/PackageManager",[],function(){var PackageManager,packages;return packages=["inputenc","graphicx","amsmath","geometry","amssymb","hyperref","babel","color","xcolor","url","natbib","fontenc","fancyhdr","amsfonts","booktabs","amsthm","float","tikz","caption","setspace","multirow","array","multicol","titlesec","enumitem","ifthen","listings","blindtext","subcaption","times","bm","subfigure","algorithm","fontspec","biblatex","tabularx","microtype","etoolbox","parskip","calc","verbatim","mathtools","epsfig","wrapfig","lipsum","cite","textcomp","longtable","textpos","algpseudocode","enumerate","subfig","pdfpages","epstopdf","latexsym","lmodern","pifont","ragged2e","rotating","dcolumn","xltxtra","marvosym","indentfirst","xspace","csquotes","xparse","changepage","soul","xunicode","comment","mathrsfs","tocbibind","lastpage","algorithm2e","pgfplots","lineno","graphics","algorithmic","fullpage","mathptmx","todonotes","ulem","tweaklist","moderncvstyleclassic","collection","moderncvcompatibility","gensymb","helvet","siunitx","adjustbox","placeins","colortbl","appendix","makeidx","supertabular","ifpdf","framed","aliascnt","layaureo","authblk"],PackageManager=function(){function PackageManager(metadataManager){this.metadataManager=metadataManager}return PackageManager.prototype.getCompletions=function(editor,session,pos,prefix,callback){var i,len,packageSnippets,pkg,usedPackages;for(usedPackages=Object.keys(this.metadataManager.getAllPackages()),packageSnippets=[],i=0,len=packages.length;len>i;i++)pkg=packages[i],indexOf.call(usedPackages,pkg)<0&&packageSnippets.push({caption:"\\usepackage{"+pkg+"}",snippet:"\\usepackage{"+pkg+"}",meta:"pkg"});return packageSnippets.push({caption:"\\usepackage{}",snippet:"\\usepackage{$1}",meta:"pkg",score:70}),callback(null,packageSnippets)},PackageManager}()})}.call(this),ace.define("ace/snippets",["require","exports","module","ace/lib/oop","ace/lib/event_emitter","ace/lib/lang","ace/range","ace/anchor","ace/keyboard/hash_handler","ace/tokenizer","ace/lib/dom","ace/editor"],function(require,exports,module){"use strict";var oop=require("./lib/oop"),EventEmitter=require("./lib/event_emitter").EventEmitter,lang=require("./lib/lang"),Range=require("./range").Range,Anchor=require("./anchor").Anchor,HashHandler=require("./keyboard/hash_handler").HashHandler,Tokenizer=require("./tokenizer").Tokenizer,comparePoints=Range.comparePoints,SnippetManager=function(){this.snippetMap={},this.snippetNameMap={}};(function(){oop.implement(this,EventEmitter),this.getTokenizer=function(){function TabstopToken(str,_,stack){return str=str.substr(1),/^\d+$/.test(str)&&!stack.inFormatString?[{tabstopId:parseInt(str,10)}]:[{text:str}]}function escape(ch){return"(?:[^\\\\"+ch+"]|\\\\.)"}return SnippetManager.$tokenizer=new Tokenizer({start:[{regex:/:/,onMatch:function(val,state,stack){return stack.length&&stack[0].expectIf?(stack[0].expectIf=!1,stack[0].elseBranch=stack[0],[stack[0]]):":"}},{regex:/\\./,onMatch:function(val,state,stack){var ch=val[1];return"}"==ch&&stack.length?val=ch:-1!="`$\\".indexOf(ch)?val=ch:stack.inFormatString&&("n"==ch?val="\n":"t"==ch?val="\n":-1!="ulULE".indexOf(ch)&&(val={changeCase:ch,local:ch>"a"})),[val]}},{regex:/}/,onMatch:function(val,state,stack){return[stack.length?stack.shift():val]}},{regex:/\$(?:\d+|\w+)/,onMatch:TabstopToken},{regex:/\$\{[\dA-Z_a-z]+/,onMatch:function(str,state,stack){var t=TabstopToken(str.substr(1),state,stack);return stack.unshift(t[0]),t},next:"snippetVar"},{regex:/\n/,token:"newline",merge:!1}],snippetVar:[{regex:"\\|"+escape("\\|")+"*\\|",onMatch:function(val,state,stack){stack[0].choices=val.slice(1,-1).split(",")},next:"start"},{regex:"/("+escape("/")+"+)/(?:("+escape("/")+"*)/)(\\w*):?",onMatch:function(val,state,stack){var ts=stack[0];return ts.fmtString=val,val=this.splitRegex.exec(val),ts.guard=val[1],ts.fmt=val[2],ts.flag=val[3],""},next:"start"},{regex:"`"+escape("`")+"*`",onMatch:function(val,state,stack){return stack[0].code=val.splice(1,-1),""},next:"start"},{regex:"\\?",onMatch:function(val,state,stack){stack[0]&&(stack[0].expectIf=!0)},next:"start"},{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"start"}],formatString:[{regex:"/("+escape("/")+"+)/",token:"regex"},{regex:"",onMatch:function(val,state,stack){stack.inFormatString=!0},next:"start"}]}),SnippetManager.prototype.getTokenizer=function(){return SnippetManager.$tokenizer},SnippetManager.$tokenizer},this.tokenizeTmSnippet=function(str,startState){return this.getTokenizer().getLineTokens(str,startState).tokens.map(function(x){return x.value||x})},this.$getDefaultValue=function(editor,name){if(/^[A-Z]\d+$/.test(name)){var i=name.substr(1);return(this.variables[name[0]+"__"]||{})[i]}if(/^\d+$/.test(name))return(this.variables.__||{})[name];if(name=name.replace(/^TM_/,""),editor){var s=editor.session;switch(name){case"CURRENT_WORD":var r=s.getWordRange();case"SELECTION":case"SELECTED_TEXT":return s.getTextRange(r);case"CURRENT_LINE":return s.getLine(editor.getCursorPosition().row);case"PREV_LINE":return s.getLine(editor.getCursorPosition().row-1);case"LINE_INDEX":return editor.getCursorPosition().column;case"LINE_NUMBER":return editor.getCursorPosition().row+1;case"SOFT_TABS":return s.getUseSoftTabs()?"YES":"NO";case"TAB_SIZE":return s.getTabSize();case"FILENAME":case"FILEPATH":return"";case"FULLNAME":return"Ace"}}},this.variables={},this.getVariableValue=function(editor,varName){return this.variables.hasOwnProperty(varName)?this.variables[varName](editor,varName)||"":this.$getDefaultValue(editor,varName)||""},this.tmStrFormat=function(str,ch,editor){var flag=ch.flag||"",re=ch.guard;re=new RegExp(re,flag.replace(/[^gi]/,""));var fmtTokens=this.tokenizeTmSnippet(ch.fmt,"formatString"),_self=this,formatted=str.replace(re,function(){_self.variables.__=arguments;for(var fmtParts=_self.resolveVariables(fmtTokens,editor),gChangeCase="E",i=0;i<fmtParts.length;i++){var ch=fmtParts[i];if("object"==typeof ch)if(fmtParts[i]="",ch.changeCase&&ch.local){var next=fmtParts[i+1];next&&"string"==typeof next&&("u"==ch.changeCase?fmtParts[i]=next[0].toUpperCase():fmtParts[i]=next[0].toLowerCase(),fmtParts[i+1]=next.substr(1))}else ch.changeCase&&(gChangeCase=ch.changeCase);else"U"==gChangeCase?fmtParts[i]=ch.toUpperCase():"L"==gChangeCase&&(fmtParts[i]=ch.toLowerCase())}return fmtParts.join("")});return this.variables.__=null,formatted},this.resolveVariables=function(snippet,editor){function gotoNext(ch){var i1=snippet.indexOf(ch,i+1);-1!=i1&&(i=i1)}for(var result=[],i=0;i<snippet.length;i++){var ch=snippet[i];if("string"==typeof ch)result.push(ch);else{if("object"!=typeof ch)continue;if(ch.skip)gotoNext(ch);else{if(ch.processed<i)continue;if(ch.text){var value=this.getVariableValue(editor,ch.text);value&&ch.fmtString&&(value=this.tmStrFormat(value,ch)),ch.processed=i,null==ch.expectIf?value&&(result.push(value),gotoNext(ch)):value?ch.skip=ch.elseBranch:gotoNext(ch)}else null!=ch.tabstopId?result.push(ch):null!=ch.changeCase&&result.push(ch)}}}return result},this.insertSnippetForSelection=function(editor,snippetText){function copyValue(val){for(var copy=[],i=0;i<val.length;i++){var p=val[i];if("object"==typeof p){if(expanding[p.tabstopId])continue;var j=val.lastIndexOf(p,i-1);p=copy[j]||{tabstopId:p.tabstopId}}copy[i]=p}return copy}var cursor=editor.getCursorPosition(),line=editor.session.getLine(cursor.row),tabString=editor.session.getTabString(),indentString=line.match(/^\s*/)[0];cursor.column<indentString.length&&(indentString=indentString.slice(0,cursor.column)),snippetText=snippetText.replace(/\r/g,"");var tokens=this.tokenizeTmSnippet(snippetText);tokens=this.resolveVariables(tokens,editor),tokens=tokens.map(function(x){return"\n"==x?x+indentString:"string"==typeof x?x.replace(/\t/g,tabString):x});var tabstops=[];tokens.forEach(function(p,i){if("object"==typeof p){var id=p.tabstopId,ts=tabstops[id];if(ts||(ts=tabstops[id]=[],ts.index=id,ts.value=""),-1===ts.indexOf(p)){ts.push(p);var i1=tokens.indexOf(p,i+1);if(-1!==i1){var value=tokens.slice(i+1,i1),isNested=value.some(function(t){return"object"==typeof t});isNested&&!ts.value?ts.value=value:!value.length||ts.value&&"string"==typeof ts.value||(ts.value=value.join(""))}}}}),tabstops.forEach(function(ts){ts.length=0});for(var expanding={},i=0;i<tokens.length;i++){var p=tokens[i];if("object"==typeof p){var id=p.tabstopId,i1=tokens.indexOf(p,i+1);if(expanding[id])expanding[id]===p&&(expanding[id]=null);else{var ts=tabstops[id],arg="string"==typeof ts.value?[ts.value]:copyValue(ts.value);arg.unshift(i+1,Math.max(0,i1-i)),arg.push(p),expanding[id]=p,tokens.splice.apply(tokens,arg),-1===ts.indexOf(p)&&ts.push(p)}}}var row=0,column=0,text="";tokens.forEach(function(t){if("string"==typeof t){var lines=t.split("\n");lines.length>1?(column=lines[lines.length-1].length,row+=lines.length-1):column+=t.length,text+=t}else t.start?t.end={row:row,column:column}:t.start={row:row,column:column}});var range=editor.getSelectionRange(),end=editor.session.replace(range,text),tabstopManager=new TabstopManager(editor),selectionId=editor.inVirtualSelectionMode&&editor.selection.index;tabstopManager.addTabstops(tabstops,range.start,end,selectionId)},this.insertSnippet=function(editor,snippetText){var self=this;return editor.inVirtualSelectionMode?self.insertSnippetForSelection(editor,snippetText):(editor.forEachSelection(function(){self.insertSnippetForSelection(editor,snippetText)},null,{keepOrder:!0}),void(editor.tabstopManager&&editor.tabstopManager.tabNext()))},this.$getScope=function(editor){var scope=editor.session.$mode.$id||"";if(scope=scope.split("/").pop(),"html"===scope||"php"===scope){"php"!==scope||editor.session.$mode.inlinePhp||(scope="html");var c=editor.getCursorPosition(),state=editor.session.getState(c.row);"object"==typeof state&&(state=state[0]),state.substring&&("js-"==state.substring(0,3)?scope="javascript":"css-"==state.substring(0,4)?scope="css":"php-"==state.substring(0,4)&&(scope="php"))}return scope},this.getActiveScopes=function(editor){var scope=this.$getScope(editor),scopes=[scope],snippetMap=this.snippetMap;return snippetMap[scope]&&snippetMap[scope].includeScopes&&scopes.push.apply(scopes,snippetMap[scope].includeScopes),scopes.push("_"),scopes},this.expandWithTab=function(editor,options){var self=this,result=editor.forEachSelection(function(){return self.expandSnippetForSelection(editor,options)},null,{keepOrder:!0});return result&&editor.tabstopManager&&editor.tabstopManager.tabNext(),result},this.expandSnippetForSelection=function(editor,options){var snippet,cursor=editor.getCursorPosition(),line=editor.session.getLine(cursor.row),before=line.substring(0,cursor.column),after=line.substr(cursor.column),snippetMap=this.snippetMap;return this.getActiveScopes(editor).some(function(scope){var snippets=snippetMap[scope];return snippets&&(snippet=this.findMatchingSnippet(snippets,before,after)),!!snippet},this),snippet?options&&options.dryRun?!0:(editor.session.doc.removeInLine(cursor.row,cursor.column-snippet.replaceBefore.length,cursor.column+snippet.replaceAfter.length),this.variables.M__=snippet.matchBefore,this.variables.T__=snippet.matchAfter,this.insertSnippetForSelection(editor,snippet.content),this.variables.M__=this.variables.T__=null,!0):!1},this.findMatchingSnippet=function(snippetList,before,after){for(var i=snippetList.length;i--;){var s=snippetList[i];if((!s.startRe||s.startRe.test(before))&&(!s.endRe||s.endRe.test(after))&&(s.startRe||s.endRe))return s.matchBefore=s.startRe?s.startRe.exec(before):[""],s.matchAfter=s.endRe?s.endRe.exec(after):[""],s.replaceBefore=s.triggerRe?s.triggerRe.exec(before)[0]:"",s.replaceAfter=s.endTriggerRe?s.endTriggerRe.exec(after)[0]:"",s}},this.snippetMap={},this.snippetNameMap={},this.register=function(snippets,scope){function wrapRegexp(src){return src&&!/^\^?\(.*\)\$?$|^\\b$/.test(src)&&(src="(?:"+src+")"),src||""}function guardedRegexp(re,guard,opening){return re=wrapRegexp(re),guard=wrapRegexp(guard),opening?(re=guard+re,re&&"$"!=re[re.length-1]&&(re+="$")):(re+=guard,re&&"^"!=re[0]&&(re="^"+re)),new RegExp(re)}function addSnippet(s){s.scope||(s.scope=scope||"_"),scope=s.scope,snippetMap[scope]||(snippetMap[scope]=[],snippetNameMap[scope]={});var map=snippetNameMap[scope];if(s.name){var old=map[s.name];old&&self.unregister(old),map[s.name]=s}snippetMap[scope].push(s),s.tabTrigger&&!s.trigger&&(!s.guard&&/^\w/.test(s.tabTrigger)&&(s.guard="\\b"),s.trigger=lang.escapeRegExp(s.tabTrigger)),(s.trigger||s.guard||s.endTrigger||s.endGuard)&&(s.startRe=guardedRegexp(s.trigger,s.guard,!0),s.triggerRe=new RegExp(s.trigger,"",!0),s.endRe=guardedRegexp(s.endTrigger,s.endGuard,!0),s.endTriggerRe=new RegExp(s.endTrigger,"",!0))}var snippetMap=this.snippetMap,snippetNameMap=this.snippetNameMap,self=this;snippets||(snippets=[]),snippets&&snippets.content?addSnippet(snippets):Array.isArray(snippets)&&snippets.forEach(addSnippet),this._signal("registerSnippets",{scope:scope})},this.unregister=function(snippets,scope){function removeSnippet(s){var nameMap=snippetNameMap[s.scope||scope];if(nameMap&&nameMap[s.name]){delete nameMap[s.name];var map=snippetMap[s.scope||scope],i=map&&map.indexOf(s);i>=0&&map.splice(i,1)}}var snippetMap=this.snippetMap,snippetNameMap=this.snippetNameMap;snippets.content?removeSnippet(snippets):Array.isArray(snippets)&&snippets.forEach(removeSnippet)},this.parseSnippetFile=function(str){str=str.replace(/\r/g,"");for(var m,list=[],snippet={},re=/^#.*|^({[\s\S]*})\s*$|^(\S+) (.*)$|^((?:\n*\t.*)+)/gm;m=re.exec(str);){if(m[1])try{snippet=JSON.parse(m[1]),list.push(snippet)}catch(e){}if(m[4])snippet.content=m[4].replace(/^\t/gm,""),list.push(snippet),snippet={};else{var key=m[2],val=m[3];if("regex"==key){var guardRe=/\/((?:[^\/\\]|\\.)*)|$/g;snippet.guard=guardRe.exec(val)[1],snippet.trigger=guardRe.exec(val)[1],snippet.endTrigger=guardRe.exec(val)[1],snippet.endGuard=guardRe.exec(val)[1]}else"snippet"==key?(snippet.tabTrigger=val.match(/^\S*/)[0],snippet.name||(snippet.name=val)):snippet[key]=val}}return list},this.getSnippetByName=function(name,editor){var snippet,snippetMap=this.snippetNameMap;return this.getActiveScopes(editor).some(function(scope){var snippets=snippetMap[scope];return snippets&&(snippet=snippets[name]),!!snippet},this),snippet}}).call(SnippetManager.prototype);var TabstopManager=function(editor){return editor.tabstopManager?editor.tabstopManager:(editor.tabstopManager=this,this.$onChange=this.onChange.bind(this),this.$onChangeSelection=lang.delayedCall(this.onChangeSelection.bind(this)).schedule,this.$onChangeSession=this.onChangeSession.bind(this),this.$onAfterExec=this.onAfterExec.bind(this),void this.attach(editor))};(function(){this.attach=function(editor){this.index=0,this.ranges=[],this.tabstops=[],this.$openTabstops=null,this.selectedTabstop=null,this.editor=editor,this.editor.on("change",this.$onChange),this.editor.on("changeSelection",this.$onChangeSelection),this.editor.on("changeSession",this.$onChangeSession),this.editor.commands.on("afterExec",this.$onAfterExec),this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)},this.detach=function(){this.tabstops.forEach(this.removeTabstopMarkers,this),this.ranges=null,this.tabstops=null,this.selectedTabstop=null,this.editor.removeListener("change",this.$onChange),this.editor.removeListener("changeSelection",this.$onChangeSelection),this.editor.removeListener("changeSession",this.$onChangeSession),this.editor.commands.removeListener("afterExec",this.$onAfterExec),this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.tabstopManager=null,this.editor=null},this.onChange=function(delta){var isRemove="r"==delta.action[0],start=delta.start,end=delta.end,startRow=start.row,endRow=end.row,lineDif=endRow-startRow,colDiff=end.column-start.column;if(isRemove&&(lineDif=-lineDif,colDiff=-colDiff),!this.$inChange&&isRemove){var ts=this.selectedTabstop,changedOutside=ts&&!ts.some(function(r){return comparePoints(r.start,start)<=0&&comparePoints(r.end,end)>=0});if(changedOutside)return this.detach()}for(var ranges=this.ranges,i=0;i<ranges.length;i++){var r=ranges[i];r.end.row<start.row||(isRemove&&comparePoints(start,r.start)<0&&comparePoints(end,r.end)>0?(this.removeRange(r),i--):(r.start.row==startRow&&r.start.column>start.column&&(r.start.column+=colDiff),r.end.row==startRow&&r.end.column>=start.column&&(r.end.column+=colDiff),r.start.row>=startRow&&(r.start.row+=lineDif),r.end.row>=startRow&&(r.end.row+=lineDif),comparePoints(r.start,r.end)>0&&this.removeRange(r)))}ranges.length||this.detach()},this.updateLinkedFields=function(){var ts=this.selectedTabstop;if(ts&&ts.hasLinkedRanges){this.$inChange=!0;for(var session=this.editor.session,text=session.getTextRange(ts.firstNonLinked),i=ts.length;i--;){var range=ts[i];if(range.linked){var fmt=exports.snippetManager.tmStrFormat(text,range.original);session.replace(range,fmt)}}this.$inChange=!1}},this.onAfterExec=function(e){e.command&&!e.command.readOnly&&this.updateLinkedFields()},this.onChangeSelection=function(){if(this.editor){for(var lead=this.editor.selection.lead,anchor=this.editor.selection.anchor,isEmpty=this.editor.selection.isEmpty(),i=this.ranges.length;i--;)if(!this.ranges[i].linked){var containsLead=this.ranges[i].contains(lead.row,lead.column),containsAnchor=isEmpty||this.ranges[i].contains(anchor.row,anchor.column);if(containsLead&&containsAnchor)return}this.detach()}},this.onChangeSession=function(){this.detach()},this.tabNext=function(dir){var max=this.tabstops.length,index=this.index+(dir||1);index=Math.min(Math.max(index,1),max),index==max&&(index=0),this.selectTabstop(index),0===index&&this.detach()},this.selectTabstop=function(index){this.$openTabstops=null;var ts=this.tabstops[this.index];if(ts&&this.addTabstopMarkers(ts),this.index=index,ts=this.tabstops[this.index],ts&&ts.length){if(this.selectedTabstop=ts,this.editor.inVirtualSelectionMode)this.editor.selection.setRange(ts.firstNonLinked);else{var sel=this.editor.multiSelect;sel.toSingleRange(ts.firstNonLinked.clone());for(var i=ts.length;i--;)ts.hasLinkedRanges&&ts[i].linked||sel.addRange(ts[i].clone(),!0);sel.ranges[0]&&sel.addRange(sel.ranges[0].clone())}this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)}},this.addTabstops=function(tabstops,start,end){if(this.$openTabstops||(this.$openTabstops=[]),!tabstops[0]){var p=Range.fromPoints(end,end);moveRelative(p.start,start),moveRelative(p.end,start),tabstops[0]=[p],tabstops[0].index=0}var i=this.index,arg=[i+1,0],ranges=this.ranges;tabstops.forEach(function(ts,index){for(var dest=this.$openTabstops[index]||ts,i=ts.length;i--;){var p=ts[i],range=Range.fromPoints(p.start,p.end||p.start);movePoint(range.start,start),movePoint(range.end,start),range.original=p,range.tabstop=dest,ranges.push(range),dest!=ts?dest.unshift(range):dest[i]=range,p.fmtString?(range.linked=!0,dest.hasLinkedRanges=!0):dest.firstNonLinked||(dest.firstNonLinked=range)}dest.firstNonLinked||(dest.hasLinkedRanges=!1),dest===ts&&(arg.push(dest),this.$openTabstops[index]=dest),this.addTabstopMarkers(dest)},this),arg.length>2&&(this.tabstops.length&&arg.push(arg.splice(2,1)[0]),this.tabstops.splice.apply(this.tabstops,arg))},this.addTabstopMarkers=function(ts){var session=this.editor.session;ts.forEach(function(range){range.markerId||(range.markerId=session.addMarker(range,"ace_snippet-marker","text"))})},this.removeTabstopMarkers=function(ts){var session=this.editor.session;ts.forEach(function(range){session.removeMarker(range.markerId),range.markerId=null})},this.removeRange=function(range){var i=range.tabstop.indexOf(range);range.tabstop.splice(i,1),i=this.ranges.indexOf(range),this.ranges.splice(i,1),this.editor.session.removeMarker(range.markerId),range.tabstop.length||(i=this.tabstops.indexOf(range.tabstop),-1!=i&&this.tabstops.splice(i,1),this.tabstops.length||this.detach())},this.keyboardHandler=new HashHandler,this.keyboardHandler.bindKeys({Tab:function(ed){exports.snippetManager&&exports.snippetManager.expandWithTab(ed)||ed.tabstopManager.tabNext(1)},"Shift-Tab":function(ed){ed.tabstopManager.tabNext(-1)},Esc:function(ed){ed.tabstopManager.detach()},Return:function(ed){return!1}})}).call(TabstopManager.prototype);var changeTracker={};changeTracker.onChange=Anchor.prototype.onChange,changeTracker.setPosition=function(row,column){this.pos.row=row,this.pos.column=column},changeTracker.update=function(pos,delta,$insertRight){this.$insertRight=$insertRight,this.pos=pos,this.onChange(delta)};var movePoint=function(point,diff){0==point.row&&(point.column+=diff.column),point.row+=diff.row},moveRelative=function(point,start){point.row==start.row&&(point.column-=start.column),point.row-=start.row};require("./lib/dom").importCssString(".ace_snippet-marker {    -moz-box-sizing: border-box;    box-sizing: border-box;    background: rgba(194, 193, 208, 0.09);    border: 1px dotted rgba(211, 208, 235, 0.62);    position: absolute;}"),exports.snippetManager=new SnippetManager;var Editor=require("./editor").Editor;(function(){this.insertSnippet=function(content,options){return exports.snippetManager.insertSnippet(this,content,options)},this.expandSnippet=function(options){return exports.snippetManager.expandWithTab(this,options)}}).call(Editor.prototype)}),ace.define("ace/autocomplete/popup",["require","exports","module","ace/virtual_renderer","ace/editor","ace/range","ace/lib/event","ace/lib/lang","ace/lib/dom"],function(require,exports,module){"use strict";var Renderer=require("../virtual_renderer").VirtualRenderer,Editor=require("../editor").Editor,Range=require("../range").Range,event=require("../lib/event"),lang=require("../lib/lang"),dom=require("../lib/dom"),$singleLineEditor=function(el){var renderer=new Renderer(el);renderer.$maxLines=4;var editor=new Editor(renderer);return editor.setHighlightActiveLine(!1),editor.setShowPrintMargin(!1),editor.renderer.setShowGutter(!1),editor.renderer.setHighlightGutterLine(!1),editor.$mouseHandler.$focusWaitTimout=0,editor.$highlightTagPending=!0,editor},AcePopup=function(parentNode){var el=dom.createElement("div"),popup=new $singleLineEditor(el);parentNode&&parentNode.appendChild(el),el.style.display="none",popup.renderer.content.style.cursor="default",popup.renderer.setStyle("ace_autocomplete"),popup.setOption("displayIndentGuides",!1),popup.setOption("dragDelay",150);var noop=function(){};popup.focus=noop,popup.$isFocused=!0,popup.renderer.$cursorLayer.restartTimer=noop,popup.renderer.$cursorLayer.element.style.opacity=0,popup.renderer.$maxLines=8,popup.renderer.$keepTextAreaAtCursor=!1,popup.setHighlightActiveLine(!1),popup.session.highlight(""),popup.session.$searchHighlight.clazz="ace_highlight-marker",popup.on("mousedown",function(e){var pos=e.getDocumentPosition();popup.selection.moveToPosition(pos),selectionMarker.start.row=selectionMarker.end.row=pos.row,e.stop()});var lastMouseEvent,hoverMarker=new Range(-1,0,-1,1/0),selectionMarker=new Range(-1,0,-1,1/0);selectionMarker.id=popup.session.addMarker(selectionMarker,"ace_active-line","fullLine"),popup.setSelectOnHover=function(val){val?hoverMarker.id&&(popup.session.removeMarker(hoverMarker.id),hoverMarker.id=null):hoverMarker.id=popup.session.addMarker(hoverMarker,"ace_line-hover","fullLine")},popup.setSelectOnHover(!1),popup.on("mousemove",function(e){if(!lastMouseEvent)return void(lastMouseEvent=e);if(lastMouseEvent.x!=e.x||lastMouseEvent.y!=e.y){lastMouseEvent=e,lastMouseEvent.scrollTop=popup.renderer.scrollTop;var row=lastMouseEvent.getDocumentPosition().row;hoverMarker.start.row!=row&&(hoverMarker.id||popup.setRow(row),setHoverMarker(row))}}),popup.renderer.on("beforeRender",function(){if(lastMouseEvent&&-1!=hoverMarker.start.row){lastMouseEvent.$pos=null;var row=lastMouseEvent.getDocumentPosition().row;hoverMarker.id||popup.setRow(row),setHoverMarker(row,!0)}}),popup.renderer.on("afterRender",function(){var row=popup.getRow(),t=popup.renderer.$textLayer,selected=t.element.childNodes[row-t.config.firstRow];selected!=t.selectedNode&&(t.selectedNode&&dom.removeCssClass(t.selectedNode,"ace_selected"),t.selectedNode=selected,selected&&dom.addCssClass(selected,"ace_selected"))});var hideHoverMarker=function(){setHoverMarker(-1)},setHoverMarker=function(row,suppressRedraw){row!==hoverMarker.start.row&&(hoverMarker.start.row=hoverMarker.end.row=row,suppressRedraw||popup.session._emit("changeBackMarker"),popup._emit("changeHoverMarker"))};popup.getHoveredRow=function(){return hoverMarker.start.row},event.addListener(popup.container,"mouseout",hideHoverMarker),popup.on("hide",hideHoverMarker),popup.on("changeSelection",hideHoverMarker),popup.session.doc.getLength=function(){return popup.data.length},popup.session.doc.getLine=function(i){var data=popup.data[i];return"string"==typeof data?data:data&&data.value||""};var bgTokenizer=popup.session.bgTokenizer;return bgTokenizer.$tokenizeRow=function(row){var data=popup.data[row],tokens=[];if(!data)return tokens;"string"==typeof data&&(data={value:data}),data.caption||(data.caption=data.value||data.name);for(var flag,c,last=-1,i=0;i<data.caption.length;i++)c=data.caption[i],flag=data.matchMask&1<<i?1:0,last!==flag?(tokens.push({type:data.className||""+(flag?"completion-highlight":""),value:c}),last=flag):tokens[tokens.length-1].value+=c;if(data.meta){var maxW=popup.renderer.$size.scrollerWidth/popup.renderer.layerConfig.characterWidth,metaData=data.meta;metaData.length+data.caption.length>maxW-2&&(metaData=metaData.substr(0,maxW-data.caption.length-3)+"…"),tokens.push({type:"rightAlignedText",value:metaData})}return tokens},bgTokenizer.$updateOnChange=noop,bgTokenizer.start=noop,popup.session.$computeWidth=function(){return this.screenWidth=0},popup.$blockScrolling=1/0,popup.isOpen=!1,popup.isTopdown=!1,popup.data=[],popup.setData=function(list){popup.setValue(lang.stringRepeat("\n",list.length),-1),popup.data=list||[],popup.setRow(0)},popup.getData=function(row){return popup.data[row]},popup.getRow=function(){return selectionMarker.start.row},popup.setRow=function(line){line=Math.max(0,Math.min(this.data.length,line)),selectionMarker.start.row!=line&&(popup.selection.clearSelection(),selectionMarker.start.row=selectionMarker.end.row=line||0,popup.session._emit("changeBackMarker"),popup.moveCursorTo(line||0,0),popup.isOpen&&popup._signal("select"))},popup.on("changeSelection",function(){popup.isOpen&&popup.setRow(popup.selection.lead.row),popup.renderer.scrollCursorIntoView()}),popup.hide=function(){this.container.style.display="none",this._signal("hide"),popup.isOpen=!1},popup.show=function(pos,lineHeight,topdownOnly){var el=this.container,screenHeight=window.innerHeight,screenWidth=window.innerWidth,renderer=this.renderer,maxH=renderer.$maxLines*lineHeight*1.4,top=pos.top+this.$borderSize,allowTopdown=top>screenHeight/2&&!topdownOnly;allowTopdown&&top+lineHeight+maxH>screenHeight?(renderer.$maxPixelHeight=top-2*this.$borderSize,el.style.top="",el.style.bottom=screenHeight-top+"px",popup.isTopdown=!1):(top+=lineHeight,renderer.$maxPixelHeight=screenHeight-top-.2*lineHeight,el.style.top=top+"px",el.style.bottom="",popup.isTopdown=!0),el.style.display="",this.renderer.$textLayer.checkForSizeChanges();var left=pos.left;left+el.offsetWidth>screenWidth&&(left=screenWidth-el.offsetWidth),el.style.left=left+"px",this._signal("show"),lastMouseEvent=null,popup.isOpen=!0},popup.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize},popup.$imageSize=0,popup.$borderSize=1,popup};dom.importCssString(".ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #CAD6FA;    z-index: 1;}.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid #abbffe;    margin-top: -1px;    background: rgba(233,233,253,0.4);}.ace_editor.ace_autocomplete .ace_line-hover {    position: absolute;    z-index: 2;}.ace_editor.ace_autocomplete .ace_scroller {   background: none;   border: none;   box-shadow: none;}.ace_rightAlignedText {    color: gray;    display: inline-block;    position: absolute;    right: 4px;    text-align: right;    z-index: -1;}.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #000;    text-shadow: 0 0 0.01em;}.ace_editor.ace_autocomplete {    width: 280px;    z-index: 200000;    background: #fbfbfb;    color: #444;    border: 1px lightgray solid;    position: fixed;    box-shadow: 2px 3px 5px rgba(0,0,0,.2);    line-height: 1.4;}"),exports.AcePopup=AcePopup}),ace.define("ace/autocomplete/util",["require","exports","module"],function(require,exports,module){"use strict";exports.parForEach=function(array,fn,callback){var completed=0,arLength=array.length;0===arLength&&callback();for(var i=0;arLength>i;i++)fn(array[i],function(result,err){completed++,completed===arLength&&callback(result,err)})};var ID_REGEX=/[a-zA-Z_0-9\$\-\u00A2-\uFFFF]/;exports.retrievePrecedingIdentifier=function(text,pos,regex){regex=regex||ID_REGEX;for(var buf=[],i=pos-1;i>=0&&regex.test(text[i]);i--)buf.push(text[i]);return buf.reverse().join("")},exports.retrieveFollowingIdentifier=function(text,pos,regex){regex=regex||ID_REGEX;for(var buf=[],i=pos;i<text.length&&regex.test(text[i]);i++)buf.push(text[i]);return buf},exports.getCompletionPrefix=function(editor){var prefix,pos=editor.getCursorPosition(),line=editor.session.getLine(pos.row);return editor.completers.forEach(function(completer){completer.identifierRegexps&&completer.identifierRegexps.forEach(function(identifierRegex){!prefix&&identifierRegex&&(prefix=this.retrievePrecedingIdentifier(line,pos.column,identifierRegex))}.bind(this))}.bind(this)),prefix||this.retrievePrecedingIdentifier(line,pos.column)}}),ace.define("ace/autocomplete",["require","exports","module","ace/keyboard/hash_handler","ace/autocomplete/popup","ace/autocomplete/util","ace/lib/event","ace/lib/lang","ace/lib/dom","ace/snippets"],function(require,exports,module){"use strict";var HashHandler=require("./keyboard/hash_handler").HashHandler,AcePopup=require("./autocomplete/popup").AcePopup,util=require("./autocomplete/util"),lang=(require("./lib/event"),require("./lib/lang")),dom=require("./lib/dom"),snippetManager=require("./snippets").snippetManager,Autocomplete=function(){
this.autoInsert=!1,this.autoSelect=!0,this.exactMatch=!1,this.gatherCompletionsId=0,this.keyboardHandler=new HashHandler,this.keyboardHandler.bindKeys(this.commands),this.blurListener=this.blurListener.bind(this),this.changeListener=this.changeListener.bind(this),this.mousedownListener=this.mousedownListener.bind(this),this.mousewheelListener=this.mousewheelListener.bind(this),this.changeTimer=lang.delayedCall(function(){this.updateCompletions(!0)}.bind(this)),this.tooltipTimer=lang.delayedCall(this.updateDocTooltip.bind(this),50)};(function(){this.$init=function(){return this.popup=new AcePopup(document.body||document.documentElement),this.popup.on("click",function(e){this.insertMatch(),e.stop()}.bind(this)),this.popup.focus=this.editor.focus.bind(this.editor),this.popup.on("show",this.tooltipTimer.bind(null,null)),this.popup.on("select",this.tooltipTimer.bind(null,null)),this.popup.on("changeHoverMarker",this.tooltipTimer.bind(null,null)),this.popup},this.getPopup=function(){return this.popup||this.$init()},this.openPopup=function(editor,prefix,keepPopupPosition){this.popup||this.$init(),this.popup.setData(this.completions.filtered),editor.keyBinding.addKeyboardHandler(this.keyboardHandler);var renderer=editor.renderer;if(this.popup.setRow(this.autoSelect?0:-1),keepPopupPosition)keepPopupPosition&&!prefix&&this.detach();else{this.popup.setTheme(editor.getTheme()),this.popup.setFontSize(editor.getFontSize());var lineHeight=renderer.layerConfig.lineHeight,pos=renderer.$cursorLayer.getPixelPosition(this.base,!0);pos.left-=this.popup.getTextLeftOffset();var rect=editor.container.getBoundingClientRect();pos.top+=rect.top-renderer.layerConfig.offset,pos.left+=rect.left-editor.renderer.scrollLeft,pos.left+=renderer.gutterWidth,this.popup.show(pos,lineHeight)}},this.detach=function(){this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.off("changeSelection",this.changeListener),this.editor.off("blur",this.blurListener),this.editor.off("mousedown",this.mousedownListener),this.editor.off("mousewheel",this.mousewheelListener),this.changeTimer.cancel(),this.hideDocTooltip(),this.gatherCompletionsId+=1,this.popup&&this.popup.isOpen&&this.popup.hide(),this.base&&this.base.detach(),this.activated=!1,this.completions=this.base=null},this.changeListener=function(e){var cursor=this.editor.selection.lead;(cursor.row!=this.base.row||cursor.column<this.base.column)&&this.detach(),this.activated?this.changeTimer.schedule():this.detach()},this.blurListener=function(e){var el=document.activeElement,text=this.editor.textInput.getElement(),fromTooltip=e.relatedTarget&&e.relatedTarget==this.tooltipNode,container=this.popup&&this.popup.container;el==text||el.parentNode==container||fromTooltip||el==this.tooltipNode||e.relatedTarget==text||this.detach()},this.mousedownListener=function(e){this.detach()},this.mousewheelListener=function(e){this.detach()},this.goTo=function(where){var row=this.popup.getRow(),max=this.popup.session.getLength()-1;switch(where){case"up":row=0>=row?max:row-1;break;case"down":row=row>=max?-1:row+1;break;case"start":row=0;break;case"end":row=max}this.popup.setRow(row)},this.insertMatch=function(data,options){if(data||(data=this.popup.getData(this.popup.getRow())),!data)return!1;if(data.completer&&data.completer.insertMatch)data.completer.insertMatch(this.editor,data);else{if(this.completions.filterText)for(var range,ranges=this.editor.selection.getAllRanges(),i=0;range=ranges[i];i++)range.start.column-=this.completions.filterText.length,this.editor.session.remove(range);data.snippet?snippetManager.insertSnippet(this.editor,data.snippet):this.editor.execCommand("insertstring",data.value||data)}this.detach()},this.commands={Up:function(editor){editor.completer.goTo("up")},Down:function(editor){editor.completer.goTo("down")},"Ctrl-Up|Ctrl-Home":function(editor){editor.completer.goTo("start")},"Ctrl-Down|Ctrl-End":function(editor){editor.completer.goTo("end")},Esc:function(editor){editor.completer.detach()},Return:function(editor){return editor.completer.insertMatch()},"Shift-Return":function(editor){editor.completer.insertMatch(null,{deleteSuffix:!0})},Tab:function(editor){var result=editor.completer.insertMatch();return result||editor.tabstopManager?result:void editor.completer.goTo("down")},PageUp:function(editor){editor.completer.popup.gotoPageUp()},PageDown:function(editor){editor.completer.popup.gotoPageDown()}},this.gatherCompletions=function(editor,callback){var session=editor.getSession(),pos=editor.getCursorPosition(),prefix=(session.getLine(pos.row),util.getCompletionPrefix(editor));this.base=session.doc.createAnchor(pos.row,pos.column-prefix.length),this.base.$insertRight=!0;var matches=[],total=editor.completers.length;return editor.completers.forEach(function(completer,i){completer.getCompletions(editor,session,pos,prefix,function(err,results){!err&&results&&(matches=matches.concat(results));var pos=editor.getCursorPosition();session.getLine(pos.row);callback(null,{prefix:prefix,matches:matches,finished:0===--total})})}),!0},this.showPopup=function(editor){this.editor&&this.detach(),this.activated=!0,this.editor=editor,editor.completer!=this&&(editor.completer&&editor.completer.detach(),editor.completer=this),editor.on("changeSelection",this.changeListener),editor.on("blur",this.blurListener),editor.on("mousedown",this.mousedownListener),editor.on("mousewheel",this.mousewheelListener),this.updateCompletions()},this.updateCompletions=function(keepPopupPosition){if(keepPopupPosition&&this.base&&this.completions){var pos=this.editor.getCursorPosition(),prefix=this.editor.session.getTextRange({start:this.base,end:pos});if(prefix==this.completions.filterText)return;return this.completions.setFilter(prefix),this.completions.filtered.length&&(1!=this.completions.filtered.length||this.completions.filtered[0].value!=prefix||this.completions.filtered[0].snippet)?void this.openPopup(this.editor,prefix,keepPopupPosition):this.detach()}var _id=this.gatherCompletionsId;this.gatherCompletions(this.editor,function(err,results){var detachIfFinished=function(){return results.finished?this.detach():void 0}.bind(this),prefix=results.prefix,matches=results&&results.matches;if(!matches||!matches.length)return detachIfFinished();if(0===prefix.indexOf(results.prefix)&&_id==this.gatherCompletionsId){this.completions=new FilteredList(matches),this.exactMatch&&(this.completions.exactMatch=!0),this.completions.setFilter(prefix);var filtered=this.completions.filtered;return filtered.length&&(1!=filtered.length||filtered[0].value!=prefix||filtered[0].snippet)?this.autoInsert&&1==filtered.length&&results.finished?this.insertMatch(filtered[0]):void this.openPopup(this.editor,prefix,keepPopupPosition):detachIfFinished()}}.bind(this))},this.cancelContextMenu=function(){this.editor.$mouseHandler.cancelContextMenu()},this.updateDocTooltip=function(){var popup=this.popup,all=popup.data,selected=all&&(all[popup.getHoveredRow()]||all[popup.getRow()]),doc=null;return selected&&this.editor&&this.popup.isOpen?(this.editor.completers.some(function(completer){return completer.getDocTooltip&&(doc=completer.getDocTooltip(selected)),doc}),doc||(doc=selected),"string"==typeof doc&&(doc={docText:doc}),doc&&(doc.docHTML||doc.docText)?void this.showDocTooltip(doc):this.hideDocTooltip()):this.hideDocTooltip()},this.showDocTooltip=function(item){this.tooltipNode||(this.tooltipNode=dom.createElement("div"),this.tooltipNode.className="ace_tooltip ace_doc-tooltip",this.tooltipNode.style.margin=0,this.tooltipNode.style.pointerEvents="auto",this.tooltipNode.tabIndex=-1,this.tooltipNode.onblur=this.blurListener.bind(this));var tooltipNode=this.tooltipNode;item.docHTML?tooltipNode.innerHTML=item.docHTML:item.docText&&(tooltipNode.textContent=item.docText),tooltipNode.parentNode||document.body.appendChild(tooltipNode);var popup=this.popup,rect=popup.container.getBoundingClientRect();tooltipNode.style.top=popup.container.style.top,tooltipNode.style.bottom=popup.container.style.bottom,window.innerWidth-rect.right<320?(tooltipNode.style.right=window.innerWidth-rect.left+"px",tooltipNode.style.left=""):(tooltipNode.style.left=rect.right+1+"px",tooltipNode.style.right=""),tooltipNode.style.display="block"},this.hideDocTooltip=function(){if(this.tooltipTimer.cancel(),this.tooltipNode){var el=this.tooltipNode;this.editor.isFocused()||document.activeElement!=el||this.editor.focus(),this.tooltipNode=null,el.parentNode&&el.parentNode.removeChild(el)}}}).call(Autocomplete.prototype),Autocomplete.startCommand={name:"startAutocomplete",exec:function(editor){editor.completer||(editor.completer=new Autocomplete),editor.completer.autoInsert=!1,editor.completer.autoSelect=!0,editor.completer.showPopup(editor),editor.completer.cancelContextMenu()},bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"};var FilteredList=function(array,filterText){this.all=array,this.filtered=array,this.filterText=filterText||"",this.exactMatch=!1};(function(){this.setFilter=function(str){if(str.length>this.filterText&&0===str.lastIndexOf(this.filterText,0))var matches=this.filtered;else var matches=this.all;this.filterText=str,matches=this.filterCompletions(matches,this.filterText),matches=matches.sort(function(a,b){return b.exactMatch-a.exactMatch||b.score-a.score});var prev=null;matches=matches.filter(function(item){var caption=item.snippet||item.caption||item.value;return caption===prev?!1:(prev=caption,!0)}),this.filtered=matches},this.filterCompletions=function(items,needle){var results=[],upper=needle.toUpperCase(),lower=needle.toLowerCase();loop:for(var item,i=0;item=items[i];i++){var caption=item.value||item.caption||item.snippet;if(caption){var index,distance,lastIndex=-1,matchMask=0,penalty=0;if(this.exactMatch){if(needle!==caption.substr(0,needle.length))continue loop}else for(var j=0;j<needle.length;j++){var i1=caption.indexOf(lower[j],lastIndex+1),i2=caption.indexOf(upper[j],lastIndex+1);if(index=i1>=0&&(0>i2||i2>i1)?i1:i2,0>index)continue loop;distance=index-lastIndex-1,distance>0&&(-1===lastIndex&&(penalty+=10),penalty+=distance),matchMask|=1<<index,lastIndex=index}item.matchMask=matchMask,item.exactMatch=penalty?0:1,item.score=(item.score||0)-penalty,results.push(item)}}return results}}).call(FilteredList.prototype),exports.Autocomplete=Autocomplete,exports.FilteredList=FilteredList}),ace.define("ace/autocomplete/text_completer",["require","exports","module","ace/range"],function(require,exports,module){function getWordIndex(doc,pos){var textBefore=doc.getTextRange(Range.fromPoints({row:0,column:0},pos));return textBefore.split(splitRegex).length-1}function wordDistance(doc,pos){var prefixPos=getWordIndex(doc,pos),words=doc.getValue().split(splitRegex),wordScores=Object.create(null),currentWord=words[prefixPos];return words.forEach(function(word,idx){if(word&&word!==currentWord){var distance=Math.abs(prefixPos-idx),score=words.length-distance;wordScores[word]?wordScores[word]=Math.max(score,wordScores[word]):wordScores[word]=score}}),wordScores}var Range=require("../range").Range,splitRegex=/[^a-zA-Z_0-9\$\-\u00C0-\u1FFF\u2C00-\uD7FF\w]+/;exports.getCompletions=function(editor,session,pos,prefix,callback){var wordScore=wordDistance(session,pos,prefix),wordList=Object.keys(wordScore);callback(null,wordList.map(function(word){return{caption:word,value:word,score:wordScore[word],meta:"local"}}))}}),ace.define("ace/ext/language_tools",["require","exports","module","ace/snippets","ace/autocomplete","ace/config","ace/lib/lang","ace/autocomplete/util","ace/autocomplete/text_completer","ace/editor","ace/config"],function(require,exports,module){"use strict";var snippetManager=require("../snippets").snippetManager,Autocomplete=require("../autocomplete").Autocomplete,config=require("../config"),lang=require("../lib/lang"),util=require("../autocomplete/util"),textCompleter=require("../autocomplete/text_completer"),keyWordCompleter={getCompletions:function(editor,session,pos,prefix,callback){if(session.$mode.completer)return session.$mode.completer.getCompletions(editor,session,pos,prefix,callback);var state=editor.session.getState(pos.row),completions=session.$mode.getCompletions(state,session,pos,prefix);callback(null,completions)}},snippetCompleter={getCompletions:function(editor,session,pos,prefix,callback){var snippetMap=snippetManager.snippetMap,completions=[];snippetManager.getActiveScopes(editor).forEach(function(scope){for(var snippets=snippetMap[scope]||[],i=snippets.length;i--;){var s=snippets[i],caption=s.name||s.tabTrigger;caption&&completions.push({caption:caption,snippet:s.content,meta:s.tabTrigger&&!s.name?s.tabTrigger+"⇥ ":"snippet",type:"snippet"})}},this),callback(null,completions)},getDocTooltip:function(item){"snippet"!=item.type||item.docHTML||(item.docHTML=["<b>",lang.escapeHTML(item.caption),"</b>","<hr></hr>",lang.escapeHTML(item.snippet)].join(""))}},completers=[snippetCompleter,textCompleter,keyWordCompleter];exports.setCompleters=function(val){completers.length=0,val&&completers.push.apply(completers,val)},exports.addCompleter=function(completer){completers.push(completer)},exports.textCompleter=textCompleter,exports.keyWordCompleter=keyWordCompleter,exports.snippetCompleter=snippetCompleter;var expandSnippet={name:"expandSnippet",exec:function(editor){return snippetManager.expandWithTab(editor)},bindKey:"Tab"},onChangeMode=function(e,editor){loadSnippetsForMode(editor.session.$mode)},loadSnippetsForMode=function(mode){var id=mode.$id;snippetManager.files||(snippetManager.files={}),loadSnippetFile(id),mode.modes&&mode.modes.forEach(loadSnippetsForMode)},loadSnippetFile=function(id){if(id&&!snippetManager.files[id]){var snippetFilePath=id.replace("mode","snippets");snippetManager.files[id]={},config.loadModule(snippetFilePath,function(m){m&&(snippetManager.files[id]=m,!m.snippets&&m.snippetText&&(m.snippets=snippetManager.parseSnippetFile(m.snippetText)),snippetManager.register(m.snippets||[],m.scope),m.includeScopes&&(snippetManager.snippetMap[m.scope].includeScopes=m.includeScopes,m.includeScopes.forEach(function(x){loadSnippetFile("ace/mode/"+x)})))})}},doLiveAutocomplete=function(e){var editor=e.editor,hasCompleter=editor.completer&&editor.completer.activated;if("backspace"===e.command.name)hasCompleter&&!util.getCompletionPrefix(editor)&&editor.completer.detach();else if("insertstring"===e.command.name){var prefix=util.getCompletionPrefix(editor);prefix&&!hasCompleter&&(editor.completer||(editor.completer=new Autocomplete),editor.completer.autoInsert=!1,editor.completer.showPopup(editor))}},Editor=require("../editor").Editor;require("../config").defineOptions(Editor.prototype,"editor",{enableBasicAutocompletion:{set:function(val){val?(this.completers||(this.completers=Array.isArray(val)?val:completers),this.commands.addCommand(Autocomplete.startCommand)):this.commands.removeCommand(Autocomplete.startCommand)},value:!1},enableLiveAutocompletion:{set:function(val){val?(this.completers||(this.completers=Array.isArray(val)?val:completers),this.commands.on("afterExec",doLiveAutocomplete)):this.commands.removeListener("afterExec",doLiveAutocomplete)},value:!1},enableSnippets:{set:function(val){val?(this.commands.addCommand(expandSnippet),this.on("changeMode",onChangeMode),onChangeMode(null,this)):(this.commands.removeCommand(expandSnippet),this.off("changeMode",onChangeMode))},value:!1}})}),function(){ace.require(["ace/ext/language_tools"],function(){})}(),define("ace/ext-language_tools",function(){}),function(){define("ide/editor/directives/aceEditor/auto-complete/Helpers",["ace/ace","ace/ext-language_tools"],function(){var Helpers,Range;return Range=ace.require("ace/range").Range,Helpers={getLastCommandFragment:function(lineUpToCursor){var index;return(index=Helpers.getLastCommandFragmentIndex(lineUpToCursor))>-1?lineUpToCursor.slice(index):null},getLastCommandFragmentIndex:function(lineUpToCursor){var blankArguments,m;return blankArguments=lineUpToCursor.replace(/\[([^\]]*)\]/g,function(args){return Array(args.length+1).join(".")}),(m=blankArguments.match(/(\\[^\\]*)$/))?m.index:-1},getCommandNameFromFragment:function(commandFragment){var ref;return null!=commandFragment&&null!=(ref=commandFragment.match(/\\(\w+)\{/))?ref[1]:void 0},getContext:function(editor,pos){var beyondCursorRange,commandFragment,commandName,lineBeyondCursor,lineUpToCursor,upToCursorRange;return upToCursorRange=new Range(pos.row,0,pos.row,pos.column),lineUpToCursor=editor.getSession().getTextRange(upToCursorRange),commandFragment=Helpers.getLastCommandFragment(lineUpToCursor),commandName=Helpers.getCommandNameFromFragment(commandFragment),beyondCursorRange=new Range(pos.row,pos.column,pos.row,99999),lineBeyondCursor=editor.getSession().getTextRange(beyondCursorRange),{lineUpToCursor:lineUpToCursor,commandFragment:commandFragment,commandName:commandName,lineBeyondCursor:lineBeyondCursor}}}})}.call(this),function(){define("ide/editor/directives/aceEditor/auto-complete/AutoCompleteManager",["ide/editor/directives/aceEditor/auto-complete/CommandManager","ide/editor/directives/aceEditor/auto-complete/EnvironmentManager","ide/editor/directives/aceEditor/auto-complete/PackageManager","ide/editor/directives/aceEditor/auto-complete/Helpers","ace/ace","ace/ext-language_tools"],function(CommandManager,EnvironmentManager,PackageManager,Helpers){var AutoCompleteManager,Range,aceSnippetManager;return Range=ace.require("ace/range").Range,aceSnippetManager=ace.require("ace/snippets").snippetManager,AutoCompleteManager=function(){function AutoCompleteManager($scope,editor1,element,metadataManager1,graphics,preamble,files){var onChange;this.$scope=$scope,this.editor=editor1,this.element=element,this.metadataManager=metadataManager1,this.graphics=graphics,this.preamble=preamble,this.files=files,this.monkeyPatchAutocomplete(),this.$scope.$watch("autoComplete",function(_this){return function(autocomplete){return autocomplete?_this.enable():_this.disable()}}(this)),onChange=function(_this){return function(change){return _this.onChange(change)}}(this),this.editor.on("changeSession",function(_this){return function(e){return e.oldSession.off("change",onChange),e.session.on("change",onChange)}}(this))}return AutoCompleteManager.prototype.enable=function(){var CommandCompleter,Files,FilesCompleter,Graphics,GraphicsCompleter,LabelsCompleter,PackageCompleter,Preamble,ReferencesCompleter,SnippetCompleter,metadataManager,references;return this.editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!1}),CommandCompleter=new CommandManager(this.metadataManager),SnippetCompleter=new EnvironmentManager,PackageCompleter=new PackageManager(this.metadataManager,Helpers),Graphics=this.graphics,Preamble=this.preamble,Files=this.files,GraphicsCompleter={getCompletions:function(editor,session,pos,prefix,callback){var _,commandFragment,commandName,currentArg,graphic,graphicsPath,graphicsPaths,j,k,len,len1,match,path,ref,result;if(commandFragment=Helpers.getContext(editor,pos).commandFragment,commandFragment&&(match=commandFragment.match(/^~?\\(includegraphics(?:\[.*])?){([^}]*, *)?(\w*)/))){for(_=match[0],commandName=match[1],_=match[2],currentArg=match[3],graphicsPaths=Preamble.getGraphicsPaths(),result=[],ref=Graphics.getGraphicsFiles(),j=0,len=ref.length;len>j;j++){for(graphic=ref[j],path=graphic.path,k=0,len1=graphicsPaths.length;len1>k;k++)if(graphicsPath=graphicsPaths[k],0===path.indexOf(graphicsPath)){path=path.slice(graphicsPath.length);break}result.push({caption:"\\"+commandName+"{"+path+"}",value:"\\"+commandName+"{"+path+"}",meta:"graphic",score:50})}return callback(null,result)}}},metadataManager=this.metadataManager,FilesCompleter={getCompletions:function(_this){return function(editor,session,pos,prefix,callback){var _,commandFragment,commandName,currentArg,file,j,len,match,path,ref,result;if(commandFragment=Helpers.getContext(editor,pos).commandFragment,commandFragment&&(match=commandFragment.match(/^\\(input|include){(\w*)/))){for(_=match[0],commandName=match[1],currentArg=match[2],result=[],ref=Files.getTeXFiles(),j=0,len=ref.length;len>j;j++)file=ref[j],file.id!==_this.$scope.docId&&(path=file.path,result.push({caption:"\\"+commandName+"{"+path+"}",value:"\\"+commandName+"{"+path+"}",meta:"file",score:50}));return callback(null,result)}}}(this)},LabelsCompleter={getCompletions:function(editor,session,pos,prefix,callback){var _,commandFragment,commandName,currentArg,j,label,len,ref,refMatch,result;if(commandFragment=Helpers.getContext(editor,pos).commandFragment,commandFragment&&(refMatch=commandFragment.match(/^~?\\([a-zA-Z]*ref){([^}]*, *)?(\w*)/))){for(_=refMatch[0],commandName=refMatch[1],currentArg=refMatch[2],result=[],"ref"!==commandName&&result.push({caption:"\\"+commandName+"{}",snippet:"\\"+commandName+"{}",meta:"cross-reference",score:60}),ref=metadataManager.getAllLabels(),j=0,len=ref.length;len>j;j++)label=ref[j],result.push({caption:"\\"+commandName+"{"+label+"}",value:"\\"+commandName+"{"+label+"}",meta:"cross-reference",score:50});return callback(null,result)}}},references=this.$scope.$root._references,ReferencesCompleter={getCompletions:function(editor,session,pos,prefix,callback){var _,citeMatch,commandFragment,commandName,currentArg,previousArgs,previousArgsCaption,result;return commandFragment=Helpers.getContext(editor,pos).commandFragment,commandFragment&&(citeMatch=commandFragment.match(/^~?\\([a-z]*cite[a-z]*(?:\[.*])?){([^}]*, *)?(\w*)/))?(_=citeMatch[0],commandName=citeMatch[1],previousArgs=citeMatch[2],currentArg=citeMatch[3],null==previousArgs&&(previousArgs=""),previousArgsCaption=previousArgs.length>8?"…,":previousArgs,result=[],result.push({caption:"\\"+commandName+"{}",snippet:"\\"+commandName+"{}",meta:"reference",score:60}),references.keys&&references.keys.length>0?(references.keys.forEach(function(key){return null!=key?result.push({caption:"\\"+commandName+"{"+previousArgsCaption+key+"}",value:"\\"+commandName+"{"+previousArgs+key+"}",meta:"reference",score:50}):void 0}),callback(null,result)):callback(null,result)):void 0}},this.editor.completers=[CommandCompleter,SnippetCompleter,PackageCompleter,ReferencesCompleter,LabelsCompleter,GraphicsCompleter,FilesCompleter]},AutoCompleteManager.prototype.disable=function(){return this.editor.setOptions({enableBasicAutocompletion:!1,enableSnippets:!1})},AutoCompleteManager.prototype.onChange=function(change){var commandFragment,cursorPosition,end,i,lastCharIsBackslash,lastTwoChars,lineUpToCursor,ref,ref1,ref2,ref3;return cursorPosition=this.editor.getCursorPosition(),end=change.end,ref=Helpers.getContext(this.editor,end),lineUpToCursor=ref.lineUpToCursor,commandFragment=ref.commandFragment,(i=lineUpToCursor.indexOf("%"))>-1&&"\\"!==lineUpToCursor[i-1]?void 0:(lastCharIsBackslash="\\"===lineUpToCursor.slice(-1),lastTwoChars=lineUpToCursor.slice(-2),/^\\[^a-zA-Z]$/.test(lastTwoChars)?void(null!=(ref1=this.editor)&&null!=(ref2=ref1.completer)&&"function"==typeof ref2.detach&&ref2.detach()):("insert"===change.action&&end.row===cursorPosition.row&&end.column===cursorPosition.column+1&&((null!=commandFragment?commandFragment.length:void 0)>2||lastCharIsBackslash)&&setTimeout(function(_this){return function(){return _this.editor.execCommand("startAutocomplete")}}(this),0),"insert"===change.action&&/(begin|end|[a-zA-Z]*ref|usepackage|[a-z]*cite[a-z]*|input|include)/.test(null!=(ref3=change.lines[0].match(/\\(\w+){}/))?ref3[1]:void 0)?setTimeout(function(_this){return function(){return _this.editor.execCommand("startAutocomplete")}}(this),0):void 0))},AutoCompleteManager.prototype.monkeyPatchAutocomplete=function(){var Autocomplete,Util,editor;return Autocomplete=ace.require("ace/autocomplete").Autocomplete,Util=ace.require("ace/autocomplete/util"),editor=this.editor,null==Autocomplete.prototype._insertMatch&&(Autocomplete.prototype._insertMatch=Autocomplete.prototype.insertMatch,Autocomplete.prototype.insertMatch=function(data){var completions,nextChar,popup,pos,range;return pos=editor.getCursorPosition(),range=new Range(pos.row,pos.column,pos.row,pos.column+1),nextChar=editor.session.getTextRange(range),/^\\\w+{/.test(this.completions.filterText)&&"}"===nextChar&&editor.session.remove(range),null==data&&(completions=this.completions,popup=this.popup,data=popup.getData(popup.getRow()),data.completer={insertMatch:function(editor,matchData){var commandStartIndex,commandTail,j,leftRange,len,lineBeyondCursor,lineUpToCursor,partialCommandMatch,ref,rightRange;for(ref=editor.selection.getAllRanges(),j=0,len=ref.length;len>j;j++)range=ref[j],leftRange=_.clone(range),rightRange=_.clone(range),lineUpToCursor=editor.getSession().getTextRange(new Range(range.start.row,0,range.start.row,range.start.column)),commandStartIndex=Helpers.getLastCommandFragmentIndex(lineUpToCursor),-1!==commandStartIndex?leftRange.start.column=commandStartIndex:leftRange.start.column-=completions.filterText.length,editor.session.remove(leftRange),lineBeyondCursor=editor.getSession().getTextRange(new Range(rightRange.start.row,rightRange.start.column,rightRange.end.row,99999)),lineBeyondCursor&&(partialCommandMatch=lineBeyondCursor.match(/^([a-zA-Z0-9]+)\{/))&&(commandTail=partialCommandMatch[1],rightRange.end.column+=commandTail.length-completions.filterText.length,editor.session.remove(rightRange),null!=matchData.snippet&&(matchData.snippet=matchData.snippet.replace(/[{\[].*[}\]]/,"")),null!=matchData.caption&&(matchData.caption=matchData.caption.replace(/[{\[].*[}\]]/,"")),null!=matchData.value&&(matchData.value=matchData.value.replace(/[{\[].*[}\]]/,"")));return matchData.snippet?aceSnippetManager.insertSnippet(editor,matchData.snippet):editor.execCommand("insertstring",matchData.value||matchData)}}),Autocomplete.prototype._insertMatch.call(this,data)},Autocomplete.startCommand={name:"startAutocomplete",exec:function(_this){return function(editor){var charWidth,container,filtered,longestCaption,longestMeta,ref,ref1,ref2,ref3,ref4,ref5,width;return editor.completer||(editor.completer=new Autocomplete),editor.completer.autoInsert=!1,editor.completer.autoSelect=!0,editor.completer.showPopup(editor),editor.completer.cancelContextMenu(),container=$(null!=(ref=editor.completer.popup)?ref.container:void 0),container.css({"font-size":_this.$scope.fontSize+"px"}),(filtered=null!=editor&&null!=(ref1=editor.completer)&&null!=(ref2=ref1.completions)?ref2.filtered:void 0)&&(longestCaption=_.max(filtered.map(function(c){return c.caption.length})),longestMeta=_.max(filtered.map(function(c){return c.meta.length})),charWidth=editor.renderer.characterWidth,width=Math.max(Math.min(Math.round(longestCaption*charWidth+longestMeta*charWidth+5*charWidth),700),280),container.css({width:width+"px"})),0===(null!=(ref3=editor.completer)&&null!=(ref4=ref3.completions)&&null!=(ref5=ref4.filtered)?ref5.length:void 0)?editor.completer.detach():void 0}}(this),bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"}),Util.retrievePrecedingIdentifier=function(text,pos,regex){var currentLine,currentLineOffset,fragment,i,j,ref;for(currentLineOffset=0,i=j=ref=pos-1;0>=ref?0>=j:j>=0;i=0>=ref?++j:--j)if("\n"===text[i]){currentLineOffset=i+1;break}return currentLine=text.slice(currentLineOffset,pos),fragment=Helpers.getLastCommandFragment(currentLine)||""}},AutoCompleteManager}()})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};define("ide/editor/directives/aceEditor/spell-check/SpellCheckManager",[],function(){var SpellCheckManager;return SpellCheckManager=function(){function SpellCheckManager($scope,cache,$http,$q,adapter){this.$scope=$scope,this.cache=cache,this.$http=$http,this.$q=$q,this.adapter=adapter,this.learnWord=bind(this.learnWord,this),this.onScroll=bind(this.onScroll,this),this.onContextMenu=bind(this.onContextMenu,this),this.onSessionChange=bind(this.onSessionChange,this),this.onChange=bind(this.onChange,this),this.$scope.spellMenu={open:!1,top:"0px",left:"0px",suggestions:[]},this.inProgressRequest=null,this.updatedLines=[],this.$scope.$watch("spellCheckLanguage",function(_this){return function(language,oldLanguage){return language!==oldLanguage&&null!=oldLanguage?_this.runFullCheck():void 0}}(this)),this.$scope.replaceWord=this.adapter.replaceWord,this.$scope.learnWord=this.learnWord,$(document).on("click",function(_this){return function(e){return 3!==e.which&&_this.closeContextMenu(),!0}}(this))}return SpellCheckManager.prototype.init=function(){return this.updatedLines=Array(this.adapter.getLines().length).fill(!0),this.isSpellCheckEnabled()?this.runSpellCheckSoon(200):void 0},SpellCheckManager.prototype.isSpellCheckEnabled=function(){return!(!this.$scope.spellCheck||!this.$scope.spellCheckLanguage||""===this.$scope.spellCheckLanguage)},SpellCheckManager.prototype.onChange=function(e){return this.isSpellCheckEnabled()?(this.markLinesAsUpdated(this.adapter.normalizeChangeEvent(e)),this.adapter.highlightedWordManager.clearHighlightTouchingRange(e),this.runSpellCheckSoon()):void 0},SpellCheckManager.prototype.onSessionChange=function(){return this.adapter.highlightedWordManager.reset(),null!=this.inProgressRequest&&this.inProgressRequest.abort(),this.isSpellCheckEnabled()?this.runSpellCheckSoon(200):void 0},SpellCheckManager.prototype.onContextMenu=function(e){return this.closeContextMenu(),this.openContextMenu(e)},SpellCheckManager.prototype.onScroll=function(){return this.closeContextMenu()},SpellCheckManager.prototype.openContextMenu=function(e){var coords,highlight,shouldPositionFromBottom;return coords=this.adapter.getCoordsFromContextMenuEvent(e),highlight=this.adapter.getHighlightFromCoords(coords),shouldPositionFromBottom=this.adapter.isContextMenuEventOnBottomHalf(e),highlight?(this.adapter.preventContextMenuEventDefault(e),this.adapter.selectHighlightedWord(highlight),this.$scope.$apply(function(_this){return function(){return _this.$scope.spellMenu={open:!0,top:coords.y+"px",left:coords.x+"px",layoutFromBottom:shouldPositionFromBottom,highlight:highlight}}}(this)),!1):void 0},SpellCheckManager.prototype.closeContextMenu=function(){var ref;return(null!=(ref=this.$scope)?ref.spellMenu:void 0)&&this.$scope.spellMenu.open!==!1?this.$scope.$apply(function(_this){return function(){return _this.$scope.spellMenu.open=!1}}(this)):void 0},SpellCheckManager.prototype.learnWord=function(highlight){var language,ref;return this.apiRequest("/learn",{word:highlight.word}),this.adapter.highlightedWordManager.removeWord(highlight.word),language=this.$scope.spellCheckLanguage,null!=(ref=this.cache)?ref.put(language+":"+highlight.word,!0):void 0},SpellCheckManager.prototype.runFullCheck=function(){return this.adapter.highlightedWordManager.reset(),this.isSpellCheckEnabled()?this.runSpellCheck():void 0},SpellCheckManager.prototype.markLinesAsUpdated=function(change){var end,insertLines,removeLines,start;return start=change.start,end=change.end,insertLines=function(_this){return function(){var lines,results;for(lines=end.row-start.row,results=[];lines--;)results.push(_this.updatedLines.splice(start.row,0,!0));return results}}(this),removeLines=function(_this){return function(){var lines,results;for(lines=end.row-start.row,results=[];lines--;)results.push(_this.updatedLines.splice(start.row+1,1));return results}}(this),"insert"===change.action?(this.updatedLines[start.row]=!0,insertLines()):"remove"===change.action?(this.updatedLines[start.row]=!0,removeLines()):void 0},SpellCheckManager.prototype.runSpellCheckSoon=function(delay){var run;return null==delay&&(delay=1e3),run=function(_this){return function(){return delete _this.timeoutId,_this.runSpellCheck(_this.updatedLines),_this.updatedLines=[]}}(this),null!=this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(run,delay)},SpellCheckManager.prototype.runSpellCheck=function(linesToProcess){var cached,displayResult,highlights,i,j,key,language,len,newPositions,newWords,positions,ref,seen,word,words;for(ref=this.getWords(linesToProcess),words=ref.words,positions=ref.positions,language=this.$scope.spellCheckLanguage,highlights=[],
seen={},newWords=[],newPositions=[],i=j=0,len=words.length;len>j;i=++j)word=words[i],key=language+":"+word,null==seen[key]&&(seen[key]=this.cache.get(key)),cached=seen[key],null==cached?(newWords.push(words[i]),newPositions.push(positions[i])):cached===!0||highlights.push({column:positions[i].column,row:positions[i].row,word:word,suggestions:cached});return words=newWords,positions=newPositions,displayResult=function(_this){return function(highlights){var highlight,k,l,len1,len2,results,row,shouldProcess;if(null!=linesToProcess)for(row=k=0,len1=linesToProcess.length;len1>k;row=++k)shouldProcess=linesToProcess[row],shouldProcess&&_this.adapter.highlightedWordManager.clearRow(row);else _this.adapter.highlightedWordManager.reset();for(results=[],l=0,len2=highlights.length;len2>l;l++)highlight=highlights[l],results.push(_this.adapter.highlightedWordManager.addHighlight(highlight));return results}}(this),words.length?this.inProgressRequest=this.apiRequest("/check",{language:language,words:words},function(_this){return function(error,result){var k,l,len1,len2,mispelled,misspelling,position,ref1;if(delete _this.inProgressRequest,null!=error||null==result||null==result.misspellings)return null;for(mispelled=[],ref1=result.misspellings,k=0,len1=ref1.length;len1>k;k++)misspelling=ref1[k],word=words[misspelling.index],position=positions[misspelling.index],mispelled[misspelling.index]=!0,highlights.push({column:position.column,row:position.row,word:word,suggestions:misspelling.suggestions}),key=language+":"+word,seen[key]||(_this.cache.put(key,misspelling.suggestions),seen[key]=!0);for(i=l=0,len2=words.length;len2>l;i=++l)word=words[i],mispelled[i]||(key=language+":"+word,seen[key]||(_this.cache.put(key,!0),seen[key]=!0));return displayResult(highlights)}}(this)):displayResult(highlights)},SpellCheckManager.prototype.apiRequest=function(endpoint,data,callback){var abortRequest,httpRequest,options,requestHandler;return null==callback&&(callback=function(error,result){}),data.token=window.user.id,data._csrf=window.csrfToken,requestHandler=this.$q.defer(),options={timeout:requestHandler.promise},httpRequest=this.$http.post("/spelling"+endpoint,data,options).then(function(_this){return function(response){return callback(null,response.data)}}(this))["catch"](function(_this){return function(response){return callback(new Error("api failure"))}}(this)),abortRequest=function(){return requestHandler.resolve()},{abort:abortRequest}},SpellCheckManager.prototype.getWords=function(linesToProcess){var j,len,line,lines,positions,result,row,word,wordRegex,words;for(lines=this.adapter.getLines(),words=[],positions=[],row=j=0,len=lines.length;len>j;row=++j)if(line=lines[row],line=this.blankOutBlacklistedCommands(line),null==linesToProcess||linesToProcess[row])for(wordRegex=/\\?(?:['A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D])+/g;result=wordRegex.exec(line);)word=result[0],"'"===word[0]&&(word=word.slice(1)),"'"===word[word.length-1]&&(word=word.slice(0,-1)),positions.push({row:row,column:result.index}),words.push(word);return{words:words,positions:positions}},SpellCheckManager.prototype.blacklistedCommandRegex=/\\(label|[a-z]{0,16}ref|usepackage|begin|end|[a-z]{0,16}cite|input|include|includegraphics)(\[[^\]]*\])?\{[^}]*\}/g,SpellCheckManager.prototype.blankOutBlacklistedCommands=function(line){return line.replace(this.blacklistedCommandRegex,function(command){return Array(command.length+1).join(".")})},SpellCheckManager}()})}.call(this),function(){define("ide/editor/directives/aceEditor/spell-check/HighlightedWordManager",["ace/ace"],function(){var Highlight,HighlightedWordManager,Range;return Range=ace.require("ace/range").Range,Highlight=function(){function Highlight(markerId1,range1,options){this.markerId=markerId1,this.range=range1,this.word=options.word,this.suggestions=options.suggestions}return Highlight}(),HighlightedWordManager=function(){function HighlightedWordManager(editor){this.editor=editor,this.reset()}return HighlightedWordManager.prototype.reset=function(){var ref;return null!=(ref=this.highlights)&&ref.forEach(function(_this){return function(highlight){return _this.editor.getSession().removeMarker(highlight.markerId)}}(this)),this.highlights=[]},HighlightedWordManager.prototype.addHighlight=function(options){var doc,markerId,range,session;return session=this.editor.getSession(),doc=session.getDocument(),range=new Range,range.start=doc.createAnchor({row:options.row,column:options.column}),range.end=doc.createAnchor({row:options.row,column:options.column+options.word.length}),range.end.$insertRight=!0,markerId=session.addMarker(range,"spelling-highlight","text",!1),this.highlights.push(new Highlight(markerId,range,options))},HighlightedWordManager.prototype.removeHighlight=function(highlight){return this.editor.getSession().removeMarker(highlight.markerId),this.highlights=this.highlights.filter(function(hl){return hl!==highlight})},HighlightedWordManager.prototype.removeWord=function(word){return this.highlights.filter(function(highlight){return highlight.word===word}).forEach(function(_this){return function(highlight){return _this.removeHighlight(highlight)}}(this))},HighlightedWordManager.prototype.clearRow=function(row){return this.highlights.filter(function(highlight){return highlight.range.start.row===row}).forEach(function(_this){return function(highlight){return _this.removeHighlight(highlight)}}(this))},HighlightedWordManager.prototype.findHighlightWithinRange=function(range){return _.find(this.highlights,function(_this){return function(highlight){return _this._doesHighlightOverlapRange(highlight,range.start,range.end)}}(this))},HighlightedWordManager.prototype._doesHighlightOverlapRange=function(highlight,start,end){var highlightEndColumn,highlightIsAllAfterRange,highlightIsAllBeforeRange,highlightRow,highlightStartColumn;return highlightRow=highlight.range.start.row,highlightStartColumn=highlight.range.start.column,highlightEndColumn=highlight.range.end.column,highlightIsAllBeforeRange=highlightRow<start.row||highlightRow===start.row&&highlightEndColumn<=start.column,highlightIsAllAfterRange=highlightRow>end.row||highlightRow===end.row&&highlightStartColumn>=end.column,!(highlightIsAllBeforeRange||highlightIsAllAfterRange)},HighlightedWordManager.prototype.clearHighlightTouchingRange=function(range){var highlight;return highlight=_.find(this.highlights,function(_this){return function(hl){return _this._doesHighlightTouchRange(hl,range.start,range.end)}}(this)),highlight?this.removeHighlight(highlight):void 0},HighlightedWordManager.prototype._doesHighlightTouchRange=function(highlight,start,end){var highlightEndColumn,highlightRow,highlightStartColumn,rangeEndIsWithinHighlight,rangeStartIsWithinHighlight;return highlightRow=highlight.range.start.row,highlightStartColumn=highlight.range.start.column,highlightEndColumn=highlight.range.end.column,rangeStartIsWithinHighlight=highlightStartColumn<=start.column&&highlightEndColumn>=start.column,rangeEndIsWithinHighlight=highlightStartColumn<=end.column&&highlightEndColumn>=end.column,highlightRow===start.row&&(rangeStartIsWithinHighlight||rangeEndIsWithinHighlight)},HighlightedWordManager}()})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};define("ide/editor/directives/aceEditor/spell-check/SpellCheckAdapter",["ace/ace","ide/editor/directives/aceEditor/spell-check/HighlightedWordManager"],function(Ace,HighlightedWordManager){var Range,SpellCheckAdapter;return Range=ace.require("ace/range").Range,SpellCheckAdapter=function(){function SpellCheckAdapter(editor){this.editor=editor,this.replaceWord=bind(this.replaceWord,this),this.highlightedWordManager=new HighlightedWordManager(this.editor)}return SpellCheckAdapter.prototype.getLines=function(){return this.editor.getValue().split("\n")},SpellCheckAdapter.prototype.normalizeChangeEvent=function(e){return e},SpellCheckAdapter.prototype.getCoordsFromContextMenuEvent=function(e){return e.domEvent.stopPropagation(),{x:e.domEvent.clientX,y:e.domEvent.clientY}},SpellCheckAdapter.prototype.preventContextMenuEventDefault=function(e){return e.domEvent.preventDefault()},SpellCheckAdapter.prototype.getHighlightFromCoords=function(coords){var position;return position=this.editor.renderer.screenToTextCoordinates(coords.x,coords.y),this.highlightedWordManager.findHighlightWithinRange({start:position,end:position})},SpellCheckAdapter.prototype.isContextMenuEventOnBottomHalf=function(e){var clientY,editorBoundingRect,relativeYPos;return clientY=e.domEvent.clientY,editorBoundingRect=e.target.container.getBoundingClientRect(),relativeYPos=(clientY-editorBoundingRect.top)/editorBoundingRect.height,relativeYPos>.5},SpellCheckAdapter.prototype.selectHighlightedWord=function(highlight){var endColumn,row,startColumn;return row=highlight.range.start.row,startColumn=highlight.range.start.column,endColumn=highlight.range.end.column,this.editor.getSession().getSelection().setSelectionRange(new Range(row,startColumn,row,endColumn))},SpellCheckAdapter.prototype.replaceWord=function(highlight,newWord){var endColumn,row,startColumn;return row=highlight.range.start.row,startColumn=highlight.range.start.column,endColumn=highlight.range.end.column,this.editor.getSession().replace(new Range(row,startColumn,row,endColumn),newWord),this.editor.focus()},SpellCheckAdapter}()})}.call(this),function(){define("ide/colors/ColorManager",[],function(){var ColorManager;return ColorManager={getColorScheme:function(hue,element){return this.isDarkTheme(element)?{cursor:"hsl("+hue+", 70%, 50%)",labelBackgroundColor:"hsl("+hue+", 70%, 50%)",highlightBackgroundColor:"hsl("+hue+", 100%, 28%);",strikeThroughBackgroundColor:"hsl("+hue+", 100%, 20%);",strikeThroughForegroundColor:"hsl("+hue+", 100%, 60%);"}:{cursor:"hsl("+hue+", 70%, 50%)",labelBackgroundColor:"hsl("+hue+", 70%, 50%)",highlightBackgroundColor:"hsl("+hue+", 70%, 85%);",strikeThroughBackgroundColor:"hsl("+hue+", 70%, 95%);",strikeThroughForegroundColor:"hsl("+hue+", 70%, 40%);"}},isDarkTheme:function(element){var b,g,m,r,ref,rgb;return rgb=element.find(".ace_editor").css("background-color"),ref=rgb.match(/rgb\(([0-9]+), ([0-9]+), ([0-9]+)\)/),m=ref[0],r=ref[1],g=ref[2],b=ref[3],r=parseInt(r,10),g=parseInt(g,10),b=parseInt(b,10),384>r+g+b},OWN_HUE:200,ANONYMOUS_HUE:100,getHueForUserId:function(user_id){var hash,hue;return null==user_id||"anonymous-user"===user_id?this.ANONYMOUS_HUE:window.user.id===user_id?this.OWN_HUE:(hash=CryptoJS.MD5(user_id),hue=parseInt(hash.toString().slice(0,8),16)%320,hue>this.OWNER_HUE-20&&(hue+=40),hue)}}})}.call(this),function(){define("ide/editor/directives/aceEditor/highlights/HighlightsManager",["ace/ace","ide/colors/ColorManager"],function(_,ColorManager){var HighlightsManager,Range;return Range=ace.require("ace/range").Range,HighlightsManager=function(){function HighlightsManager($scope,editor,element){var onChangeScrollTop;this.$scope=$scope,this.editor=editor,this.element=element,this.markerIds=[],this.labels=[],this.$scope.annotationLabel={show:!1,right:"auto",left:"auto",top:"auto",bottom:"auto",backgroundColor:"black",text:""},this.$scope.updateLabels={updatesAbove:0,updatesBelow:0},this.$scope.$watch("highlights",function(_this){return function(value){return _this.redrawAnnotations()}}(this)),this.$scope.$watch("theme",function(_this){return function(value){return _this.redrawAnnotations()}}(this)),this.editor.on("mousemove",function(_this){return function(e){var position;return position=_this.editor.renderer.screenToTextCoordinates(e.clientX,e.clientY),e.position=position,_this.showAnnotationLabels(position)}}(this)),onChangeScrollTop=function(_this){return function(){return _this.updateShowMoreLabels()}}(this),this.editor.getSession().on("changeScrollTop",onChangeScrollTop),this.$scope.$watch("text",function(_this){return function(){return _this.$scope.navigateHighlights?setTimeout(function(){return _this.scrollToFirstHighlight()},0):void 0}}(this)),this.editor.on("changeSession",function(_this){return function(e){var ref;return null!=(ref=e.oldSession)&&ref.off("changeScrollTop",onChangeScrollTop),e.session.on("changeScrollTop",onChangeScrollTop),_this.redrawAnnotations()}}(this)),this.$scope.gotoHighlightBelow=function(_this){return function(){return null!=_this.firstHiddenHighlightAfter?_this.editor.scrollToLine(_this.firstHiddenHighlightAfter.end.row,!0,!1):void 0}}(this),this.$scope.gotoHighlightAbove=function(_this){return function(){return null!=_this.lastHiddenHighlightBefore?_this.editor.scrollToLine(_this.lastHiddenHighlightBefore.start.row,!0,!1):void 0}}(this)}return HighlightsManager.prototype.redrawAnnotations=function(){var annotation,fn,i,len,ref;for(this._clearMarkers(),this._clearLabels(),ref=this.$scope.highlights||[],fn=function(_this){return function(annotation){var colorScheme;return colorScheme=ColorManager.getColorScheme(annotation.hue,_this.element),null!=annotation.cursor?(_this.labels.push({text:annotation.label,range:new Range(annotation.cursor.row,annotation.cursor.column,annotation.cursor.row,annotation.cursor.column+1),colorScheme:colorScheme,snapToStartOfRange:!0}),_this._drawCursor(annotation,colorScheme)):null!=annotation.highlight?(_this.labels.push({text:annotation.label,range:new Range(annotation.highlight.start.row,annotation.highlight.start.column,annotation.highlight.end.row,annotation.highlight.end.column),colorScheme:colorScheme}),_this._drawHighlight(annotation,colorScheme)):null!=annotation.strikeThrough?(_this.labels.push({text:annotation.label,range:new Range(annotation.strikeThrough.start.row,annotation.strikeThrough.start.column,annotation.strikeThrough.end.row,annotation.strikeThrough.end.column),colorScheme:colorScheme}),_this._drawStrikeThrough(annotation,colorScheme)):void 0}}(this),i=0,len=ref.length;len>i;i++)annotation=ref[i],fn(annotation);return this.updateShowMoreLabels()},HighlightsManager.prototype.showAnnotationLabels=function(position){var $ace,$label,bottom,coords,height,i,label,labelToShow,left,len,offset,ref,ref1,ref2,right,top;for(labelToShow=null,ref=this.labels||[],i=0,len=ref.length;len>i;i++)label=ref[i],label.range.contains(position.row,position.column)&&(labelToShow=label);return null!=labelToShow?($ace=$(this.editor.renderer.container).find(".ace_scroller"),$ace.append(this.element.find(".annotation-label")),coords=labelToShow.snapToStartOfRange?this.editor.renderer.textToScreenCoordinates(labelToShow.range.start.row,labelToShow.range.start.column):this.editor.renderer.textToScreenCoordinates(position.row,position.column),offset=$ace.offset(),height=$ace.height(),coords.pageX=coords.pageX-offset.left,coords.pageY=coords.pageY-offset.top,coords.pageY>2*this.editor.renderer.lineHeight?(top="auto",bottom=height-coords.pageY):(top=coords.pageY+this.editor.renderer.lineHeight,bottom="auto"),this.$scope.$apply(function(_this){return function(){return _this.$scope.annotationLabel.text=labelToShow.text,_this.$scope.annotationLabel.show=!0}}(this)),$label=this.element.find(".annotation-label"),coords.pageX+$label.outerWidth()<$ace.width()?(left=coords.pageX,right="auto"):(right=0,left="auto"),this.$scope.$apply(function(_this){return function(){return _this.$scope.annotationLabel={show:!0,left:left,right:right,bottom:bottom,top:top,backgroundColor:labelToShow.colorScheme.labelBackgroundColor,text:labelToShow.text}}}(this))):(null!=(ref1=this.$scope)&&null!=(ref2=ref1.annotationLabel)?ref2.show:void 0)!==!1?this.$scope.$apply(function(_this){return function(){return _this.$scope.annotationLabel.show=!1}}(this)):void 0},HighlightsManager.prototype.updateShowMoreLabels=function(){return this.$scope.navigateHighlights?setTimeout(function(_this){return function(){var annotation,firstRow,highlightsAfter,highlightsBefore,i,lastRow,len,range,ref;for(firstRow=_this.editor.getFirstVisibleRow(),lastRow=_this.editor.getLastVisibleRow(),highlightsBefore=0,highlightsAfter=0,_this.lastHiddenHighlightBefore=null,_this.firstHiddenHighlightAfter=null,ref=_this.$scope.highlights||[],i=0,len=ref.length;len>i;i++)annotation=ref[i],range=annotation.highlight||annotation.strikeThrough,null!=range&&(range.start.row<firstRow&&(highlightsBefore+=1,_this.lastHiddenHighlightBefore=range),range.end.row>lastRow&&(highlightsAfter+=1,_this.firstHiddenHighlightAfter||(_this.firstHiddenHighlightAfter=range)));return _this.$scope.$apply(function(){return _this.$scope.updateLabels={highlightsBefore:highlightsBefore,highlightsAfter:highlightsAfter}})}}(this),100):void 0},HighlightsManager.prototype.scrollToFirstHighlight=function(){var annotation,i,len,range,ref,results;for(ref=this.$scope.highlights||[],results=[],i=0,len=ref.length;len>i;i++)if(annotation=ref[i],range=annotation.highlight||annotation.strikeThrough,null!=range){this.editor.scrollToLine(range.start.row,!0,!1);break}return results},HighlightsManager.prototype._clearMarkers=function(){var i,len,marker_id,ref;for(ref=this.markerIds,i=0,len=ref.length;len>i;i++)marker_id=ref[i],this.editor.getSession().removeMarker(marker_id);return this.markerIds=[]},HighlightsManager.prototype._clearLabels=function(){return this.labels=[]},HighlightsManager.prototype._drawCursor=function(annotation,colorScheme){return this.markerIds.push(this.editor.getSession().addMarker(new Range(annotation.cursor.row,annotation.cursor.column,annotation.cursor.row,annotation.cursor.column+1),"annotation remote-cursor",function(html,range,left,top,config){var div;return div="<div\n	class='remote-cursor custom ace_start'\n	style='height: "+config.lineHeight+"px; top:"+top+"px; left:"+left+"px; border-color: "+colorScheme.cursor+';\'\n>\n	<div class="nubbin" style="bottom: '+config.lineHeight+"px; background-color: "+colorScheme.cursor+';"></div>\n</div>',html.push(div)},!0))},HighlightsManager.prototype._drawHighlight=function(annotation,colorScheme){return this._addMarkerWithCustomStyle(new Range(annotation.highlight.start.row,annotation.highlight.start.column,annotation.highlight.end.row,annotation.highlight.end.column),"annotation highlight",!1,"background-color: "+colorScheme.highlightBackgroundColor)},HighlightsManager.prototype._drawStrikeThrough=function(annotation,colorScheme){var lineHeight;return lineHeight=this.editor.renderer.lineHeight,this._addMarkerWithCustomStyle(new Range(annotation.strikeThrough.start.row,annotation.strikeThrough.start.column,annotation.strikeThrough.end.row,annotation.strikeThrough.end.column),"annotation strike-through-background",!1,"background-color: "+colorScheme.strikeThroughBackgroundColor),this._addMarkerWithCustomStyle(new Range(annotation.strikeThrough.start.row,annotation.strikeThrough.start.column,annotation.strikeThrough.end.row,annotation.strikeThrough.end.column),"annotation strike-through-foreground",!0,"height: "+(Math.round(lineHeight/2)+2)+"px;\nborder-bottom: 2px solid "+colorScheme.strikeThroughForegroundColor+";")},HighlightsManager.prototype._addMarkerWithCustomStyle=function(range,klass,foreground,style){var markerLayer;return markerLayer=null!=foreground?this.editor.renderer.$markerBack:this.editor.renderer.$markerFront,this.markerIds.push(this.editor.getSession().addMarker(range,klass,function(html,range,left,top,config){return range.isMultiLine()?markerLayer.drawTextMarker(html,range,klass,config,style):markerLayer.drawSingleLineMarker(html,range,klass+" ace_start",config,0,style)},foreground))},HighlightsManager}()})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};define("ide/editor/directives/aceEditor/cursor-position/CursorPositionManager",[],function(){var CursorPositionManager;return CursorPositionManager=function(){function CursorPositionManager($scope,adapter,localStorage){this.$scope=$scope,this.adapter=adapter,this.localStorage=localStorage,this.onSyncToPdf=bind(this.onSyncToPdf,this),this.onCursorChange=bind(this.onCursorChange,this),this.onUnload=bind(this.onUnload,this),this.jumpToPositionInNewDoc=bind(this.jumpToPositionInNewDoc,this),this.storePositionAndLine=bind(this.storePositionAndLine,this),this.$scope.$on("editorInit",this.jumpToPositionInNewDoc),this.$scope.$on("beforeChangeDocument",this.storePositionAndLine),this.$scope.$on("afterChangeDocument",this.jumpToPositionInNewDoc),this.$scope.$on("changeEditor",this.storePositionAndLine),this.$scope.$on(this.$scope.name+":gotoLine",function(_this){return function(e,line,column){return null!=line?setTimeout(function(){return _this.adapter.gotoLine(line,column)},10):void 0}}(this)),this.$scope.$on(this.$scope.name+":gotoOffset",function(_this){return function(e,offset){return null!=offset?setTimeout(function(){return _this.adapter.gotoOffset(offset)},10):void 0}}(this)),this.$scope.$on(this.$scope.name+":clearSelection",function(_this){return function(e){return _this.adapter.clearSelection()}}(this))}return CursorPositionManager.prototype.storePositionAndLine=function(){return this.storeCursorPosition(),this.storeFirstVisibleLine()},CursorPositionManager.prototype.jumpToPositionInNewDoc=function(){var ref;return this.doc_id=null!=(ref=this.$scope.sharejsDoc)?ref.doc_id:void 0,setTimeout(function(_this){return function(){return _this.gotoStoredPosition()}}(this),0)},CursorPositionManager.prototype.onUnload=function(){return this.storeCursorPosition(),this.storeFirstVisibleLine()},CursorPositionManager.prototype.onCursorChange=function(){return this.emitCursorUpdateEvent()},CursorPositionManager.prototype.onSyncToPdf=function(){return this.$scope.$emit("cursor:"+this.$scope.name+":syncToPdf")},CursorPositionManager.prototype.storeFirstVisibleLine=function(){var docPosition;return null!=this.doc_id?(docPosition=this.localStorage("doc.position."+this.doc_id)||{},docPosition.firstVisibleLine=this.adapter.getEditorScrollPosition(),this.localStorage("doc.position."+this.doc_id,docPosition)):void 0},CursorPositionManager.prototype.storeCursorPosition=function(){var docPosition;return null!=this.doc_id?(docPosition=this.localStorage("doc.position."+this.doc_id)||{},docPosition.cursorPosition=this.adapter.getCursor(),this.localStorage("doc.position."+this.doc_id,docPosition)):void 0},CursorPositionManager.prototype.emitCursorUpdateEvent=function(){var cursor;return cursor=this.adapter.getCursor(),this.$scope.$emit("cursor:"+this.$scope.name+":update",cursor)},CursorPositionManager.prototype.gotoStoredPosition=function(){var pos;if(null!=this.doc_id)return pos=this.localStorage("doc.position."+this.doc_id)||{},this.adapter.setCursor(pos),this.adapter.setEditorScrollPosition(pos)},CursorPositionManager}()})}.call(this),function(){define("ide/editor/AceShareJsCodec",[],function(){var AceShareJsCodec;return AceShareJsCodec={aceRangeToShareJs:function(range,lines){var i,j,len,line,offset;for(offset=0,i=j=0,len=lines.length;len>j;i=++j)line=lines[i],offset+=i<range.row?line.length:range.column;return offset+=range.row},aceChangeToShareJs:function(delta,lines){var offset,text;switch(offset=AceShareJsCodec.aceRangeToShareJs(delta.start,lines),text=delta.lines.join("\n"),delta.action){case"insert":return{i:text,p:offset};case"remove":return{d:text,p:offset};default:throw new Error("unknown action: "+delta.action)}},shareJsOffsetToAcePosition:function(offset,lines){var j,len,line,row;for(row=0,row=j=0,len=lines.length;len>j&&(line=lines[row],!(offset<=line.length));row=++j)offset-=lines[row].length+1;return{row:row,column:offset}}}})}.call(this),function(){define("ide/editor/directives/aceEditor/cursor-position/CursorPositionAdapter",["ide/editor/AceShareJsCodec"],function(AceShareJsCodec){var CursorPositionAdapter;return CursorPositionAdapter=function(){function CursorPositionAdapter(editor){this.editor=editor}return CursorPositionAdapter.prototype.getCursor=function(){return this.editor.getCursorPosition()},CursorPositionAdapter.prototype.getEditorScrollPosition=function(){return this.editor.getFirstVisibleRow()},CursorPositionAdapter.prototype.setCursor=function(pos){return pos=pos.cursorPosition||{row:0,column:0},this.editor.moveCursorToPosition(pos)},CursorPositionAdapter.prototype.setEditorScrollPosition=function(pos){return pos=pos.firstVisibleLine||0,this.editor.scrollToLine(pos)},CursorPositionAdapter.prototype.clearSelection=function(){return this.editor.selection.clearSelection()},CursorPositionAdapter.prototype.gotoLine=function(line,column){return this.editor.gotoLine(line,column),this.editor.scrollToLine(line,!0,!0),this.editor.focus()},CursorPositionAdapter.prototype.gotoOffset=function(offset){var lines,position;return lines=this.editor.getSession().getDocument().getAllLines(),position=AceShareJsCodec.shareJsOffsetToAcePosition(offset,lines),this.gotoLine(position.row+1,position.column)},CursorPositionAdapter}()})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};define("ide/editor/directives/aceEditor/track-changes/TrackChangesManager",["ace/ace","utils/EventEmitter","ide/colors/ColorManager","ide/editor/AceShareJsCodec"],function(_,EventEmitter,ColorManager,AceShareJsCodec){var TrackChangesManager;return TrackChangesManager=function(){function TrackChangesManager($scope,editor,element){var _scrollTimeout,bindToAce,changingSelection,onChangeScroll,onChangeSelection,onChangeSession,onCut,onPaste,onResize,unbindFromAce;
this.$scope=$scope,this.editor=editor,this.element=element,this.onPaste=bind(this.onPaste,this),null==window.trackChangesManager&&(window.trackChangesManager=this),this.$scope.$watch("trackChanges",function(_this){return function(track_changes){return null!=track_changes?_this.setTrackChanges(track_changes):void 0}}(this)),this.$scope.$watch("sharejsDoc",function(_this){return function(doc,oldDoc){return null!=doc?(null!=oldDoc&&_this.disconnectFromDoc(oldDoc),_this.connectToDoc(doc)):void 0}}(this)),this.$scope.$on("comment:add",function(_this){return function(e,thread_id,offset,length){return _this.addCommentToSelection(thread_id,offset,length)}}(this)),this.$scope.$on("comment:select_line",function(_this){return function(e){return _this.selectLineIfNoSelection()}}(this)),this.$scope.$on("changes:accept",function(_this){return function(e,change_ids){return _this.acceptChangeIds(change_ids)}}(this)),this.$scope.$on("changes:reject",function(_this){return function(e,change_ids){return _this.rejectChangeIds(change_ids)}}(this)),this.$scope.$on("comment:remove",function(_this){return function(e,comment_id){return _this.removeCommentId(comment_id)}}(this)),this.$scope.$on("comment:resolve_threads",function(_this){return function(e,thread_ids){return _this.hideCommentsByThreadIds(thread_ids)}}(this)),this.$scope.$on("comment:unresolve_thread",function(_this){return function(e,thread_id){return _this.showCommentByThreadId(thread_id)}}(this)),this.$scope.$on("review-panel:recalculate-screen-positions",function(_this){return function(){return _this.recalculateReviewEntriesScreenPositions()}}(this)),changingSelection=!1,onChangeSelection=function(_this){return function(){return changingSelection?void 0:(changingSelection=!0,_this.$scope.$evalAsync(function(){return changingSelection=!1,_this.updateFocus()}))}}(this),onResize=function(_this){return function(){return _this.recalculateReviewEntriesScreenPositions()}}(this),onChangeSession=function(_this){return function(e){return _this.clearAnnotations(),_this.redrawAnnotations(),_this.editor.session.on("changeScrollTop",onChangeScroll)}}(this),_scrollTimeout=null,onChangeScroll=function(_this){return function(){return null==_scrollTimeout?_scrollTimeout=setTimeout(function(){return _this.recalculateVisibleEntries(),_this.$scope.$apply(),_scrollTimeout=null},200):void 0}}(this),this._resetCutState(),onCut=function(_this){return function(){return _this.onCut()}}(this),onPaste=function(_this){return function(){return _this.onPaste()}}(this),bindToAce=function(_this){return function(){return _this.editor.on("changeSelection",onChangeSelection),_this.editor.on("change",onChangeSelection),_this.editor.on("changeSession",onChangeSession),_this.editor.on("cut",onCut),_this.editor.on("paste",onPaste),_this.editor.renderer.on("resize",onResize)}}(this),unbindFromAce=function(_this){return function(){return _this.editor.off("changeSelection",onChangeSelection),_this.editor.off("change",onChangeSelection),_this.editor.off("changeSession",onChangeSession),_this.editor.off("cut",onCut),_this.editor.off("paste",onPaste),_this.editor.renderer.off("resize",onResize)}}(this),this.$scope.$watch("trackChangesEnabled",function(_this){return function(enabled){return null!=enabled?enabled?bindToAce():unbindFromAce():void 0}}(this))}var Range;return Range=ace.require("ace/range").Range,TrackChangesManager.prototype.disconnectFromDoc=function(doc){return this.changeIdToMarkerIdMap={},doc.off("ranges:clear"),doc.off("ranges:redraw"),doc.off("ranges:dirty")},TrackChangesManager.prototype.setTrackChanges=function(value){var ref,ref1;return value?null!=(ref=this.$scope.sharejsDoc)?ref.track_changes_as=window.user.id||"anonymous":void 0:null!=(ref1=this.$scope.sharejsDoc)?ref1.track_changes_as=null:void 0},TrackChangesManager.prototype.connectToDoc=function(doc){return this.rangesTracker=doc.ranges,this.setTrackChanges(this.$scope.trackChanges),doc.on("ranges:dirty",function(_this){return function(){return _this.updateAnnotations()}}(this)),doc.on("ranges:clear",function(_this){return function(){return _this.clearAnnotations()}}(this)),doc.on("ranges:redraw",function(_this){return function(){return _this.redrawAnnotations()}}(this))},TrackChangesManager.prototype.clearAnnotations=function(){var change_id,marker_id,marker_name,markers,ref,session;session=this.editor.getSession(),ref=this.changeIdToMarkerIdMap;for(change_id in ref){markers=ref[change_id];for(marker_name in markers)marker_id=markers[marker_name],session.removeMarker(marker_id)}return this.changeIdToMarkerIdMap={}},TrackChangesManager.prototype.redrawAnnotations=function(){var change,comment,i,j,len,len1,ref,ref1;for(ref=this.rangesTracker.changes,i=0,len=ref.length;len>i;i++)change=ref[i],null!=change.op.i?this._onInsertAdded(change):null!=change.op.d&&this._onDeleteAdded(change);for(ref1=this.rangesTracker.comments,j=0,len1=ref1.length;len1>j;j++)comment=ref1[j],this._onCommentAdded(comment);return this.broadcastChange()},TrackChangesManager.prototype._doneUpdateThisLoop=!1,TrackChangesManager.prototype._pendingUpdates=!1,TrackChangesManager.prototype.updateAnnotations=function(){return this._doneUpdateThisLoop?this._pendingUpdates=!0:(this._doUpdateAnnotations(),this._doneUpdateThisLoop=!0,setTimeout(function(_this){return function(){return _this._pendingUpdates&&_this._doUpdateAnnotations(),_this._doneUpdateThisLoop=!1,_this._pendingUpdates=!1}}(this)))},TrackChangesManager.prototype._doUpdateAnnotations=function(){var change,comment,dirty,id,ref,ref1,ref2,ref3,ref4,ref5,updateMarkers;dirty=this.rangesTracker.getDirtyState(),updateMarkers=!1,ref=dirty.change.added;for(id in ref)change=ref[id],null!=change.op.i?this._onInsertAdded(change):null!=change.op.d&&this._onDeleteAdded(change);ref1=dirty.change.removed;for(id in ref1)change=ref1[id],null!=change.op.i?this._onInsertRemoved(change):null!=change.op.d&&this._onDeleteRemoved(change);ref2=dirty.change.moved;for(id in ref2)change=ref2[id],updateMarkers=!0,this._onChangeMoved(change);ref3=dirty.comment.added;for(id in ref3)comment=ref3[id],this._onCommentAdded(comment);ref4=dirty.comment.removed;for(id in ref4)comment=ref4[id],this._onCommentRemoved(comment);ref5=dirty.comment.moved;for(id in ref5)comment=ref5[id],updateMarkers=!0,this._onCommentMoved(comment);return this.rangesTracker.resetDirtyState(),updateMarkers&&this.editor.renderer.updateBackMarkers(),this.broadcastChange()},TrackChangesManager.prototype.addComment=function(offset,content,thread_id){var op;return op={c:content,p:offset,t:thread_id},this.$scope.sharejsDoc.submitOp(op)},TrackChangesManager.prototype.addCommentToSelection=function(thread_id,offset,length){var content,end,range,start;return start=this._shareJsOffsetToAcePosition(offset),end=this._shareJsOffsetToAcePosition(offset+length),range=new Range(start.row,start.column,end.row,end.column),content=this.editor.session.getTextRange(range),this.addComment(offset,content,thread_id)},TrackChangesManager.prototype.selectLineIfNoSelection=function(){return this.editor.selection.isEmpty()?this.editor.selection.selectLine():void 0},TrackChangesManager.prototype.acceptChangeIds=function(change_ids){return this.rangesTracker.removeChangeIds(change_ids),this.updateAnnotations(),this.updateFocus()},TrackChangesManager.prototype.rejectChangeIds=function(change_ids){var change,changes,content,editor_text,end,i,len,position,session,start;if(changes=this.rangesTracker.getChanges(change_ids),0!==changes.length){for(changes.sort(function(a,b){return b.op.p-a.op.p}),session=this.editor.getSession(),i=0,len=changes.length;len>i;i++)if(change=changes[i],null!=change.op.d)content=change.op.d,position=this._shareJsOffsetToAcePosition(change.op.p),session.$fromReject=!0,session.insert(position,content),session.$fromReject=!1;else{if(null==change.op.i)throw new Error("unknown change: "+JSON.stringify(change));if(start=this._shareJsOffsetToAcePosition(change.op.p),end=this._shareJsOffsetToAcePosition(change.op.p+change.op.i.length),editor_text=session.getDocument().getTextRange({start:start,end:end}),editor_text!==change.op.i)throw new Error("Op to be removed ("+JSON.stringify(change.op)+"), does not match editor text, '"+editor_text+"'");session.$fromReject=!0,session.remove({start:start,end:end}),session.$fromReject=!1}return setTimeout(function(_this){return function(){return _this.updateFocus()}}(this))}},TrackChangesManager.prototype.removeCommentId=function(comment_id){return this.rangesTracker.removeCommentId(comment_id),this.updateAnnotations()},TrackChangesManager.prototype.hideCommentsByThreadIds=function(thread_ids){var comment,i,id,j,len,len1,ref,ref1,resolve_ids;for(resolve_ids={},i=0,len=thread_ids.length;len>i;i++)id=thread_ids[i],resolve_ids[id]=!0;for(ref1=(null!=(ref=this.rangesTracker)?ref.comments:void 0)||[],j=0,len1=ref1.length;len1>j;j++)comment=ref1[j],resolve_ids[comment.op.t]&&this._onCommentRemoved(comment);return this.broadcastChange()},TrackChangesManager.prototype.showCommentByThreadId=function(thread_id){var comment,i,len,ref,ref1;for(ref1=(null!=(ref=this.rangesTracker)?ref.comments:void 0)||[],i=0,len=ref1.length;len>i;i++)comment=ref1[i],comment.op.t===thread_id&&this._onCommentAdded(comment);return this.broadcastChange()},TrackChangesManager.prototype._resetCutState=function(){return this._cutState={text:null,comments:[],docId:null}},TrackChangesManager.prototype.onCut=function(){var comment,comment_end,comment_start,i,len,ref,results,selection,selection_end,selection_start;for(this._resetCutState(),selection=this.editor.getSelectionRange(),selection_start=this._aceRangeToShareJs(selection.start),selection_end=this._aceRangeToShareJs(selection.end),this._cutState.text=this.editor.getSelectedText(),this._cutState.docId=this.$scope.docId,ref=this.rangesTracker.comments,results=[],i=0,len=ref.length;len>i;i++)comment=ref[i],comment_start=comment.op.p,comment_end=comment_start+comment.op.c.length,comment_start>=selection_start&&selection_end>=comment_end?results.push(this._cutState.comments.push({offset:comment.op.p-selection_start,text:comment.op.c,comment:comment})):results.push(void 0);return results},TrackChangesManager.prototype.onPaste=function(){return this.editor.once("change",function(_this){return function(change){var paste_offset,pasted_text;if("insert"===change.action)return pasted_text=change.lines.join("\n"),paste_offset=_this._aceRangeToShareJs(change.start),_this.$scope.sharejsDoc.on("ranges:dirty.paste",function(){var comment,i,len,offset,op,ref,ref1,text;if(_this.$scope.sharejsDoc.off("ranges:dirty.paste"),pasted_text===_this._cutState.text&&_this.$scope.docId===_this._cutState.docId)for(ref=_this._cutState.comments,i=0,len=ref.length;len>i;i++)ref1=ref[i],comment=ref1.comment,offset=ref1.offset,text=ref1.text,op={c:text,p:paste_offset+offset,t:comment.id},_this.$scope.sharejsDoc.submitOp(op);return _this._resetCutState(),_this.rangesTracker.validate(_this.editor.getValue())})}}(this))},TrackChangesManager.prototype.checkMapping=function(){var background_marker_id,callout_marker_id,change,comment,end,expected_markers,i,j,k,len,len1,len2,marker,marker_id,markers,op,ref,ref1,ref2,ref3,ref4,ref5,results,session,start;session=this.editor.getSession(),markers={},ref=session.getMarkers();for(marker_id in ref)marker=ref[marker_id],markers[marker_id]=marker;for(expected_markers=[],ref1=this.rangesTracker.changes,i=0,len=ref1.length;len>i;i++)change=ref1[i],null!=this.changeIdToMarkerIdMap[change.id]&&(op=change.op,ref2=this.changeIdToMarkerIdMap[change.id],background_marker_id=ref2.background_marker_id,callout_marker_id=ref2.callout_marker_id,start=this._shareJsOffsetToAcePosition(op.p),null!=op.i?end=this._shareJsOffsetToAcePosition(op.p+op.i.length):null!=op.d&&(end=start),expected_markers.push({marker_id:background_marker_id,start:start,end:end}),expected_markers.push({marker_id:callout_marker_id,start:start,end:start}));for(ref3=this.rangesTracker.comments,j=0,len1=ref3.length;len1>j;j++)comment=ref3[j],null!=this.changeIdToMarkerIdMap[comment.id]&&(ref4=this.changeIdToMarkerIdMap[comment.id],background_marker_id=ref4.background_marker_id,callout_marker_id=ref4.callout_marker_id,start=this._shareJsOffsetToAcePosition(comment.op.p),end=this._shareJsOffsetToAcePosition(comment.op.p+comment.op.c.length),expected_markers.push({marker_id:background_marker_id,start:start,end:end}),expected_markers.push({marker_id:callout_marker_id,start:start,end:start}));for(k=0,len2=expected_markers.length;len2>k;k++)ref5=expected_markers[k],marker_id=ref5.marker_id,start=ref5.start,end=ref5.end,marker=markers[marker_id],delete markers[marker_id],(marker.range.start.row!==start.row||marker.range.start.column!==start.column||marker.range.end.row!==end.row||marker.range.end.column!==end.column)&&console.error("Change doesn't match marker anymore",{change:change,marker:marker,start:start,end:end});results=[];for(marker_id in markers)marker=markers[marker_id],/track-changes/.test(marker.clazz)?results.push(console.error("Orphaned ace marker",marker)):results.push(void 0);return results},TrackChangesManager.prototype.updateFocus=function(){var entries,is_selection,selection,selection_end,selection_start;return selection=this.editor.getSelectionRange(),selection_start=this._aceRangeToShareJs(selection.start),selection_end=this._aceRangeToShareJs(selection.end),entries=this._getCurrentDocEntries(),is_selection=selection_start!==selection_end,this.$scope.$emit("editor:focus:changed",selection_start,selection_end,is_selection)},TrackChangesManager.prototype.broadcastChange=function(){return this.$scope.$emit("editor:track-changes:changed",this.$scope.docId)},TrackChangesManager.prototype.recalculateReviewEntriesScreenPositions=function(){var doc_position,entries,entry,entry_id,firstRow,lastRow,ref,ref1,renderer,screen_position,session,y;session=this.editor.getSession(),renderer=this.editor.renderer,ref=renderer.layerConfig,firstRow=ref.firstRow,lastRow=ref.lastRow,entries=this._getCurrentDocEntries(),ref1=entries||{};for(entry_id in ref1)entry=ref1[entry_id],doc_position=this._shareJsOffsetToAcePosition(entry.offset),screen_position=session.documentToScreenPosition(doc_position.row,doc_position.column),y=screen_position.row*renderer.lineHeight,null==entry.screenPos&&(entry.screenPos={}),entry.screenPos.y=y,entry.docPos=doc_position;return this.recalculateVisibleEntries(),this.$scope.$apply()},TrackChangesManager.prototype.recalculateVisibleEntries=function(){var CULL_AFTER,OFFSCREEN_ROWS,changed,entries,entriesLength,entry,entry_id,firstRow,lastRow,old,ref,ref1;OFFSCREEN_ROWS=20,CULL_AFTER=100,ref=this.editor.renderer.layerConfig,firstRow=ref.firstRow,lastRow=ref.lastRow,entries=this._getCurrentDocEntries()||{},entriesLength=Object.keys(entries).length,changed=!1;for(entry_id in entries)entry=entries[entry_id],old=entry.visible,entry.visible=CULL_AFTER>entriesLength||firstRow-OFFSCREEN_ROWS<=(ref1=entry.docPos.row)&&lastRow+OFFSCREEN_ROWS>=ref1,entry.visible!==old&&(changed=!0);return changed?this.$scope.$emit("editor:track-changes:visibility_changed"):void 0},TrackChangesManager.prototype._getCurrentDocEntries=function(){var base,doc_id,entries;return doc_id=this.$scope.docId,entries=null!=(base=this.$scope.reviewPanel.entries)[doc_id]?base[doc_id]:base[doc_id]={}},TrackChangesManager.prototype._makeZeroWidthRange=function(position){var ace_range;return ace_range=new Range(position.row,position.column,position.row,position.column),ace_range.clipRows=function(first_row,last_row){return this.isEmpty=function(){return first_row>this.end.row||last_row<this.start.row},this},ace_range},TrackChangesManager.prototype._createCalloutMarker=function(position,klass){var callout_marker_id,callout_range,markerLayer,session;return session=this.editor.getSession(),callout_range=this._makeZeroWidthRange(position),markerLayer=this.editor.renderer.$markerBack,callout_marker_id=session.addMarker(callout_range,klass,function(html,range,left,top,config){return markerLayer.drawSingleLineMarker(html,range,"track-changes-marker-callout "+klass+" ace_start",config,0,"width: auto; right: 0;")})},TrackChangesManager.prototype._onInsertAdded=function(change){var background_marker_id,background_range,callout_marker_id,doc,end,session,start;return start=this._shareJsOffsetToAcePosition(change.op.p),end=this._shareJsOffsetToAcePosition(change.op.p+change.op.i.length),session=this.editor.getSession(),doc=session.getDocument(),background_range=new Range(start.row,start.column,end.row,end.column),background_marker_id=session.addMarker(background_range,"track-changes-marker track-changes-added-marker","text"),callout_marker_id=this._createCalloutMarker(start,"track-changes-added-marker-callout"),this.changeIdToMarkerIdMap[change.id]={background_marker_id:background_marker_id,callout_marker_id:callout_marker_id}},TrackChangesManager.prototype._onDeleteAdded=function(change){var background_marker_id,background_range,callout_marker_id,doc,klass,markerLayer,position,session;return position=this._shareJsOffsetToAcePosition(change.op.p),session=this.editor.getSession(),doc=session.getDocument(),markerLayer=this.editor.renderer.$markerBack,klass="track-changes-marker track-changes-deleted-marker",background_range=this._makeZeroWidthRange(position),background_marker_id=session.addMarker(background_range,klass,function(html,range,left,top,config){return markerLayer.drawSingleLineMarker(html,range,klass+" ace_start",config,0,"")}),callout_marker_id=this._createCalloutMarker(position,"track-changes-deleted-marker-callout"),this.changeIdToMarkerIdMap[change.id]={background_marker_id:background_marker_id,callout_marker_id:callout_marker_id}},TrackChangesManager.prototype._onInsertRemoved=function(change){var background_marker_id,callout_marker_id,ref,session;return ref=this.changeIdToMarkerIdMap[change.id],background_marker_id=ref.background_marker_id,callout_marker_id=ref.callout_marker_id,delete this.changeIdToMarkerIdMap[change.id],session=this.editor.getSession(),session.removeMarker(background_marker_id),session.removeMarker(callout_marker_id)},TrackChangesManager.prototype._onDeleteRemoved=function(change){var background_marker_id,callout_marker_id,ref,session;return ref=this.changeIdToMarkerIdMap[change.id],background_marker_id=ref.background_marker_id,callout_marker_id=ref.callout_marker_id,delete this.changeIdToMarkerIdMap[change.id],session=this.editor.getSession(),session.removeMarker(background_marker_id),session.removeMarker(callout_marker_id)},TrackChangesManager.prototype._onCommentAdded=function(comment){var background_marker_id,background_range,callout_marker_id,doc,end,session,start;if(!this.rangesTracker.resolvedThreadIds[comment.op.t])return null==this.changeIdToMarkerIdMap[comment.id]?(start=this._shareJsOffsetToAcePosition(comment.op.p),end=this._shareJsOffsetToAcePosition(comment.op.p+comment.op.c.length),session=this.editor.getSession(),doc=session.getDocument(),background_range=new Range(start.row,start.column,end.row,end.column),background_marker_id=session.addMarker(background_range,"track-changes-marker track-changes-comment-marker","text"),callout_marker_id=this._createCalloutMarker(start,"track-changes-comment-marker-callout"),this.changeIdToMarkerIdMap[comment.id]={background_marker_id:background_marker_id,callout_marker_id:callout_marker_id}):void 0},TrackChangesManager.prototype._onCommentRemoved=function(comment){var background_marker_id,callout_marker_id,ref,session;return null!=this.changeIdToMarkerIdMap[comment.id]?(ref=this.changeIdToMarkerIdMap[comment.id],background_marker_id=ref.background_marker_id,callout_marker_id=ref.callout_marker_id,delete this.changeIdToMarkerIdMap[comment.id],session=this.editor.getSession(),session.removeMarker(background_marker_id),session.removeMarker(callout_marker_id)):void 0},TrackChangesManager.prototype._aceRangeToShareJs=function(range){var lines;return lines=this.editor.getSession().getDocument().getLines(0,range.row),AceShareJsCodec.aceRangeToShareJs(range,lines)},TrackChangesManager.prototype._aceChangeToShareJs=function(delta){var lines;return lines=this.editor.getSession().getDocument().getLines(0,delta.start.row),AceShareJsCodec.aceChangeToShareJs(delta,lines)},TrackChangesManager.prototype._shareJsOffsetToAcePosition=function(offset){var lines;return lines=this.editor.getSession().getDocument().getAllLines(),AceShareJsCodec.shareJsOffsetToAcePosition(offset,lines)},TrackChangesManager.prototype._onChangeMoved=function(change){var end,start;return start=this._shareJsOffsetToAcePosition(change.op.p),end=null!=change.op.i?this._shareJsOffsetToAcePosition(change.op.p+change.op.i.length):start,this._updateMarker(change.id,start,end)},TrackChangesManager.prototype._onCommentMoved=function(comment){var end,start;return start=this._shareJsOffsetToAcePosition(comment.op.p),end=this._shareJsOffsetToAcePosition(comment.op.p+comment.op.c.length),this._updateMarker(comment.id,start,end)},TrackChangesManager.prototype._updateMarker=function(change_id,start,end){var background_marker,background_marker_id,callout_marker,callout_marker_id,markers,ref,session;if(null!=this.changeIdToMarkerIdMap[change_id])return session=this.editor.getSession(),markers=session.getMarkers(),ref=this.changeIdToMarkerIdMap[change_id],background_marker_id=ref.background_marker_id,callout_marker_id=ref.callout_marker_id,null!=background_marker_id&&null!=markers[background_marker_id]&&(background_marker=markers[background_marker_id],background_marker.range.start=start,background_marker.range.end=end),null!=callout_marker_id&&null!=markers[callout_marker_id]?(callout_marker=markers[callout_marker_id],callout_marker.range.start=start,callout_marker.range.end=start):void 0},TrackChangesManager}()})}.call(this),function(){define("ide/editor/directives/aceEditor/metadata/MetadataManager",["ace/ace"],function(){var MetadataManager,Range,getLastCommandFragment;return Range=ace.require("ace/range").Range,getLastCommandFragment=function(lineUpToCursor){var m;return(m=lineUpToCursor.match(/(\\[^\\]+)$/))?m[1]:null},MetadataManager=function(){function MetadataManager($scope,editor,element,Metadata){var onChange;this.$scope=$scope,this.editor=editor,this.element=element,this.Metadata=Metadata,this.debouncer={},onChange=function(_this){return function(change){var commandFragment,cursorPosition,end,lastCommandFragmentIsLabel,lastCommandFragmentIsMeta,lastCommandFragmentIsPackage,lastCommandFragmentIsReqPack,lineUpToCursor,linesContainLabel,linesContainMeta,linesContainPackage,linesContainReqPackage,range,ref;if(!change.remote&&("remove"===(ref=change.action)||"insert"===ref))return cursorPosition=_this.editor.getCursorPosition(),end=change.end,range=new Range(end.row,0,end.row,end.column),lineUpToCursor=_this.editor.getSession().getTextRange(range),("%"===lineUpToCursor.trim()||"\\"===lineUpToCursor.slice(0,1))&&(range=new Range(end.row,0,end.row,end.column+80),lineUpToCursor=_this.editor.getSession().getTextRange(range)),commandFragment=getLastCommandFragment(lineUpToCursor),linesContainPackage=_.any(change.lines,function(line){return line.match(/^\\usepackage(?:\[.{0,80}?])?{(.{0,80}?)}/)}),linesContainReqPackage=_.any(change.lines,function(line){return line.match(/^\\RequirePackage(?:\[.{0,80}?])?{(.{0,80}?)}/)}),linesContainLabel=_.any(change.lines,function(line){return line.match(/\\label{(.{0,80}?)}/)}),linesContainMeta=linesContainPackage||linesContainLabel||linesContainReqPackage,lastCommandFragmentIsLabel="\\label{"===(null!=commandFragment?commandFragment.slice(0,7):void 0),lastCommandFragmentIsPackage="\\usepackage"===(null!=commandFragment?commandFragment.slice(0,11):void 0),lastCommandFragmentIsReqPack="\\RequirePackage"===(null!=commandFragment?commandFragment.slice(0,15):void 0),lastCommandFragmentIsMeta=lastCommandFragmentIsPackage||lastCommandFragmentIsLabel||lastCommandFragmentIsReqPack,linesContainMeta||lastCommandFragmentIsMeta?_this.Metadata.scheduleLoadDocMetaFromServer(_this.$scope.docId):void 0}}(this),this.editor.on("changeSession",function(_this){return function(e){return e.oldSession.off("change",onChange),e.session.on("change",onChange)}}(this))}return MetadataManager.prototype.getAllLabels=function(){return this.Metadata.getAllLabels()},MetadataManager.prototype.getAllPackages=function(){return this.Metadata.getAllPackages()},MetadataManager}()})}.call(this),function(){define("ide/metadata/services/metadata",["base"],function(App){return App.factory("metadata",function($http,ide){var debouncer,metadata,state;return debouncer={},state={documents:{}},metadata={state:state},metadata.onBroadcastDocMeta=function(data){return null!=data.docId&&null!=data.meta?state.documents[data.docId]=data.meta:void 0},metadata.onEntityDeleted=function(e,entity){return"doc"===entity.type?delete state.documents[entity.id]:void 0},metadata.onFileUploadComplete=function(e,upload){return"doc"===upload.entity_type?metadata.loadDocMetaFromServer(upload.entity_id):void 0},metadata.getAllLabels=function(){var docId,meta;return _.flatten(function(){var ref,results;ref=state.documents,results=[];for(docId in ref)meta=ref[docId],results.push(meta.labels);return results}())},metadata.getAllPackages=function(){var _docId,commandSnippets,meta,packageCommandMapping,packageName,ref,ref1;packageCommandMapping={},ref=state.documents;for(_docId in ref){meta=ref[_docId],ref1=meta.packages;for(packageName in ref1)commandSnippets=ref1[packageName],packageCommandMapping[packageName]=commandSnippets}return packageCommandMapping},metadata.loadProjectMetaFromServer=function(){return $http.get("/project/"+window.project_id+"/metadata").then(function(response){var data,docId,docMeta,ref,results;if(data=response.data,data.projectMeta){ref=data.projectMeta,results=[];for(docId in ref)docMeta=ref[docId],results.push(state.documents[docId]=docMeta);return results}})},metadata.loadDocMetaFromServer=function(docId){return $http.post("/project/"+window.project_id+"/doc/"+docId+"/metadata",{_csrf:window.csrfToken})},metadata.scheduleLoadDocMetaFromServer=function(docId){var existingTimeout;return existingTimeout=debouncer[docId],null!=existingTimeout&&(clearTimeout(existingTimeout),delete debouncer[docId]),debouncer[docId]=setTimeout(function(_this){return function(){return metadata.loadDocMetaFromServer(docId),delete debouncer[docId]}}(this),1e3)},metadata})})}.call(this),function(){define("ide/graphics/services/graphics",["base"],function(App){return App.factory("graphics",function(ide){var Graphics;return Graphics={getGraphicsFiles:function(){var graphicsFiles;return graphicsFiles=[],ide.fileTreeManager.forEachEntity(function(entity,folder,path){var cloned,ref;return"file"===entity.type&&(null!=entity&&null!=(ref=entity.name)&&"function"==typeof ref.match?ref.match(/.*\.(png|jpg|jpeg|pdf|eps)/):void 0)?(cloned=_.clone(entity),cloned.path=path,graphicsFiles.push(cloned)):void 0}),graphicsFiles}}})})}.call(this),function(){define("ide/preamble/services/preamble",["base"],function(App){return App.factory("preamble",function(ide){var Preamble;return Preamble={getPreambleText:function(){var preamble,ref,text;return text=ide.editorManager.getCurrentDocValue().slice(0,5e3),preamble=(null!=(ref=text.match(/([^]*)^\\begin\{document\}/m))?ref[1]:void 0)||""},getGraphicsPaths:function(){var graphicsPathsArgs,match,paths,preamble,re,ref;for(preamble=Preamble.getPreambleText(),graphicsPathsArgs=(null!=(ref=preamble.match(/\\graphicspath\{(.*)\}/))?ref[1]:void 0)||"",paths=[],re=/\{([^}]*)\}/g;match=re.exec(graphicsPathsArgs);)paths.push(match[1]);return paths}}})})}.call(this),function(){define("ide/files/services/files",["base"],function(App){return App.factory("files",function(ide){var Files;return Files={getTeXFiles:function(){var texFiles;return texFiles=[],ide.fileTreeManager.forEachEntity(function(entity,folder,path){var cloned,ref;return"doc"===entity.type&&(null!=entity&&null!=(ref=entity.name)&&"function"==typeof ref.match?ref.match(/.*\.(tex|txt|md)/):void 0)?(cloned=_.clone(entity),cloned.path=path,texFiles.push(cloned)):void 0}),texFiles}}})})}.call(this),function(){var slice=[].slice;define("ide/editor/directives/aceEditor",["base","ace/ace","ace/ext-searchbox","ace/ext-modelist","ace/keybinding-vim","ide/editor/directives/aceEditor/undo/UndoManager","ide/editor/directives/aceEditor/auto-complete/AutoCompleteManager","ide/editor/directives/aceEditor/spell-check/SpellCheckManager","ide/editor/directives/aceEditor/spell-check/SpellCheckAdapter","ide/editor/directives/aceEditor/highlights/HighlightsManager","ide/editor/directives/aceEditor/cursor-position/CursorPositionManager","ide/editor/directives/aceEditor/cursor-position/CursorPositionAdapter","ide/editor/directives/aceEditor/track-changes/TrackChangesManager","ide/editor/directives/aceEditor/metadata/MetadataManager","ide/metadata/services/metadata","ide/graphics/services/graphics","ide/preamble/services/preamble","ide/files/services/files"],function(App,Ace,SearchBox,Vim,ModeList,UndoManager,AutoCompleteManager,SpellCheckManager,SpellCheckAdapter,HighlightsManager,CursorPositionManager,CursorPositionAdapter,TrackChangesManager,MetadataManager){var EditSession,monkeyPatchSearch,syntaxValidationEnabled;return EditSession=ace.require("ace/edit_session").EditSession,ModeList=ace.require("ace/ext/modelist"),Vim=ace.require("ace/keyboard/vim").Vim,""!==window.aceWorkerPath?(syntaxValidationEnabled=!0,ace.config.set("workerPath",""+window.aceWorkerPath)):syntaxValidationEnabled=!1,ace.config.setDefaultValue("session","useWorker",!1),null==ace.config._moduleUrl&&(ace.config._moduleUrl=ace.config.moduleUrl,ace.config.moduleUrl=function(){var args,ref,url;return args=1<=arguments.length?slice.call(arguments,0):[],url=(ref=ace.config)._moduleUrl.apply(ref,args)}),App.directive("aceEditor",function($timeout,$compile,$rootScope,event_tracking,localStorage,$cacheFactory,metadata,graphics,preamble,files,$http,$q,$window){return monkeyPatchSearch($rootScope,$compile),{scope:{theme:"=",showPrintMargin:"=",keybindings:"=",fontSize:"=",autoComplete:"=",autoPairDelimiters:"=",sharejsDoc:"=",spellCheck:"=",spellCheckLanguage:"=",highlights:"=",text:"=",readOnly:"=",annotations:"=",navigateHighlights:"=",fileName:"=",onCtrlEnter:"=",onCtrlJ:"=",onCtrlShiftC:"=",onCtrlShiftA:"=",onSave:"=",syntaxValidation:"=",reviewPanel:"=",eventsBridge:"=",trackChanges:"=",trackChangesEnabled:"=",docId:"=",rendererData:"=",lineHeight:"=",fontFamily:"="},link:function(scope,element,attrs){var attachToAce,autoCompleteManager,cursorPositionManager,detachFromAce,editor,event,getCursorScreenPosition,highlightsManager,i,initCursorPosition,initSpellCheck,len,metadataManager,onChange,onScroll,onScrollbarVisibilityChanged,onSessionChangeForCursorPosition,onSessionChangeForSpellCheck,onUnloadForCursorPosition,ref,resetScrollMargins,setScrollMargins,spellCheckCache,spellCheckManager,tearDownCursorPosition,tearDownSpellCheck,trackChangesManager,triggerEditorInitEvent,undoManager,updateCount;if(scope.$originalApply=scope.$apply,scope.$apply=function(fn){var phase;return null==fn&&(fn=function(){}),phase=this.$root.$$phase,"$apply"===phase||"$digest"===phase?fn():this.$originalApply(fn)},editor=ace.edit(element.find(".ace-editor-body")[0]),editor.$blockScrolling=Infinity,editor.setOption("behavioursEnabled",scope.autoPairDelimiters||!1),editor.setOption("wrapBehavioursEnabled",!1),scope.$watch("autoPairDelimiters",function(_this){return function(autoPairDelimiters){return autoPairDelimiters?editor.setOption("behavioursEnabled",!0):editor.setOption("behavioursEnabled",!1)}}(this)),window._debug_editors||(window._debug_editors=[]),window._debug_editors.push(editor),scope.name=attrs.aceEditor,scope.spellCheck&&(spellCheckCache=$cacheFactory.get("spellCheck-"+scope.name)||$cacheFactory("spellCheck-"+scope.name,{capacity:1e3}),spellCheckManager=new SpellCheckManager(scope,spellCheckCache,$http,$q,new SpellCheckAdapter(editor))),undoManager=new UndoManager(scope,editor,element),highlightsManager=new HighlightsManager(scope,editor,element),
cursorPositionManager=new CursorPositionManager(scope,new CursorPositionAdapter(editor),localStorage),trackChangesManager=new TrackChangesManager(scope,editor,element),metadataManager=new MetadataManager(scope,editor,element,metadata),autoCompleteManager=new AutoCompleteManager(scope,editor,element,metadataManager,graphics,preamble,files),scope.$watch("onSave",function(callback){return null!=callback?(Vim.defineEx("write","w",callback),editor.commands.addCommand({name:"save",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:callback,readOnly:!0}),editor.commands.addCommand({name:"recompile_v1",bindKey:{win:"Ctrl-.",mac:"Ctrl-."},exec:callback,readOnly:!0})):void 0}),editor.commands.removeCommand("transposeletters"),editor.commands.removeCommand("showSettingsMenu"),editor.commands.removeCommand("foldall"),editor.commands.removeCommand("toggleBlockComment"),editor.commands.removeCommand("togglecomment"),editor.commands.addCommand({name:"togglecomment",bindKey:{win:"Ctrl-/|Ctrl-Shift-7",mac:"Command-/|Command-Shift-/"},exec:function(editor){return editor.toggleCommentLines()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"}),editor.commands.addCommand({name:"find",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(editor){return ace.require("ace/ext/searchbox").Search(editor,!0)},readOnly:!0}),editor.commands.addCommand({name:"bold",bindKey:{win:"Ctrl-B",mac:"Command-B"},exec:function(editor){var selection,text;return selection=editor.getSelection(),selection.isEmpty()?(editor.insert("\\textbf{}"),editor.navigateLeft(1)):(text=editor.getCopyText(),editor.insert("\\textbf{"+text+"}"))},readOnly:!1}),editor.commands.addCommand({name:"italics",bindKey:{win:"Ctrl-I",mac:"Command-I"},exec:function(editor){var selection,text;return selection=editor.getSelection(),selection.isEmpty()?(editor.insert("\\textit{}"),editor.navigateLeft(1)):(text=editor.getCopyText(),editor.insert("\\textit{"+text+"}"))},readOnly:!1}),scope.$watch("onCtrlEnter",function(callback){return null!=callback?editor.commands.addCommand({name:"compile",bindKey:{win:"Ctrl-Enter",mac:"Command-Enter"},exec:function(_this){return function(editor){return callback()}}(this),readOnly:!0}):void 0}),scope.$watch("onCtrlJ",function(callback){return null!=callback?editor.commands.addCommand({name:"toggle-review-panel",bindKey:{win:"Ctrl-J",mac:"Command-J"},exec:function(_this){return function(editor){return callback()}}(this),readOnly:!0}):void 0}),scope.$watch("onCtrlShiftC",function(callback){return null!=callback?editor.commands.addCommand({name:"add-new-comment",bindKey:{win:"Ctrl-Shift-C",mac:"Command-Shift-C"},exec:function(_this){return function(editor){return callback()}}(this),readOnly:!0}):void 0}),scope.$watch("onCtrlShiftA",function(callback){return null!=callback?editor.commands.addCommand({name:"toggle-track-changes",bindKey:{win:"Ctrl-Shift-A",mac:"Command-Shift-A"},exec:function(_this){return function(editor){return callback()}}(this),readOnly:!0}):void 0}),editor.showCommandLine=function(_this){return function(arg){return"/"===arg?ace.require("ace/ext/searchbox").Search(editor,!0):void 0}}(this),getCursorScreenPosition=function(){var cursorPosition,screenPos,session,sessionPos;return session=editor.getSession(),cursorPosition=session.selection.getCursor(),sessionPos=session.documentToScreenPosition(cursorPosition.row,cursorPosition.column),screenPos=editor.renderer.textToScreenCoordinates(sessionPos.row,sessionPos.column),sessionPos.row*editor.renderer.lineHeight-session.getScrollTop()},null!=attrs.resizeOn)for(ref=attrs.resizeOn.split(","),i=0,len=ref.length;len>i;i++)event=ref[i],scope.$on(event,function(){var newScreenPosition,previousScreenPosition,session;return previousScreenPosition=getCursorScreenPosition(),editor.resize(),newScreenPosition=getCursorScreenPosition(),session=editor.getSession(),session.setScrollTop(session.getScrollTop()+newScreenPosition-previousScreenPosition)});return scope.$on(scope.name+":set-scroll-size",function(e,size){var marginBottom,marginTop,maxHeight;return marginTop=size.overflowTop,maxHeight=editor.renderer.layerConfig.maxHeight,marginBottom=Math.max(size.height-maxHeight,0),setScrollMargins(marginTop,marginBottom)}),setScrollMargins=function(marginTop,marginBottom){var marginChanged;return marginChanged=!1,editor.renderer.scrollMargin.top!==marginTop&&(editor.renderer.scrollMargin.top=marginTop,marginChanged=!0),editor.renderer.scrollMargin.bottom!==marginBottom&&(editor.renderer.scrollMargin.bottom=marginBottom,marginChanged=!0),marginChanged?editor.renderer.updateFull():void 0},resetScrollMargins=function(){return setScrollMargins(0,0)},scope.$watch("theme",function(value){return editor.setTheme("ace/theme/"+value)}),scope.$watch("showPrintMargin",function(value){return editor.setShowPrintMargin(value)}),scope.$watch("keybindings",function(value){return"vim"===value||"emacs"===value?editor.setKeyboardHandler("ace/keyboard/"+value):editor.setKeyboardHandler(null)}),scope.$watch("fontSize",function(value){return element.find(".ace_editor, .ace_content").css({"font-size":value+"px"})}),scope.$watch("fontFamily",function(value){if(null!=value)switch(value){case"monaco":return editor.setOption("fontFamily",'"Monaco", "Menlo", "Ubuntu Mono", "Consolas", "source-code-pro", monospace');case"lucida":return editor.setOption("fontFamily",'"Lucida Console", monospace');default:return editor.setOption("fontFamily",null)}}),scope.$watch("lineHeight",function(value){if(null!=value){switch(value){case"compact":editor.container.style.lineHeight=1.33;break;case"normal":editor.container.style.lineHeight=1.6;break;case"wide":editor.container.style.lineHeight=2;break;default:editor.container.style.lineHeight=1.6}return editor.renderer.updateFontSize()}}),scope.$watch("sharejsDoc",function(sharejs_doc,old_sharejs_doc){return null!=old_sharejs_doc&&(scope.$broadcast("beforeChangeDocument"),detachFromAce(old_sharejs_doc)),null!=sharejs_doc&&attachToAce(sharejs_doc),null!=sharejs_doc&&null!=old_sharejs_doc?scope.$broadcast("afterChangeDocument"):void 0}),scope.$watch("text",function(text){var session;return null!=text?(editor.setValue(text,-1),session=editor.getSession(),session.setUseWrapMode(!0)):void 0}),scope.$watch("annotations",function(annotations){var session;return session=editor.getSession(),session.setAnnotations(annotations)}),scope.$watch("readOnly",function(value){return editor.setReadOnly(!!value)}),scope.$watch("syntaxValidation",function(value){var session;return null!=value&&syntaxValidationEnabled?(session=editor.getSession(),session.setOption("useWorker",value)):void 0}),editor.setOption("scrollPastEnd",!0),updateCount=0,onChange=function(){return updateCount++,100===updateCount&&event_tracking.send("editor-interaction","multi-doc-update"),scope.$emit(scope.name+":change")},onScroll=function(scrollTop){var height;if(null!=scope.eventsBridge)return height=editor.renderer.layerConfig.maxHeight,scope.eventsBridge.emit("aceScroll",scrollTop,height)},onScrollbarVisibilityChanged=function(event,vRenderer){return null!=scope.eventsBridge?scope.eventsBridge.emit("aceScrollbarVisibilityChanged",vRenderer.scrollBarV.isVisible,vRenderer.scrollBarV.width):void 0},null!=scope.eventsBridge&&(editor.renderer.on("scrollbarVisibilityChanged",onScrollbarVisibilityChanged),scope.eventsBridge.on("externalScroll",function(position){return editor.getSession().setScrollTop(position)}),scope.eventsBridge.on("refreshScrollPosition",function(){var session;return session=editor.getSession(),session.setScrollTop(session.getScrollTop()+1),session.setScrollTop(session.getScrollTop()-1)})),onSessionChangeForSpellCheck=function(e){var ref1,ref2;return spellCheckManager.onSessionChange(),null!=(ref1=e.oldSession)&&ref1.getDocument().off("change",spellCheckManager.onChange),e.session.getDocument().on("change",spellCheckManager.onChange),null!=(ref2=e.oldSession)&&ref2.off("changeScrollTop",spellCheckManager.onScroll),e.session.on("changeScrollTop",spellCheckManager.onScroll)},initSpellCheck=function(){return spellCheckManager.init(),editor.on("changeSession",onSessionChangeForSpellCheck),onSessionChangeForSpellCheck({session:editor.getSession()}),editor.on("nativecontextmenu",spellCheckManager.onContextMenu)},tearDownSpellCheck=function(){return editor.off("changeSession",onSessionChangeForSpellCheck),editor.off("nativecontextmenu",spellCheckManager.onContextMenu)},onSessionChangeForCursorPosition=function(e){var ref1;return null!=(ref1=e.oldSession)&&ref1.selection.off("changeCursor",cursorPositionManager.onCursorChange),e.session.selection.on("changeCursor",cursorPositionManager.onCursorChange)},onUnloadForCursorPosition=function(){return cursorPositionManager.onUnload(editor.getSession())},initCursorPosition=function(){return editor.on("changeSession",onSessionChangeForCursorPosition),onSessionChangeForCursorPosition({session:editor.getSession()}),$(window).on("unload",onUnloadForCursorPosition)},tearDownCursorPosition=function(){return editor.off("changeSession",onSessionChangeForCursorPosition),$(window).off("unload",onUnloadForCursorPosition)},initCursorPosition(),triggerEditorInitEvent=_.once(function(){return scope.$broadcast("editorInit")}),attachToAce=function(sharejs_doc){var doc,lines,mode,session;lines=sharejs_doc.getSnapshot().split("\n"),session=editor.getSession(),null!=session&&session.destroy();try{/\.(Rtex|bbl)$/i.test(scope.fileName)?mode="ace/mode/latex":/\.(sty|cls|clo)$/.test(scope.fileName)?mode="ace/mode/tex":(mode=ModeList.getModeForPath(scope.fileName).mode,"ace/mode/text"===mode&&(mode="ace/mode/plain_text"))}catch(error){mode="ace/mode/plain_text"}return session=new EditSession(lines,mode),session.setUseWrapMode(!0),null!=scope.syntaxValidation&&syntaxValidationEnabled&&!/\.bib$/.test(scope.fileName)&&session.setOption("useWorker",scope.syntaxValidation),editor.setReadOnly(!0),editor.setSession(session),doc=session.getDocument(),doc.on("change",onChange),editor.initing=!0,sharejs_doc.attachToAce(editor),editor.initing=!1,editor.setReadOnly(scope.readOnly),triggerEditorInitEvent(),initSpellCheck(),resetScrollMargins(),session.setAnnotations(scope.annotations),session.on("changeScrollTop",event_tracking.editingSessionHeartbeat),angular.element($window).on("click",event_tracking.editingSessionHeartbeat),scope.$on("$destroy",function(){return angular.element($window).off("click",event_tracking.editingSessionHeartbeat)}),null!=scope.eventsBridge&&session.on("changeScrollTop",onScroll),$rootScope.hasLintingError=!1,session.on("changeAnnotation",function(){var hasErrors;return hasErrors=session.getAnnotations().filter(function(annotation){return"info"!==annotation.type}).length>0,$rootScope.hasLintingError!==hasErrors?$rootScope.hasLintingError=hasErrors:void 0}),setTimeout(function(){return onScroll(editor.renderer.getScrollTop())}),editor.focus()},detachFromAce=function(sharejs_doc){var doc,session;return tearDownSpellCheck(),sharejs_doc.detachFromAce(),sharejs_doc.off("remoteop.recordRemote"),session=editor.getSession(),session.off("changeScrollTop"),doc=session.getDocument(),doc.off("change",onChange)},editor.renderer.on("changeCharacterSize",function(){return scope.$apply(function(){return scope.rendererData.lineHeight=editor.renderer.lineHeight})}),scope.$watch("rendererData",function(rendererData){return null!=rendererData?rendererData.lineHeight=editor.renderer.lineHeight:void 0}),scope.$on("$destroy",function(){var session;return null!=scope.sharejsDoc?(scope.$broadcast("changeEditor"),tearDownSpellCheck(),tearDownCursorPosition(),detachFromAce(scope.sharejsDoc),session=editor.getSession(),null!=session&&session.destroy(),scope.eventsBridge.emit("aceScrollbarVisibilityChanged",!1,0)):void 0}),scope.$emit(scope.name+":inited",editor)},template:'<div class="ace-editor-wrapper">\n	<div\n		class="undo-conflict-warning alert alert-danger small"\n		ng-show="undo.show_remote_warning"\n	>\n		<strong>Watch out!</strong>\n		We had to undo some of your collaborators changes before we could undo yours.\n		<a\n			href="#"\n			class="pull-right"\n			ng-click="undo.show_remote_warning = false"\n		>Dismiss</a>\n	</div>\n	<div class="ace-editor-body"></div>\n	<spell-menu\n		open="spellMenu.open"\n		top="spellMenu.top"\n		left="spellMenu.left"\n		layout-from-bottom="spellMenu.layoutFromBottom"\n		highlight="spellMenu.highlight"\n		replace-word="replaceWord(highlight, suggestion)"\n		learn-word="learnWord(highlight)"\n	></spell-menu>\n	<div\n		class="annotation-label"\n		ng-show="annotationLabel.show"\n		ng-style="{\n			position: \'absolute\',\n			left:     annotationLabel.left,\n			right:    annotationLabel.right,\n			bottom:   annotationLabel.bottom,\n			top:      annotationLabel.top,\n			\'background-color\': annotationLabel.backgroundColor\n		}"\n	>\n		{{ annotationLabel.text }}\n	</div>\n\n	<a\n		href\n		class="highlights-before-label btn btn-info btn-xs"\n		ng-show="updateLabels.highlightsBefore > 0"\n		ng-click="gotoHighlightAbove()"\n	>\n		<i class="fa fa-fw fa-arrow-up"></i>\n		{{ updateLabels.highlightsBefore }} more update{{ updateLabels.highlightsBefore > 1 && "" || "s" }} above\n	</a>\n\n	<a\n		href\n		class="highlights-after-label btn btn-info btn-xs"\n		ng-show="updateLabels.highlightsAfter > 0"\n		ng-click="gotoHighlightBelow()"\n	>\n		<i class="fa fa-fw fa-arrow-down"></i>\n		{{ updateLabels.highlightsAfter }} more update{{ updateLabels.highlightsAfter > 1 && "" || "s" }} below\n\n	</a>\n</div>'}}),monkeyPatchSearch=function($rootScope,$compile){var $init,searchHtml;return SearchBox=ace.require("ace/ext/searchbox").SearchBox,searchHtml='<div class="ace_search right">\n	<a href type="button" action="hide" class="ace_searchbtn_close">\n		<i class="fa fa-fw fa-times"></i>\n	</a>\n	<div class="ace_search_form">\n		<input class="ace_search_field form-control input-sm" placeholder="Search for" spellcheck="false"></input>\n		<div class="btn-group">\n			<button type="button" action="findNext" class="ace_searchbtn next btn btn-default btn-sm">\n				<i class="fa fa-chevron-down fa-fw"></i>\n			</button>\n			<button type="button" action="findPrev" class="ace_searchbtn prev btn btn-default btn-sm">\n				<i class="fa fa-chevron-up fa-fw"></i>\n			</button>\n		</div>\n	</div>\n	<div class="ace_replace_form">\n		<input class="ace_search_field form-control input-sm" placeholder="Replace with" spellcheck="false"></input>\n		<div class="btn-group">\n			<button type="button" action="replaceAndFindNext" class="ace_replacebtn btn btn-default btn-sm">Replace</button>\n			<button type="button" action="replaceAll" class="ace_replacebtn btn btn-default btn-sm">All</button>\n		</div>\n	</div>\n	<div class="ace_search_options">\n		<div class="btn-group">\n			<span action="toggleRegexpMode" class="btn btn-default btn-sm" tooltip-placement="bottom" tooltip-append-to-body="true" tooltip="RegExp Search">.*</span>\n			<span action="toggleCaseSensitive" class="btn btn-default btn-sm" tooltip-placement="bottom" tooltip-append-to-body="true" tooltip="CaseSensitive Search">Aa</span>\n			<span action="toggleWholeWords" class="btn btn-default btn-sm" tooltip-placement="bottom" tooltip-append-to-body="true" tooltip="Whole Word Search">"..."</span>\n		</div>\n	</div>\n</div>',$("#ace_searchbox").remove(),$init=SearchBox.prototype.$init,SearchBox.prototype.$init=function(){return this.element=$compile(searchHtml)($rootScope.$new())[0],$init.apply(this)}}})}.call(this),function(){define("ide/editor/directives/toggleSwitch",["base"],function(App){return App.directive("toggleSwitch",function(){return{restrict:"E",scope:{description:"@",labelFalse:"@",labelTrue:"@",ngModel:"="},template:'<fieldset class="toggle-switch">\n  <legend class="sr-only">{{description}}</legend>\n\n  <input\n    type="radio"\n    name="toggle-switch-{{$id}}"\n    class="toggle-switch-input"\n    id="toggle-switch-false-{{$id}}"\n    ng-value="false"\n    ng-model="ngModel"\n  >\n  <label for="toggle-switch-false-{{$id}}" class="toggle-switch-label">{{labelFalse}}</label>\n\n  <input\n    type="radio"\n    class="toggle-switch-input"\n    name="toggle-switch-{{$id}}"\n    id="toggle-switch-true-{{$id}}"\n    ng-value="true"\n    ng-model="ngModel"\n  >\n  <label for="toggle-switch-true-{{$id}}" class="toggle-switch-label">{{labelTrue}}</label>\n\n  <span class="toggle-switch-selection" aria-hidden="true"></span>\n</fieldset>'}})})}.call(this),function(){define("ide/editor/controllers/SavingNotificationController",["base","ide/editor/Document"],function(App,Document){return App.controller("SavingNotificationController",["$scope","$interval","ide",function($scope,$interval,ide){var MAX_UNSAVED_SECONDS,lockEditorModal,pollSavedStatus,warnAboutUnsavedChanges;return setInterval(function(){return pollSavedStatus()},1e3),$(window).bind("beforeunload",function(_this){return function(){return warnAboutUnsavedChanges()}}(this)),lockEditorModal=null,MAX_UNSAVED_SECONDS=15,$scope.docSavingStatus={},pollSavedStatus=function(){var doc,doc_id,maxUnsavedSeconds,newStatus,newUnsavedCount,oldStatus,oldUnsavedCount,ref,saving,t;oldStatus=$scope.docSavingStatus,oldUnsavedCount=$scope.docSavingStatusCount,newStatus={},newUnsavedCount=0,maxUnsavedSeconds=0,ref=Document.openDocs;for(doc_id in ref)doc=ref[doc_id],saving=doc.pollSavedStatus(),saving||(newUnsavedCount++,null!=oldStatus[doc_id]?(newStatus[doc_id]=oldStatus[doc_id],t=newStatus[doc_id].unsavedSeconds+=1,t>maxUnsavedSeconds&&(maxUnsavedSeconds=t)):newStatus[doc_id]={unsavedSeconds:0,doc:ide.fileTreeManager.findEntityById(doc_id)});return newUnsavedCount>0&&t>MAX_UNSAVED_SECONDS&&!lockEditorModal&&(lockEditorModal=ide.showLockEditorMessageModal("Connection lost","Sorry, the connection to the server is down."),lockEditorModal.result["finally"](function(){return lockEditorModal=null})),lockEditorModal&&0===newUnsavedCount&&lockEditorModal.dismiss("connection back up"),newUnsavedCount||oldUnsavedCount?($scope.docSavingStatus=newStatus,$scope.docSavingStatusCount=newUnsavedCount,$scope.$apply()):void 0},warnAboutUnsavedChanges=function(){return Document.hasUnsavedChanges()?"You have unsaved changes. If you leave now they will not be saved.":void 0}}])})}.call(this),function(){define("ide/editor/EditorManager",["ide/editor/Document","ide/editor/components/spellMenu","ide/editor/directives/aceEditor","ide/editor/directives/toggleSwitch","ide/editor/controllers/SavingNotificationController"],function(Document){var EditorManager;return EditorManager=function(){function EditorManager(ide,$scope,localStorage){var initialized;this.ide=ide,this.$scope=$scope,this.localStorage=localStorage,this.$scope.editor={sharejs_doc:null,open_doc_id:null,open_doc_name:null,opening:!0,trackChanges:!1,wantTrackChanges:!1,showRichText:this.showRichText()},this.$scope.$on("entity:selected",function(_this){return function(event,entity){return"history"!==_this.$scope.ui.view&&"doc"===entity.type?_this.openDoc(entity):void 0}}(this)),this.$scope.$on("entity:deleted",function(_this){return function(event,entity){var doc;if(_this.$scope.editor.open_doc_id===entity.id){if(!_this.$scope.project.rootDoc_id)return;if(doc=_this.ide.fileTreeManager.findEntityById(_this.$scope.project.rootDoc_id),null==doc)return;return _this.openDoc(doc)}}}(this)),initialized=!1,this.$scope.$on("file-tree:initialized",function(_this){return function(){return initialized?void 0:(initialized=!0,_this.autoOpenDoc())}}(this)),this.$scope.$on("flush-changes",function(_this){return function(){return Document.flushAll()}}(this)),this.$scope.$watch("editor.wantTrackChanges",function(_this){return function(value){return null!=value?_this._syncTrackChangesState(_this.$scope.editor.sharejs_doc):void 0}}(this))}return EditorManager.prototype.showRichText=function(){return window.richTextEnabled?"rich-text"===this.localStorage("editor.mode."+this.$scope.project_id):!1},EditorManager.prototype.autoOpenDoc=function(){var doc,open_doc_id;return open_doc_id=this.ide.localStorage("doc.open_id."+this.$scope.project_id)||this.$scope.project.rootDoc_id,null!=open_doc_id&&(doc=this.ide.fileTreeManager.findEntityById(open_doc_id),null!=doc)?this.openDoc(doc):void 0},EditorManager.prototype.openDocId=function(doc_id,options){var doc;return null==options&&(options={}),doc=this.ide.fileTreeManager.findEntityById(doc_id),null!=doc?this.openDoc(doc,options):void 0},EditorManager.prototype.openDoc=function(doc,options){var done;return null==options&&(options={}),sl_console.log("[openDoc] Opening "+doc.id),this.$scope.ui.view="editor",done=function(_this){return function(){return null!=options.gotoLine?setTimeout(function(){return _this.$scope.$broadcast("editor:gotoLine",options.gotoLine,options.gotoColumn)},0):null!=options.gotoOffset?setTimeout(function(){return _this.$scope.$broadcast("editor:gotoOffset",options.gotoOffset)},0):void 0}}(this),doc.id!==this.$scope.editor.open_doc_id||options.forceReopen?(this.$scope.editor.open_doc_id=doc.id,this.$scope.editor.open_doc_name=doc.name,this.ide.localStorage("doc.open_id."+this.$scope.project_id,doc.id),this.ide.fileTreeManager.selectEntity(doc),this.$scope.editor.opening=!0,this._openNewDocument(doc,function(_this){return function(error,sharejs_doc){return null!=error?void _this.ide.showGenericMessageModal("Error opening document","Sorry, something went wrong opening this document. Please try again."):(_this._syncTrackChangesState(sharejs_doc),_this.$scope.$broadcast("doc:opened"),_this.$scope.$apply(function(){return _this.$scope.editor.opening=!1,_this.$scope.editor.sharejs_doc=sharejs_doc,done()}))}}(this))):void this.$scope.$apply(function(_this){return function(){return done()}}(this))},EditorManager.prototype._openNewDocument=function(doc,callback){var current_sharejs_doc,new_sharejs_doc;return null==callback&&(callback=function(error,sharejs_doc){}),sl_console.log("[_openNewDocument] Opening..."),current_sharejs_doc=this.$scope.editor.sharejs_doc,null!=current_sharejs_doc&&(sl_console.log("[_openNewDocument] Leaving existing open doc..."),current_sharejs_doc.leaveAndCleanUp(),this._unbindFromDocumentEvents(current_sharejs_doc)),new_sharejs_doc=Document.getDocument(this.ide,doc.id),new_sharejs_doc.join(function(_this){return function(error){return null!=error?callback(error):(_this._bindToDocumentEvents(doc,new_sharejs_doc),callback(null,new_sharejs_doc))}}(this))},EditorManager.prototype._bindToDocumentEvents=function(doc,sharejs_doc){return sharejs_doc.on("error",function(_this){return function(error,meta){var message;return message=null!=(null!=error?error.message:void 0)?error.message:"string"==typeof error?error:"",/maxDocLength/.test(message)?_this.ide.showGenericMessageModal("Document Too Long","Sorry, this file is too long to be edited manually. Please upload it directly."):/too many comments or tracked changes/.test(message)?_this.ide.showGenericMessageModal("Too many comments or tracked changes","Sorry, this file has too many comments or tracked changes. Please try accepting or rejecting some existing changes, or resolving and deleting some comments."):(_this.ide.socket.disconnect(),_this.ide.reportError(error,meta),_this.ide.showGenericMessageModal("Out of sync","Sorry, this file has gone out of sync and we need to do a full refresh. <br> <a href='/learn/Kb/Editor_out_of_sync_problems'>Please see this help guide for more information</a>")),_this.openDoc(doc,{forceReopen:!0})}}(this)),sharejs_doc.on("externalUpdate",function(_this){return function(update){return _this._ignoreExternalUpdates?void 0:_this.ide.showGenericMessageModal("Document Updated Externally","This document was just updated externally. Any recent changes you have made may have been overwritten. To see previous versions please look in the history.")}}(this))},EditorManager.prototype._unbindFromDocumentEvents=function(document){return document.off()},EditorManager.prototype.getCurrentDocValue=function(){var ref;return null!=(ref=this.$scope.editor.sharejs_doc)?ref.getSnapshot():void 0},EditorManager.prototype.getCurrentDocId=function(){return this.$scope.editor.open_doc_id},EditorManager.prototype.startIgnoringExternalUpdates=function(){return this._ignoreExternalUpdates=!0},EditorManager.prototype.stopIgnoringExternalUpdates=function(){return this._ignoreExternalUpdates=!1},EditorManager.prototype._syncTimeout=null,EditorManager.prototype._syncTrackChangesState=function(doc){var have,tryToggle,want;if(null!=doc)return null!=this._syncTimeout&&(clearTimeout(this._syncTimeout),this._syncTimeout=null),want=this.$scope.editor.wantTrackChanges,have=doc.getTrackingChanges(),want===have?void(this.$scope.editor.trackChanges=want):(tryToggle=function(_this){return function(){var saved;return saved=null==doc.getInflightOp()&&null==doc.getPendingOp(),saved?(doc.setTrackingChanges(want),_this.$scope.$apply(function(){return _this.$scope.editor.trackChanges=want})):_this._syncTimeout=setTimeout(tryToggle,100)}}(this))()},EditorManager}()})}.call(this);var CryptoJS=CryptoJS||function(s,p){var m={},l=m.lib={},n=function(){},r=l.Base={extend:function(b){n.prototype=this;var h=new n;return b&&h.mixIn(b),h.hasOwnProperty("init")||(h.init=function(){h.$super.init.apply(this,arguments)}),h.init.prototype=h,h.$super=this,h},create:function(){var b=this.extend();return b.init.apply(b,arguments),b},init:function(){},mixIn:function(b){for(var h in b)b.hasOwnProperty(h)&&(this[h]=b[h]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}},q=l.WordArray=r.extend({init:function(b,h){b=this.words=b||[],this.sigBytes=h!=p?h:4*b.length},toString:function(b){return(b||t).stringify(this)},concat:function(b){var h=this.words,a=b.words,j=this.sigBytes;if(b=b.sigBytes,this.clamp(),j%4)for(var g=0;b>g;g++)h[j+g>>>2]|=(a[g>>>2]>>>24-8*(g%4)&255)<<24-8*((j+g)%4);else if(65535<a.length)for(g=0;b>g;g+=4)h[j+g>>>2]=a[g>>>2];else h.push.apply(h,a);return this.sigBytes+=b,this},clamp:function(){var b=this.words,h=this.sigBytes;b[h>>>2]&=4294967295<<32-8*(h%4),b.length=s.ceil(h/4)},clone:function(){var b=r.clone.call(this);return b.words=this.words.slice(0),b},random:function(b){for(var h=[],a=0;b>a;a+=4)h.push(4294967296*s.random()|0);return new q.init(h,b)}}),v=m.enc={},t=v.Hex={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;b>j;j++){var k=a[j>>>2]>>>24-8*(j%4)&255;g.push((k>>>4).toString(16)),g.push((15&k).toString(16))}return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;a>j;j+=2)g[j>>>3]|=parseInt(b.substr(j,2),16)<<24-4*(j%8);return new q.init(g,a/2)}},a=v.Latin1={stringify:function(b){var a=b.words;b=b.sigBytes;for(var g=[],j=0;b>j;j++)g.push(String.fromCharCode(a[j>>>2]>>>24-8*(j%4)&255));return g.join("")},parse:function(b){for(var a=b.length,g=[],j=0;a>j;j++)g[j>>>2]|=(255&b.charCodeAt(j))<<24-8*(j%4);return new q.init(g,a)}},u=v.Utf8={stringify:function(b){try{return decodeURIComponent(escape(a.stringify(b)))}catch(g){throw Error("Malformed UTF-8 data")}},parse:function(b){return a.parse(unescape(encodeURIComponent(b)))}},g=l.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new q.init,this._nDataBytes=0},_append:function(b){"string"==typeof b&&(b=u.parse(b)),this._data.concat(b),this._nDataBytes+=b.sigBytes},_process:function(b){var a=this._data,g=a.words,j=a.sigBytes,k=this.blockSize,m=j/(4*k),m=b?s.ceil(m):s.max((0|m)-this._minBufferSize,0);if(b=m*k,j=s.min(4*b,j),b){for(var l=0;b>l;l+=k)this._doProcessBlock(g,l);l=g.splice(0,b),a.sigBytes-=j}return new q.init(l,j)},clone:function(){var b=r.clone.call(this);return b._data=this._data.clone(),b},_minBufferSize:0});l.Hasher=g.extend({cfg:r.extend(),init:function(b){this.cfg=this.cfg.extend(b),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(b){return this._append(b),this._process(),this},finalize:function(b){return b&&this._append(b),this._doFinalize()},blockSize:16,_createHelper:function(b){return function(a,g){return new b.init(g).finalize(a)}},_createHmacHelper:function(b){return function(a,g){return new k.HMAC.init(b,g).finalize(a)}}});var k=m.algo={};return m}(Math);!function(s){function p(a,k,b,h,l,j,m){return a=a+(k&b|~k&h)+l+m,(a<<j|a>>>32-j)+k}function m(a,k,b,h,l,j,m){return a=a+(k&h|b&~h)+l+m,(a<<j|a>>>32-j)+k}function l(a,k,b,h,l,j,m){return a=a+(k^b^h)+l+m,(a<<j|a>>>32-j)+k}function n(a,k,b,h,l,j,m){return a=a+(b^(k|~h))+l+m,(a<<j|a>>>32-j)+k}for(var r=CryptoJS,q=r.lib,v=q.WordArray,t=q.Hasher,q=r.algo,a=[],u=0;64>u;u++)a[u]=4294967296*s.abs(s.sin(u+1))|0;q=q.MD5=t.extend({_doReset:function(){this._hash=new v.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(g,k){for(var b=0;16>b;b++){var h=k+b,w=g[h];g[h]=16711935&(w<<8|w>>>24)|4278255360&(w<<24|w>>>8)}var b=this._hash.words,h=g[k+0],w=g[k+1],j=g[k+2],q=g[k+3],r=g[k+4],s=g[k+5],t=g[k+6],u=g[k+7],v=g[k+8],x=g[k+9],y=g[k+10],z=g[k+11],A=g[k+12],B=g[k+13],C=g[k+14],D=g[k+15],c=b[0],d=b[1],e=b[2],f=b[3],c=p(c,d,e,f,h,7,a[0]),f=p(f,c,d,e,w,12,a[1]),e=p(e,f,c,d,j,17,a[2]),d=p(d,e,f,c,q,22,a[3]),c=p(c,d,e,f,r,7,a[4]),f=p(f,c,d,e,s,12,a[5]),e=p(e,f,c,d,t,17,a[6]),d=p(d,e,f,c,u,22,a[7]),c=p(c,d,e,f,v,7,a[8]),f=p(f,c,d,e,x,12,a[9]),e=p(e,f,c,d,y,17,a[10]),d=p(d,e,f,c,z,22,a[11]),c=p(c,d,e,f,A,7,a[12]),f=p(f,c,d,e,B,12,a[13]),e=p(e,f,c,d,C,17,a[14]),d=p(d,e,f,c,D,22,a[15]),c=m(c,d,e,f,w,5,a[16]),f=m(f,c,d,e,t,9,a[17]),e=m(e,f,c,d,z,14,a[18]),d=m(d,e,f,c,h,20,a[19]),c=m(c,d,e,f,s,5,a[20]),f=m(f,c,d,e,y,9,a[21]),e=m(e,f,c,d,D,14,a[22]),d=m(d,e,f,c,r,20,a[23]),c=m(c,d,e,f,x,5,a[24]),f=m(f,c,d,e,C,9,a[25]),e=m(e,f,c,d,q,14,a[26]),d=m(d,e,f,c,v,20,a[27]),c=m(c,d,e,f,B,5,a[28]),f=m(f,c,d,e,j,9,a[29]),e=m(e,f,c,d,u,14,a[30]),d=m(d,e,f,c,A,20,a[31]),c=l(c,d,e,f,s,4,a[32]),f=l(f,c,d,e,v,11,a[33]),e=l(e,f,c,d,z,16,a[34]),d=l(d,e,f,c,C,23,a[35]),c=l(c,d,e,f,w,4,a[36]),f=l(f,c,d,e,r,11,a[37]),e=l(e,f,c,d,u,16,a[38]),d=l(d,e,f,c,y,23,a[39]),c=l(c,d,e,f,B,4,a[40]),f=l(f,c,d,e,h,11,a[41]),e=l(e,f,c,d,q,16,a[42]),d=l(d,e,f,c,t,23,a[43]),c=l(c,d,e,f,x,4,a[44]),f=l(f,c,d,e,A,11,a[45]),e=l(e,f,c,d,D,16,a[46]),d=l(d,e,f,c,j,23,a[47]),c=n(c,d,e,f,h,6,a[48]),f=n(f,c,d,e,u,10,a[49]),e=n(e,f,c,d,C,15,a[50]),d=n(d,e,f,c,s,21,a[51]),c=n(c,d,e,f,A,6,a[52]),f=n(f,c,d,e,q,10,a[53]),e=n(e,f,c,d,y,15,a[54]),d=n(d,e,f,c,w,21,a[55]),c=n(c,d,e,f,v,6,a[56]),f=n(f,c,d,e,D,10,a[57]),e=n(e,f,c,d,t,15,a[58]),d=n(d,e,f,c,B,21,a[59]),c=n(c,d,e,f,r,6,a[60]),f=n(f,c,d,e,z,10,a[61]),e=n(e,f,c,d,j,15,a[62]),d=n(d,e,f,c,x,21,a[63]);b[0]=b[0]+c|0,b[1]=b[1]+d|0,b[2]=b[2]+e|0,b[3]=b[3]+f|0},_doFinalize:function(){var a=this._data,k=a.words,b=8*this._nDataBytes,h=8*a.sigBytes;k[h>>>5]|=128<<24-h%32;var l=s.floor(b/4294967296);for(k[(h+64>>>9<<4)+15]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8),k[(h+64>>>9<<4)+14]=16711935&(b<<8|b>>>24)|4278255360&(b<<24|b>>>8),a.sigBytes=4*(k.length+1),this._process(),a=this._hash,k=a.words,b=0;4>b;b++)h=k[b],k[b]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8);return a},clone:function(){var a=t.clone.call(this);return a._hash=this._hash.clone(),a}}),r.MD5=t._createHelper(q),r.HmacMD5=t._createHmacHelper(q)}(Math),define("libs/md5",function(){}),function(){define("ide/online-users/controllers/OnlineUsersController",["base"],function(App){return App.controller("OnlineUsersController",function($scope,ide){return $scope.gotoUser=function(user){return null!=user.doc&&null!=user.row?ide.editorManager.openDoc(user.doc,{gotoLine:user.row+1}):void 0},$scope.userInitial=function(user){return"anonymous-user"===user.user_id?"?":user.name.slice(0,1)}})})}.call(this),function(){define("ide/online-users/OnlineUsersManager",["ide/colors/ColorManager","libs/md5","ide/online-users/controllers/OnlineUsersController"],function(ColorManager){var OnlineUsersManager;return OnlineUsersManager=function(){function OnlineUsersManager(ide,$scope){this.ide=ide,this.$scope=$scope,this.$scope.onlineUsers={},this.$scope.onlineUserCursorHighlights={},this.$scope.onlineUsersArray=[],this.$scope.$on("cursor:editor:update",function(_this){return function(event,position){
return _this.sendCursorPositionUpdate(position)}}(this)),this.$scope.$on("project:joined",function(_this){return function(){return _this.ide.socket.emit("clientTracking.getConnectedUsers",function(error,connectedUsers){var i,len,ref,ref1,ref2,ref3,user;for(_this.$scope.onlineUsers={},ref=connectedUsers||[],i=0,len=ref.length;len>i;i++)user=ref[i],user.client_id!==_this.ide.socket.socket.sessionid&&(_this.$scope.onlineUsers[user.client_id]={id:user.client_id,user_id:user.user_id,email:user.email,name:user.first_name+" "+user.last_name,doc_id:null!=(ref1=user.cursorData)?ref1.doc_id:void 0,row:null!=(ref2=user.cursorData)?ref2.row:void 0,column:null!=(ref3=user.cursorData)?ref3.column:void 0});return _this.refreshOnlineUsers()})}}(this)),this.ide.socket.on("clientTracking.clientUpdated",function(_this){return function(client){return client.id!==_this.ide.socket.socket.sessionid?_this.$scope.$apply(function(){return _this.$scope.onlineUsers[client.id]=client,_this.refreshOnlineUsers()}):void 0}}(this)),this.ide.socket.on("clientTracking.clientDisconnected",function(_this){return function(client_id){return _this.$scope.$apply(function(){return delete _this.$scope.onlineUsers[client_id],_this.refreshOnlineUsers()})}}(this)),this.$scope.getHueForUserId=function(_this){return function(user_id){return ColorManager.getHueForUserId(user_id)}}(this)}return OnlineUsersManager.prototype.cursorUpdateInterval=500,OnlineUsersManager.prototype.refreshOnlineUsers=function(){var base,client,client_id,doc_id,ref,ref1,ref2,ref3,user;this.$scope.onlineUsersArray=[],ref=this.$scope.onlineUsers;for(client_id in ref)user=ref[client_id],null!=user.doc_id&&(user.doc=this.ide.fileTreeManager.findEntityById(user.doc_id)),0===(null!=(ref1=user.name)?ref1.trim().length:void 0)&&(user.name=user.email.trim()),user.initial=null!=(ref2=user.name)?ref2[0]:void 0,user.initial&&" "!==user.initial||(user.initial="?"),this.$scope.onlineUsersArray.push(user);this.$scope.onlineUserCursorHighlights={},ref3=this.$scope.onlineUsers;for(client_id in ref3)client=ref3[client_id],doc_id=client.doc_id,null!=doc_id&&null!=client.row&&null!=client.column&&((base=this.$scope.onlineUserCursorHighlights)[doc_id]||(base[doc_id]=[]),this.$scope.onlineUserCursorHighlights[doc_id].push({label:client.name,cursor:{row:client.row,column:client.column},hue:ColorManager.getHueForUserId(client.user_id)}));return this.$scope.onlineUsersArray.length>0?(delete this.cursorUpdateTimeout,this.cursorUpdateInterval=500):(delete this.cursorUpdateTimeout,this.cursorUpdateInterval=3e5)},OnlineUsersManager.prototype.sendCursorPositionUpdate=function(position){return null!=position&&(this.$scope.currentPosition=position),null==this.cursorUpdateTimeout?this.cursorUpdateTimeout=setTimeout(function(_this){return function(){var doc_id,ref,ref1;return doc_id=_this.$scope.editor.open_doc_id,_this.ide.socket.emit("clientTracking.updatePosition",{row:null!=(ref=_this.$scope.currentPosition)?ref.row:void 0,column:null!=(ref1=_this.$scope.currentPosition)?ref1.column:void 0,doc_id:doc_id}),delete _this.cursorUpdateTimeout}}(this),this.cursorUpdateInterval):void 0},OnlineUsersManager}()})}.call(this),function(a){function b(a,b,c){switch(arguments.length){case 2:return null!=a?a:b;case 3:return null!=a?a:null!=b?b:c;default:throw new Error("Implement me")}}function c(a,b){return Bb.call(a,b)}function d(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function e(a){vb.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+a)}function f(a,b){var c=!0;return o(function(){return c&&(e(a),c=!1),b.apply(this,arguments)},b)}function g(a,b){sc[a]||(e(b),sc[a]=!0)}function h(a,b){return function(c){return r(a.call(this,c),b)}}function i(a,b){return function(c){return this.localeData().ordinal(a.call(this,c),b)}}function j(a,b){var c,d,e=12*(b.year()-a.year())+(b.month()-a.month()),f=a.clone().add(e,"months");return 0>b-f?(c=a.clone().add(e-1,"months"),d=(b-f)/(f-c)):(c=a.clone().add(e+1,"months"),d=(b-f)/(c-f)),-(e+d)}function k(a,b,c){var d;return null==c?b:null!=a.meridiemHour?a.meridiemHour(b,c):null!=a.isPM?(d=a.isPM(c),d&&12>b&&(b+=12),d||12!==b||(b=0),b):b}function l(){}function m(a,b){b!==!1&&H(a),p(this,a),this._d=new Date(+a._d),uc===!1&&(uc=!0,vb.updateOffset(this),uc=!1)}function n(a){var b=A(a),c=b.year||0,d=b.quarter||0,e=b.month||0,f=b.week||0,g=b.day||0,h=b.hour||0,i=b.minute||0,j=b.second||0,k=b.millisecond||0;this._milliseconds=+k+1e3*j+6e4*i+36e5*h,this._days=+g+7*f,this._months=+e+3*d+12*c,this._data={},this._locale=vb.localeData(),this._bubble()}function o(a,b){for(var d in b)c(b,d)&&(a[d]=b[d]);return c(b,"toString")&&(a.toString=b.toString),c(b,"valueOf")&&(a.valueOf=b.valueOf),a}function p(a,b){var c,d,e;if("undefined"!=typeof b._isAMomentObject&&(a._isAMomentObject=b._isAMomentObject),"undefined"!=typeof b._i&&(a._i=b._i),"undefined"!=typeof b._f&&(a._f=b._f),"undefined"!=typeof b._l&&(a._l=b._l),"undefined"!=typeof b._strict&&(a._strict=b._strict),"undefined"!=typeof b._tzm&&(a._tzm=b._tzm),"undefined"!=typeof b._isUTC&&(a._isUTC=b._isUTC),"undefined"!=typeof b._offset&&(a._offset=b._offset),"undefined"!=typeof b._pf&&(a._pf=b._pf),"undefined"!=typeof b._locale&&(a._locale=b._locale),Kb.length>0)for(c in Kb)d=Kb[c],e=b[d],"undefined"!=typeof e&&(a[d]=e);return a}function q(a){return 0>a?Math.ceil(a):Math.floor(a)}function r(a,b,c){for(var d=""+Math.abs(a),e=a>=0;d.length<b;)d="0"+d;return(e?c?"+":"":"-")+d}function s(a,b){var c={milliseconds:0,months:0};return c.months=b.month()-a.month()+12*(b.year()-a.year()),a.clone().add(c.months,"M").isAfter(b)&&--c.months,c.milliseconds=+b-+a.clone().add(c.months,"M"),c}function t(a,b){var c;return b=M(b,a),a.isBefore(b)?c=s(a,b):(c=s(b,a),c.milliseconds=-c.milliseconds,c.months=-c.months),c}function u(a,b){return function(c,d){var e,f;return null===d||isNaN(+d)||(g(b,"moment()."+b+"(period, number) is deprecated. Please use moment()."+b+"(number, period)."),f=c,c=d,d=f),c="string"==typeof c?+c:c,e=vb.duration(c,d),v(this,e,a),this}}function v(a,b,c,d){var e=b._milliseconds,f=b._days,g=b._months;d=null==d?!0:d,e&&a._d.setTime(+a._d+e*c),f&&pb(a,"Date",ob(a,"Date")+f*c),g&&nb(a,ob(a,"Month")+g*c),d&&vb.updateOffset(a,f||g)}function w(a){return"[object Array]"===Object.prototype.toString.call(a)}function x(a){return"[object Date]"===Object.prototype.toString.call(a)||a instanceof Date}function y(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;e>d;d++)(c&&a[d]!==b[d]||!c&&C(a[d])!==C(b[d]))&&g++;return g+f}function z(a){if(a){var b=a.toLowerCase().replace(/(.)s$/,"$1");a=lc[a]||mc[b]||b}return a}function A(a){var b,d,e={};for(d in a)c(a,d)&&(b=z(d),b&&(e[b]=a[d]));return e}function B(b){var c,d;if(0===b.indexOf("week"))c=7,d="day";else{if(0!==b.indexOf("month"))return;c=12,d="month"}vb[b]=function(e,f){var g,h,i=vb._locale[b],j=[];if("number"==typeof e&&(f=e,e=a),h=function(a){var b=vb().utc().set(d,a);return i.call(vb._locale,b,e||"")},null!=f)return h(f);for(g=0;c>g;g++)j.push(h(g));return j}}function C(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=b>=0?Math.floor(b):Math.ceil(b)),c}function D(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function E(a,b,c){return jb(vb([a,11,31+b-c]),b,c).week}function F(a){return G(a)?366:365}function G(a){return a%4===0&&a%100!==0||a%400===0}function H(a){var b;a._a&&-2===a._pf.overflow&&(b=a._a[Db]<0||a._a[Db]>11?Db:a._a[Eb]<1||a._a[Eb]>D(a._a[Cb],a._a[Db])?Eb:a._a[Fb]<0||a._a[Fb]>24||24===a._a[Fb]&&(0!==a._a[Gb]||0!==a._a[Hb]||0!==a._a[Ib])?Fb:a._a[Gb]<0||a._a[Gb]>59?Gb:a._a[Hb]<0||a._a[Hb]>59?Hb:a._a[Ib]<0||a._a[Ib]>999?Ib:-1,a._pf._overflowDayOfYear&&(Cb>b||b>Eb)&&(b=Eb),a._pf.overflow=b)}function I(b){return null==b._isValid&&(b._isValid=!isNaN(b._d.getTime())&&b._pf.overflow<0&&!b._pf.empty&&!b._pf.invalidMonth&&!b._pf.nullInput&&!b._pf.invalidFormat&&!b._pf.userInvalidated,b._strict&&(b._isValid=b._isValid&&0===b._pf.charsLeftOver&&0===b._pf.unusedTokens.length&&b._pf.bigHour===a)),b._isValid}function J(a){return a?a.toLowerCase().replace("_","-"):a}function K(a){for(var b,c,d,e,f=0;f<a.length;){for(e=J(a[f]).split("-"),b=e.length,c=J(a[f+1]),c=c?c.split("-"):null;b>0;){if(d=L(e.slice(0,b).join("-")))return d;if(c&&c.length>=b&&y(e,c,!0)>=b-1)break;b--}f++}return null}function L(a){var b=null;if(!Jb[a]&&Lb)try{b=vb.locale(),require("./locale/"+a),vb.locale(b)}catch(c){}return Jb[a]}function M(a,b){var c,d;return b._isUTC?(c=b.clone(),d=(vb.isMoment(a)||x(a)?+a:+vb(a))-+c,c._d.setTime(+c._d+d),vb.updateOffset(c,!1),c):vb(a).local()}function N(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function O(a){var b,c,d=a.match(Pb);for(b=0,c=d.length;c>b;b++)d[b]=rc[d[b]]?rc[d[b]]:N(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function P(a,b){return a.isValid()?(b=Q(b,a.localeData()),nc[b]||(nc[b]=O(b)),nc[b](a)):a.localeData().invalidDate()}function Q(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(Qb.lastIndex=0;d>=0&&Qb.test(a);)a=a.replace(Qb,c),Qb.lastIndex=0,d-=1;return a}function R(a,b){var c,d=b._strict;switch(a){case"Q":return _b;case"DDDD":return bc;case"YYYY":case"GGGG":case"gggg":return d?cc:Tb;case"Y":case"G":case"g":return ec;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return d?dc:Ub;case"S":if(d)return _b;case"SS":if(d)return ac;case"SSS":if(d)return bc;case"DDD":return Sb;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Wb;case"a":case"A":return b._locale._meridiemParse;case"x":return Zb;case"X":return $b;case"Z":case"ZZ":return Xb;case"T":return Yb;case"SSSS":return Vb;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return d?ac:Rb;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return Rb;case"Do":return d?b._locale._ordinalParse:b._locale._ordinalParseLenient;default:return c=new RegExp($(Z(a.replace("\\","")),"i"))}}function S(a){a=a||"";var b=a.match(Xb)||[],c=b[b.length-1]||[],d=(c+"").match(jc)||["-",0,0],e=+(60*d[1])+C(d[2]);return"+"===d[0]?e:-e}function T(a,b,c){var d,e=c._a;switch(a){case"Q":null!=b&&(e[Db]=3*(C(b)-1));break;case"M":case"MM":null!=b&&(e[Db]=C(b)-1);break;case"MMM":case"MMMM":d=c._locale.monthsParse(b,a,c._strict),null!=d?e[Db]=d:c._pf.invalidMonth=b;break;case"D":case"DD":null!=b&&(e[Eb]=C(b));break;case"Do":null!=b&&(e[Eb]=C(parseInt(b.match(/\d{1,2}/)[0],10)));break;case"DDD":case"DDDD":null!=b&&(c._dayOfYear=C(b));break;case"YY":e[Cb]=vb.parseTwoDigitYear(b);break;case"YYYY":case"YYYYY":case"YYYYYY":e[Cb]=C(b);break;case"a":case"A":c._meridiem=b;break;case"h":case"hh":c._pf.bigHour=!0;case"H":case"HH":e[Fb]=C(b);break;case"m":case"mm":e[Gb]=C(b);break;case"s":case"ss":e[Hb]=C(b);break;case"S":case"SS":case"SSS":case"SSSS":e[Ib]=C(1e3*("0."+b));break;case"x":c._d=new Date(C(b));break;case"X":c._d=new Date(1e3*parseFloat(b));break;case"Z":case"ZZ":c._useUTC=!0,c._tzm=S(b);break;case"dd":case"ddd":case"dddd":d=c._locale.weekdaysParse(b),null!=d?(c._w=c._w||{},c._w.d=d):c._pf.invalidWeekday=b;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":a=a.substr(0,1);case"gggg":case"GGGG":case"GGGGG":a=a.substr(0,2),b&&(c._w=c._w||{},c._w[a]=C(b));break;case"gg":case"GG":c._w=c._w||{},c._w[a]=vb.parseTwoDigitYear(b)}}function U(a){var c,d,e,f,g,h,i;c=a._w,null!=c.GG||null!=c.W||null!=c.E?(g=1,h=4,d=b(c.GG,a._a[Cb],jb(vb(),1,4).year),e=b(c.W,1),f=b(c.E,1)):(g=a._locale._week.dow,h=a._locale._week.doy,d=b(c.gg,a._a[Cb],jb(vb(),g,h).year),e=b(c.w,1),null!=c.d?(f=c.d,g>f&&++e):f=null!=c.e?c.e+g:g),i=kb(d,e,f,h,g),a._a[Cb]=i.year,a._dayOfYear=i.dayOfYear}function V(a){var c,d,e,f,g=[];if(!a._d){for(e=X(a),a._w&&null==a._a[Eb]&&null==a._a[Db]&&U(a),a._dayOfYear&&(f=b(a._a[Cb],e[Cb]),a._dayOfYear>F(f)&&(a._pf._overflowDayOfYear=!0),d=fb(f,0,a._dayOfYear),a._a[Db]=d.getUTCMonth(),a._a[Eb]=d.getUTCDate()),c=0;3>c&&null==a._a[c];++c)a._a[c]=g[c]=e[c];for(;7>c;c++)a._a[c]=g[c]=null==a._a[c]?2===c?1:0:a._a[c];24===a._a[Fb]&&0===a._a[Gb]&&0===a._a[Hb]&&0===a._a[Ib]&&(a._nextDay=!0,a._a[Fb]=0),a._d=(a._useUTC?fb:eb).apply(null,g),null!=a._tzm&&a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),a._nextDay&&(a._a[Fb]=24)}}function W(a){var b;a._d||(b=A(a._i),a._a=[b.year,b.month,b.day||b.date,b.hour,b.minute,b.second,b.millisecond],V(a))}function X(a){var b=new Date;return a._useUTC?[b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]:[b.getFullYear(),b.getMonth(),b.getDate()]}function Y(b){if(b._f===vb.ISO_8601)return void ab(b);b._a=[],b._pf.empty=!0;var c,d,e,f,g,h=""+b._i,i=h.length,j=0;for(e=Q(b._f,b._locale).match(Pb)||[],c=0;c<e.length;c++)f=e[c],d=(h.match(R(f,b))||[])[0],d&&(g=h.substr(0,h.indexOf(d)),g.length>0&&b._pf.unusedInput.push(g),h=h.slice(h.indexOf(d)+d.length),j+=d.length),rc[f]?(d?b._pf.empty=!1:b._pf.unusedTokens.push(f),T(f,d,b)):b._strict&&!d&&b._pf.unusedTokens.push(f);b._pf.charsLeftOver=i-j,h.length>0&&b._pf.unusedInput.push(h),b._pf.bigHour===!0&&b._a[Fb]<=12&&(b._pf.bigHour=a),b._a[Fb]=k(b._locale,b._a[Fb],b._meridiem),V(b),H(b)}function Z(a){return a.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e})}function $(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function _(a){var b,c,e,f,g;if(0===a._f.length)return a._pf.invalidFormat=!0,void(a._d=new Date(NaN));for(f=0;f<a._f.length;f++)g=0,b=p({},a),null!=a._useUTC&&(b._useUTC=a._useUTC),b._pf=d(),b._f=a._f[f],Y(b),I(b)&&(g+=b._pf.charsLeftOver,g+=10*b._pf.unusedTokens.length,b._pf.score=g,(null==e||e>g)&&(e=g,c=b));o(a,c||b)}function ab(a){var b,c,d=a._i,e=fc.exec(d);if(e){for(a._pf.iso=!0,b=0,c=hc.length;c>b;b++)if(hc[b][1].exec(d)){a._f=hc[b][0]+(e[6]||" ");break}for(b=0,c=ic.length;c>b;b++)if(ic[b][1].exec(d)){a._f+=ic[b][0];break}d.match(Xb)&&(a._f+="Z"),Y(a)}else a._isValid=!1}function bb(a){ab(a),a._isValid===!1&&(delete a._isValid,vb.createFromInputFallback(a))}function cb(a,b){var c,d=[];for(c=0;c<a.length;++c)d.push(b(a[c],c));return d}function db(b){var c,d=b._i;d===a?b._d=new Date:x(d)?b._d=new Date(+d):null!==(c=Mb.exec(d))?b._d=new Date(+c[1]):"string"==typeof d?bb(b):w(d)?(b._a=cb(d.slice(0),function(a){return parseInt(a,10)}),V(b)):"object"==typeof d?W(b):"number"==typeof d?b._d=new Date(d):vb.createFromInputFallback(b)}function eb(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return 1970>a&&h.setFullYear(a),h}function fb(a){var b=new Date(Date.UTC.apply(null,arguments));return 1970>a&&b.setUTCFullYear(a),b}function gb(a,b){if("string"==typeof a)if(isNaN(a)){if(a=b.weekdaysParse(a),"number"!=typeof a)return null}else a=parseInt(a,10);return a}function hb(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function ib(a,b,c){var d=vb.duration(a).abs(),e=Ab(d.as("s")),f=Ab(d.as("m")),g=Ab(d.as("h")),h=Ab(d.as("d")),i=Ab(d.as("M")),j=Ab(d.as("y")),k=e<oc.s&&["s",e]||1===f&&["m"]||f<oc.m&&["mm",f]||1===g&&["h"]||g<oc.h&&["hh",g]||1===h&&["d"]||h<oc.d&&["dd",h]||1===i&&["M"]||i<oc.M&&["MM",i]||1===j&&["y"]||["yy",j];return k[2]=b,k[3]=+a>0,k[4]=c,hb.apply({},k)}function jb(a,b,c){var d,e=c-b,f=c-a.day();return f>e&&(f-=7),e-7>f&&(f+=7),d=vb(a).add(f,"d"),{week:Math.ceil(d.dayOfYear()/7),year:d.year()}}function kb(a,b,c,d,e){var f,g,h=fb(a,0,1).getUTCDay();return h=0===h?7:h,c=null!=c?c:e,f=e-h+(h>d?7:0)-(e>h?7:0),g=7*(b-1)+(c-e)+f+1,{year:g>0?a:a-1,dayOfYear:g>0?g:F(a-1)+g}}function lb(b){var c,d=b._i,e=b._f;return b._locale=b._locale||vb.localeData(b._l),null===d||e===a&&""===d?vb.invalid({nullInput:!0}):("string"==typeof d&&(b._i=d=b._locale.preparse(d)),vb.isMoment(d)?new m(d,!0):(e?w(e)?_(b):Y(b):db(b),c=new m(b),c._nextDay&&(c.add(1,"d"),c._nextDay=a),c))}function mb(a,b){var c,d;if(1===b.length&&w(b[0])&&(b=b[0]),!b.length)return vb();for(c=b[0],d=1;d<b.length;++d)b[d][a](c)&&(c=b[d]);return c}function nb(a,b){var c;return"string"==typeof b&&(b=a.localeData().monthsParse(b),"number"!=typeof b)?a:(c=Math.min(a.date(),D(a.year(),b)),a._d["set"+(a._isUTC?"UTC":"")+"Month"](b,c),a)}function ob(a,b){return a._d["get"+(a._isUTC?"UTC":"")+b]()}function pb(a,b,c){return"Month"===b?nb(a,c):a._d["set"+(a._isUTC?"UTC":"")+b](c)}function qb(a,b){return function(c){return null!=c?(pb(this,a,c),vb.updateOffset(this,b),this):ob(this,a)}}function rb(a){return 400*a/146097}function sb(a){return 146097*a/400}function tb(a){vb.duration.fn[a]=function(){return this._data[a]}}function ub(a){"undefined"==typeof ender&&(wb=zb.moment,zb.moment=a?f("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",vb):vb)}for(var vb,wb,xb,yb="2.9.0",zb="undefined"==typeof global||"undefined"!=typeof window&&window!==global.window?this:global,Ab=Math.round,Bb=Object.prototype.hasOwnProperty,Cb=0,Db=1,Eb=2,Fb=3,Gb=4,Hb=5,Ib=6,Jb={},Kb=[],Lb="undefined"!=typeof module&&module&&module.exports,Mb=/^\/?Date\((\-?\d+)/i,Nb=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Ob=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,Pb=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,Qb=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Rb=/\d\d?/,Sb=/\d{1,3}/,Tb=/\d{1,4}/,Ub=/[+\-]?\d{1,6}/,Vb=/\d+/,Wb=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Xb=/Z|[\+\-]\d\d:?\d\d/gi,Yb=/T/i,Zb=/[\+\-]?\d+/,$b=/[\+\-]?\d+(\.\d{1,3})?/,_b=/\d/,ac=/\d\d/,bc=/\d{3}/,cc=/\d{4}/,dc=/[+-]?\d{6}/,ec=/[+-]?\d+/,fc=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,gc="YYYY-MM-DDTHH:mm:ssZ",hc=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],ic=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],jc=/([\+\-]|\d\d)/gi,kc=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),lc={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},mc={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},nc={},oc={s:45,m:45,h:22,d:26,M:11},pc="DDD w W M D d".split(" "),qc="M D H h m s w W".split(" "),rc={M:function(){return this.month()+1},MMM:function(a){return this.localeData().monthsShort(this,a)},MMMM:function(a){return this.localeData().months(this,a)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(a){return this.localeData().weekdaysMin(this,a)},ddd:function(a){return this.localeData().weekdaysShort(this,a)},dddd:function(a){return this.localeData().weekdays(this,a)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return r(this.year()%100,2)},YYYY:function(){return r(this.year(),4)},YYYYY:function(){return r(this.year(),5)},YYYYYY:function(){var a=this.year(),b=a>=0?"+":"-";return b+r(Math.abs(a),6)},gg:function(){return r(this.weekYear()%100,2)},gggg:function(){return r(this.weekYear(),4)},ggggg:function(){return r(this.weekYear(),5)},GG:function(){return r(this.isoWeekYear()%100,2)},GGGG:function(){return r(this.isoWeekYear(),4)},GGGGG:function(){return r(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return C(this.milliseconds()/100)},SS:function(){return r(C(this.milliseconds()/10),2)},SSS:function(){return r(this.milliseconds(),3)},SSSS:function(){return r(this.milliseconds(),3)},Z:function(){var a=this.utcOffset(),b="+";return 0>a&&(a=-a,b="-"),b+r(C(a/60),2)+":"+r(C(a)%60,2)},ZZ:function(){var a=this.utcOffset(),b="+";return 0>a&&(a=-a,b="-"),b+r(C(a/60),2)+r(C(a)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},x:function(){return this.valueOf()},X:function(){return this.unix()},Q:function(){return this.quarter()}},sc={},tc=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"],uc=!1;pc.length;)xb=pc.pop(),rc[xb+"o"]=i(rc[xb],xb);for(;qc.length;)xb=qc.pop(),rc[xb+xb]=h(rc[xb],2);rc.DDDD=h(rc.DDD,3),o(l.prototype,{set:function(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(a){return this._months[a.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(a){return this._monthsShort[a.month()]},monthsParse:function(a,b,c){var d,e,f;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),d=0;12>d;d++){if(e=vb.utc([2e3,d]),c&&!this._longMonthsParse[d]&&(this._longMonthsParse[d]=new RegExp("^"+this.months(e,"").replace(".","")+"$","i"),this._shortMonthsParse[d]=new RegExp("^"+this.monthsShort(e,"").replace(".","")+"$","i")),c||this._monthsParse[d]||(f="^"+this.months(e,"")+"|^"+this.monthsShort(e,""),this._monthsParse[d]=new RegExp(f.replace(".",""),"i")),c&&"MMMM"===b&&this._longMonthsParse[d].test(a))return d;if(c&&"MMM"===b&&this._shortMonthsParse[d].test(a))return d;if(!c&&this._monthsParse[d].test(a))return d}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(a){return this._weekdays[a.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(a){return this._weekdaysShort[a.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(a){return this._weekdaysMin[a.day()]},weekdaysParse:function(a){var b,c,d;for(this._weekdaysParse||(this._weekdaysParse=[]),b=0;7>b;b++)if(this._weekdaysParse[b]||(c=vb([2e3,1]).day(b),d="^"+this.weekdays(c,"")+"|^"+this.weekdaysShort(c,"")+"|^"+this.weekdaysMin(c,""),this._weekdaysParse[b]=new RegExp(d.replace(".",""),"i")),this._weekdaysParse[b].test(a))return b},_longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(a){var b=this._longDateFormat[a];return!b&&this._longDateFormat[a.toUpperCase()]&&(b=this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a]=b),b},isPM:function(a){return"p"===(a+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(a,b,c){var d=this._calendar[a];return"function"==typeof d?d.apply(b,[c]):d},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)},pastFuture:function(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)},ordinal:function(a){return this._ordinal.replace("%d",a)},_ordinal:"%d",_ordinalParse:/\d{1,2}/,preparse:function(a){return a},postformat:function(a){return a},week:function(a){return jb(a,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},firstDayOfWeek:function(){return this._week.dow},firstDayOfYear:function(){return this._week.doy},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),vb=function(b,c,e,f){var g;return"boolean"==typeof e&&(f=e,e=a),g={},g._isAMomentObject=!0,g._i=b,g._f=c,g._l=e,g._strict=f,g._isUTC=!1,g._pf=d(),lb(g)},vb.suppressDeprecationWarnings=!1,vb.createFromInputFallback=f("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))}),vb.min=function(){var a=[].slice.call(arguments,0);return mb("isBefore",a)},vb.max=function(){var a=[].slice.call(arguments,0);return mb("isAfter",a)},vb.utc=function(b,c,e,f){var g;return"boolean"==typeof e&&(f=e,e=a),g={},g._isAMomentObject=!0,g._useUTC=!0,g._isUTC=!0,g._l=e,g._i=b,g._f=c,g._strict=f,g._pf=d(),lb(g).utc()},vb.unix=function(a){return vb(1e3*a)},vb.duration=function(a,b){var d,e,f,g,h=a,i=null;return vb.isDuration(a)?h={ms:a._milliseconds,d:a._days,M:a._months}:"number"==typeof a?(h={},b?h[b]=a:h.milliseconds=a):(i=Nb.exec(a))?(d="-"===i[1]?-1:1,h={y:0,d:C(i[Eb])*d,h:C(i[Fb])*d,m:C(i[Gb])*d,s:C(i[Hb])*d,ms:C(i[Ib])*d}):(i=Ob.exec(a))?(d="-"===i[1]?-1:1,f=function(a){var b=a&&parseFloat(a.replace(",","."));return(isNaN(b)?0:b)*d},h={y:f(i[2]),M:f(i[3]),d:f(i[4]),h:f(i[5]),m:f(i[6]),s:f(i[7]),w:f(i[8])}):null==h?h={}:"object"==typeof h&&("from"in h||"to"in h)&&(g=t(vb(h.from),vb(h.to)),h={},h.ms=g.milliseconds,h.M=g.months),e=new n(h),vb.isDuration(a)&&c(a,"_locale")&&(e._locale=a._locale),e},vb.version=yb,vb.defaultFormat=gc,vb.ISO_8601=function(){},vb.momentProperties=Kb,vb.updateOffset=function(){},vb.relativeTimeThreshold=function(b,c){return oc[b]===a?!1:c===a?oc[b]:(oc[b]=c,!0)},vb.lang=f("moment.lang is deprecated. Use moment.locale instead.",function(a,b){return vb.locale(a,b)}),vb.locale=function(a,b){var c;return a&&(c="undefined"!=typeof b?vb.defineLocale(a,b):vb.localeData(a),c&&(vb.duration._locale=vb._locale=c)),vb._locale._abbr},vb.defineLocale=function(a,b){return null!==b?(b.abbr=a,Jb[a]||(Jb[a]=new l),Jb[a].set(b),vb.locale(a),Jb[a]):(delete Jb[a],null)},vb.langData=f("moment.langData is deprecated. Use moment.localeData instead.",function(a){return vb.localeData(a)}),vb.localeData=function(a){var b;if(a&&a._locale&&a._locale._abbr&&(a=a._locale._abbr),!a)return vb._locale;if(!w(a)){if(b=L(a))return b;a=[a]}return K(a)},vb.isMoment=function(a){return a instanceof m||null!=a&&c(a,"_isAMomentObject")},vb.isDuration=function(a){return a instanceof n};for(xb=tc.length-1;xb>=0;--xb)B(tc[xb]);vb.normalizeUnits=function(a){return z(a)},vb.invalid=function(a){var b=vb.utc(NaN);return null!=a?o(b._pf,a):b._pf.userInvalidated=!0,b},vb.parseZone=function(){return vb.apply(null,arguments).parseZone()},vb.parseTwoDigitYear=function(a){return C(a)+(C(a)>68?1900:2e3)},vb.isDate=x,o(vb.fn=m.prototype,{clone:function(){return vb(this)},valueOf:function(){return+this._d-6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var a=vb(this).utc();return 0<a.year()&&a.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():P(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):P(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds()]},isValid:function(){return I(this)},isDSTShifted:function(){return this._a?this.isValid()&&y(this._a,(this._isUTC?vb.utc(this._a):vb(this._a)).toArray())>0:!1},parsingFlags:function(){return o({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(a){return this.utcOffset(0,a)},local:function(a){return this._isUTC&&(this.utcOffset(0,a),this._isUTC=!1,a&&this.subtract(this._dateUtcOffset(),"m")),this},format:function(a){var b=P(this,a||vb.defaultFormat);return this.localeData().postformat(b)},add:u(1,"add"),subtract:u(-1,"subtract"),diff:function(a,b,c){var d,e,f=M(a,this),g=6e4*(f.utcOffset()-this.utcOffset());return b=z(b),"year"===b||"month"===b||"quarter"===b?(e=j(this,f),"quarter"===b?e/=3:"year"===b&&(e/=12)):(d=this-f,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?(d-g)/864e5:"week"===b?(d-g)/6048e5:d),c?e:q(e)},from:function(a,b){return vb.duration({to:this,from:a}).locale(this.locale()).humanize(!b)},fromNow:function(a){return this.from(vb(),a)},calendar:function(a){var b=a||vb(),c=M(b,this).startOf("day"),d=this.diff(c,"days",!0),e=-6>d?"sameElse":-1>d?"lastWeek":0>d?"lastDay":1>d?"sameDay":2>d?"nextDay":7>d?"nextWeek":"sameElse";return this.format(this.localeData().calendar(e,this,vb(b)))},isLeapYear:function(){return G(this.year())},isDST:function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=gb(a,this.localeData()),this.add(a-b,"d")):b},month:qb("Month",!0),startOf:function(a){switch(a=z(a)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a?this.weekday(0):"isoWeek"===a&&this.isoWeekday(1),"quarter"===a&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(b){return b=z(b),b===a||"millisecond"===b?this:this.startOf(b).add(1,"isoWeek"===b?"week":b).subtract(1,"ms")},isAfter:function(a,b){var c;return b=z("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=vb.isMoment(a)?a:vb(a),+this>+a):(c=vb.isMoment(a)?+a:+vb(a),c<+this.clone().startOf(b))},isBefore:function(a,b){var c;return b=z("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=vb.isMoment(a)?a:vb(a),+a>+this):(c=vb.isMoment(a)?+a:+vb(a),+this.clone().endOf(b)<c)},isBetween:function(a,b,c){return this.isAfter(a,c)&&this.isBefore(b,c)},isSame:function(a,b){var c;return b=z(b||"millisecond"),"millisecond"===b?(a=vb.isMoment(a)?a:vb(a),+this===+a):(c=+vb(a),+this.clone().startOf(b)<=c&&c<=+this.clone().endOf(b))},min:f("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(a){return a=vb.apply(null,arguments),this>a?this:a}),max:f("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(a){return a=vb.apply(null,arguments),a>this?this:a}),zone:f("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",function(a,b){return null!=a?("string"!=typeof a&&(a=-a),this.utcOffset(a,b),this):-this.utcOffset()}),utcOffset:function(a,b){var c,d=this._offset||0;return null!=a?("string"==typeof a&&(a=S(a)),Math.abs(a)<16&&(a=60*a),!this._isUTC&&b&&(c=this._dateUtcOffset()),this._offset=a,this._isUTC=!0,null!=c&&this.add(c,"m"),d!==a&&(!b||this._changeInProgress?v(this,vb.duration(a-d,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,vb.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?d:this._dateUtcOffset()},isLocal:function(){return!this._isUTC},isUtcOffset:function(){return this._isUTC},isUtc:function(){return this._isUTC&&0===this._offset},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(S(this._i)),this},hasAlignedHourOffset:function(a){
return a=a?vb(a).utcOffset():0,(this.utcOffset()-a)%60===0},daysInMonth:function(){return D(this.year(),this.month())},dayOfYear:function(a){var b=Ab((vb(this).startOf("day")-vb(this).startOf("year"))/864e5)+1;return null==a?b:this.add(a-b,"d")},quarter:function(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*(a-1)+this.month()%3)},weekYear:function(a){var b=jb(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==a?b:this.add(a-b,"y")},isoWeekYear:function(a){var b=jb(this,1,4).year;return null==a?b:this.add(a-b,"y")},week:function(a){var b=this.localeData().week(this);return null==a?b:this.add(7*(a-b),"d")},isoWeek:function(a){var b=jb(this,1,4).week;return null==a?b:this.add(7*(a-b),"d")},weekday:function(a){var b=(this.day()+7-this.localeData()._week.dow)%7;return null==a?b:this.add(a-b,"d")},isoWeekday:function(a){return null==a?this.day()||7:this.day(this.day()%7?a:a-7)},isoWeeksInYear:function(){return E(this.year(),1,4)},weeksInYear:function(){var a=this.localeData()._week;return E(this.year(),a.dow,a.doy)},get:function(a){return a=z(a),this[a]()},set:function(a,b){var c;if("object"==typeof a)for(c in a)this.set(c,a[c]);else a=z(a),"function"==typeof this[a]&&this[a](b);return this},locale:function(b){var c;return b===a?this._locale._abbr:(c=vb.localeData(b),null!=c&&(this._locale=c),this)},lang:f("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(b){return b===a?this.localeData():this.locale(b)}),localeData:function(){return this._locale},_dateUtcOffset:function(){return 15*-Math.round(this._d.getTimezoneOffset()/15)}}),vb.fn.millisecond=vb.fn.milliseconds=qb("Milliseconds",!1),vb.fn.second=vb.fn.seconds=qb("Seconds",!1),vb.fn.minute=vb.fn.minutes=qb("Minutes",!1),vb.fn.hour=vb.fn.hours=qb("Hours",!0),vb.fn.date=qb("Date",!0),vb.fn.dates=f("dates accessor is deprecated. Use date instead.",qb("Date",!0)),vb.fn.year=qb("FullYear",!0),vb.fn.years=f("years accessor is deprecated. Use year instead.",qb("FullYear",!0)),vb.fn.days=vb.fn.day,vb.fn.months=vb.fn.month,vb.fn.weeks=vb.fn.week,vb.fn.isoWeeks=vb.fn.isoWeek,vb.fn.quarters=vb.fn.quarter,vb.fn.toJSON=vb.fn.toISOString,vb.fn.isUTC=vb.fn.isUtc,o(vb.duration.fn=n.prototype,{_bubble:function(){var a,b,c,d=this._milliseconds,e=this._days,f=this._months,g=this._data,h=0;g.milliseconds=d%1e3,a=q(d/1e3),g.seconds=a%60,b=q(a/60),g.minutes=b%60,c=q(b/60),g.hours=c%24,e+=q(c/24),h=q(rb(e)),e-=q(sb(h)),f+=q(e/30),e%=30,h+=q(f/12),f%=12,g.days=e,g.months=f,g.years=h},abs:function(){return this._milliseconds=Math.abs(this._milliseconds),this._days=Math.abs(this._days),this._months=Math.abs(this._months),this._data.milliseconds=Math.abs(this._data.milliseconds),this._data.seconds=Math.abs(this._data.seconds),this._data.minutes=Math.abs(this._data.minutes),this._data.hours=Math.abs(this._data.hours),this._data.months=Math.abs(this._data.months),this._data.years=Math.abs(this._data.years),this},weeks:function(){return q(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*C(this._months/12)},humanize:function(a){var b=ib(this,!a,this.localeData());return a&&(b=this.localeData().pastFuture(+this,b)),this.localeData().postformat(b)},add:function(a,b){var c=vb.duration(a,b);return this._milliseconds+=c._milliseconds,this._days+=c._days,this._months+=c._months,this._bubble(),this},subtract:function(a,b){var c=vb.duration(a,b);return this._milliseconds-=c._milliseconds,this._days-=c._days,this._months-=c._months,this._bubble(),this},get:function(a){return a=z(a),this[a.toLowerCase()+"s"]()},as:function(a){var b,c;if(a=z(a),"month"===a||"year"===a)return b=this._days+this._milliseconds/864e5,c=this._months+12*rb(b),"month"===a?c:c/12;switch(b=this._days+Math.round(sb(this._months/12)),a){case"week":return b/7+this._milliseconds/6048e5;case"day":return b+this._milliseconds/864e5;case"hour":return 24*b+this._milliseconds/36e5;case"minute":return 24*b*60+this._milliseconds/6e4;case"second":return 24*b*60*60+this._milliseconds/1e3;case"millisecond":return Math.floor(24*b*60*60*1e3)+this._milliseconds;default:throw new Error("Unknown unit "+a)}},lang:vb.fn.lang,locale:vb.fn.locale,toIsoString:f("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",function(){return this.toISOString()}),toISOString:function(){var a=Math.abs(this.years()),b=Math.abs(this.months()),c=Math.abs(this.days()),d=Math.abs(this.hours()),e=Math.abs(this.minutes()),f=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(a?a+"Y":"")+(b?b+"M":"")+(c?c+"D":"")+(d||e||f?"T":"")+(d?d+"H":"")+(e?e+"M":"")+(f?f+"S":""):"P0D"},localeData:function(){return this._locale},toJSON:function(){return this.toISOString()}}),vb.duration.fn.toString=vb.duration.fn.toISOString;for(xb in kc)c(kc,xb)&&tb(xb.toLowerCase());vb.duration.fn.asMilliseconds=function(){return this.as("ms")},vb.duration.fn.asSeconds=function(){return this.as("s")},vb.duration.fn.asMinutes=function(){return this.as("m")},vb.duration.fn.asHours=function(){return this.as("h")},vb.duration.fn.asDays=function(){return this.as("d")},vb.duration.fn.asWeeks=function(){return this.as("weeks")},vb.duration.fn.asMonths=function(){return this.as("M")},vb.duration.fn.asYears=function(){return this.as("y")},vb.locale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var b=a%10,c=1===C(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),Lb?module.exports=vb:"function"==typeof define&&define.amd?(define("moment",["require","exports","module"],function(a,b,c){return c.config&&c.config()&&c.config().noGlobal===!0&&(zb.moment=wb),vb}),ub(!0)):ub()}.call(this),function(){define("ide/history/util/displayNameForUser",[],function(){var displayNameForUser;return displayNameForUser=function(user){var name;return null==user?"Anonymous":user.id===window.user.id?"you":null!=user.name?user.name:(name=[user.first_name,user.last_name].filter(function(n){return null!=n}).join(" ").trim(),""===name&&(name=user.email.split("@")[0]),null==name||""===name?"?":name)}})}.call(this),function(){define("ide/history/controllers/HistoryListController",["base","ide/history/util/displayNameForUser"],function(App,displayNameForUser){return App.controller("HistoryListController",["$scope","$modal","ide",function($scope,$modal,ide){var _getUserById;return $scope.hoveringOverListSelectors=!1,$scope.projectUsers=[],$scope.$watch("project.members",function(newVal){return null!=newVal?$scope.projectUsers=newVal.concat($scope.project.owner):void 0}),_getUserById=function(id){return _.find($scope.projectUsers,function(user){var curUserId;return curUserId=(null!=user?user._id:void 0)||(null!=user?user.id:void 0),curUserId===id})},$scope.getDisplayNameById=function(id){return displayNameForUser(_getUserById(id))},$scope.deleteLabel=function(labelDetails){return $modal.open({templateUrl:"historyV2DeleteLabelModalTemplate",controller:"HistoryV2DeleteLabelModalController",resolve:{labelDetails:function(){return labelDetails}}})},$scope.loadMore=function(_this){return function(){return ide.historyManager.fetchNextBatchOfUpdates()}}(this),$scope.recalculateSelectedUpdates=function(){var afterSelection,beforeSelection,i,inSelection,len,ref,results,update;for(beforeSelection=!0,afterSelection=!1,$scope.history.selection.updates=[],ref=$scope.history.updates,results=[],i=0,len=ref.length;len>i;i++)update=ref[i],update.selectedTo&&(inSelection=!0,beforeSelection=!1),update.beforeSelection=beforeSelection,update.inSelection=inSelection,update.afterSelection=afterSelection,inSelection&&$scope.history.selection.updates.push(update),update.selectedFrom?(inSelection=!1,results.push(afterSelection=!0)):results.push(void 0);return results},$scope.recalculateHoveredUpdates=function(){var hoverSelectedFrom,hoverSelectedTo,i,inHoverSelection,j,k,len,len1,len2,ref,ref1,ref2,results,update;for(hoverSelectedFrom=!1,hoverSelectedTo=!1,ref=$scope.history.updates,i=0,len=ref.length;len>i;i++)update=ref[i],update.hoverSelectedFrom&&(hoverSelectedFrom=!0),update.hoverSelectedTo&&(hoverSelectedTo=!0);if(hoverSelectedFrom)for(inHoverSelection=!1,ref1=$scope.history.updates,j=0,len1=ref1.length;len1>j;j++)update=ref1[j],update.selectedTo&&(update.hoverSelectedTo=!0,inHoverSelection=!0),update.inHoverSelection=inHoverSelection,update.hoverSelectedFrom&&(inHoverSelection=!1);if(hoverSelectedTo){for(inHoverSelection=!1,ref2=$scope.history.updates,results=[],k=0,len2=ref2.length;len2>k;k++)update=ref2[k],update.hoverSelectedTo&&(inHoverSelection=!0),update.inHoverSelection=inHoverSelection,update.selectedFrom?(update.hoverSelectedFrom=!0,results.push(inHoverSelection=!1)):results.push(void 0);return results}},$scope.resetHoverState=function(){var i,len,ref,results,update;for(ref=$scope.history.updates,results=[],i=0,len=ref.length;len>i;i++)update=ref[i],delete update.hoverSelectedFrom,delete update.hoverSelectedTo,results.push(delete update.inHoverSelection);return results},$scope.$watch("history.updates.length",function(){return $scope.recalculateSelectedUpdates()})}]),App.controller("HistoryListItemController",["$scope","event_tracking",function($scope,event_tracking){return $scope.$watch("update.selectedFrom",function(selectedFrom,oldSelectedFrom){var i,len,ref,update;if(selectedFrom){for(ref=$scope.history.updates,i=0,len=ref.length;len>i;i++)update=ref[i],update!==$scope.update&&(update.selectedFrom=!1);return $scope.recalculateSelectedUpdates()}}),$scope.$watch("update.selectedTo",function(selectedTo,oldSelectedTo){var i,len,ref,update;if(selectedTo){for(ref=$scope.history.updates,i=0,len=ref.length;len>i;i++)update=ref[i],update!==$scope.update&&(update.selectedTo=!1);return $scope.recalculateSelectedUpdates()}}),$scope.select=function(){return event_tracking.sendMB("history-view-change"),$scope.update.selectedTo=!0,$scope.update.selectedFrom=!0},$scope.mouseOverSelectedFrom=function(){return $scope.history.hoveringOverListSelectors=!0,$scope.update.hoverSelectedFrom=!0,$scope.recalculateHoveredUpdates()},$scope.mouseOutSelectedFrom=function(){return $scope.history.hoveringOverListSelectors=!1,$scope.resetHoverState()},$scope.mouseOverSelectedTo=function(){return $scope.history.hoveringOverListSelectors=!0,$scope.update.hoverSelectedTo=!0,$scope.recalculateHoveredUpdates()},$scope.mouseOutSelectedTo=function(){return $scope.history.hoveringOverListSelectors=!1,$scope.resetHoverState()},$scope.displayName=displayNameForUser}])})}.call(this),function(){define("ide/history/controllers/HistoryDiffController",["base"],function(App){return App.controller("HistoryDiffController",function($scope,$modal,ide,event_tracking){return $scope.restoreDeletedDoc=function(){return event_tracking.sendMB("history-restore-deleted"),$scope.history.diff.restoreInProgress=!0,ide.historyManager.restoreDeletedDoc($scope.history.diff.doc).then(function(response){var data;return data=response.data,$scope.history.diff.restoredDocNewId=data.doc_id,$scope.history.diff.restoreInProgress=!1,$scope.history.diff.restoreDeletedSuccess=!0})},$scope.openRestoreDiffModal=function(){return event_tracking.sendMB("history-restore-modal"),$modal.open({templateUrl:"historyRestoreDiffModalTemplate",controller:"HistoryRestoreDiffModalController",resolve:{diff:function(){return $scope.history.diff}}})},$scope.backToEditorAfterRestore=function(){return ide.editorManager.openDoc({id:$scope.history.diff.restoredDocNewId})}}),App.controller("HistoryRestoreDiffModalController",function($scope,$modalInstance,diff,ide,event_tracking){return $scope.state={inflight:!1},$scope.diff=diff,$scope.restore=function(){return event_tracking.sendMB("history-restored"),$scope.state.inflight=!0,ide.historyManager.restoreDiff(diff).then(function(){return $scope.state.inflight=!1,$modalInstance.close(),ide.editorManager.openDoc(diff.doc)})},$scope.cancel=function(){return $modalInstance.dismiss()}})})}.call(this),function(){define("ide/history/directives/infiniteScroll",["base"],function(App){return App.directive("infiniteScroll",function(){return{link:function(scope,element,attrs,ctrl){var atBottomOfListView,atEndOfListView,atTopOfListView,innerElement,listShorterThanContainer,loadUntilFull;return innerElement=element.find(".infinite-scroll-inner"),element.css({"overflow-y":"auto"}),atEndOfListView=function(){return null!=attrs.infiniteScrollUpwards?atTopOfListView():atBottomOfListView()},atTopOfListView=function(){return element.scrollTop()<30},atBottomOfListView=function(){return element.scrollTop()+element.height()>=innerElement.height()-30},listShorterThanContainer=function(){return element.height()>innerElement.height()},loadUntilFull=function(){var promise;return!listShorterThanContainer()&&!atEndOfListView()||scope.$eval(attrs.infiniteScrollDisabled)?void 0:(promise=scope.$eval(attrs.infiniteScroll),promise.then(function(){return setTimeout(function(){return loadUntilFull()},0)}))},element.on("scroll",function(event){return loadUntilFull()}),scope.$watch(attrs.infiniteScrollInitialize,function(value){return value?loadUntilFull():void 0})}}})})}.call(this),function(){define("ide/history/HistoryManager",["moment","ide/colors/ColorManager","ide/history/util/displayNameForUser","ide/history/controllers/HistoryListController","ide/history/controllers/HistoryDiffController","ide/history/directives/infiniteScroll"],function(moment,ColorManager,displayNameForUser){var HistoryManager;return HistoryManager=function(){function HistoryManager(ide,$scope){this.ide=ide,this.$scope=$scope,this.reset(),this.$scope.toggleHistory=function(_this){return function(){return"history"===_this.$scope.ui.view?_this.hide():_this.show()}}(this),this.$scope.$watch("history.selection.updates",function(_this){return function(updates){return null!=updates&&updates.length>0?(_this._selectDocFromUpdates(),_this.reloadDiff()):void 0}}(this)),this.$scope.$on("entity:selected",function(_this){return function(event,entity){return"history"===_this.$scope.ui.view&&"doc"===entity.type?(_this.$scope.history.selection.doc=entity,_this.reloadDiff()):void 0}}(this))}return HistoryManager.prototype.show=function(){return this.$scope.ui.view="history",this.reset()},HistoryManager.prototype.hide=function(){return this.$scope.ui.view="editor",this.$scope.$emit("entity:selected",this.ide.fileTreeManager.findSelectedEntity())},HistoryManager.prototype.reset=function(){return this.$scope.history={updates:[],nextBeforeTimestamp:null,atEnd:!1,selection:{updates:[],doc:null,range:{fromV:null,toV:null,start_ts:null,end_ts:null}},diff:null}},HistoryManager.prototype.autoSelectRecentUpdates=function(){var i,indexOfLastUpdateNotByMe,j,len,ref,update;if(0!==this.$scope.history.updates.length){for(this.$scope.history.updates[0].selectedTo=!0,indexOfLastUpdateNotByMe=0,ref=this.$scope.history.updates,i=j=0,len=ref.length;len>j&&(update=ref[i],!this._updateContainsUserId(update,this.$scope.user.id));i=++j)indexOfLastUpdateNotByMe=i;return this.$scope.history.updates[indexOfLastUpdateNotByMe].selectedFrom=!0}},HistoryManager.prototype.BATCH_SIZE=10,HistoryManager.prototype.fetchNextBatchOfUpdates=function(){var url;return url="/project/"+this.ide.project_id+"/updates?min_count="+this.BATCH_SIZE,null!=this.$scope.history.nextBeforeTimestamp&&(url+="&before="+this.$scope.history.nextBeforeTimestamp),this.$scope.history.loading=!0,this.ide.$http.get(url).then(function(_this){return function(response){var data;return data=response.data,_this._loadUpdates(data.updates),_this.$scope.history.nextBeforeTimestamp=data.nextBeforeTimestamp,null==data.nextBeforeTimestamp&&(_this.$scope.history.atEnd=!0),_this.$scope.history.loading=!1}}(this))},HistoryManager.prototype.reloadDiff=function(){var diff,doc,end_ts,fromV,ref,ref1,start_ts,toV,updates,url;return diff=this.$scope.history.diff,ref=this.$scope.history.selection,updates=ref.updates,doc=ref.doc,ref1=this._calculateRangeFromSelection(),fromV=ref1.fromV,toV=ref1.toV,start_ts=ref1.start_ts,end_ts=ref1.end_ts,null==doc||null!=diff&&diff.doc===doc&&diff.fromV===fromV&&diff.toV===toV?void 0:(this.$scope.history.diff=diff={fromV:fromV,toV:toV,start_ts:start_ts,end_ts:end_ts,doc:doc,error:!1,pathname:doc.name},doc.deleted?(diff.deleted=!0,diff.restoreInProgress=!1,diff.restoreDeletedSuccess=!1,diff.restoredDocNewId=null):(diff.loading=!0,url="/project/"+this.$scope.project_id+"/doc/"+diff.doc.id+"/diff",null!=diff.fromV&&null!=diff.toV&&(url+="?from="+diff.fromV+"&to="+diff.toV),this.ide.$http.get(url).then(function(_this){return function(response){var data,highlights,ref2,text;return data=response.data,diff.loading=!1,ref2=_this._parseDiff(data),text=ref2.text,highlights=ref2.highlights,diff.text=text,diff.highlights=highlights}}(this))["catch"](function(){return diff.loading=!1,diff.error=!0})))},HistoryManager.prototype.restoreDeletedDoc=function(doc){var url;return url="/project/"+this.$scope.project_id+"/doc/"+doc.id+"/restore",this.ide.$http.post(url,{name:doc.name,_csrf:window.csrfToken})},HistoryManager.prototype.restoreDiff=function(diff){var url;return url="/project/"+this.$scope.project_id+"/doc/"+diff.doc.id+"/version/"+diff.fromV+"/restore",this.ide.$http.post(url,{_csrf:window.csrfToken})},HistoryManager.prototype._parseDiff=function(diff){var column,content,date,endColumn,endRow,entry,highlights,i,j,len,lines,name,range,ref,ref1,ref2,row,startColumn,startRow,text;for(row=0,column=0,highlights=[],text="",ref=diff.diff||[],i=j=0,len=ref.length;len>j;i=++j)entry=ref[i],content=entry.u||entry.i||entry.d,content||(content=""),text+=content,lines=content.split("\n"),startRow=row,startColumn=column,lines.length>1?(endRow=startRow+lines.length-1,endColumn=lines[lines.length-1].length):(endRow=startRow,endColumn=startColumn+lines[0].length),row=endRow,column=endColumn,range={start:{row:startRow,column:startColumn},end:{row:endRow,column:endColumn}},(null!=entry.i||null!=entry.d)&&(name=displayNameForUser(entry.meta.user),date=moment(entry.meta.end_ts).format("Do MMM YYYY, h:mm a"),null!=entry.i?highlights.push({label:"Added by "+name+" on "+date,highlight:range,hue:ColorManager.getHueForUserId(null!=(ref1=entry.meta.user)?ref1.id:void 0)}):null!=entry.d&&highlights.push({label:"Deleted by "+name+" on "+date,strikeThrough:range,hue:ColorManager.getHueForUserId(null!=(ref2=entry.meta.user)?ref2.id:void 0)}));return{text:text,highlights:highlights}},HistoryManager.prototype._loadUpdates=function(updates){var doc,doc_id,firstLoad,j,k,len,len1,previousUpdate,ref,ref1,update,user;for(null==updates&&(updates=[]),previousUpdate=this.$scope.history.updates[this.$scope.history.updates.length-1],j=0,len=updates.length;len>j;j++){update=updates[j],update.pathnames=[],ref=update.docs||{};for(doc_id in ref)doc=ref[doc_id],doc.entity=this.ide.fileTreeManager.findEntityById(doc_id,{includeDeleted:!0}),update.pathnames.push(doc.entity.name);for(ref1=update.meta.users||[],k=0,len1=ref1.length;len1>k;k++)user=ref1[k],null!=user&&(user.hue=ColorManager.getHueForUserId(user.id));null!=previousUpdate&&moment(previousUpdate.meta.end_ts).isSame(update.meta.end_ts,"day")||(update.meta.first_in_day=!0),update.selectedFrom=!1,update.selectedTo=!1,update.inSelection=!1,previousUpdate=update}return firstLoad=0===this.$scope.history.updates.length,this.$scope.history.updates=this.$scope.history.updates.concat(updates),firstLoad?this.autoSelectRecentUpdates():void 0},HistoryManager.prototype._calculateRangeFromSelection=function(){var doc,doc_id,end_ts,fromV,j,len,ref,ref1,ref2,selected_doc_id,start_ts,toV,update;for(fromV=toV=start_ts=end_ts=null,selected_doc_id=null!=(ref=this.$scope.history.selection.doc)?ref.id:void 0,ref1=this.$scope.history.selection.updates||[],j=0,len=ref1.length;len>j;j++){update=ref1[j],ref2=update.docs;for(doc_id in ref2)if(doc=ref2[doc_id],doc_id===selected_doc_id){null!=fromV&&null!=toV?(fromV=Math.min(fromV,doc.fromV),toV=Math.max(toV,doc.toV),start_ts=Math.min(start_ts,update.meta.start_ts),end_ts=Math.max(end_ts,update.meta.end_ts)):(fromV=doc.fromV,toV=doc.toV,start_ts=update.meta.start_ts,end_ts=update.meta.end_ts);break}}return{fromV:fromV,toV:toV,start_ts:start_ts,end_ts:end_ts}},HistoryManager.prototype._selectDocFromUpdates=function(){var affected_docs,doc,doc_id,j,len,ref,ref1,selected_doc,update;for(affected_docs={},ref=this.$scope.history.selection.updates,j=0,len=ref.length;len>j;j++){update=ref[j],ref1=update.docs;for(doc_id in ref1)doc=ref1[doc_id],affected_docs[doc_id]=doc.entity}if(selected_doc=this.$scope.history.selection.doc,null!=selected_doc&&null!=affected_docs[selected_doc.id]);else for(doc_id in affected_docs){doc=affected_docs[doc_id],selected_doc=doc;break}return this.$scope.history.selection.doc=selected_doc,this.ide.fileTreeManager.selectEntity(selected_doc)},HistoryManager.prototype._updateContainsUserId=function(update,user_id){var j,len,ref,user;for(ref=update.meta.users,j=0,len=ref.length;len>j;j++)if(user=ref[j],(null!=user?user.id:void 0)===user_id)return!0;return!1},HistoryManager}()})}.call(this),function(){define("ide/history/util/HistoryViewModes",[],function(){var HistoryViewModes;return HistoryViewModes={POINT_IN_TIME:"point_in_time",COMPARE:"compare"}})}.call(this),function(){define("ide/history/controllers/HistoryV2ListController",["base","ide/history/util/displayNameForUser"],function(App,displayNameForUser){return App.controller("HistoryV2ListController",["$scope","$modal","ide",function($scope,$modal,ide){return $scope.hoveringOverListSelectors=!1,$scope.listConfig={showOnlyLabelled:!1},$scope.projectUsers=[],$scope.$watch("project.members",function(newVal){return null!=newVal?$scope.projectUsers=newVal.concat($scope.project.owner):void 0}),$scope.loadMore=function(_this){return function(){return ide.historyManager.fetchNextBatchOfUpdates()}}(this),$scope.handleEntrySelect=function(entry){return ide.historyManager.selectUpdate(entry)},$scope.handleLabelSelect=function(label){return ide.historyManager.selectLabel(label)},$scope.handleLabelDelete=function(labelDetails){return $modal.open({templateUrl:"historyV2DeleteLabelModalTemplate",controller:"HistoryV2DeleteLabelModalController",resolve:{labelDetails:function(){return labelDetails}}})}}])})}.call(this),function(){define("ide/history/controllers/HistoryV2DiffController",["base"],function(App){return App.controller("HistoryV2DiffController",function($scope,ide,event_tracking,waitFor){var openEntity;return $scope.restoreState={inflight:!1,error:!1},$scope.restoreDeletedFile=function(){var pathname,ref,version;return pathname=$scope.history.selection.pathname,null!=pathname&&(version=null!=(ref=$scope.history.selection.docs[pathname])?ref.deletedAtV:void 0,null!=version)?(event_tracking.sendMB("history-v2-restore-deleted"),$scope.restoreState.inflight=!0,ide.historyManager.restoreFile(version,pathname).then(function(response){var data;return data=response.data,openEntity(data)})["catch"](function(){return ide.showGenericMessageModal("Sorry, something went wrong with the restore")})["finally"](function(){return $scope.restoreState.inflight=!1})):void 0},openEntity=function(data){var id,type;return id=data.id,type=data.type,waitFor(function(){return ide.fileTreeManager.findEntityById(id)},3e3).then(function(entity){return"doc"===type?ide.editorManager.openDoc(entity):"file"===type?ide.binaryFilesManager.openFile(entity):void 0})["catch"](function(err){return console.warn(err)})}})})}.call(this),function(){define("ide/history/controllers/HistoryV2FileTreeController",["base"],function(App){return App.controller("HistoryV2FileTreeController",["$scope","ide","_",function($scope,ide,_){var _getSelectedDefaultPathname,_pathnameExistsInFiles,_previouslySelectedPathname,_reducePathsToTree;return _previouslySelectedPathname=null,$scope.currentFileTree=[],_pathnameExistsInFiles=function(pathname,files){return _.any(files,function(file){return file.pathname===pathname})},_getSelectedDefaultPathname=function(files){var mainFile,selectedPathname;return selectedPathname=null,null!=_previouslySelectedPathname&&_pathnameExistsInFiles(_previouslySelectedPathname,files)?selectedPathname=_previouslySelectedPathname:(mainFile=_.find(files,function(file){return/main\.tex$/.test(file.pathname)}),selectedPathname=_previouslySelectedPathname=null!=mainFile?mainFile.pathname:files[0].pathname),selectedPathname},$scope.handleFileSelection=function(file){return $scope.history.selection.pathname=_previouslySelectedPathname=file.pathname},$scope.$watch("history.files",function(files){return null!=files&&files.length>0?($scope.currentFileTree=_.reduce(files,_reducePathsToTree,[]),$scope.history.selection.pathname=_getSelectedDefaultPathname(files)):void 0}),_reducePathsToTree=function(currentFileTree,fileObject){var currentFileTreeLocation,filePathParts,fileTreeEntity,i,index,isFile,len,pathPart;for(filePathParts=fileObject.pathname.split("/"),currentFileTreeLocation=currentFileTree,index=i=0,len=filePathParts.length;len>i;index=++i)pathPart=filePathParts[index],isFile=index===filePathParts.length-1,isFile?(fileTreeEntity={name:pathPart,pathname:fileObject.pathname,type:"file",operation:fileObject.operation||"edited"},currentFileTreeLocation.push(fileTreeEntity)):(fileTreeEntity=_.find(currentFileTreeLocation,function(_this){return function(entity){return entity.name===pathPart}}(this)),null==fileTreeEntity&&(fileTreeEntity={name:pathPart,type:"folder",children:[]},currentFileTreeLocation.push(fileTreeEntity)),currentFileTreeLocation=fileTreeEntity.children);return currentFileTree}}])})}.call(this),function(){define("ide/history/controllers/HistoryV2ToolbarController",["base"],function(App){return App.controller("HistoryV2ToolbarController",["$scope","$modal","ide",function($scope,$modal,ide){return $scope.showAddLabelDialog=function(){return $modal.open({templateUrl:"historyV2AddLabelModalTemplate",controller:"HistoryV2AddLabelModalController",resolve:{update:function(){return $scope.history.selection.updates[0]}}})}}])})}.call(this),function(){define("ide/history/controllers/HistoryV2AddLabelModalController",["base"],function(App){return App.controller("HistoryV2AddLabelModalController",["$scope","$modalInstance","ide","update",function($scope,$modalInstance,ide,update){return $scope.update=update,$scope.inputs={labelName:null},$scope.state={inflight:!1,error:!1},$modalInstance.opened.then(function(){return $scope.$applyAsync(function(){return $scope.$broadcast("open")})}),$scope.addLabelModalFormSubmit=function(){return $scope.state.inflight=!0,ide.historyManager.labelCurrentVersion($scope.inputs.labelName).then(function(response){return $scope.state.inflight=!1,$modalInstance.close()})["catch"](function(response){var data,status;return data=response.data,status=response.status,$scope.state.inflight=!1,400===status?$scope.state.error={message:data}:$scope.state.error=!0})}}])})}.call(this),function(){define("ide/history/controllers/HistoryV2DeleteLabelModalController",["base"],function(App){return App.controller("HistoryV2DeleteLabelModalController",["$scope","$modalInstance","ide","labelDetails",function($scope,$modalInstance,ide,labelDetails){return $scope.labelDetails=labelDetails,$scope.state={inflight:!1,error:!1},$scope.deleteLabel=function(){return $scope.state.inflight=!0,ide.historyManager.deleteLabel(labelDetails).then(function(response){return $scope.state.inflight=!1,$modalInstance.close()})["catch"](function(response){var data,status;return data=response.data,status=response.status,$scope.state.inflight=!1,400===status?$scope.state.error={message:data}:$scope.state.error=!0})}}])})}.call(this),function(){define("ide/history/components/historyEntriesList",["base"],function(App){var historyEntriesListController;return historyEntriesListController=function($scope,$element,$attrs){var _getScrollTopPosForEntry,_isEntryElVisible,ctrl;ctrl=this,ctrl.$entryListViewportEl=null,_isEntryElVisible=function($entryEl){var entryElBottom,entryElTop,entryListViewportElBottom,entryListViewportElTop;return entryElTop=$entryEl.offset().top,entryElBottom=entryElTop+$entryEl.outerHeight(),entryListViewportElTop=ctrl.$entryListViewportEl.offset().top,entryListViewportElBottom=entryListViewportElTop+ctrl.$entryListViewportEl.height(),entryElTop>=entryListViewportElTop&&entryListViewportElBottom>=entryElBottom},_getScrollTopPosForEntry=function($entryEl){var halfViewportElHeight;return halfViewportElHeight=ctrl.$entryListViewportEl.height()/2,$entryEl.offset().top-halfViewportElHeight},ctrl.onEntryLinked=function(entry,$entryEl){return entry.selectedTo&&entry.selectedFrom&&!_isEntryElVisible($entryEl)?$scope.$applyAsync(function(){return ctrl.$entryListViewportEl.scrollTop(_getScrollTopPosForEntry($entryEl))}):void 0},ctrl.$onInit=function(){return ctrl.$entryListViewportEl=$element.find("> .history-entries")}},App.component("historyEntriesList",{bindings:{entries:"<",users:"<",loadEntries:"&",loadDisabled:"<",loadInitialize:"<",isLoading:"<",currentUser:"<",freeHistoryLimitHit:"<",currentUserIsOwner:"<",onEntrySelect:"&",onLabelDelete:"&"},controller:historyEntriesListController,templateUrl:"historyEntriesListTpl"})})}.call(this),function(){define("ide/history/components/historyEntry",["base","ide/colors/ColorManager","ide/history/util/displayNameForUser"],function(App,ColorManager,displayNameForUser){var historyEntryController;return historyEntryController=function($scope,$element,$attrs,_){var _getUserById,ctrl;ctrl=this,_getUserById=function(id){return _.find(ctrl.users,function(user){var curUserId;return curUserId=(null!=user?user._id:void 0)||(null!=user?user.id:void 0),curUserId===id})},ctrl.displayName=displayNameForUser,ctrl.displayNameById=function(id){return displayNameForUser(_getUserById(id))},ctrl.getProjectOpDoc=function(projectOp){return null!=projectOp.rename?projectOp.rename.pathname+" → "+projectOp.rename.newPathname:null!=projectOp.add?""+projectOp.add.pathname:null!=projectOp.remove?""+projectOp.remove.pathname:void 0},ctrl.getUserCSSStyle=function(user){var curUserId,hue;return curUserId=(null!=user?user._id:void 0)||(null!=user?user.id:void 0),hue=ColorManager.getHueForUserId(curUserId)||100,ctrl.entry.inSelection?{color:"#FFF"}:{color:"hsl("+hue+", 70%, 50%)"}},ctrl.$onInit=function(){return ctrl.historyEntriesList.onEntryLinked(ctrl.entry,$element.find("> .history-entry"))}},App.component("historyEntry",{bindings:{entry:"<",currentUser:"<",users:"<",onSelect:"&",onLabelDelete:"&"},require:{historyEntriesList:"^historyEntriesList"},controller:historyEntryController,templateUrl:"historyEntryTpl"})})}.call(this),function(){define("ide/history/components/historyLabelsList",["base","ide/colors/ColorManager","ide/history/util/displayNameForUser"],function(App,ColorManager,displayNameForUser){var historyLabelsListController;return historyLabelsListController=function($scope,$element,$attrs){var ctrl;ctrl=this,ctrl.getUserById=function(id){return _.find(ctrl.users,function(user){var curUserId;return curUserId=(null!=user?user._id:void 0)||(null!=user?user.id:void 0),curUserId===id})},ctrl.displayName=displayNameForUser,ctrl.getUserCSSStyle=function(user,label){var curUserId,hue,ref;return curUserId=(null!=user?user._id:void 0)||(null!=user?user.id:void 0),hue=ColorManager.getHueForUserId(curUserId)||100,label.id===(null!=(ref=ctrl.selectedLabel)?ref.id:void 0)?{color:"#FFF"}:{color:"hsl("+hue+", 70%, 50%)"}}},App.component("historyLabelsList",{bindings:{labels:"<",users:"<",currentUser:"<",isLoading:"<",selectedLabel:"<",onLabelSelect:"&",onLabelDelete:"&"},controller:historyLabelsListController,templateUrl:"historyLabelsListTpl"})})}.call(this),function(){define("ide/history/components/historyLabel",["base"],function(App){var historyLabelController;return historyLabelController=function($scope,$element,$attrs,$filter,_){var ctrl;ctrl=this,ctrl.$onInit=function(){return null!=ctrl.showTooltip?ctrl.showTooltip:ctrl.showTooltip=!0;
}},App.component("historyLabel",{bindings:{labelText:"<",labelOwnerName:"<?",labelCreationDateTime:"<?",isOwnedByCurrentUser:"<",onLabelDelete:"&",showTooltip:"<?"},controller:historyLabelController,templateUrl:"historyLabelTpl"})})}.call(this),function(){define("ide/history/components/historyFileTree",["base"],function(App){var historyFileTreeController;return historyFileTreeController=function($scope,$element,$attrs){var ctrl;ctrl=this,ctrl.handleEntityClick=function(file){return ctrl.onSelectedFileChange({file:file})}},App.component("historyFileTree",{bindings:{fileTree:"<",selectedPathname:"<",onSelectedFileChange:"&",isLoading:"<"},controller:historyFileTreeController,templateUrl:"historyFileTreeTpl"})})}.call(this),function(){define("ide/history/components/historyFileEntity",["base","ide/file-tree/util/iconTypeFromName"],function(App,iconTypeFromName){var historyFileEntityController;return historyFileEntityController=function($scope,$element,$attrs){var _getFolderIcon,_handleFileClick,_handleFolderClick,ctrl;ctrl=this,_handleFolderClick=function(){return ctrl.isOpen=!ctrl.isOpen,ctrl.iconClass=_getFolderIcon()},_handleFileClick=function(){return ctrl.historyFileTreeController.handleEntityClick(ctrl.fileEntity)},_getFolderIcon=function(){return ctrl.isOpen?"fa-folder-open":"fa-folder"},ctrl.$onInit=function(){return"folder"===ctrl.fileEntity.type?(ctrl.isOpen=!0,ctrl.iconClass=_getFolderIcon(),ctrl.handleClick=_handleFolderClick):(ctrl.iconClass="fa-"+iconTypeFromName(ctrl.fileEntity.name),ctrl.handleClick=_handleFileClick,$scope.$watch(function(){return ctrl.historyFileTreeController.selectedPathname},function(newPathname){return ctrl.isSelected=ctrl.fileEntity.pathname===newPathname}))}},App.component("historyFileEntity",{require:{historyFileTreeController:"^historyFileTree"},bindings:{fileEntity:"<"},controller:historyFileEntityController,templateUrl:"historyFileEntityTpl"})})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};define("ide/history/HistoryV2Manager",["moment","ide/colors/ColorManager","ide/history/util/displayNameForUser","ide/history/util/HistoryViewModes","ide/history/controllers/HistoryV2ListController","ide/history/controllers/HistoryV2DiffController","ide/history/controllers/HistoryV2FileTreeController","ide/history/controllers/HistoryV2ToolbarController","ide/history/controllers/HistoryV2AddLabelModalController","ide/history/controllers/HistoryV2DeleteLabelModalController","ide/history/directives/infiniteScroll","ide/history/components/historyEntriesList","ide/history/components/historyEntry","ide/history/components/historyLabelsList","ide/history/components/historyLabel","ide/history/components/historyFileTree","ide/history/components/historyFileEntity"],function(moment,ColorManager,displayNameForUser,HistoryViewModes){var HistoryManager;return HistoryManager=function(){function HistoryManager(ide,$scope){this.ide=ide,this.$scope=$scope,this._addLabelToLocalUpdate=bind(this._addLabelToLocalUpdate,this),this.deleteLabel=bind(this.deleteLabel,this),this.labelCurrentVersion=bind(this.labelCurrentVersion,this),this.reset(),this.$scope.HistoryViewModes=HistoryViewModes,this.$scope.toggleHistory=function(_this){return function(){return"history"===_this.$scope.ui.view?_this.hide():_this.show(),_this.ide.$timeout(function(){return _this.$scope.$broadcast("history:toggle")},0)}}(this),this.$scope.toggleHistoryViewMode=function(_this){return function(){return _this.$scope.history.viewMode===HistoryViewModes.COMPARE?(_this.reset(),_this.$scope.history.viewMode=HistoryViewModes.POINT_IN_TIME):(_this.reset(),_this.$scope.history.viewMode=HistoryViewModes.COMPARE),_this.ide.$timeout(function(){return _this.$scope.$broadcast("history:toggle")},0)}}(this),this.$scope.$watch("history.selection.updates",function(_this){return function(updates){return _this.$scope.history.viewMode===HistoryViewModes.COMPARE&&null!=updates&&updates.length>0?(_this._selectDocFromUpdates(),_this.reloadDiff()):void 0}}(this)),this.$scope.$watch("history.selection.pathname",function(_this){return function(pathname){return _this.$scope.history.viewMode!==HistoryViewModes.POINT_IN_TIME?_this.reloadDiff():null!=pathname?_this.loadFileAtPointInTime():void 0}}(this)),this.$scope.$watch("history.showOnlyLabels",function(_this){return function(showOnlyLabels,prevVal){if(null!=showOnlyLabels&&showOnlyLabels!==prevVal){if(showOnlyLabels)return _this.selectedLabelFromUpdatesSelection();if(_this.$scope.history.selection.label=null,0===_this.$scope.history.selection.updates.length)return _this.autoSelectLastUpdate()}}}(this)),this.$scope.$watch("history.updates.length",function(_this){return function(){return _this.recalculateSelectedUpdates()}}(this))}return HistoryManager.prototype.show=function(){return this.$scope.ui.view="history",this.reset(),this.$scope.history.viewMode=HistoryViewModes.POINT_IN_TIME},HistoryManager.prototype.hide=function(){return this.$scope.ui.view="editor"},HistoryManager.prototype.reset=function(){var ref,ref1;return this.$scope.history={isV2:!0,updates:[],viewMode:null,nextBeforeTimestamp:null,atEnd:!1,userHasFullFeature:(null!=(ref=this.$scope.project)&&null!=(ref1=ref.features)?ref1.versioning:void 0)||!1,freeHistoryLimitHit:!1,selection:{label:null,updates:[],docs:{},pathname:null,range:{fromV:null,toV:null}},error:null,showOnlyLabels:!1,labels:null,files:[],diff:null,selectedFile:null}},HistoryManager.prototype.restoreFile=function(version,pathname){var url;return url="/project/"+this.$scope.project_id+"/restore_file",this.ide.$http.post(url,{version:version,pathname:pathname,_csrf:window.csrfToken})},HistoryManager.prototype.loadFileTreeForVersion=function(version){var query,url;return url="/project/"+this.$scope.project_id+"/filetree/diff",query=["from="+version,"to="+version],url+="?"+query.join("&"),this.$scope.history.loadingFileTree=!0,this.$scope.history.selectedFile=null,this.$scope.history.selection.pathname=null,this.ide.$http.get(url).then(function(_this){return function(response){return _this.$scope.history.files=response.data.diff,_this.$scope.history.loadingFileTree=!1}}(this))},HistoryManager.prototype.MAX_RECENT_UPDATES_TO_SELECT=5,HistoryManager.prototype.autoSelectRecentUpdates=function(){var i,indexOfLastUpdateNotByMe,j,len,ref,update;if(0!==this.$scope.history.updates.length){for(this.$scope.history.updates[0].selectedTo=!0,indexOfLastUpdateNotByMe=0,ref=this.$scope.history.updates,i=j=0,len=ref.length;len>j&&(update=ref[i],!(this._updateContainsUserId(update,this.$scope.user.id)||i>this.MAX_RECENT_UPDATES_TO_SELECT));i=++j)indexOfLastUpdateNotByMe=i;return this.$scope.history.updates[indexOfLastUpdateNotByMe].selectedFrom=!0}},HistoryManager.prototype.autoSelectLastUpdate=function(){return 0!==this.$scope.history.updates.length?this.selectUpdate(this.$scope.history.updates[0]):void 0},HistoryManager.prototype.autoSelectLastLabel=function(){return 0!==this.$scope.history.labels.length?this.selectLabel(this.$scope.history.labels[0]):void 0},HistoryManager.prototype.selectUpdate=function(update){var j,len,ref,selectedUpdateIndex;for(selectedUpdateIndex=this.$scope.history.updates.indexOf(update),-1===selectedUpdateIndex&&(selectedUpdateIndex=0),ref=this.$scope.history.updates,j=0,len=ref.length;len>j;j++)update=ref[j],update.selectedTo=!1,update.selectedFrom=!1;return this.$scope.history.updates[selectedUpdateIndex].selectedTo=!0,this.$scope.history.updates[selectedUpdateIndex].selectedFrom=!0,this.recalculateSelectedUpdates(),this.loadFileTreeForVersion(this.$scope.history.updates[selectedUpdateIndex].toV)},HistoryManager.prototype.selectedLabelFromUpdatesSelection=function(){var lastLabelFromUpdate,nSelectedLabels,ref,ref1,ref2,sortedLabels;return nSelectedLabels=null!=(ref=this.$scope.history.selection.updates)&&null!=(ref1=ref[0])&&null!=(ref2=ref1.labels)?ref2.length:void 0,0===nSelectedLabels?this.autoSelectLastLabel():1===nSelectedLabels?this.selectLabel(this.$scope.history.selection.updates[0].labels[0]):nSelectedLabels>1?(sortedLabels=this.ide.$filter("orderBy")(this.$scope.history.selection.updates[0].labels,"-created_at"),lastLabelFromUpdate=sortedLabels[0],this.selectLabel(lastLabelFromUpdate)):void 0},HistoryManager.prototype.selectLabel=function(labelToSelect){var j,len,ref,update,updateToSelect;if(updateToSelect=null,!this._isLabelSelected(labelToSelect)){for(ref=this.$scope.history.updates,j=0,len=ref.length;len>j;j++)if(update=ref[j],update.toV===labelToSelect.version){updateToSelect=update;break}return this.$scope.history.selection.label=labelToSelect,null!=updateToSelect?this.selectUpdate(updateToSelect):(this.$scope.history.selection.updates=[],this.loadFileTreeForVersion(labelToSelect.version))}},HistoryManager.prototype.recalculateSelectedUpdates=function(){var afterSelection,beforeSelection,inSelection,j,len,ref,results,update;for(beforeSelection=!0,afterSelection=!1,this.$scope.history.selection.updates=[],ref=this.$scope.history.updates,results=[],j=0,len=ref.length;len>j;j++)update=ref[j],update.selectedTo&&(inSelection=!0,beforeSelection=!1),update.beforeSelection=beforeSelection,update.inSelection=inSelection,update.afterSelection=afterSelection,inSelection&&this.$scope.history.selection.updates.push(update),update.selectedFrom?(inSelection=!1,results.push(afterSelection=!0)):results.push(void 0);return results},HistoryManager.prototype.BATCH_SIZE=10,HistoryManager.prototype.fetchNextBatchOfUpdates=function(){var labelsURL,requests,updatesURL;return updatesURL="/project/"+this.ide.project_id+"/updates?min_count="+this.BATCH_SIZE,null!=this.$scope.history.nextBeforeTimestamp&&(updatesURL+="&before="+this.$scope.history.nextBeforeTimestamp),labelsURL="/project/"+this.ide.project_id+"/labels",this.$scope.history.loading=!0,this.$scope.history.loadingFileTree=!0,requests={updates:this.ide.$http.get(updatesURL)},null==this.$scope.history.labels&&(requests.labels=this.ide.$http.get(labelsURL)),this.ide.$q.all(requests).then(function(_this){return function(response){var updatesData;return updatesData=response.updates.data,null!=response.labels&&(_this.$scope.history.labels=_this._sortLabelsByVersionAndDate(response.labels.data)),_this._loadUpdates(updatesData.updates),_this.$scope.history.nextBeforeTimestamp=updatesData.nextBeforeTimestamp,(null==updatesData.nextBeforeTimestamp||_this.$scope.history.freeHistoryLimitHit)&&(_this.$scope.history.atEnd=!0),_this.$scope.history.loading=!1,0===_this.$scope.history.updates.length?_this.$scope.history.loadingFileTree=!1:void 0}}(this))["catch"](function(_this){return function(error){var status,statusText;return status=error.status,statusText=error.statusText,_this.$scope.history.error={status:status,statusText:statusText},_this.$scope.history.loading=!1,_this.$scope.history.loadingFileTree=!1}}(this))},HistoryManager.prototype._sortLabelsByVersionAndDate=function(labels){return this.ide.$filter("orderBy")(labels,["-version","-created_at"])},HistoryManager.prototype.loadFileAtPointInTime=function(){var pathname,query,ref,toV,url;return pathname=this.$scope.history.selection.pathname,null!=(null!=(ref=this.$scope.history.selection.updates)?ref[0]:void 0)?toV=this.$scope.history.selection.updates[0].toV:null!=this.$scope.history.selection.label&&(toV=this.$scope.history.selection.label.version),null!=toV?(url="/project/"+this.$scope.project_id+"/diff",query=["pathname="+encodeURIComponent(pathname),"from="+toV,"to="+toV],url+="?"+query.join("&"),this.$scope.history.selectedFile={loading:!0},this.ide.$http.get(url).then(function(_this){return function(response){var binary,ref1,text;return ref1=_this._parseDiff(response.data.diff),text=ref1.text,binary=ref1.binary,_this.$scope.history.selectedFile.binary=binary,_this.$scope.history.selectedFile.text=text,_this.$scope.history.selectedFile.loading=!1}}(this))["catch"](function(){})):void 0},HistoryManager.prototype.reloadDiff=function(){var diff,fromV,pathname,query,ref,toV,updates,url;return diff=this.$scope.history.diff,updates=this.$scope.history.selection.updates,ref=this._calculateDiffDataFromSelection(),fromV=ref.fromV,toV=ref.toV,pathname=ref.pathname,null==pathname?void(this.$scope.history.diff=null):null==diff||diff.pathname!==pathname||diff.fromV!==fromV||diff.toV!==toV?(this.$scope.history.diff=diff={fromV:fromV,toV:toV,pathname:pathname,error:!1},diff.loading=!0,url="/project/"+this.$scope.project_id+"/diff",query=["pathname="+encodeURIComponent(pathname)],null!=diff.fromV&&null!=diff.toV&&query.push("from="+diff.fromV,"to="+diff.toV),url+="?"+query.join("&"),this.ide.$http.get(url).then(function(_this){return function(response){var binary,data,highlights,ref1,text;return data=response.data,diff.loading=!1,ref1=_this._parseDiff(data.diff),text=ref1.text,highlights=ref1.highlights,binary=ref1.binary,diff.binary=binary,diff.text=text,diff.highlights=highlights}}(this))["catch"](function(){return diff.loading=!1,diff.error=!0})):void 0},HistoryManager.prototype.labelCurrentVersion=function(labelComment){return this._labelVersion(labelComment,this.$scope.history.selection.updates[0].toV)},HistoryManager.prototype.deleteLabel=function(label){var url;return url="/project/"+this.$scope.project_id+"/labels/"+label.id,this.ide.$http({url:url,method:"DELETE",headers:{"X-CSRF-Token":window.csrfToken}}).then(function(_this){return function(response){return _this._deleteLabelLocally(label)}}(this))},HistoryManager.prototype._isLabelSelected=function(label){var ref;return label.id===(null!=(ref=this.$scope.history.selection.label)?ref.id:void 0)},HistoryManager.prototype._deleteLabelLocally=function(labelToDelete){var i,j,len,ref,update;for(ref=this.$scope.history.updates,i=j=0,len=ref.length;len>j;i=++j)if(update=ref[i],update.toV===labelToDelete.version){update.labels=_.filter(update.labels,function(label){return label.id!==labelToDelete.id});break}return this.$scope.history.labels=_.filter(this.$scope.history.labels,function(label){return label.id!==labelToDelete.id})},HistoryManager.prototype._parseDiff=function(diff){var column,content,date,endColumn,endRow,entry,highlights,i,j,len,lines,name,range,ref,ref1,row,startColumn,startRow,text,user;if(diff.binary)return{binary:!0};for(row=0,column=0,highlights=[],text="",ref=diff||[],i=j=0,len=ref.length;len>j;i=++j)entry=ref[i],content=entry.u||entry.i||entry.d,content||(content=""),text+=content,lines=content.split("\n"),startRow=row,startColumn=column,lines.length>1?(endRow=startRow+lines.length-1,endColumn=lines[lines.length-1].length):(endRow=startRow,endColumn=startColumn+lines[0].length),row=endRow,column=endColumn,range={start:{row:startRow,column:startColumn},end:{row:endRow,column:endColumn}},(null!=entry.i||null!=entry.d)&&(user=null!=(ref1=entry.meta.users)?ref1[0]:void 0,name=displayNameForUser(user),date=moment(entry.meta.end_ts).format("Do MMM YYYY, h:mm a"),null!=entry.i?highlights.push({label:"Added by "+name+" on "+date,highlight:range,hue:ColorManager.getHueForUserId(null!=user?user.id:void 0)}):null!=entry.d&&highlights.push({label:"Deleted by "+name+" on "+date,strikeThrough:range,hue:ColorManager.getHueForUserId(null!=user?user.id:void 0)}));return{text:text,highlights:highlights}},HistoryManager.prototype._loadUpdates=function(updates){var cutOffIndex,dateTimeNow,firstLoad,i,j,k,len,len1,previousUpdate,ref,ref1,timestamp24hoursAgo,update,user;for(null==updates&&(updates=[]),previousUpdate=this.$scope.history.updates[this.$scope.history.updates.length-1],dateTimeNow=new Date,timestamp24hoursAgo=dateTimeNow.setDate(dateTimeNow.getDate()-1),cutOffIndex=null,ref=updates||[],i=j=0,len=ref.length;len>j;i=++j){for(update=ref[i],ref1=update.meta.users||[],k=0,len1=ref1.length;len1>k;k++)user=ref1[k],null!=user&&(user.hue=ColorManager.getHueForUserId(user.id));if(null!=previousUpdate&&moment(previousUpdate.meta.end_ts).isSame(update.meta.end_ts,"day")||(update.meta.first_in_day=!0),update.selectedFrom=!1,update.selectedTo=!1,update.inSelection=!1,previousUpdate=update,!this.$scope.history.userHasFullFeature&&update.meta.end_ts<timestamp24hoursAgo){cutOffIndex=i||1,this.$scope.history.freeHistoryLimitHit=!0;break}}return firstLoad=0===this.$scope.history.updates.length,this.$scope.history.userHasFullFeature||null==cutOffIndex||(updates=updates.slice(0,cutOffIndex)),this.$scope.history.updates=this.$scope.history.updates.concat(updates),firstLoad?this.$scope.history.viewMode===HistoryViewModes.COMPARE?this.autoSelectRecentUpdates():this.$scope.history.showOnlyLabels?this.autoSelectLastLabel():this.autoSelectLastUpdate():void 0},HistoryManager.prototype._labelVersion=function(comment,version){var url;return url="/project/"+this.$scope.project_id+"/labels",this.ide.$http.post(url,{comment:comment,version:version,_csrf:window.csrfToken}).then(function(_this){return function(response){return _this._addLabelToLocalUpdate(response.data)}}(this))},HistoryManager.prototype._addLabelToLocalUpdate=function(label){var localUpdate;return localUpdate=_.find(this.$scope.history.updates,function(update){return update.toV===label.version}),null!=localUpdate&&(localUpdate.labels=this._sortLabelsByVersionAndDate(localUpdate.labels.concat(label))),this.$scope.history.labels=this._sortLabelsByVersionAndDate(this.$scope.history.labels.concat(label))},HistoryManager.prototype._perDocSummaryOfUpdates=function(updates){var add,docs_summary,j,k,l,len,len1,len2,original_pathnames,pathname,project_op,ref,ref1,remove,rename,update,updatePathnameWithUpdateVersions;for(original_pathnames=Object.create(null),docs_summary=Object.create(null),updatePathnameWithUpdateVersions=function(pathname,update,deletedAtV){var doc_summary,original_pathname;return null==original_pathnames[pathname]&&(original_pathnames[pathname]=pathname),original_pathname=original_pathnames[pathname],doc_summary=null!=docs_summary[original_pathname]?docs_summary[original_pathname]:docs_summary[original_pathname]={fromV:update.fromV,toV:update.toV},doc_summary.fromV=Math.min(doc_summary.fromV,update.fromV),doc_summary.toV=Math.max(doc_summary.toV,update.toV),null!=deletedAtV?doc_summary.deletedAtV=deletedAtV:void 0},updates=updates.slice().reverse(),j=0,len=updates.length;len>j;j++){for(update=updates[j],ref=update.pathnames||[],k=0,len1=ref.length;len1>k;k++)pathname=ref[k],updatePathnameWithUpdateVersions(pathname,update);for(ref1=update.project_ops||[],l=0,len2=ref1.length;len2>l;l++)project_op=ref1[l],null!=project_op.rename&&(rename=project_op.rename,updatePathnameWithUpdateVersions(rename.pathname,update),original_pathnames[rename.newPathname]=original_pathnames[rename.pathname],delete original_pathnames[rename.pathname]),null!=project_op.add&&(add=project_op.add,updatePathnameWithUpdateVersions(add.pathname,update)),null!=project_op.remove&&(remove=project_op.remove,updatePathnameWithUpdateVersions(remove.pathname,update,project_op.atV))}return docs_summary},HistoryManager.prototype._calculateDiffDataFromSelection=function(){var doc,fromV,pathname,ref,selected_pathname,toV;fromV=toV=pathname=null,selected_pathname=this.$scope.history.selection.pathname,ref=this._perDocSummaryOfUpdates(this.$scope.history.selection.updates);for(pathname in ref)if(doc=ref[pathname],pathname===selected_pathname)return fromV=doc.fromV,toV=doc.toV,{fromV:fromV,toV:toV,pathname:pathname};return{}},HistoryManager.prototype._selectDocFromUpdates=function(){var affected_docs,doc,pathname,selected_pathname;if(affected_docs=this._perDocSummaryOfUpdates(this.$scope.history.selection.updates),this.$scope.history.selection.docs=affected_docs,selected_pathname=this.$scope.history.selection.pathname,null!=selected_pathname&&affected_docs[selected_pathname]);else for(pathname in affected_docs){doc=affected_docs[pathname],selected_pathname=pathname;break}return this.$scope.history.selection.pathname=selected_pathname},HistoryManager.prototype._updateContainsUserId=function(update,user_id){var j,len,ref,user;for(ref=update.meta.users,j=0,len=ref.length;len>j;j++)if(user=ref[j],(null!=user?user.id:void 0)===user_id)return!0;return!1},HistoryManager}()})}.call(this),function(){define("ide/permissions/PermissionsManager",[],function(){var PermissionsManager;return PermissionsManager=function(){function PermissionsManager(ide,$scope){this.ide=ide,this.$scope=$scope,this.$scope.permissions={read:!1,write:!1,admin:!1,comment:!1},this.$scope.$watch("permissionsLevel",function(_this){return function(permissionsLevel){return null!=permissionsLevel&&("readOnly"===permissionsLevel?(_this.$scope.permissions.read=!0,_this.$scope.permissions.comment=!0):"readAndWrite"===permissionsLevel?(_this.$scope.permissions.read=!0,_this.$scope.permissions.write=!0,_this.$scope.permissions.comment=!0):"owner"===permissionsLevel&&(_this.$scope.permissions.read=!0,_this.$scope.permissions.write=!0,_this.$scope.permissions.admin=!0,_this.$scope.permissions.comment=!0)),_this.$scope.anonymous?_this.$scope.permissions.comment=!1:void 0}}(this))}return PermissionsManager}()})}.call(this),define("libs/latex-log-parser",[],function(){var HBOX_WARNING_REGEX,LATEX_WARNING_REGEX,LINES_REGEX,LOG_WRAP_LIMIT,LatexParser,LogText,PACKAGE_REGEX,PACKAGE_WARNING_REGEX,state;return LOG_WRAP_LIMIT=79,LATEX_WARNING_REGEX=/^LaTeX Warning: (.*)$/,HBOX_WARNING_REGEX=/^(Over|Under)full \\(v|h)box/,PACKAGE_WARNING_REGEX=/^(Package \b.+\b Warning:.*)$/,LINES_REGEX=/lines? ([0-9]+)/,PACKAGE_REGEX=/^Package (\b.+\b) Warning/,LogText=function(text){var i,wrappedLines;for(this.text=text.replace(/(\r\n)|\r/g,"\n"),wrappedLines=this.text.split("\n"),this.lines=[wrappedLines[0]],i=1;i<wrappedLines.length;)wrappedLines[i-1].length===LOG_WRAP_LIMIT&&"..."!==wrappedLines[i-1].slice(-3)?this.lines[this.lines.length-1]+=wrappedLines[i]:this.lines.push(wrappedLines[i]),i++;this.row=0},function(){this.nextLine=function(){return this.row++,this.row>=this.lines.length?!1:this.lines[this.row]},this.rewindLine=function(){this.row--},this.linesUpToNextWhitespaceLine=function(){return this.linesUpToNextMatchingLine(/^ *$/)},this.linesUpToNextMatchingLine=function(match){var lines,nextLine;for(lines=[],nextLine=this.nextLine(),nextLine!==!1&&lines.push(nextLine);nextLine!==!1&&!nextLine.match(match)&&nextLine!==!1;)nextLine=this.nextLine(),nextLine!==!1&&lines.push(nextLine);return lines}}.call(LogText.prototype),state={NORMAL:0,ERROR:1},LatexParser=function(text,options){this.log=new LogText(text),this.state=state.NORMAL,options=options||{},this.fileBaseNames=options.fileBaseNames||[/compiles/,/\/usr\/local/],this.ignoreDuplicates=options.ignoreDuplicates,this.data=[],this.fileStack=[],this.currentFileList=this.rootFileList=[],this.openParens=0},function(){return this.parse=function(){for(var lineNo;(this.currentLine=this.log.nextLine())!==!1;)this.state===state.NORMAL&&(this.currentLineIsError()?(this.state=state.ERROR,this.currentError={line:null,file:this.currentFilePath,level:"error",message:this.currentLine.slice(2),content:"",raw:this.currentLine+"\n"}):this.currentLineIsRunawayArgument()?this.parseRunawayArgumentError():this.currentLineIsWarning()?this.parseSingleWarningLine(LATEX_WARNING_REGEX):this.currentLineIsHboxWarning()?this.parseHboxLine():this.currentLineIsPackageWarning()?this.parseMultipleWarningLine():this.parseParensForFilenames()),this.state===state.ERROR&&(this.currentError.content+=this.log.linesUpToNextMatchingLine(/^l\.[0-9]+/).join("\n"),this.currentError.content+="\n",this.currentError.content+=this.log.linesUpToNextWhitespaceLine().join("\n"),this.currentError.content+="\n",this.currentError.content+=this.log.linesUpToNextWhitespaceLine().join("\n"),this.currentError.raw+=this.currentError.content,lineNo=this.currentError.raw.match(/l\.([0-9]+)/),lineNo&&(this.currentError.line=parseInt(lineNo[1],10)),this.data.push(this.currentError),this.state=state.NORMAL);return this.postProcess(this.data)},this.currentLineIsError=function(){return"!"===this.currentLine[0]},this.currentLineIsRunawayArgument=function(){return this.currentLine.match(/^Runaway argument/)},this.currentLineIsWarning=function(){return!!this.currentLine.match(LATEX_WARNING_REGEX)},this.currentLineIsPackageWarning=function(){return!!this.currentLine.match(PACKAGE_WARNING_REGEX)},this.currentLineIsHboxWarning=function(){return!!this.currentLine.match(HBOX_WARNING_REGEX)},this.parseRunawayArgumentError=function(){var lineNo;return this.currentError={line:null,file:this.currentFilePath,level:"error",message:this.currentLine,content:"",raw:this.currentLine+"\n"},this.currentError.content+=this.log.linesUpToNextWhitespaceLine().join("\n"),this.currentError.content+="\n",this.currentError.content+=this.log.linesUpToNextWhitespaceLine().join("\n"),this.currentError.raw+=this.currentError.content,lineNo=this.currentError.raw.match(/l\.([0-9]+)/),lineNo&&(this.currentError.line=parseInt(lineNo[1],10)),this.data.push(this.currentError)},this.parseSingleWarningLine=function(prefix_regex){var line,lineMatch,warning,warningMatch;warningMatch=this.currentLine.match(prefix_regex),warningMatch&&(warning=warningMatch[1],lineMatch=warning.match(LINES_REGEX),line=lineMatch?parseInt(lineMatch[1],10):null,this.data.push({line:line,file:this.currentFilePath,level:"warning",message:warning,raw:warning}))},this.parseMultipleWarningLine=function(){var line,lineMatch,packageMatch,packageName,prefixRegex,raw_message,warningMatch,warning_lines;if(warningMatch=this.currentLine.match(PACKAGE_WARNING_REGEX)){for(warning_lines=[warningMatch[1]],lineMatch=this.currentLine.match(LINES_REGEX),line=lineMatch?parseInt(lineMatch[1],10):null,packageMatch=this.currentLine.match(PACKAGE_REGEX),packageName=packageMatch[1],prefixRegex=new RegExp("(?:\\("+packageName+"\\))*[\\s]*(.*)","i");this.currentLine=this.log.nextLine();)lineMatch=this.currentLine.match(LINES_REGEX),line=lineMatch?parseInt(lineMatch[1],10):line,warningMatch=this.currentLine.match(prefixRegex),warning_lines.push(warningMatch[1]);raw_message=warning_lines.join(" "),this.data.push({line:line,file:this.currentFilePath,level:"warning",message:raw_message,raw:raw_message})}},this.parseHboxLine=function(){var line,lineMatch;lineMatch=this.currentLine.match(LINES_REGEX),line=lineMatch?parseInt(lineMatch[1],10):null,this.data.push({line:line,file:this.currentFilePath,level:"typesetting",message:this.currentLine,raw:this.currentLine})},this.parseParensForFilenames=function(){var filePath,newFile,pos,previousFile,token;pos=this.currentLine.search(/\(|\)/),-1!==pos&&(token=this.currentLine[pos],this.currentLine=this.currentLine.slice(pos+1),"("===token?(filePath=this.consumeFilePath(),filePath?(this.currentFilePath=filePath,newFile={path:filePath,files:[]},this.fileStack.push(newFile),this.currentFileList.push(newFile),this.currentFileList=newFile.files):this.openParens++):")"===token&&(this.openParens>0?this.openParens--:this.fileStack.length>1&&(this.fileStack.pop(),previousFile=this.fileStack[this.fileStack.length-1],this.currentFilePath=previousFile.path,this.currentFileList=previousFile.files)),this.parseParensForFilenames())},this.consumeFilePath=function(){var endOfFilePath,path;return this.currentLine.match(/^\/?([^ \)]+\/)+/)?(endOfFilePath=this.currentLine.search(RegExp(" |\\)")),path=void 0,-1===endOfFilePath?(path=this.currentLine,this.currentLine=""):(path=this.currentLine.slice(0,endOfFilePath),this.currentLine=this.currentLine.slice(endOfFilePath)),path):!1},this.postProcess=function(data){var all,errors,hashEntry,hashes,i,typesetting,warnings;for(all=[],errors=[],warnings=[],typesetting=[],hashes=[],hashEntry=function(entry){return entry.raw},i=0;i<data.length;)this.ignoreDuplicates&&hashes.indexOf(hashEntry(data[i]))>-1?i++:("error"===data[i].level?errors.push(data[i]):"typesetting"===data[i].level?typesetting.push(data[i]):"warning"===data[i].level&&warnings.push(data[i]),all.push(data[i]),hashes.push(hashEntry(data[i])),i++);return{errors:errors,warnings:warnings,typesetting:typesetting,all:all,files:this.rootFileList}}}.call(LatexParser.prototype),LatexParser.parse=function(text,options){return new LatexParser(text,options).parse()},LatexParser}),function(){define("ide/human-readable-logs/HumanReadableLogsRules",[],function(){return[{regexToMatch:/Misplaced alignment tab character \&/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Misplaced_alignment_tab_character_%26",humanReadableHint:"You have placed an alignment tab character '&' in the wrong place. If you want to align something, you must write it inside an align environment such as \\begin{align} … \\end{align}, \\begin{tabular} … \\end{tabular}, etc. If you want to write an ampersand '&' in text, you must write \\& instead."},{regexToMatch:/Extra alignment tab has been changed to \\cr/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Extra_alignment_tab_has_been_changed_to_%5Ccr",humanReadableHint:'You have written too many alignment tabs in a table, causing one of them to be turned into a line break. Make sure you have specified the correct number of columns in your <a target="_blank" href="https://www.sharelatex.com/learn/Tables">table</a>.'},{regexToMatch:/Display math should end with \$\$/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Display_math_should_end_with_$$",humanReadableHint:"You have forgotten a $ sign at the end of 'display math' mode. When writing in display math mode, you must always math write inside $$ … $$. Check that the number of $s match around each math expression."},{regexToMatch:/Missing [{$] inserted./,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Missing_$_inserted",humanReadableHint:"Check that your $'s match around math expressions. If they do, then you've probably used a symbol in normal text that needs to be in math mode. Symbols such as subscripts ( _ ), integrals ( \\int ), Greek letters ( \\alpha, \\beta, \\delta ), and modifiers (\\vec{x}, \\tilde{x} ) must be written in math mode. See the full list <a target=\"_blank\" href=\"https://www.sharelatex.com/learn/Errors/Missing_$_inserted \">here</a>.If you intended to use mathematics mode, then use $ … $ for 'inline math mode', $$ … $$ for 'display math mode' or alternatively \\begin{math} … \\end{math}."},{regexToMatch:/(undefined )?[rR]eference(s)?.+(undefined)?/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/There_were_undefined_references",humanReadableHint:"You have referenced something which has not yet been labelled. If you have labelled it already, make sure that what is written inside \\ref{...} is the same as what is written inside \\label{...}."},{regexToMatch:/Citation .+ on page .+ undefined on input line .+/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Citation_XXX_on_page_XXX_undefined_on_input_line_XXX",humanReadableHint:"You have cited something which is not included in your bibliography. Make sure that the citation (\\cite{...}) has a corresponding key in your bibliography, and that both are spelled the same way."},{regexToMatch:/(Label .+)? multiply[ -]defined( labels)?/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/There_were_multiply-defined_labels",humanReadableHint:"You have used the same label more than once. Check that each \\label{...} labels only one item."},{regexToMatch:/`!?h' float specifier changed to `!?ht'/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/%60!h%27_float_specifier_changed_to_%60!ht%27",humanReadableHint:"The float specifier 'h' is too strict of a demand for LaTeX to place your float in a nice way here. Try relaxing it by using 'ht', or even 'htbp' if necessary. If you want to try keep the float here anyway, check out the <a target=\"_blank\" href=\"https://www.sharelatex.com/learn/Positioning_of_Figures\">float package</a>."},{regexToMatch:/No positions in optional float specifier/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/No_positions_in_optional_float_specifier",humanReadableHint:'You have forgotten to include a float specifier, which tells LaTeX where to position your figure. To fix this, either insert a float specifier inside the square brackets (e.g. \\begin{figure}[h]), or remove the square brackets (e.g. \\begin{figure}). Find out more about float specifiers <a target="_blank" href="https://www.sharelatex.com/learn/Positioning_of_Figures">here</a>.'
},{regexToMatch:/Undefined control sequence/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Undefined_control_sequence",humanReadableHint:"The compiler is having trouble understanding a command you have used. Check that the command is spelled correctly. If the command is part of a package, make sure you have included the package in your preamble using \\usepackage{...}."},{regexToMatch:/File .+ not found/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/File_XXX_not_found_on_input_line_XXX",humanReadableHint:'The compiler cannot find the file you want to include. Make sure that you have <a target="_blank" href="https://www.sharelatex.com/learn/Including_images_in_ShareLaTeX">uploaded the file</a> and <a target="_blank" href="https://www.sharelatex.com/learn/Errors/File_XXX_not_found_on_input_line_XXX.">specified the file location correctly</a>.'},{regexToMatch:/LaTeX Error: Unknown graphics extension: \..+/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_Unknown_graphics_extension:_.XXX",humanReadableHint:'The compiler does not recognise the file type of one of your images. Make sure you are using a <a target="_blank" href="https://www.sharelatex.com/learn/Errors/LaTeX_Error:_Unknown_graphics_extension:_.gif.">supported image format</a> for your choice of compiler, and check that there are no periods (.) in the name of your image.'},{regexToMatch:/LaTeX Error: Unknown float option `H'/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_Unknown_float_option_%60H%27",humanReadableHint:"The compiler isn't recognizing the float option 'H'. Include \\usepackage{float} in your preamble to fix this."},{regexToMatch:/LaTeX Error: Unknown float option `q'/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_Unknown_float_option_%60q%27",humanReadableHint:'You have used a float specifier which the compiler does not understand. You can learn more about the different float options available for placing figures <a target="_blank" href="https://www.sharelatex.com/learn/Positioning_of_Figures">here</a>.'},{regexToMatch:/LaTeX Error: \\math.+ allowed only in math mode/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_%5Cmathrm_allowed_only_in_math_mode",humanReadableHint:"You have used a font command which is only available in math mode. To use this command, you must be in maths mode (E.g. $ … $ or \\begin{math} … \\end{math}). If you want to use it outside of math mode, use the text version instead: \\textrm, \\textit, etc."},{ruleId:"hint_mismatched_environment",types:["environment"],regexToMatch:/Error: `([^']{2,})' expected, found `([^']{2,})'.*/,newMessage:"Error: environment does not match \\begin{$1} ... \\end{$2}",humanReadableHint:"You have used \\begin{...} without a corresponding \\end{...}."},{ruleId:"hint_mismatched_brackets",types:["environment"],regexToMatch:/Error: `([^a-zA-Z0-9])' expected, found `([^a-zA-Z0-9])'.*/,newMessage:"Error: brackets do not match, found '$2' instead of '$1'",humanReadableHint:"You have used an open bracket without a corresponding close bracket."},{regexToMatch:/LaTeX Error: Can be used only in preamble/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_Can_be_used_only_in_preamble",humanReadableHint:"You have used a command in the main body of your document which should be used in the preamble. Make sure that \\documentclass[…]{…} and all \\usepackage{…} commands are written before \\begin{document}."},{regexToMatch:/Missing \\right inserted/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Missing_%5Cright_insertede",humanReadableHint:'You have started an expression with a \\left command, but have not included a corresponding \\right command. Make sure that your \\left and \\right commands balance everywhere, or else try using \\Biggl and \\Biggr commands instead as shown <a target="_blank" href="https://www.sharelatex.com/learn/Errors/Missing_%5Cright_inserted">here</a>.'},{regexToMatch:/Double superscript/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Double_superscript",humanReadableHint:"You have written a double superscript incorrectly as a^b^c, or else you have written a prime with a superscript. Remember to include { and } when using multiple superscripts. Try a^{b^c} instead."},{regexToMatch:/Double subscript/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Double_subscript",humanReadableHint:"You have written a double subscript incorrectly as a_b_c. Remember to include { and } when using multiple subscripts. Try a_{b_c} instead."},{regexToMatch:/No \\author given/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/No_%5Cauthor_given",humanReadableHint:"You have used the \\maketitle command, but have not specified any \\author. To fix this, include an author in your preamble using the \\author{…} command."},{regexToMatch:/LaTeX Error: Environment .+ undefined/,extraInfoURL:"https://www.sharelatex.com/learn/Errors%2FLaTeX%20Error%3A%20Environment%20XXX%20undefined",humanReadableHint:"You have created an environment (using \\begin{…} and \\end{…} commands) which is not recognized. Make sure you have included the required package for that environment in your preamble, and that the environment is spelled correctly."},{regexToMatch:/LaTeX Error: Something's wrong--perhaps a missing \\item/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_Something%27s_wrong--perhaps_a_missing_%5Citem",humanReadableHint:"There are no entries found in a list you have created. Make sure you label list entries using the \\item command, and that you have not used a list inside a table."},{regexToMatch:/Misplaced \\noalign/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Misplaced_%5Cnoalign",humanReadableHint:"You have used a \\hline command in the wrong place, probably outside a table. If the \\hline command is written inside a table, try including \\ before it."},{regexToMatch:/LaTeX Error: There's no line here to end/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_There%27s_no_line_here_to_end",humanReadableHint:"You have used a \\\\ or \\newline command where LaTeX was not expecting one. Make sure that you only use line breaks after blocks of text, and be careful using linebreaks inside lists and other environments."},{regexToMatch:/LaTeX Error: \\verb ended by end of line/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/LaTeX_Error:_%5Cverb_ended_by_end_of_line",humanReadableHint:"You have used a \\verb command incorrectly. Try replacling the \\verb command with \\begin{verbatim}…\\end{verbatim}."},{regexToMatch:/Illegal unit of measure (pt inserted)/,extraInfoURL:"https://www.sharelatex.com/learn/Errors%2FIllegal%20unit%20of%20measure%20(pt%20inserted)",humanReadableHint:"You have written a length, but have not specified the appropriate units (pt, mm, cm etc.). If you have not written a length, check that you have not witten a linebreak \\\\ followed by square brackets […] anywhere."},{regexToMatch:/Extra \\right/,extraInfoURL:"https://www.sharelatex.com/learn/Errors/Extra_%5Cright",humanReadableHint:"You have written a \\right command without a corresponding \\left command. Check that all \\left and \\right commands balance everywhere. "},{regexToMatch:/Missing \\begin{document}/,extraInfoURL:"https://www.sharelatex.com/learn/Errors%2FLaTeX%20Error%3A%20Missing%20%5Cbegin%20document",humanReadableHint:"No \\begin{document} command was found. Make sure you have included \\begin{document} in your preamble, and that your main document is set correctly."},{ruleId:"hint_mismatched_environment2",types:["environment"],cascadesFrom:["environment"],regexToMatch:/Error: `\\end\{([^\}]+)\}' expected but found `\\end\{([^\}]+)\}'.*/,newMessage:"Error: environments do not match: \\begin{$1} ... \\end{$2}",humanReadableHint:"You have used \\begin{} without a corresponding \\end{}."},{ruleId:"hint_mismatched_environment3",types:["environment"],cascadesFrom:["environment"],regexToMatch:/Warning: No matching \\end found for `\\begin\{([^\}]+)\}'.*/,newMessage:"Warning: No matching \\end found for \\begin{$1}",humanReadableHint:"You have used \\begin{} without a corresponding \\end{}."},{ruleId:"hint_mismatched_environment4",types:["environment"],cascadesFrom:["environment"],regexToMatch:/Error: Found `\\end\{([^\}]+)\}' without corresponding \\begin.*/,newMessage:"Error: found \\end{$1} without a corresponding \\begin{$1}",humanReadableHint:"You have used \\begin{} without a corresponding \\end{}."}]})}.call(this),function(){define("ide/human-readable-logs/HumanReadableLogs",["libs/latex-log-parser","ide/human-readable-logs/HumanReadableLogsRules"],function(LogParser,ruleset){return{parse:function(rawLog,options){var _getRule,entry,err,errors,i,j,k,key,len,len1,len2,parsedLogEntries,ref,ref1,ref2,ruleDetails,seenErrorTypes,type;for(parsedLogEntries="string"==typeof rawLog?LogParser.parse(rawLog,options):rawLog,_getRule=function(logMessage){var i,len,rule;for(i=0,len=ruleset.length;len>i;i++)if(rule=ruleset[i],rule.regexToMatch.test(logMessage))return rule},seenErrorTypes={},ref=parsedLogEntries.all,i=0,len=ref.length;len>i;i++)if(entry=ref[i],ruleDetails=_getRule(entry.message),null!=ruleDetails){if(null!=ruleDetails.ruleId?entry.ruleId=ruleDetails.ruleId:null!=ruleDetails.regexToMatch&&(entry.ruleId="hint_"+ruleDetails.regexToMatch.toString().replace(/\s/g,"_").slice(1,-1)),null!=ruleDetails.newMessage&&(entry.message=entry.message.replace(ruleDetails.regexToMatch,ruleDetails.newMessage)),null!=ruleDetails.cascadesFrom)for(ref1=ruleDetails.cascadesFrom,j=0,len1=ref1.length;len1>j;j++)type=ref1[j],seenErrorTypes[type]&&(entry.suppressed=!0);if(null!=ruleDetails.types)for(ref2=ruleDetails.types,k=0,len2=ref2.length;len2>k;k++)type=ref2[k],seenErrorTypes[type]=!0;null!=ruleDetails.humanReadableHint&&(entry.humanReadableHint=ruleDetails.humanReadableHint),null!=ruleDetails.extraInfoURL&&(entry.extraInfoURL=ruleDetails.extraInfoURL)}for(key in parsedLogEntries)errors=parsedLogEntries[key],"object"==typeof errors&&errors.length>0&&(parsedLogEntries[key]=function(){var l,len3,results;for(results=[],l=0,len3=errors.length;len3>l;l++)err=errors[l],err.suppressed||results.push(err);return results}());return parsedLogEntries}}})}.call(this),define("libs/bib-log-parser",[],function(){var BAD_CROSS_REFERENCE_REGEX,BibLogParser,LINE_SPLITTER_REGEX,MESSAGE_LEVELS,MULTILINE_COMMAND_ERROR_REGEX,MULTILINE_ERROR_REGEX,MULTILINE_WARNING_REGEX,SINGLELINE_WARNING_REGEX,consume,errorParsers,warningParsers;return LINE_SPLITTER_REGEX=/^\[(\d+)].*>\s(INFO|WARN|ERROR)\s-\s(.*)$/,MESSAGE_LEVELS={INFO:"info",WARN:"warning",ERROR:"error"},BibLogParser=function(text,options){if("string"!=typeof text)throw new Error("BibLogParser Error: text parameter must be a string");this.text=text.replace(/(\r\n)|\r/g,"\n"),this.options=options||{},this.lines=text.split("\n")},consume=function(logText,regex,process){var iterationCount,match,newEntry,re,result,text;for(text=logText,result=[],re=regex,iterationCount=0;match=re.exec(text);){if(iterationCount+=1,iterationCount>=1e4)return result;newEntry=process(match),result.push(newEntry),text=match.input.slice(0,match.index)+match.input.slice(match.index+match[0].length+1,match.input.length)}return[result,text]},MULTILINE_WARNING_REGEX=/^Warning--(.+)\n--line (\d+) of file (.+)$/m,SINGLELINE_WARNING_REGEX=/^Warning--(.+)$/m,MULTILINE_ERROR_REGEX=/^(.*)---line (\d+) of file (.*)\n([^]+?)\nI'm skipping whatever remains of this entry$/m,BAD_CROSS_REFERENCE_REGEX=/^(A bad cross reference---entry ".+?"\nrefers to entry.+?, which doesn't exist)$/m,MULTILINE_COMMAND_ERROR_REGEX=/^(.*)\n---line (\d+) of file (.*)\n([^]+?)\nI'm skipping whatever remains of this command$/m,warningParsers=[[MULTILINE_WARNING_REGEX,function(match){var fileName,fullMatch,lineNumber,message;return fullMatch=match[0],message=match[1],lineNumber=match[2],fileName=match[3],{file:fileName,level:"warning",message:message,line:lineNumber,raw:fullMatch}}],[SINGLELINE_WARNING_REGEX,function(match){var fullMatch,message;return fullMatch=match[0],message=match[1],{file:"",level:"warning",message:message,line:"",raw:fullMatch}}]],errorParsers=[[MULTILINE_ERROR_REGEX,function(match){var fileName,firstMessage,fullMatch,lineNumber,secondMessage;return fullMatch=match[0],firstMessage=match[1],lineNumber=match[2],fileName=match[3],secondMessage=match[4],{file:fileName,level:"error",message:firstMessage+"\n"+secondMessage,line:lineNumber,raw:fullMatch}}],[BAD_CROSS_REFERENCE_REGEX,function(match){var fullMatch,message;return fullMatch=match[0],message=match[1],{file:"",level:"error",message:message,line:"",raw:fullMatch}}],[MULTILINE_COMMAND_ERROR_REGEX,function(match){var fileName,firstMessage,fullMatch,lineNumber,secondMessage;return fullMatch=match[0],firstMessage=match[1],lineNumber=match[2],fileName=match[3],secondMessage=match[4],{file:fileName,level:"error",message:firstMessage+"\n"+secondMessage,line:lineNumber,raw:fullMatch}}]],function(){return this.parseBibtex=function(){var allErrors,allWarnings,ref,ref1,remainingText,result;return result={all:[],errors:[],warnings:[],files:[],typesetting:[]},ref=warningParsers.reduce(function(accumulator,parser){var _remainingText,currentWarnings,process,ref,regex,text,warnings;return currentWarnings=accumulator[0],text=accumulator[1],regex=parser[0],process=parser[1],ref=consume(text,regex,process),warnings=ref[0],_remainingText=ref[1],[currentWarnings.concat(warnings),_remainingText]},[[],this.text]),allWarnings=ref[0],remainingText=ref[1],ref1=errorParsers.reduce(function(accumulator,parser){var _remainingText,currentErrors,errors,process,ref1,regex,text;return currentErrors=accumulator[0],text=accumulator[1],regex=parser[0],process=parser[1],ref1=consume(text,regex,process),errors=ref1[0],_remainingText=ref1[1],[currentErrors.concat(errors),_remainingText]},[[],remainingText]),allErrors=ref1[0],remainingText=ref1[1],result.warnings=allWarnings,result.errors=allErrors,result.all=allWarnings.concat(allErrors),result},this.parseBiber=function(){var result;return result={all:[],errors:[],warnings:[],files:[],typesetting:[]},this.lines.forEach(function(line){var _,fileName,fullLine,lineMatch,lineNumber,match,message,messageType,newEntry,realMessage;if(match=line.match(LINE_SPLITTER_REGEX))switch(fullLine=match[0],lineNumber=match[1],messageType=match[2],message=match[3],newEntry={file:"",level:MESSAGE_LEVELS[messageType]||"INFO",message:message,line:"",raw:fullLine},lineMatch=newEntry.message.match(/^BibTeX subsystem: \/.+\/(\w+\.\w+)_.+, line (\d+), (.+)$/),lineMatch&&4===lineMatch.length&&(_=lineMatch[0],fileName=lineMatch[1],lineNumber=lineMatch[2],realMessage=lineMatch[3],newEntry.file=fileName,newEntry.line=lineNumber,newEntry.message=realMessage),result.all.push(newEntry),newEntry.level){case"error":return result.errors.push(newEntry);case"warning":return result.warnings.push(newEntry)}}),result},this.parse=function(){var firstLine;if(firstLine=this.lines[0],firstLine.match(/^.*INFO - This is Biber.*$/))return this.parseBiber();if(firstLine.match(/^This is BibTeX, Version.+$/))return this.parseBibtex();throw new Error("BibLogParser Error: cannot determine whether text is biber or bibtex output")}}.call(BibLogParser.prototype),BibLogParser.parse=function(text,options){return new BibLogParser(text,options).parse()},BibLogParser}),function(){define("ide/pdf/controllers/PdfController",["base","ace/ace","ide/human-readable-logs/HumanReadableLogs","libs/bib-log-parser"],function(App,Ace,HumanReadableLogs,BibLogParser){var AUTO_COMPILE_DEBOUNCE,AUTO_COMPILE_MAX_WAIT;return AUTO_COMPILE_MAX_WAIT=5e3,AUTO_COMPILE_DEBOUNCE=2e3,App.filter("trusted",["$sce",function($sce){return function(url){return $sce.trustAsResourceUrl(url)}}]),App.controller("PdfController",function($scope,$http,ide,$modal,synctex,event_tracking,localStorage){var _updateDocLastChangedAt,autoCompile,autoCompileIfReady,autoCompileInterval,autoCompileListeners,buildPdfDownloadUrl,createQueryString,fetchLogs,filesDropdownEl,getFilesDropdownTopCoordAsRatio,getRootDocOverride_id,logsContainerEl,normalizeFilePath,onCompilingStateChanged,onDocChanged,onDocSaved,parseCompileResponse,perUserCompile,recalculateUncompiledChanges,ref,sendCompileRequest,startTryingAutoCompile,stopTryingAutoCompile,toggleAutoCompile,triggerAutoCompile;return perUserCompile=!0,autoCompile=!0,$scope.pdf.view=(null!=$scope&&null!=(ref=$scope.pdf)?ref.url:void 0)?"pdf":"uncompiled",$scope.shouldShowLogs=!1,$scope.wikiEnabled=window.wikiEnabled,$scope.shouldDropUp=!1,logsContainerEl=document.querySelector(".pdf-logs"),filesDropdownEl=null!=logsContainerEl?logsContainerEl.querySelector(".files-dropdown"):void 0,getFilesDropdownTopCoordAsRatio=function(){return(null!=filesDropdownEl?filesDropdownEl.getBoundingClientRect().top:void 0)/(null!=logsContainerEl?logsContainerEl.getBoundingClientRect().height:void 0)},$scope.$watch("shouldShowLogs",function(shouldShow){return shouldShow?$scope.$applyAsync(function(){return $scope.shouldDropUp=getFilesDropdownTopCoordAsRatio()>.65}):void 0}),$scope.trackLogHintsLearnMore=function(){return event_tracking.sendMB("logs-hints-learn-more")},ace.require("ace/lib/useragent").isMac?$scope.modifierKey="Cmd":$scope.modifierKey="Ctrl",createQueryString=function(args){var k,qs_args,v;return qs_args=function(){var results;results=[];for(k in args)v=args[k],results.push(k+"="+v);return results}(),qs_args.length?"?"+qs_args.join("&"):""},$scope.stripHTMLFromString=function(htmlStr){var tmp;return tmp=document.createElement("DIV"),tmp.innerHTML=htmlStr,tmp.textContent||tmp.innerText||""},$scope.$on("project:joined",function(){return autoCompile?(autoCompile=!1,$scope.recompile({isAutoCompileOnLoad:!0}),$scope.hasPremiumCompile="priority"===$scope.project.features.compileGroup):void 0}),$scope.$on("pdf:error:display",function(){return $scope.pdf.view="errors",$scope.pdf.renderingError=!0}),autoCompileInterval=null,autoCompileIfReady=function(){var autoCompileLintingError,shouldCompile,startedTryingAt,timeSinceLastChange,timeSinceStartedTrying;if(!$scope.pdf.compiling&&$scope.autocompile_enabled&&(autoCompileLintingError=ide.$scope.hasLintingError&&ide.$scope.settings.syntaxValidation,$scope.autoCompileLintingError!==autoCompileLintingError&&$scope.$apply(function(){return $scope.autoCompileLintingError=autoCompileLintingError,$scope.startedTryingAutoCompileAt=Date.now(),$scope.docLastChangedAt=Date.now()}),!autoCompileLintingError||!$scope.stop_on_validation_error))return startedTryingAt=Math.max($scope.startedTryingAutoCompileAt,$scope.lastFinishedCompileAt||0),timeSinceStartedTrying=Date.now()-startedTryingAt,timeSinceLastChange=Date.now()-$scope.docLastChangedAt,shouldCompile=!1,timeSinceLastChange>AUTO_COMPILE_DEBOUNCE?shouldCompile=!0:timeSinceStartedTrying>AUTO_COMPILE_MAX_WAIT?shouldCompile=!0:(0>timeSinceStartedTrying||0>timeSinceLastChange)&&(shouldCompile=!0),shouldCompile?triggerAutoCompile():void 0},triggerAutoCompile=function(){return $scope.recompile({isAutoCompileOnChange:!0})},startTryingAutoCompile=function(){return null==autoCompileInterval?($scope.startedTryingAutoCompileAt=Date.now(),autoCompileInterval=setInterval(autoCompileIfReady,200)):void 0},stopTryingAutoCompile=function(){return clearInterval(autoCompileInterval),autoCompileInterval=null},$scope.$watch("uncompiledChanges",function(uncompiledChanges){return uncompiledChanges?startTryingAutoCompile():stopTryingAutoCompile()}),$scope.uncompiledChanges=!1,recalculateUncompiledChanges=function(){return $scope.autocompile_enabled||($scope.uncompiledChanges=!1),$scope.ui.pdfHidden?$scope.uncompiledChanges=!1:null==$scope.docLastChangedAt?$scope.uncompiledChanges=!1:null==$scope.lastStartedCompileAt||$scope.docLastChangedAt>$scope.lastStartedCompileAt?$scope.uncompiledChanges=!0:$scope.uncompiledChanges=!1},_updateDocLastChangedAt=function(){return $scope.docLastChangedAt=Date.now(),recalculateUncompiledChanges()},onDocChanged=function(){return $scope.autoCompileLintingError=!1,_updateDocLastChangedAt()},onDocSaved=function(){return _updateDocLastChangedAt()},onCompilingStateChanged=function(compiling){return recalculateUncompiledChanges()},autoCompileListeners=[],toggleAutoCompile=function(enabling){var i,len,unbind;if(enabling)return autoCompileListeners=[ide.$scope.$on("doc:changed",onDocChanged),ide.$scope.$on("doc:saved",onDocSaved),$scope.$watch("pdf.compiling",onCompilingStateChanged)];for(i=0,len=autoCompileListeners.length;len>i;i++)(unbind=autoCompileListeners[i])();return autoCompileListeners=[],$scope.autoCompileLintingError=!1},$scope.autocompile_enabled=localStorage("autocompile_enabled:"+$scope.project_id)||!1,$scope.$watch("autocompile_enabled",function(newValue,oldValue){return null!=newValue&&oldValue!==newValue?(localStorage("autocompile_enabled:"+$scope.project_id,newValue),toggleAutoCompile(newValue),event_tracking.sendMB("autocompile-setting-changed",{value:newValue})):void 0}),$scope.autocompile_enabled&&toggleAutoCompile(!0),$scope.stop_on_validation_error=localStorage("stop_on_validation_error:"+$scope.project_id),null==$scope.stop_on_validation_error&&($scope.stop_on_validation_error=!0),$scope.$watch("stop_on_validation_error",function(new_value,old_value){return null!=new_value&&old_value!==new_value?localStorage("stop_on_validation_error:"+$scope.project_id,new_value):void 0}),$scope.draft=localStorage("draft:"+$scope.project_id)||!1,$scope.$watch("draft",function(new_value,old_value){return null!=new_value&&old_value!==new_value?localStorage("draft:"+$scope.project_id,new_value):void 0}),sendCompileRequest=function(options){var checkType,params,url;return null==options&&(options={}),url="/project/"+$scope.project_id+"/compile",params={},(options.isAutoCompileOnLoad||options.isAutoCompileOnChange)&&(params.auto_compile=!0),$scope.check&&($scope.pdf.logEntries=[]),$scope.check=options.check?!0:!1,options.check&&event_tracking.sendMB("syntax-check-request"),checkType=function(){switch(!1){case!$scope.check:return"validate";case!options["try"]:return"silent";case!$scope.stop_on_validation_error:return"error";default:return"silent"}}(),"error"===checkType&&(checkType="silent"),$http.post(url,{rootDoc_id:options.rootDocOverride_id||null,draft:$scope.draft,check:checkType,incrementalCompilesEnabled:!$scope.pdf.error,_csrf:window.csrfToken},{params:params})},buildPdfDownloadUrl=function(pdfDownloadDomain,path){return null!=pdfDownloadDomain&&null!=path&&-1!==path.indexOf("build")?""+pdfDownloadDomain+path:path},parseCompileResponse=function(response){var IGNORE_FILES,build,file,fileByPath,i,isOutputFile,j,last_pdf_url,len,len1,pdfDownloadDomain,qs,ref1,ref2,ref3,ref4,ref5,ref6;if(last_pdf_url=$scope.pdf.url,pdfDownloadDomain=response.pdfDownloadDomain,$scope.pdf.error=!1,$scope.pdf.timedout=!1,$scope.pdf.failure=!1,$scope.pdf.url=null,$scope.pdf.clsiMaintenance=!1,$scope.pdf.tooRecentlyCompiled=!1,$scope.pdf.renderingError=!1,$scope.pdf.projectTooLarge=!1,$scope.pdf.compileTerminated=!1,$scope.pdf.compileExited=!1,$scope.pdf.failedCheck=!1,$scope.pdf.compileInProgress=!1,$scope.pdf.autoCompileDisabled=!1,fileByPath={},null!=(null!=response?response.outputFiles:void 0))for(ref1=null!=response?response.outputFiles:void 0,i=0,len=ref1.length;len>i;i++)file=ref1[i],fileByPath[file.path]=file;if(qs={},null!=response.compileGroup&&(ide.compileGroup=qs.compileGroup=response.compileGroup),null!=response.clsiServerId&&(ide.clsiServerId=qs.clsiserverid=response.clsiServerId),"timedout"===response.status?($scope.pdf.view="errors",$scope.pdf.timedout=!0,fetchLogs(fileByPath,{pdfDownloadDomain:pdfDownloadDomain})):"terminated"===response.status?($scope.pdf.view="errors",$scope.pdf.compileTerminated=!0,fetchLogs(fileByPath,{pdfDownloadDomain:pdfDownloadDomain})):"validation-fail"===(ref2=response.status)||"validation-pass"===ref2?($scope.pdf.view="pdf",$scope.pdf.url=buildPdfDownloadUrl(pdfDownloadDomain,last_pdf_url),$scope.shouldShowLogs=!0,"validation-fail"===response.status&&($scope.pdf.failedCheck=!0),event_tracking.sendMB("syntax-check-"+response.status),fetchLogs(fileByPath,{validation:!0,pdfDownloadDomain:pdfDownloadDomain})):"exited"===response.status?($scope.pdf.view="pdf",$scope.pdf.compileExited=!0,$scope.pdf.url=buildPdfDownloadUrl(pdfDownloadDomain,last_pdf_url),$scope.shouldShowLogs=!0,fetchLogs(fileByPath,{pdfDownloadDomain:pdfDownloadDomain})):"autocompile-backoff"===response.status?$scope.pdf.isAutoCompileOnLoad?$scope.pdf.view="uncompiled":($scope.pdf.view="errors",$scope.pdf.autoCompileDisabled=!0,$scope.autocompile_enabled=!1,event_tracking.sendMB("autocompile-rate-limited",{hasPremiumCompile:$scope.hasPremiumCompile})):"project-too-large"===response.status?($scope.pdf.view="errors",$scope.pdf.projectTooLarge=!0):"failure"===response.status?($scope.pdf.view="errors",$scope.pdf.failure=!0,$scope.shouldShowLogs=!0,fetchLogs(fileByPath,{pdfDownloadDomain:pdfDownloadDomain})):"clsi-maintenance"===response.status?($scope.pdf.view="errors",$scope.pdf.clsiMaintenance=!0):"too-recently-compiled"===response.status?($scope.pdf.view="errors",$scope.pdf.tooRecentlyCompiled=!0):"validation-problems"===response.status?($scope.pdf.view="validation-problems",$scope.pdf.validation=response.validationProblems,$scope.shouldShowLogs=!1):"compile-in-progress"===response.status?($scope.pdf.view="errors",$scope.pdf.compileInProgress=!0):"success"===response.status&&($scope.pdf.view="pdf",$scope.shouldShowLogs=!1,null!=(null!=(ref3=fileByPath["output.pdf"])?ref3.url:void 0)?$scope.pdf.url=buildPdfDownloadUrl(pdfDownloadDomain,fileByPath["output.pdf"].url):null!=(null!=(ref4=fileByPath["output.pdf"])?ref4.build:void 0)?(build=fileByPath["output.pdf"].build,$scope.pdf.url=buildPdfDownloadUrl(pdfDownloadDomain,"/project/"+$scope.project_id+"/build/"+build+"/output/output.pdf")):$scope.pdf.url=buildPdfDownloadUrl(pdfDownloadDomain,"/project/"+$scope.project_id+"/output/output.pdf"),null==(null!=(ref5=fileByPath["output.pdf"])?ref5.build:void 0)&&(qs.cache_bust=""+Date.now()),$scope.pdf.url+=createQueryString(qs),qs.popupDownload=!0,$scope.pdf.downloadUrl="/project/"+$scope.project_id+"/output/output.pdf"+createQueryString(qs),fetchLogs(fileByPath,{pdfDownloadDomain:pdfDownloadDomain})),IGNORE_FILES=["output.fls","output.fdb_latexmk"],$scope.pdf.outputFiles=[],null!=response.outputFiles){for(qs={},null!=response.clsiServerId&&(qs.clsiserverid=response.clsiServerId),ref6=response.outputFiles,j=0,len1=ref6.length;len1>j;j++)file=ref6[j],-1===IGNORE_FILES.indexOf(file.path)&&(isOutputFile=/^output\./.test(file.path),$scope.pdf.outputFiles.push({name:isOutputFile?file.path.replace(/^output\./,"")+" file":file.path,url:"/project/"+project_id+"/output/"+file.path+createQueryString(qs),main:isOutputFile?!0:!1}));return $scope.pdf.outputFiles.sort(function(a,b){return b.main-a.main||a.name.localeCompare(b.name)})}},fetchLogs=function(fileByPath,options){var accumulateResults,annotateFiles,blgFile,chktexFile,getChkTex,getFile,handleError,logEntries,logFile,processBiber,processChkTex,processLog,response;return(null!=options?options.validation:void 0)?chktexFile=fileByPath["output.chktex"]:(logFile=fileByPath["output.log"],blgFile=fileByPath["output.blg"]),getFile=function(name,file){var opts;return opts={method:"GET",params:{compileGroup:ide.compileGroup,clsiserverid:ide.clsiServerId}},null!=(null!=file?file.url:void 0)?opts.url=file.url:null!=(null!=file?file.build:void 0)?opts.url="/project/"+$scope.project_id+"/build/"+file.build+"/output/"+name:opts.url="/project/"+$scope.project_id+"/output/"+name,null==(null!=file?file.build:void 0)&&(opts.params.cache_bust=""+Date.now()),opts.url=buildPdfDownloadUrl(options.pdfDownloadDomain,opts.url),$http(opts)},logEntries={all:[],errors:[],warnings:[]},accumulateResults=function(newEntries){var entry,i,j,key,len,len1,ref1,ref2,results;for(ref1=["all","errors","warnings"],results=[],i=0,len=ref1.length;len>i;i++){if(key=ref1[i],null!=newEntries.type)for(ref2=newEntries[key],j=0,len1=ref2.length;len1>j;j++)entry=ref2[j],entry.type=newEntries.type;results.push(logEntries[key]=logEntries[key].concat(newEntries[key]))}return results},processLog=function(log){var all,errors,ref1,typesetting,warnings;return $scope.pdf.rawLog=log,ref1=HumanReadableLogs.parse(log,{ignoreDuplicates:!0}),errors=ref1.errors,warnings=ref1.warnings,typesetting=ref1.typesetting,all=[].concat(errors,warnings,typesetting),accumulateResults({all:all,errors:errors,warnings:warnings})},processChkTex=function(log){var all,errors,i,len,line,logHints,m,ref1,result,warnings;for(errors=[],warnings=[],ref1=log.split("\n"),i=0,len=ref1.length;len>i;i++)line=ref1[i],(m=line.match(/^(\S+):(\d+):(\d+): (Error|Warning): (.*)/))&&(result={file:m[1],line:m[2],column:m[3],level:m[4].toLowerCase(),message:m[4]+": "+m[5]},"error"===result.level?errors.push(result):warnings.push(result));return all=[].concat(errors,warnings),logHints=HumanReadableLogs.parse({type:"Syntax",all:all,errors:errors,warnings:warnings}),event_tracking.sendMB("syntax-check-return-count",{errors:errors.length,warnings:warnings.length}),accumulateResults(logHints)},processBiber=function(log){var all,errors,ref1,warnings;return ref1=BibLogParser.parse(log,{}),errors=ref1.errors,warnings=ref1.warnings,all=[].concat(errors,warnings),accumulateResults({type:"BibTeX",all:all,errors:errors,warnings:warnings})},handleError=function(){return $scope.pdf.logEntries=[],$scope.pdf.rawLog=""},annotateFiles=function(){var base,entity,entry,i,len,name1,ref1,results;for($scope.pdf.logEntries=logEntries,$scope.pdf.logEntryAnnotations={},ref1=logEntries.all,results=[],i=0,len=ref1.length;len>i;i++)entry=ref1[i],null!=entry.file?(entry.file=normalizeFilePath(entry.file),entity=ide.fileTreeManager.findEntityByPath(entry.file),null!=entity?((base=$scope.pdf.logEntryAnnotations)[name1=entity.id]||(base[name1]=[]),results.push($scope.pdf.logEntryAnnotations[entity.id].push({row:entry.line-1,type:"error"===entry.level?"error":"warning",text:entry.message}))):results.push(void 0)):results.push(void 0);return results},null!=logFile&&(response=getFile("output.log",logFile).then(function(response){return processLog(response.data)}),null!=blgFile&&(response=response.then(function(){return getFile("output.blg",blgFile).then(function(response){return processBiber(response.data)},function(){return!0})}))),null!=response?response["catch"](handleError):handleError(),null!=chktexFile&&(getChkTex=function(){return getFile("output.chktex",chktexFile).then(function(response){return processChkTex(response.data)})},response=null!=response?response.then(getChkTex,getChkTex):getChkTex()),null!=response?response["finally"](annotateFiles):void 0},getRootDocOverride_id=function(){var doc,i,len,line,ref1;if(doc=ide.editorManager.getCurrentDocValue(),null==doc)return null;for(ref1=doc.split("\n"),i=0,len=ref1.length;len>i;i++)if(line=ref1[i],/^[^%]*\\documentclass/.test(line))return ide.editorManager.getCurrentDocId();return null},normalizeFilePath=function(path){var rootDocDirname;return path=path.replace(/^(.*)\/compiles\/[0-9a-f]{24}(-[0-9a-f]{24})?\/(\.\/)?/,""),path=path.replace(/^\/compile\//,""),rootDocDirname=ide.fileTreeManager.getRootDocDirname(),null!=rootDocDirname&&(path=path.replace(/^\.\//,rootDocDirname+"/")),path},$scope.recompile=function(options){return null==options&&(options={}),$scope.pdf.compiling?void 0:(event_tracking.sendMBSampled("editor-recompile-sampled",options),$scope.lastStartedCompileAt=Date.now(),$scope.pdf.compiling=!0,$scope.pdf.isAutoCompileOnLoad=null!=options?options.isAutoCompileOnLoad:void 0,(null!=options?options.force:void 0)&&($scope.stop_on_validation_error=!1,$scope.shouldShowLogs=!1,event_tracking.sendMB("syntax-check-turn-off-checking")),(null!=options?options["try"]:void 0)&&($scope.shouldShowLogs=!1,event_tracking.sendMB("syntax-check-try-compile-anyway")),ide.$scope.$broadcast("flush-changes"),options.rootDocOverride_id=getRootDocOverride_id(),
sendCompileRequest(options).then(function(response){var data;return data=response.data,$scope.pdf.view="pdf",$scope.pdf.compiling=!1,parseCompileResponse(data)})["catch"](function(response){var data,status;return data=response.data,status=response.status,429===status&&($scope.pdf.rateLimited=!0),$scope.pdf.compiling=!1,$scope.pdf.renderingError=!1,$scope.pdf.error=!0,$scope.pdf.view="errors"})["finally"](function(){return $scope.lastFinishedCompileAt=Date.now()}))},ide.$scope.recompile=$scope.recompile,ide.$scope.recompileViaKey=function(){return $scope.recompile({keyShortcut:!0})},$scope.stop=function(){return $scope.pdf.compiling?$http({url:"/project/"+$scope.project_id+"/compile/stop",method:"POST",params:{clsiserverid:ide.clsiServerId},headers:{"X-Csrf-Token":window.csrfToken}}):void 0},$scope.clearCache=function(){return $http({url:"/project/"+$scope.project_id+"/output",method:"DELETE",params:{clsiserverid:ide.clsiServerId},headers:{"X-Csrf-Token":window.csrfToken}})},$scope.toggleLogs=function(){return $scope.shouldShowLogs=!$scope.shouldShowLogs,$scope.shouldShowLogs?event_tracking.sendMBOnce("ide-open-logs-once"):void 0},$scope.showPdf=function(){return $scope.pdf.view="pdf",$scope.shouldShowLogs=!1},$scope.toggleRawLog=function(){return $scope.pdf.showRawLog=!$scope.pdf.showRawLog,$scope.pdf.showRawLog?event_tracking.sendMB("logs-view-raw"):void 0},$scope.openClearCacheModal=function(){var modalInstance;return modalInstance=$modal.open({templateUrl:"clearCacheModalTemplate",controller:"ClearCacheModalController",scope:$scope})},$scope.syncToCode=function(position){return synctex.syncToCode(position).then(function(data){var doc,line;return doc=data.doc,line=data.line,ide.editorManager.openDoc(doc,{gotoLine:line})})}}),App.factory("synctex",["ide","$http","$q",function(ide,$http,$q){var perUserCompile,synctex;return perUserCompile=!0,synctex={syncToPdf:function(cursorPosition){var column,deferred,doc,doc_id,path,rootDocDirname,row;return deferred=$q.defer(),doc_id=ide.editorManager.getCurrentDocId(),null==doc_id?(deferred.reject(),deferred.promise):(doc=ide.fileTreeManager.findEntityById(doc_id),null==doc?(deferred.reject(),deferred.promise):(path=ide.fileTreeManager.getEntityPath(doc),null==path?(deferred.reject(),deferred.promise):(rootDocDirname=ide.fileTreeManager.getRootDocDirname(),null!=rootDocDirname&&""!==rootDocDirname&&(path=path.replace(RegExp("^"+rootDocDirname),rootDocDirname+"/.")),row=cursorPosition.row,column=cursorPosition.column,$http({url:"/project/"+ide.project_id+"/sync/code",method:"GET",params:{file:path,line:row+1,column:column,clsiserverid:ide.clsiServerId}}).then(function(response){var data;return data=response.data,deferred.resolve(data.pdf||[])})["catch"](function(response){var error;return error=response.data,deferred.reject(error)}),deferred.promise)))},syncToCode:function(position,options){var deferred,h,ref,v;return null==options&&(options={}),deferred=$q.defer(),null==position?(deferred.reject(),deferred.promise):(h=position.offset.left,v=options.fromPdfPosition&&null!=(null!=(ref=position.pageSize)?ref.height:void 0)?position.pageSize.height-position.offset.top||0:position.offset.top||0,options.includeVisualOffset&&(v+=72),$http({url:"/project/"+ide.project_id+"/sync/pdf",method:"GET",params:{page:position.page+1,h:h.toFixed(2),v:v.toFixed(2),clsiserverid:ide.clsiServerId}}).then(function(response){var data,doc;if(data=response.data,null!=data.code&&data.code.length>0){if(doc=ide.fileTreeManager.findEntityByPath(data.code[0].file),null==doc)return;return deferred.resolve({doc:doc,line:data.code[0].line})}})["catch"](function(response){var error;return error=response.data,deferred.reject(error)}),deferred.promise)}}}]),App.controller("PdfSynctexController",["$scope","synctex","ide",function($scope,synctex,ide){return this.cursorPosition=null,ide.$scope.$on("cursor:editor:update",function(_this){return function(event,cursorPosition1){_this.cursorPosition=cursorPosition1}}(this)),$scope.syncToPdf=function(_this){return function(){return null!=_this.cursorPosition?synctex.syncToPdf(_this.cursorPosition).then(function(highlights){return $scope.pdf.highlights=highlights}):void 0}}(this),ide.$scope.$on("cursor:editor:syncToPdf",$scope.syncToPdf),$scope.syncToCode=function(){return synctex.syncToCode($scope.pdf.position,{includeVisualOffset:!0,fromPdfPosition:!0}).then(function(data){var doc,line;return doc=data.doc,line=data.line,ide.editorManager.openDoc(doc,{gotoLine:line})})}}]),App.controller("PdfLogEntryController",["$scope","ide","event_tracking",function($scope,ide,event_tracking){return $scope.openInEditor=function(entry){var column,entity,line;return event_tracking.sendMBOnce("logs-jump-to-location-once"),entity=ide.fileTreeManager.findEntityByPath(entry.file),null!=entity&&"doc"===entity.type?(null!=entry.line&&(line=entry.line),null!=entry.column&&(column=entry.column),ide.editorManager.openDoc(entity,{gotoLine:line,gotoColumn:column})):void 0}}]),App.controller("ClearCacheModalController",["$scope","$modalInstance",function($scope,$modalInstance){return $scope.state={inflight:!1},$scope.clear=function(){return $scope.state.inflight=!0,$scope.clearCache().then(function(){return $scope.state.inflight=!1,$modalInstance.close()})},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}}])})}.call(this),function(){define("ide/pdf/controllers/PdfViewToggleController",["base"],function(App){return App.controller("PdfViewToggleController",function($scope){return $scope.togglePdfView=function(){return"pdf"===$scope.ui.view?$scope.ui.view="editor":$scope.ui.view="pdf"},$scope.fileTreeClosed=!1,$scope.$on("layout:main:resize",function(e,state){return state.west.initClosed?$scope.fileTreeClosed=!0:$scope.fileTreeClosed=!1,$scope.$apply()})})})}.call(this),function(){define("ide/pdfng/directives/pdfTextLayer",["base"],function(App){return App.factory("pdfTextLayer",[function(){var pdfTextLayer;return pdfTextLayer=function(){function pdfTextLayer(options){this.textLayerDiv=options.textLayerDiv,this.divContentDone=!1,this.viewport=options.viewport,this.textDivs=[],this.renderer=options.renderer,this.renderingDone=!1}return pdfTextLayer.prototype.render=function(timeout){var textLayerFailure,textLayerFrag,textLayerSuccess;if(!this.renderingDone&&this.divContentDone)return null!=this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null),this.textDivs=[],textLayerFrag=document.createDocumentFragment(),this.textLayerRenderTask=this.renderer({textContent:this.textContent,container:textLayerFrag,viewport:this.viewport,textDivs:this.textDivs,timeout:timeout,enhanceTextSelection:this.enhanceTextSelection}),textLayerSuccess=function(_this){return function(){return _this.textLayerDiv.appendChild(textLayerFrag),_this.renderingDone=!0}}(this),textLayerFailure=function(){},this.textLayerRenderTask.promise.then(textLayerSuccess,textLayerFailure)},pdfTextLayer.prototype.setTextContent=function(textContent){return this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null),this.textContent=textContent,this.divContentDone=!0},pdfTextLayer}()}])})}.call(this),function(){define("ide/pdfng/directives/pdfAnnotations",["base"],function(App){return App.factory("pdfAnnotations",[function(){var pdfAnnotations;return pdfAnnotations=function(){function pdfAnnotations(options){this.annotationsLayerDiv=options.annotations,this.viewport=options.viewport,this.navigateFn=options.navigateFn}return pdfAnnotations.EXTERNAL_LINK_TARGET="_blank",pdfAnnotations.prototype.setAnnotations=function(annotations){var annotation,i,len,results;for(results=[],i=0,len=annotations.length;len>i;i++)switch(annotation=annotations[i],annotation.subtype){case"Link":results.push(this.addLink(annotation));break;case"Text":continue;default:results.push(void 0)}return results},pdfAnnotations.prototype.addLink=function(link){var element;return element=this.buildLinkElementFromRect(link.rect),this.setLinkTarget(element,link),this.annotationsLayerDiv.appendChild(element)},pdfAnnotations.prototype.buildLinkElementFromRect=function(rect){var element;return rect=this.viewport.convertToViewportRectangle(rect),rect=PDFJS.Util.normalizeRect(rect),element=document.createElement("a"),element.style.left=Math.floor(rect[0])+"px",element.style.top=Math.floor(rect[1])+"px",element.style.width=Math.ceil(rect[2]-rect[0])+"px",element.style.height=Math.ceil(rect[3]-rect[1])+"px",element},pdfAnnotations.prototype.setLinkTarget=function(element,link){return link.url?(element.href=link.url,element.target=this.EXTERNAL_LINK_TARGET):link.dest?(element.href="#"+link.dest,element.onclick=function(_this){return function(e){return _this.navigateFn(link),!1}}(this)):void 0},pdfAnnotations}()}])})}.call(this),function(){define("ide/pdfng/directives/pdfHighlights",["base"],function(App){return App.factory("pdfHighlights",[function(){var pdfHighlights;return pdfHighlights=function(){function pdfHighlights(options){this.highlightsLayerDiv=options.highlights[0],this.highlightElements=[]}return pdfHighlights.prototype.addHighlight=function(viewport,left,top,width,height){var element,rect;return rect=viewport.convertToViewportRectangle([left,top,left+width,top+height]),rect=PDFJS.Util.normalizeRect(rect),element=document.createElement("div"),element.style.left=Math.floor(rect[0])+"px",element.style.top=Math.floor(rect[1])+"px",element.style.width=Math.ceil(rect[2]-rect[0])+"px",element.style.height=Math.ceil(rect[3]-rect[1])+"px",this.highlightElements.push(element),this.highlightsLayerDiv.appendChild(element),element},pdfHighlights.prototype.clearHighlights=function(){var h,i,len,ref;for(ref=this.highlightElements,i=0,len=ref.length;len>i;i++)h=ref[i],null!=h&&h.parentNode.removeChild(h);return this.highlightElements=[]},pdfHighlights}()}])})}.call(this),function(){define("ide/pdfng/directives/pdfRenderer",["base","pdfjs-dist/build/pdf"],function(App,PDFJS){return App.factory("PDFRenderer",["$q","$timeout","pdfAnnotations","pdfTextLayer","pdfSpinner",function($q,$timeout,pdfAnnotations,pdfTextLayer,pdfSpinner){var PDFRenderer;return PDFRenderer=function(){function PDFRenderer(url,options){var ref1,ref2;this.url=url,this.options=options,window.PDFJS.cMapUrl=window.pdfCMapsPath,window.PDFJS.cMapPacked=!0,(null!=(ref1=window.location)&&null!=(ref2=ref1.search)?ref2.indexOf("disable-font-face=true"):void 0)>=0?window.PDFJS.disableFontFace=!0:window.PDFJS.disableFontFace=!1,this.options.disableAutoFetch&&(window.PDFJS.disableAutoFetch=!0),this.scale=this.options.scale||1,this.pdfjs=PDFJS.getDocument({url:this.url,rangeChunkSize:131072}),this.pdfjs.onProgress=this.options.progressCallback,this.document=$q.when(this.pdfjs),this.navigateFn=this.options.navigateFn,this.spinner=new pdfSpinner,this.resetState(),this.document.then(function(_this){return function(pdfDocument){return pdfDocument.getDownloadInfo().then(function(){return _this.options.loadedCallback()})}}(this)),this.errorCallback=this.options.errorCallback,this.pageSizeChangeCallback=this.options.pageSizeChangeCallback,this.pdfjs.promise["catch"](function(_this){return function(exception){return _this.errorCallback(exception)}}(this))}return PDFRenderer.prototype.JOB_QUEUE_INTERVAL=25,PDFRenderer.prototype.PAGE_LOAD_TIMEOUT=6e4,PDFRenderer.prototype.INDICATOR_DELAY1=100,PDFRenderer.prototype.INDICATOR_DELAY2=250,PDFRenderer.prototype.TEXTLAYER_TIMEOUT=100,PDFRenderer.prototype.resetState=function(){var i,j,len,len1,page,ref1,ref2,ref3,ref4,timer;for(this.renderQueue=[],null!=this.queueTimer&&clearTimeout(this.queueTimer),ref1=this.spinTimer||[],i=0,len=ref1.length;len>i;i++)timer=ref1[i],clearTimeout(timer);for(ref2=this.pageState||[],j=0,len1=ref2.length;len1>j;j++)page=ref2[j],null!=page&&null!=(ref3=page.loadTask)&&ref3.cancel(),null!=page&&null!=(ref4=page.renderTask)&&ref4.cancel();return this.pageState=[],this.spinTimer=[],this.spinTimerDone=[],this.jobs=0},PDFRenderer.prototype.getNumPages=function(){return this.document.then(function(pdfDocument){return pdfDocument.numPages})},PDFRenderer.prototype.getPage=function(pageNum){return this.document.then(function(pdfDocument){return pdfDocument.getPage(pageNum)})},PDFRenderer.prototype.getPdfViewport=function(pageNum,scale){return null==scale&&(scale=this.scale),this.document.then(function(_this){return function(pdfDocument){return pdfDocument.getPage(pageNum).then(function(page){var viewport;return viewport=page.getViewport(scale)},function(error){return"function"==typeof _this.errorCallback?_this.errorCallback(error):void 0})}}(this))},PDFRenderer.prototype.getDestinations=function(){return this.document.then(function(pdfDocument){return pdfDocument.getDestinations()})},PDFRenderer.prototype.getDestination=function(dest){return this.document.then(function(pdfDocument){return pdfDocument.getDestination(dest)},function(_this){return function(error){return"function"==typeof _this.errorCallback?_this.errorCallback(error):void 0}}(this))},PDFRenderer.prototype.getPageIndex=function(ref){return this.document.then(function(_this){return function(pdfDocument){return pdfDocument.getPageIndex(ref).then(function(idx){return idx},function(error){return"function"==typeof _this.errorCallback?_this.errorCallback(error):void 0})}}(this))},PDFRenderer.prototype.getScale=function(){return this.scale},PDFRenderer.prototype.setScale=function(scale1){return this.scale=scale1,this.resetState()},PDFRenderer.prototype.triggerRenderQueue=function(interval){return null==interval&&(interval=this.JOB_QUEUE_INTERVAL),null!=this.queueTimer&&clearTimeout(this.queueTimer),this.queueTimer=setTimeout(function(_this){return function(){return _this.queueTimer=null,_this.processRenderQueue()}}(this),interval)},PDFRenderer.prototype.removeCompletedJob=function(pagenum){return this.jobs=this.jobs-1,this.triggerRenderQueue(0)},PDFRenderer.prototype.renderPages=function(pages){var page;if(!this.shuttingDown)return this.renderQueue=function(){var i,len,results;for(results=[],i=0,len=pages.length;len>i;i++)page=pages[i],results.push({element:page.elementChildren,pagenum:page.pageNum});return results}(),this.triggerRenderQueue()},PDFRenderer.prototype.renderPage=function(page){var current;if(!this.shuttingDown)return current={element:page.elementChildren,pagenum:page.pageNum},this.renderQueue.push(current),this.processRenderQueue()},PDFRenderer.prototype.getPageDetails=function(page){return[page.element.canvas,page.pagenum]},PDFRenderer.prototype.startIndicators=function(){var i,j,len,len1,page,pagenum,ref1,ref2,results;for(this.queuedPages=[],ref1=this.renderQueue,i=0,len=ref1.length;len>i;i++)page=ref1[i],this.queuedPages[page.pagenum]=!0;for(pagenum in this.spinTimer)this.queuedPages[pagenum]||(clearTimeout(this.spinTimer[pagenum]),delete this.spinTimer[pagenum]);for(ref2=this.renderQueue,results=[],j=0,len1=ref2.length;len1>j;j++)page=ref2[j],this.spinTimer[page.pagenum]||this.spinTimerDone[page.pagenum]||results.push(this.startIndicator(page));return results},PDFRenderer.prototype.startIndicator=function(page){var canvas,pagenum,ref1;return ref1=this.getPageDetails(page),canvas=ref1[0],pagenum=ref1[1],canvas.addClass("pdfng-loading"),this.spinTimer[pagenum]=setTimeout(function(_this){return function(){var i,len,queuedPage,ref2;for(ref2=_this.renderQueue,i=0,len=ref2.length;len>i;i++)if(queuedPage=ref2[i],pagenum===queuedPage.pagenum){_this.spinner.add(canvas,{"static":!0}),_this.spinTimerDone[pagenum]=!0;break}return delete _this.spinTimer[pagenum]}}(this),this.INDICATOR_DELAY1)},PDFRenderer.prototype.updateIndicator=function(page){var canvas,pagenum,ref1;return ref1=this.getPageDetails(page),canvas=ref1[0],pagenum=ref1[1],this.spinTimerDone[pagenum]?this.spinTimer[pagenum]=setTimeout(function(_this){return function(){return _this.spinner.start(canvas),delete _this.spinTimer[pagenum]}}(this),this.INDICATOR_DELAY2):(clearTimeout(this.spinTimer[pagenum]),this.spinTimer[pagenum]=setTimeout(function(_this){return function(){return _this.spinner.add(canvas,{"static":!0}),_this.spinTimerDone[pagenum]=!0,_this.spinTimer[pagenum]=setTimeout(function(){return _this.spinner.start(canvas),delete _this.spinTimer[pagenum]},_this.INDICATOR_DELAY2)}}(this),this.INDICATOR_DELAY1))},PDFRenderer.prototype.clearIndicator=function(page){var canvas,pagenum,ref1;return ref1=this.getPageDetails(page),canvas=ref1[0],pagenum=ref1[1],this.spinner.stop(canvas),clearTimeout(this.spinTimer[pagenum]),delete this.spinTimer[pagenum],this.spinTimerDone[pagenum]=!0},PDFRenderer.prototype.processRenderQueue=function(){var element,loadTask,page,pageState,pagenum,ref1,timedOut,timer;if(!(this.shuttingDown||(this.startIndicators(),this.jobs>0))){for(page=this.renderQueue.shift();null!=page&&null!=this.pageState[page.pagenum];)page=this.renderQueue.shift();if(null!=page)return ref1=[page.element,page.pagenum],element=ref1[0],pagenum=ref1[1],this.jobs=this.jobs+1,this.updateIndicator(page),timedOut=!1,timer=$timeout(function(_this){return function(){return loadTask.cancelled?void 0:("undefined"!=typeof Raven&&null!==Raven&&"function"==typeof Raven.captureMessage&&Raven.captureMessage("pdfng page load timed out after "+_this.PAGE_LOAD_TIMEOUT+"ms"),timedOut=!0,_this.clearIndicator(page),"function"==typeof _this.errorCallback?_this.errorCallback("timeout"):void 0)}}(this),this.PAGE_LOAD_TIMEOUT),loadTask=this.getPage(pagenum),loadTask.cancel=function(){return this.cancelled=!0},this.pageState[pagenum]=pageState={loadTask:loadTask},loadTask.then(function(_this){return function(pageObject){return $timeout.cancel(timer),loadTask.cancelled?void 0:(pageState.renderTask=_this.doRender(element,pagenum,pageObject),pageState.renderTask.then(function(){return _this.clearIndicator(page),pageState.complete=!0,delete pageState.renderTask,_this.removeCompletedJob(pagenum)},function(){return pageState.complete=!1,delete pageState.renderTask,_this.removeCompletedJob(pagenum)}))}}(this))["catch"](function(_this){return function(error){return $timeout.cancel(timer),_this.clearIndicator(page)}}(this))}},PDFRenderer.prototype.doRender=function(element,pagenum,page){var annotationsLayer,backingStoreRatio,canvas,ctx,devicePixelRatio,newHeight,newWidth,oldHeight,oldWidth,pixelRatio,result,scale,scaledHeight,scaledWidth,self,textLayer,textLayerTimeout,viewport;return self=this,scale=this.scale,null!=scale?(canvas=$('<canvas class="pdf-canvas pdfng-rendering"></canvas>'),element.canvas.replaceWith(canvas),viewport=page.getViewport(scale),devicePixelRatio=window.devicePixelRatio||1,ctx=canvas[0].getContext("2d"),backingStoreRatio=ctx.webkitBackingStorePixelRatio||ctx.mozBackingStorePixelRatio||ctx.msBackingStorePixelRatio||ctx.oBackingStorePixelRatio||ctx.backingStorePixelRatio||1,pixelRatio=devicePixelRatio/backingStoreRatio,scaledWidth=Math.floor(viewport.width)*pixelRatio|0,scaledHeight=Math.floor(viewport.height)*pixelRatio|0,newWidth=Math.floor(viewport.width),newHeight=Math.floor(viewport.height),canvas[0].height=scaledHeight,canvas[0].width=scaledWidth,canvas.height(newHeight+"px"),canvas.width(newWidth+"px"),oldHeight=element.canvas.height(),oldWidth=element.canvas.width(),(newHeight!==oldHeight||newWidth!==oldWidth)&&(element.canvas.height(newHeight+"px"),element.canvas.width(newWidth+"px"),element.container.height(newHeight+"px"),element.container.width(newWidth+"px"),"function"==typeof this.pageSizeChangeCallback&&this.pageSizeChangeCallback(pagenum,newHeight-oldHeight)),textLayer=new pdfTextLayer({textLayerDiv:element.text[0],viewport:viewport,renderer:PDFJS.renderTextLayer}),annotationsLayer=new pdfAnnotations({annotations:element.annotations[0],viewport:viewport,navigateFn:this.navigateFn}),result=page.render({canvasContext:ctx,viewport:viewport,transform:[pixelRatio,0,0,pixelRatio,0,0]}),textLayerTimeout=this.TEXTLAYER_TIMEOUT,result.then(function(){return canvas.removeClass("pdfng-rendering"),page.getTextContent({normalizeWhitespace:!0}).then(function(textContent){return textLayer.setTextContent(textContent),textLayer.render(textLayerTimeout)},function(error){return"function"==typeof self.errorCallback?self.errorCallback(error):void 0}),page.getAnnotations().then(function(annotations){return annotationsLayer.setAnnotations(annotations)},function(error){return"function"==typeof self.errorCallback?self.errorCallback(error):void 0})})["catch"](function(error){return"cancelled"!==error&&"function"==typeof self.errorCallback?self.errorCallback(error):void 0}),result):void 0},PDFRenderer.prototype.destroy=function(){return this.shuttingDown=!0,this.resetState(),this.pdfjs.then(function(document){return document.cleanup(),document.destroy()})},PDFRenderer}()}])})}.call(this),function(){define("ide/pdfng/directives/pdfPage",["base"],function(App){return App.directive("pdfPage",["$timeout","pdfHighlights","pdfSpinner",function($timeout,pdfHighlights,pdfSpinner){return{require:"^pdfViewer",template:'<div class="plv-page-view page-view">\n	<div class="pdf-canvas pdfng-empty"></div>\n	<div class="plv-text-layer text-layer"></div>\n	<div class="plv-annotations-layer annotations-layer"></div>\n	<div class="plv-highlights-layer highlights-layer"></div>\n</div>',link:function(scope,element,attrs,ctrl){var annotationsElement,canvasElement,handler,highlightsElement,highlightsLayer,textElement,updatePageSize;return canvasElement=$(element).find(".pdf-canvas"),textElement=$(element).find(".text-layer"),annotationsElement=$(element).find(".annotations-layer"),highlightsElement=$(element).find(".highlights-layer"),updatePageSize=function(size){var h,w;return h=Math.floor(size[0]),w=Math.floor(size[1]),element.height(h),element.width(w),canvasElement.height(h),canvasElement.width(w),scope.page.sized=!0},scope.page.element=element,scope.page.elementChildren={canvas:canvasElement,text:textElement,annotations:annotationsElement,highlights:highlightsElement,container:element},scope.page.sized||(null!=scope.defaultPageSize?updatePageSize(scope.defaultPageSize):handler=scope.$watch("defaultPageSize",function(defaultPageSize){return null!=defaultPageSize?(updatePageSize(defaultPageSize),handler()):void 0})),scope.page.current&&(scope.document.renderPage(scope.page),ctrl.setPdfPosition(scope.page,scope.page.position)),element.on("dblclick",function(e){var dx,dy,offset;return offset=$(element).find(".pdf-canvas").offset(),dx=e.pageX-offset.left,dy=e.pageY-offset.top,scope.document.getPdfViewport(scope.page.pageNum).then(function(viewport){var event,pdfPoint;return pdfPoint=viewport.convertToPdfPoint(dx,dy),event={page:scope.page.pageNum,x:pdfPoint[0],y:viewport.viewBox[3]-pdfPoint[1]},scope.$emit("pdfDoubleClick",event)})}),highlightsLayer=new pdfHighlights({highlights:highlightsElement}),scope.$on("pdf:highlights",function(event,highlights){var h,pageHighlights;if(null!=highlights&&highlights.length>0&&(scope.timeoutHandler&&($timeout.cancel(scope.timeoutHandler),highlightsLayer.clearHighlights(),scope.timeoutHandler=null),pageHighlights=function(){var i,len,results;for(results=[],i=0,len=highlights.length;len>i;i++)h=highlights[i],h.page===scope.page.pageNum&&results.push(h);return results}(),pageHighlights.length))return scope.document.getPdfViewport(scope.page.pageNum).then(function(viewport){var hl,i,len,results,top;for(results=[],i=0,len=pageHighlights.length;len>i;i++)hl=pageHighlights[i],top=viewport.viewBox[3]-hl.v,results.push(highlightsLayer.addHighlight(viewport,hl.h,top,hl.width,hl.height));return results}),scope.timeoutHandler=$timeout(function(){return highlightsLayer.clearHighlights(),scope.timeoutHandler=null},1e3)}),scope.$on("$destroy",function(){return null!=scope.timeoutHandler?($timeout.cancel(scope.timeoutHandler),highlightsLayer.clearHighlights()):void 0})}}}])})}.call(this),function(){define("ide/pdfng/directives/pdfSpinner",["base"],function(App){return App.factory("pdfSpinner",[function(){var pdfSpinner;return pdfSpinner=function(){function pdfSpinner(){}return pdfSpinner.prototype.add=function(element,options){var size,spinner;return size=64,spinner=$('<div class="pdfng-spinner" style="position: absolute; top: 50%; left:50%; transform: translateX(-50%) translateY(-50%);"><i class="fa fa-spinner'+((null!=options?options["static"]:void 0)?"":" fa-spin")+'" style="color: #999"></i></div>'),spinner.css({"font-size":size+"px"}),element.append(spinner)},pdfSpinner.prototype.start=function(element){return element.find(".fa-spinner").addClass("fa-spin")},pdfSpinner.prototype.stop=function(element){return element.find(".fa-spinner").removeClass("fa-spin")},pdfSpinner.prototype.remove=function(element){return element.find(".fa-spinner").remove()},pdfSpinner}()}])})}.call(this),function(){define("ide/pdfng/directives/pdfViewer",["base","ide/pdfng/directives/pdfTextLayer","ide/pdfng/directives/pdfAnnotations","ide/pdfng/directives/pdfHighlights","ide/pdfng/directives/pdfRenderer","ide/pdfng/directives/pdfPage","ide/pdfng/directives/pdfSpinner"],function(App,pdfTextLayer,pdfAnnotations,pdfHighlights,pdfRenderer,pdfPage,pdfSpinner,pdf){return App.controller("pdfViewerController",["$scope","$q","$timeout","PDFRenderer","$element","pdfHighlights","pdfSpinner",function($scope,$q,$timeout,PDFRenderer,$element,pdfHighlights,pdfSpinner){return this.load=function(){var onDemandLoading,queryStringExists,url;return null!=$scope.document&&$scope.document.destroy(),$scope.loadCount=null!=$scope.loadCount?$scope.loadCount+1:1,url=$scope.pdfSrc,queryStringExists=/\?/.test(url),url=url+(queryStringExists?"&":"?")+"pdfng=true",onDemandLoading=!0,$scope.document=new PDFRenderer(url,{scale:1,disableAutoFetch:onDemandLoading?!0:void 0,navigateFn:function(ref){return $scope.navigateTo=ref,$scope.$apply()},progressCallback:function(progress){return $scope.$emit("progress",progress)},loadedCallback:function(){return $scope.$emit("loaded")},errorCallback:function(error){return"undefined"!=typeof Raven&&null!==Raven&&"function"==typeof Raven.captureMessage&&Raven.captureMessage("pdfng error "+error),$scope.$emit("pdf:error",error)},pageSizeChangeCallback:function(pageNum,deltaH){return $scope.$broadcast("pdf:page:size-change",pageNum,deltaH)}}),$scope.loaded=$q.all({numPages:$scope.document.getNumPages(),pdfViewport:$scope.document.getPdfViewport(1,1)}).then(function(result){return $scope.pdfViewport=result.pdfViewport,$scope.pdfPageSize=[result.pdfViewport.height,result.pdfViewport.width],$scope.$emit("loaded"),$scope.numPages=result.numPages})["catch"](function(error){return $scope.$emit("pdf:error",error),$q.reject(error)})},this.setScale=function(scale,containerHeight,containerWidth){return $scope.loaded.then(function(){var numScale;return null==scale&&(scale={}),0===containerHeight||0===containerWidth?numScale=1:"scale_mode_fit_width"===scale.scaleMode?numScale=(containerWidth-40)/$scope.pdfPageSize[1]:"scale_mode_fit_height"===scale.scaleMode?numScale=(containerHeight-20)/$scope.pdfPageSize[0]:"scale_mode_value"===scale.scaleMode?numScale=scale.scale:"scale_mode_auto"===scale.scaleMode||(scale.scaleMode="scale_mode_fit_width",numScale=(containerWidth-40)/$scope.pdfPageSize[1]),$scope.scale.scale=numScale,$scope.document.setScale(numScale),$scope.defaultPageSize=[numScale*$scope.pdfPageSize[0],numScale*$scope.pdfPageSize[1]]})["catch"](function(error){return $scope.$emit("pdf:error",error),$q.reject(error)})},this.redraw=function(position){var i,pagenum;return $scope.pages=function(){var j,ref1,results;for(results=[],i=j=0,ref1=$scope.numPages-1;ref1>=0?ref1>=j:j>=ref1;i=ref1>=0?++j:--j)results.push({pageNum:i+1});return results}(),null!=position&&null!=position.page?(pagenum=position.page,pagenum>$scope.numPages-1&&(pagenum=$scope.numPages-1),$scope.pages[pagenum].current=!0,$scope.pages[pagenum].position=position):void 0},this.zoomIn=function(){var newScale;return newScale=1.2*$scope.scale.scale,$scope.forceScale={scaleMode:"scale_mode_value",scale:newScale}},this.zoomOut=function(){var newScale;return newScale=$scope.scale.scale/1.2,$scope.forceScale={scaleMode:"scale_mode_value",scale:newScale}},this.fitWidth=function(){return $scope.forceScale={scaleMode:"scale_mode_fit_width"}},this.fitHeight=function(){return $scope.forceScale={scaleMode:"scale_mode_fit_height"}},this.checkPosition=function(){return $scope.forceCheck=($scope.forceCheck||0)+1},this.showRandomHighlights=function(){return $scope.highlights=[{page:3,h:100,v:100,height:30,width:200}]},this.getPdfPosition=function(){var bottom,canvasOffset,newPosition,pdfOffset,scaledOffset,someContentVisible,top,topPage,topPageIdx,topVisible,viewport,viewportBottom,viewportTop,visible;return topPageIdx=0,topPage=$scope.pages[0],visible=$scope.pages.some(function(page,i){var ref1;return page.visible?(ref1=[i,page],topPageIdx=ref1[0],topPage=ref1[1],ref1):void 0}),visible&&null!=topPage.element?(top=topPage.element.offset().top,bottom=top+topPage.element.innerHeight(),viewportTop=$element.offset().top,viewportBottom=viewportTop+$element.height(),topVisible=top>=viewportTop&&viewportBottom>top,someContentVisible=viewportTop>top&&bottom>viewportTop,canvasOffset=topVisible?0:someContentVisible?viewportTop-top:null,topPage.viewport?(viewport=topPage.viewport,pdfOffset=viewport.convertToPdfPoint(0,canvasOffset)):(viewport=$scope.pdfViewport,scaledOffset=canvasOffset/$scope.scale.scale,pdfOffset=viewport.convertToPdfPoint(0,scaledOffset)),newPosition={page:topPageIdx,offset:{top:pdfOffset[1],left:0},pageSize:{height:viewport.viewBox[3],width:viewport.viewBox[2]}}):void 0},this.computeOffset=function(page,position){var currentScroll,element,offset,pageTop,ref1,ref2,t1,t2;return element=page.element,t1=null!=(ref1=$(element).offset())?ref1.top:void 0,t2=null!=(ref2=$(element).parent().offset())?ref2.top:void 0,null==t1||null==t2?$q(function(resolve,reject){return reject("elements destroyed")}):(pageTop=$(element).offset().top-$(element).parent().offset().top,currentScroll=$(element).parent().scrollTop(),offset=position.offset,$scope.document.getPdfViewport(page.pageNum).then(function(viewport){var pageOffset;return page.viewport=viewport,pageOffset=viewport.convertToViewportPoint(offset.left,offset.top),null==position.pageSize&&(position.pageSize={height:viewport.viewBox[3],width:viewport.viewBox[2]}),Math.round(pageTop+pageOffset[1]+currentScroll)}))},this.setPdfPosition=function(page,position){return this.computeOffset(page,position).then(function(offset){return $scope.pleaseScrollTo=offset,$scope.position=position})},this}]),App.directive("pdfViewer",["$q","$timeout","pdfSpinner",function($q,$timeout,pdfSpinner){return{controller:"pdfViewerController",controllerAs:"ctrl",scope:{pdfSrc:"=",highlights:"=",position:"=",scale:"=",pleaseJumpTo:"="},template:"<div data-pdf-page class='pdf-page-container page-container' ng-repeat='page in pages'></div>",link:function(scope,element,attrs,ctrl){var _handleSelectionMouseUp,_hasSelection,_isSelectionWithinPDF,_removeClassIfNoSelection,_setMouseUpHandler,doRescale,elementTimer,getExtraPages,getVisiblePages,layoutReady,layoutTimer,mouseUpHandler,queueLayout,queueRescale,renderVisiblePages,rescaleTimer,scrollHandler,spinner,spinnerTimer,updateLayout;return spinner=new pdfSpinner,layoutReady=$q.defer(),layoutReady.notify("waiting for layout"),layoutReady.promise.then(function(){}),renderVisiblePages=function(){var pages,visiblePages;return visiblePages=getVisiblePages(),pages=getExtraPages(visiblePages),scope.document.renderPages(pages)},getVisiblePages=function(){var bottom,top,visiblePages;return top=element[0].scrollTop,bottom=top+element[0].clientHeight,visiblePages=_.filter(scope.pages,function(page){var pageBottom,pageElement,pageTop;return null==page.element?!1:(pageElement=page.element[0],pageTop=pageElement.offsetTop,pageBottom=pageTop+pageElement.clientHeight,page.visible=bottom>pageTop&&pageBottom>top,page.visible)})},getExtraPages=function(visiblePages){var extra,firstVisiblePage,firstVisiblePageIdx,lastVisiblePage,lastVisiblePageIdx,len;return extra=[],visiblePages.length>0&&(firstVisiblePage=visiblePages[0].pageNum,
firstVisiblePageIdx=firstVisiblePage-1,len=visiblePages.length,lastVisiblePage=visiblePages[len-1].pageNum,lastVisiblePageIdx=lastVisiblePage-1,lastVisiblePageIdx+1<scope.pages.length&&extra.push(scope.pages[lastVisiblePageIdx+1]),firstVisiblePageIdx>0&&extra.push(scope.pages[firstVisiblePageIdx-1]),lastVisiblePageIdx+2<scope.pages.length&&extra.push(scope.pages[lastVisiblePageIdx+2])),visiblePages.concat(extra)},rescaleTimer=null,queueRescale=function(scale){return null!=rescaleTimer||"undefined"!=typeof layoutTimer&&null!==layoutTimer||"undefined"!=typeof elementTimer&&null!==elementTimer?void 0:rescaleTimer=setTimeout(function(){return doRescale(scale),rescaleTimer=null},0)},spinnerTimer=null,doRescale=function(scale){var origposition;if(null!=scale)return origposition=angular.copy(scope.position),null==spinnerTimer&&(spinnerTimer=setTimeout(function(){return spinner.add(element),spinnerTimer=null},100)),layoutReady.promise.then(function(parentSize){var h,w;return h=parentSize[0],w=parentSize[1],ctrl.setScale(scale,h,w).then(function(){return scope.$evalAsync(function(){return spinnerTimer?clearTimeout(spinnerTimer):spinner.remove(element),element.removeClass("pdfjs-viewer-show-text"),ctrl.redraw(origposition),$timeout(renderVisiblePages),scope.loadSuccess=!0})})["catch"](function(error){return scope.$emit("pdf:error",error)})})},elementTimer=null,updateLayout=function(){if(0===element.height()||0===element.width()){if(null!=elementTimer)return;return elementTimer=setTimeout(function(){return elementTimer=null,updateLayout()},1e3)}return scope.parentSize=[element.innerHeight(),element.innerWidth()],$timeout(function(){return layoutReady.resolve(scope.parentSize),scope.$emit("flash-controls")})},layoutTimer=null,queueLayout=function(){return null==layoutTimer?(layoutReady=$q.defer(),layoutTimer=setTimeout(function(){return updateLayout(),layoutTimer=null},0)):void 0},queueLayout(),scope.$on("layout:main:resize",function(){return queueLayout()}),scope.$on("layout:pdf:resize",function(){return queueLayout()}),scope.$on("pdf:error",function(event,error){var message;if("cancelled"!==error)return message=(null!=error?error.message:void 0)||error,scope.loadCount>3||/^Missing PDF/i.test(message)||/^loading/i.test(message)?void scope.$emit("pdf:error:display"):scope.loadSuccess?ctrl.load().then(function(){return scope.scale=angular.copy(scope.scale)})["catch"](function(error){return scope.$emit("pdf:error:display")}):void scope.$emit("pdf:error:display")}),scope.$on("pdf:page:size-change",function(event,pageNum,delta){var currentScrollTop,origposition;return origposition=angular.copy(scope.position),null!=origposition&&pageNum-1<origposition.page&&0!==delta?(currentScrollTop=element.scrollTop(),scope.adjustingScroll=!0,element.scrollTop(currentScrollTop+delta)):void 0}),element.on("mousedown",function(e){return e.target===element[0]||_hasSelection()?void 0:(element.addClass("pdfjs-viewer-show-text"),_setMouseUpHandler())}),mouseUpHandler=null,_setMouseUpHandler=function(){return null==mouseUpHandler?mouseUpHandler=$(document.body).one("mouseup",_handleSelectionMouseUp):void 0},_handleSelectionMouseUp=function(){return mouseUpHandler=null,window.setTimeout(function(){var removedClass;return removedClass=_removeClassIfNoSelection(),removedClass?void 0:_setMouseUpHandler()},10),!0},_removeClassIfNoSelection=function(){return _hasSelection()?!1:(element.removeClass("pdfjs-viewer-show-text"),!0)},_hasSelection=function(){var selection;return selection="function"==typeof window.getSelection?window.getSelection():void 0,null!=selection&&_isSelectionWithinPDF(selection)&&!selection.isCollapsed},_isSelectionWithinPDF=function(selection){var selectionAncestorNode;return 0===selection.rangeCount?!1:(selectionAncestorNode=selection.getRangeAt(0).commonAncestorContainer,element.find(selectionAncestorNode).length>0||element.is(selectionAncestorNode))},element.on("scroll",function(){return scope.adjustingScroll?(renderVisiblePages(),void(scope.adjustingScroll=!1)):(scope.scrollHandlerTimeout&&clearTimeout(scope.scrollHandlerTimeout),scope.scrollHandlerTimeout=setTimeout(scrollHandler,25))}),scrollHandler=function(){var newPosition;return renderVisiblePages(),newPosition=ctrl.getPdfPosition(),null!=newPosition&&(scope.position=newPosition),scope.scrollHandlerTimeout=null},scope.$watch("pdfSrc",function(newVal,oldVal){return null!=newVal?(scope.loadCount=0,scope.loadSuccess=!1,ctrl.load().then(function(){return scope.scale=angular.copy(scope.scale)})["catch"](function(error){return scope.$emit("pdf:error",error)})):void 0}),scope.$watch("scale",function(newVal,oldVal){return newVal!==oldVal?queueRescale(newVal):void 0}),scope.$watch("forceScale",function(newVal,oldVal){return null!=newVal?queueRescale(newVal):void 0}),scope.$watch("forceCheck",function(newVal,oldVal){return null!=newVal?(scope.adjustingScroll=!0,queueRescale(scope.scale)):void 0}),scope.$watch("parentSize",function(newVal,oldVal){return null!=newVal?queueRescale(scope.scale):void 0},!0),scope.$watch("pleaseScrollTo",function(newVal,oldVal){return null!=newVal?(scope.adjustingScroll=!0,$(element).scrollTop(newVal),scope.pleaseScrollTo=void 0):void 0}),scope.$watch("pleaseJumpTo",function(newPosition,oldPosition){return null!=newPosition?ctrl.setPdfPosition(scope.pages[newPosition.page-1],newPosition):void 0}),scope.$watch("navigateTo",function(newVal,oldVal){return null!=newVal?(scope.navigateTo=void 0,scope.document.getDestination(newVal.dest).then(function(r){return scope.document.getPageIndex(r[0]).then(function(pidx){var page;return page=scope.pages[pidx],scope.document.getPdfViewport(page.pageNum).then(function(viewport){var coords,newPosition;return coords=viewport.convertToViewportPoint(r[2],r[3]),"XYZ"===r[1].name?(newPosition={page:pidx,offset:{top:r[3],left:r[2]}},ctrl.setPdfPosition(scope.pages[pidx],newPosition)):void 0})})})):void 0}),scope.$watch("highlights",function(areas){var area,first,highlights,pageNum,ref1;if(null!=areas&&(highlights=function(){var j,len1,ref1,results;for(ref1=areas||[],results=[],j=0,len1=ref1.length;len1>j;j++)area=ref1[j],results.push({page:area.page-1,highlight:{left:area.h,top:area.v,height:area.height,width:area.width}});return results}(),highlights.length&&(scope.$broadcast("pdf:highlights",areas),first=highlights[0],scope.pages&&(pageNum=null!=(ref1=scope.pages[first.page])?ref1.pageNum:void 0,null!=pageNum))))return scope.document.getPdfViewport(pageNum).then(function(viewport){var position;return position={page:first.page,offset:{left:first.highlight.left,top:viewport.viewBox[3]-first.highlight.top+first.highlight.height+72}},ctrl.setPdfPosition(scope.pages[first.page],position)})}),scope.$on("$destroy",function(){return null!=elementTimer&&clearTimeout(elementTimer),null!=layoutTimer&&clearTimeout(layoutTimer),null!=rescaleTimer&&clearTimeout(rescaleTimer),null!=spinnerTimer?clearTimeout(spinnerTimer):void 0})}}}])})}.call(this),function(){define("ide/pdfng/directives/pdfJs",["base","ide/pdfng/directives/pdfViewer"],function(App,pdfViewer){return App.directive("pdfng",["$timeout","localStorage",function($timeout,localStorage){return{scope:{pdfSrc:"=",highlights:"=",position:"=",dblClickCallback:"="},link:function(scope,element,attrs){var event,flashControls,i,initializePosition,initializedPosition,len,ref;if(scope.loading=!1,scope.pleaseJumpTo=null,scope.scale=null,initializedPosition=!1,initializePosition=function(){var position,scale;if(!initializedPosition)return initializedPosition=!0,null!=(scale=localStorage("pdf.scale"))?scope.scale={scaleMode:scale.scaleMode,scale:+scale.scale}:scope.scale={scaleMode:"scale_mode_fit_width"},(position=localStorage("pdf.position."+attrs.key))&&(scope.position={page:+position.page,offset:{top:+position.offset.top,left:+position.offset.left}}),scope.$on("$destroy",function(_this){return function(){return localStorage("pdf.scale",scope.scale),localStorage("pdf.position."+attrs.key,scope.position)}}(this)),$(window).unload(function(_this){return function(){return localStorage("pdf.scale",scope.scale),localStorage("pdf.position."+attrs.key,scope.position)}}(this))},flashControls=function(){return scope.$evalAsync(function(){return scope.flashControls=!0,$timeout(function(){return scope.flashControls=!1},1e3)})},scope.$on("pdfDoubleClick",function(event,e){return"function"==typeof scope.dblClickCallback?scope.dblClickCallback({page:e.page-1,offset:{top:e.y,left:e.x}}):void 0}),scope.$on("flash-controls",function(){return flashControls()}),scope.$watch("pdfSrc",function(url){return url?(scope.loading=!0,scope.loaded=!1,scope.progress=1,initializePosition(),flashControls()):void 0}),scope.$on("loaded",function(){return scope.loaded=!0,scope.progress=100,$timeout(function(){return scope.loading=!1,delete scope.progress},500)}),scope.fitToHeight=function(){var scale;return scale=angular.copy(scope.scale),scale.scaleMode="scale_mode_fit_height",scope.scale=scale},scope.fitToWidth=function(){var scale;return scale=angular.copy(scope.scale),scale.scaleMode="scale_mode_fit_width",scope.scale=scale},scope.zoomIn=function(){var scale;return scale=angular.copy(scope.scale),scale.scaleMode="scale_mode_value",scale.scale=1.2*scale.scale,scope.scale=scale},scope.zoomOut=function(){var scale;return scale=angular.copy(scope.scale),scale.scaleMode="scale_mode_value",scale.scale=scale.scale/1.2,scope.scale=scale},null!=attrs.resizeOn)for(ref=attrs.resizeOn.split(","),i=0,len=ref.length;len>i;i++)event=ref[i],scope.$on(event,function(e){});return scope.$on("progress",function(event,progress){return scope.$apply(function(){return scope.loaded?void 0:(scope.progress=Math.floor(progress.loaded/progress.total*100),scope.progress>100&&(scope.progress=100),scope.progress<0?scope.progress=0:void 0)})}),scope.$on("$destroy",function(){})},template:'<div data-pdf-viewer class="pdfjs-viewer" pdf-src=\'pdfSrc\' position=\'position\' scale=\'scale\' highlights=\'highlights\' please-jump-to=\'pleaseJumpTo\'></div>\n<div class="pdfjs-controls" ng-class="{\'flash\': flashControls }">\n	<div class="btn-group">\n		<a href\n			class="btn btn-info btn-lg"\n			ng-click="fitToWidth()"\n			tooltip="Fit to Width"\n			tooltip-append-to-body="true"\n			tooltip-placement="bottom"\n		>\n			<i class="fa fa-fw fa-arrows-h"></i>\n		</a>\n		<a href\n			class="btn btn-info btn-lg"\n			ng-click="fitToHeight()"\n			tooltip="Fit to Height"\n			tooltip-append-to-body="true"\n			tooltip-placement="bottom"\n		>\n			<i class="fa fa-fw fa-arrows-v"></i>\n		</a>\n		<a href\n			class="btn btn-info btn-lg"\n			ng-click="zoomIn()"\n			tooltip="Zoom In"\n			tooltip-append-to-body="true"\n			tooltip-placement="bottom"\n		>\n			<i class="fa fa-fw fa-search-plus"></i>\n		</a>\n		<a href\n			class="btn btn-info btn-lg"\n			ng-click="zoomOut()"\n			tooltip="Zoom Out"\n			tooltip-append-to-body="true"\n			tooltip-placement="bottom"\n		>\n			<i class="fa fa-fw fa-search-minus"></i>\n		</a>\n	</div>\n</div>\n<div class="progress-thin" ng-show="loading">\n	<div class="progress-bar" ng-style="{ \'width\': progress + \'%\' }"></div>\n</div>'}}])})}.call(this),function(){define("ide/pdf/PdfManager",["ide/pdf/controllers/PdfController","ide/pdf/controllers/PdfViewToggleController","ide/pdfng/directives/pdfJs"],function(){var PdfManager;return PdfManager=function(){function PdfManager(ide,$scope){this.ide=ide,this.$scope=$scope,this.$scope.pdf={url:null,error:!1,timeout:!1,failure:!1,compiling:!1,uncompiled:!0,logEntries:[],logEntryAnnotations:{},rawLog:"",view:null,showRawLog:!1,highlights:[],position:null}}return PdfManager}()})}.call(this),function(){define("ide/binary-files/controllers/BinaryFileController",["base","moment"],function(App,moment){return App.controller("BinaryFileController",["$scope","$rootScope","$http","$timeout","$element","ide","waitFor",function($scope,$rootScope,$http,$timeout,$element,ide,waitFor){var FILLER,FRONT_OF_URL_LENGTH,MAX_URL_LENGTH,TAIL_OF_URL_LENGTH,TWO_MEGABYTES,extension,imageExtentions,loadTextFileFilePreview,previewableExtensions,setHeight,textExtensions;return TWO_MEGABYTES=2097152,textExtensions=["bib","tex","txt","cls","sty"],imageExtentions=["png","jpg","jpeg","gif"],previewableExtensions=["eps","pdf"],extension=function(file){var ref;return null!=(ref=file.name.split(".").pop())?ref.toLowerCase():void 0},$scope.isTextFile=function(_this){return function(){return textExtensions.indexOf(extension($scope.openFile))>-1}}(this),$scope.isImageFile=function(_this){return function(){return imageExtentions.indexOf(extension($scope.openFile))>-1}}(this),$scope.isPreviewableFile=function(_this){return function(){return previewableExtensions.indexOf(extension($scope.openFile))>-1}}(this),$scope.isUnpreviewableFile=function(){return!$scope.isTextFile()&&!$scope.isImageFile()&&!$scope.isPreviewableFile()},$scope.textPreview={loading:!1,shouldShowDots:!1,error:!1,data:null},$scope.refreshing=!1,$scope.refreshError=null,MAX_URL_LENGTH=60,FRONT_OF_URL_LENGTH=35,FILLER="...",TAIL_OF_URL_LENGTH=MAX_URL_LENGTH-FRONT_OF_URL_LENGTH-FILLER.length,$scope.displayUrl=function(url){var front,tail;if(null!=url)return url.length>MAX_URL_LENGTH?(front=url.slice(0,FRONT_OF_URL_LENGTH),tail=url.slice(url.length-TAIL_OF_URL_LENGTH),front+FILLER+tail):url},$scope.refreshFile=function(file){return $scope.refreshing=!0,$scope.refreshError=null,ide.fileTreeManager.refreshLinkedFile(file).then(function(response){var data,new_file_id;return data=response.data,new_file_id=data.new_file_id,$timeout(function(){return waitFor(function(){return ide.fileTreeManager.findEntityById(new_file_id)},5e3).then(function(newFile){return ide.binaryFilesManager.openFile(newFile)})["catch"](function(err){return console.warn(err)})},0),$scope.refreshError=null})["catch"](function(response){return $scope.refreshError=response.data})["finally"](function(){return $scope.refreshing=!1})},$scope.failedLoad=!1,window.sl_binaryFilePreviewError=function(_this){return function(){return $scope.failedLoad=!0,$scope.$apply()}}(this),$scope.imgLoaded=!1,window.sl_binaryFilePreviewLoaded=function(_this){return function(){return $scope.imgLoaded=!0,$scope.$apply()}}(this),(loadTextFileFilePreview=function(){var url;if($scope.isTextFile())return url="/project/"+project_id+"/file/"+$scope.openFile.id+"?range=0-"+TWO_MEGABYTES,$scope.textPreview.data=null,$scope.textPreview.loading=!0,$scope.textPreview.shouldShowDots=!1,$scope.$apply(),$http({url:url,method:"GET",transformResponse:null}).then(function(response){var data;return data=response.data,$scope.textPreview.error=!1,data.length>=TWO_MEGABYTES-200&&($scope.textPreview.shouldShowDots=!0,data=null!=data&&"function"==typeof data.replace?data.replace(/\n.*$/,""):void 0),$scope.textPreview.data=data,$timeout(setHeight,0)})["catch"](function(error){return console.error(error),$scope.textPreview.error=!0,$scope.textPreview.loading=!1})})(),setHeight=function(){var $footer,$preview,maxHeight;return $preview=$element.find(".text-preview .scroll-container"),$footer=$element.find(".binary-file-footer"),maxHeight=$element.height()-$footer.height()-14,$preview.css({"max-height":maxHeight}),$scope.textPreview.loading=!1}}])})}.call(this),function(){define("ide/binary-files/BinaryFilesManager",["ide/binary-files/controllers/BinaryFileController"],function(){var BinaryFilesManager;return BinaryFilesManager=function(){function BinaryFilesManager(ide,$scope){this.ide=ide,this.$scope=$scope,this.$scope.$on("entity:selected",function(_this){return function(event,entity){return"track-changes"!==_this.$scope.ui.view&&"file"===entity.type?_this.openFile(entity):void 0}}(this))}return BinaryFilesManager.prototype.openFile=function(file){return this.ide.fileTreeManager.selectEntity(file),this.$scope.ui.view="file",this.$scope.openFile=null,this.$scope.$apply(),window.setTimeout(function(_this){return function(){return _this.$scope.openFile=file,_this.$scope.$apply()}}(this),0,this)},BinaryFilesManager}()})}.call(this),function(){define("ide/references/ReferencesManager",[],function(){var ReferencesManager;return ReferencesManager=function(){function ReferencesManager(ide,$scope){this.ide=ide,this.$scope=$scope,this.$scope.$root._references=this.state={keys:[]},this.$scope.$on("document:closed",function(_this){return function(e,doc){var entity,ref;return doc.doc_id&&(entity=_this.ide.fileTreeManager.findEntityById(doc.doc_id)),(null!=entity&&null!=(ref=entity.name)?ref.match(/.*\.bib$/):void 0)?_this.indexReferences([doc.doc_id],!0):void 0}}(this)),this.$scope.$on("references:should-reindex",function(_this){return function(e,data){return _this.indexAllReferences(!0)}}(this)),this.inited=!1,this.$scope.$on("project:joined",function(_this){return function(e){return _this.inited?void 0:(_this.inited=!0,_this.indexAllReferences(!1))}}(this)),setTimeout(function(self){return self.ide.socket.on("references:keys:updated",function(keys){return self._storeReferencesKeys(keys)})},1e3,this)}return ReferencesManager.prototype._storeReferencesKeys=function(newKeys){var oldKeys;return oldKeys=this.$scope.$root._references.keys,this.$scope.$root._references.keys=_.union(oldKeys,newKeys)},ReferencesManager.prototype.indexReferences=function(docIds,shouldBroadcast){var opts;return opts={docIds:docIds,shouldBroadcast:shouldBroadcast,_csrf:window.csrfToken},this.ide.$http.post("/project/"+this.$scope.project_id+"/references/index",opts).then(function(_this){return function(response){return _this._storeReferencesKeys(response.data.keys)}}(this))},ReferencesManager.prototype.indexAllReferences=function(shouldBroadcast){var opts;return opts={shouldBroadcast:shouldBroadcast,_csrf:window.csrfToken},this.ide.$http.post("/project/"+this.$scope.project_id+"/references/indexAll",opts).then(function(_this){return function(response){return _this._storeReferencesKeys(response.data.keys)}}(this))},ReferencesManager}()})}.call(this),function(){define("ide/metadata/MetadataManager",[],function(){var MetadataManager;return MetadataManager=function(){function MetadataManager(ide,$scope,metadata){this.ide=ide,this.$scope=$scope,this.metadata=metadata,this.ide.socket.on("broadcastDocMeta",function(_this){return function(data){return _this.metadata.onBroadcastDocMeta(data)}}(this)),this.$scope.$on("entity:deleted",this.metadata.onEntityDeleted),this.$scope.$on("file:upload:complete",this.metadata.fileUploadComplete)}return MetadataManager.prototype.loadProjectMetaFromServer=function(){return this.metadata.loadProjectMetaFromServer()},MetadataManager}()})}.call(this),function(){define("ide/review-panel/controllers/ReviewPanelController",["base","utils/EventEmitter","ide/colors/ColorManager","ide/review-panel/RangesTracker"],function(App,EventEmitter,ColorManager,RangesTracker){return App.controller("ReviewPanelController",function($scope,$element,ide,$timeout,$http,$modal,event_tracking,localStorage){var $reviewPanelEl,UserTCSyncState,UserTypes,_doAcceptChanges,_doRejectChanges,_inited,_onCommentDeleted,_onCommentEdited,_onCommentReopened,_onCommentResolved,_onThreadDeleted,_refreshedForUserIds,_refreshingRangeUsers,_setEveryoneTCState,_setGuestsTCState,_setUserTCState,_threadsLoaded,applyClientTrackChangesStateToServer,applyTrackChangesStateToClient,bulkAccept,bulkReject,currentUserType,ensureThreadsAreLoaded,formatComment,formatUser,getChangeTracker,getDocEntries,getDocResolvedComments,getThread,onToggleTrackChangesForGuestsAvailability,rangesTrackers,refreshChangeUsers,refreshOverviewPanel,refreshRanges,regenerateTrackChangesId,scrollbar,setGuestFeatureBasedOnProjectAccessLevel,showBulkActionsDialog,updateEntries,updateScrollbar;return $reviewPanelEl=$element.find("#review-panel"),UserTypes={MEMBER:"member",GUEST:"guest",ANONYMOUS:"anonymous"},currentUserType=function(){var i,len,member,project,ref,ref1,ref2,user_id;if(null==(null!=(ref=ide.$scope.user)?ref.id:void 0))return UserTypes.ANONYMOUS;if(user_id=ide.$scope.user.id,project=ide.$scope.project,(null!=(ref1=project.owner)?ref1.id:void 0)===user_id)return UserTypes.MEMBER;for(ref2=project.members,i=0,len=ref2.length;len>i;i++)if(member=ref2[i],member._id===user_id)return UserTypes.MEMBER;return UserTypes.GUEST},$scope.SubViews={CUR_FILE:"cur_file",OVERVIEW:"overview"},$scope.UserTCSyncState=UserTCSyncState={SYNCED:"synced",PENDING:"pending"},$scope.reviewPanel={trackChangesState:{},trackChangesOnForEveryone:!1,trackChangesOnForGuests:!1,trackChangesForGuestsAvailable:!1,entries:{},resolvedComments:{},hasEntries:!1,subView:$scope.SubViews.CUR_FILE,openSubView:$scope.SubViews.CUR_FILE,overview:{loading:!1,docsCollapsedState:JSON.parse(localStorage("docs_collapsed_state:"+$scope.project_id))||{}},dropdown:{loading:!1},commentThreads:{},resolvedThreadIds:{},rendererData:{},formattedProjectMembers:{},fullTCStateCollapsed:!0,loadingThreads:!1,selectedEntryIds:[],nVisibleSelectedChanges:0},window.addEventListener("beforeunload",function(){var collapsedStates,doc,ref,state,valToStore;collapsedStates={},ref=$scope.reviewPanel.overview.docsCollapsedState;for(doc in ref)state=ref[doc],state&&(collapsedStates[doc]=state);return valToStore=Object.keys(collapsedStates).length>0?JSON.stringify(collapsedStates):null,localStorage("docs_collapsed_state:"+$scope.project_id,valToStore)}),$scope.$on("layout:pdf:linked",function(event,state){return $scope.$broadcast("review-panel:layout")}),$scope.$on("layout:pdf:resize",function(event,state){return $scope.$broadcast("review-panel:layout",!1)}),$scope.$on("expandable-text-area:resize",function(event){return $timeout(function(){return $scope.$broadcast("review-panel:layout")})}),$scope.$on("review-panel:sizes",function(e,sizes){return $scope.$broadcast("editor:set-scroll-size",sizes)}),$scope.$watch("project.features.trackChangesVisible",function(visible){return null!=visible?visible?void 0:$scope.ui.reviewPanelOpen=!1:void 0}),$scope.$watch("project.members",function(members){var i,len,member,ref,ref1,results;if($scope.reviewPanel.formattedProjectMembers={},null!=(null!=(ref=$scope.project)?ref.owner:void 0)&&($scope.reviewPanel.formattedProjectMembers[$scope.project.owner._id]=formatUser($scope.project.owner)),null!=(null!=(ref1=$scope.project)?ref1.members:void 0)){for(results=[],i=0,len=members.length;len>i;i++)member=members[i],"readAndWrite"===member.privileges?results.push($scope.reviewPanel.formattedProjectMembers[member._id]=formatUser(member)):results.push(void 0);return results}}),$scope.commentState={adding:!1,content:""},$scope.users={},$scope.reviewPanelEventsBridge=new EventEmitter,ide.socket.on("new-comment",function(thread_id,comment){var thread;return thread=getThread(thread_id),delete thread.submitting,thread.messages.push(formatComment(comment)),$scope.$apply(),$timeout(function(){return $scope.$broadcast("review-panel:layout")})}),ide.socket.on("accept-changes",function(doc_id,change_ids){return doc_id!==$scope.editor.open_doc_id?getChangeTracker(doc_id).removeChangeIds(change_ids):$scope.$broadcast("changes:accept",change_ids),updateEntries(doc_id),$scope.$apply(function(){})}),ide.socket.on("resolve-thread",function(thread_id,user){return _onCommentResolved(thread_id,user)}),ide.socket.on("reopen-thread",function(thread_id){return _onCommentReopened(thread_id)}),ide.socket.on("delete-thread",function(thread_id){return _onThreadDeleted(thread_id),$scope.$apply(function(){})}),ide.socket.on("edit-message",function(thread_id,message_id,content){return _onCommentEdited(thread_id,message_id,content),$scope.$apply(function(){})}),ide.socket.on("delete-message",function(thread_id,message_id){return _onCommentDeleted(thread_id,message_id),$scope.$apply(function(){})}),rangesTrackers={},getDocEntries=function(doc_id){var base;return null==(base=$scope.reviewPanel.entries)[doc_id]&&(base[doc_id]={}),$scope.reviewPanel.entries[doc_id]},getDocResolvedComments=function(doc_id){var base;return null==(base=$scope.reviewPanel.resolvedComments)[doc_id]&&(base[doc_id]={}),$scope.reviewPanel.resolvedComments[doc_id]},getThread=function(thread_id){var base;return null==(base=$scope.reviewPanel.commentThreads)[thread_id]&&(base[thread_id]={messages:[]}),$scope.reviewPanel.commentThreads[thread_id]},getChangeTracker=function(doc_id){return null==rangesTrackers[doc_id]&&(rangesTrackers[doc_id]=new RangesTracker,rangesTrackers[doc_id].resolvedThreadIds=$scope.reviewPanel.resolvedThreadIds),rangesTrackers[doc_id]},scrollbar={},$scope.reviewPanelEventsBridge.on("aceScrollbarVisibilityChanged",function(isVisible,scrollbarWidth){return scrollbar={isVisible:isVisible,scrollbarWidth:scrollbarWidth},updateScrollbar()}),updateScrollbar=function(){return scrollbar.isVisible&&$scope.reviewPanel.subView===$scope.SubViews.CUR_FILE&&!$scope.editor.showRichText?$reviewPanelEl.css("right",scrollbar.scrollbarWidth+"px"):$reviewPanelEl.css("right","0")},$scope.$watch("!ui.reviewPanelOpen && reviewPanel.hasEntries",function(open,prevVal){return null!=open?($scope.ui.miniReviewPanelVisible=open,open!==prevVal?$timeout(function(){return $scope.$broadcast("review-panel:toggle")}):void 0):void 0}),$scope.$watch("ui.reviewPanelOpen",function(open){return null!=open?(open?$scope.reviewPanel.subView=$scope.reviewPanel.openSubView:($scope.reviewPanel.openSubView=$scope.reviewPanel.subView,$scope.reviewPanel.subView=$scope.SubViews.CUR_FILE),$timeout(function(){return $scope.$broadcast("review-panel:toggle"),$scope.$broadcast("review-panel:layout",!1)})):void 0}),$scope.$watch("reviewPanel.subView",function(view){return null!=view?(updateScrollbar(),view===$scope.SubViews.OVERVIEW?refreshOverviewPanel():void 0):void 0}),$scope.$watch("editor.sharejs_doc",function(doc,old_doc){return null!=doc?(rangesTrackers[doc.doc_id]=doc.ranges,rangesTrackers[doc.doc_id].resolvedThreadIds=$scope.reviewPanel.resolvedThreadIds,$scope.reviewPanel.rangesTracker=rangesTrackers[doc.doc_id],null!=old_doc&&old_doc.off("flipped_pending_to_inflight"),doc.on("flipped_pending_to_inflight",function(){return regenerateTrackChangesId(doc)}),regenerateTrackChangesId(doc)):void 0}),$scope.$watch(function(){var entries,entry,entryData,permEntries;entries=$scope.reviewPanel.entries[$scope.editor.open_doc_id]||{},permEntries={};for(entry in entries)entryData=entries[entry],"add-comment"!==entry&&"bulk-actions"!==entry&&(permEntries[entry]=entryData);return Object.keys(permEntries).length},function(nEntries){return $scope.reviewPanel.hasEntries=nEntries>0&&$scope.project.features.trackChangesVisible}),regenerateTrackChangesId=function(doc){var new_id,old_id;return old_id=getChangeTracker(doc.doc_id).getIdSeed(),new_id=RangesTracker.generateIdSeed(),getChangeTracker(doc.doc_id).setIdSeed(new_id),doc.setTrackChangesIdSeeds({pending:new_id,inflight:old_id})},refreshRanges=function(){return $http.get("/project/"+$scope.project_id+"/ranges").then(function(response){var doc,docs,i,len,rangesTracker,ref,ref1,results;for(docs=response.data,results=[],i=0,len=docs.length;len>i;i++)doc=docs[i],null==$scope.reviewPanel.overview.docsCollapsedState[doc.id]&&($scope.reviewPanel.overview.docsCollapsedState[doc.id]=!1),doc.id!==$scope.editor.open_doc_id&&(rangesTracker=getChangeTracker(doc.id),rangesTracker.comments=(null!=(ref=doc.ranges)?ref.comments:void 0)||[],rangesTracker.changes=(null!=(ref1=doc.ranges)?ref1.changes:void 0)||[]),results.push(updateEntries(doc.id));return results})},refreshOverviewPanel=function(){return $scope.reviewPanel.overview.loading=!0,refreshRanges().then(function(){return $scope.reviewPanel.overview.loading=!1})["catch"](function(){return $scope.reviewPanel.overview.loading=!1})},$scope.refreshResolvedCommentsDropdown=function(){var q;return $scope.reviewPanel.dropdown.loading=!0,q=refreshRanges(),q.then(function(){return $scope.reviewPanel.dropdown.loading=!1}),q["catch"](function(){return $scope.reviewPanel.dropdown.loading=!1}),q},updateEntries=function(doc_id){var _,change,change_id,changed,comment,delete_changes,entries,entry_id,i,id,j,k,key,l,len,len1,len2,len3,name1,name2,name3,new_comment,new_entry,potential_aggregate,prev_insertion,rangesTracker,ref,ref1,ref2,ref3,resolvedComments,value;rangesTracker=getChangeTracker(doc_id),entries=getDocEntries(doc_id),resolvedComments=getDocResolvedComments(doc_id),changed=!1,delete_changes={};for(id in entries)if(change=entries[id],"add-comment"!==id&&"bulk-actions"!==id)for(ref=change.entry_ids,i=0,len=ref.length;len>i;i++)entry_id=ref[i],delete_changes[entry_id]=!0;for(id in resolvedComments)for(change=resolvedComments[id],ref1=change.entry_ids,j=0,len1=ref1.length;len1>j;j++)entry_id=ref1[j],delete_changes[entry_id]=!0;for(potential_aggregate=!1,prev_insertion=null,ref2=rangesTracker.changes,k=0,len2=ref2.length;len2>k;k++){if(change=ref2[k],changed=!0,potential_aggregate&&change.op.d&&change.op.p===prev_insertion.op.p+prev_insertion.op.i.length&&change.metadata.user_id===prev_insertion.metadata.user_id)entries[prev_insertion.id].type="aggregate-change",entries[prev_insertion.id].metadata.replaced_content=change.op.d,entries[prev_insertion.id].entry_ids.push(change.id);else{null==entries[name1=change.id]&&(entries[name1]={}),delete delete_changes[change.id],new_entry={type:change.op.i?"insert":"delete",entry_ids:[change.id],content:change.op.i||change.op.d,offset:change.op.p,metadata:change.metadata};for(key in new_entry)value=new_entry[key],entries[change.id][key]=value}change.op.i?(potential_aggregate=!0,prev_insertion=change):(potential_aggregate=!1,prev_insertion=null),null==$scope.users[change.metadata.user_id]&&refreshChangeUsers(change.metadata.user_id)}for(rangesTracker.comments.length>0&&ensureThreadsAreLoaded(),ref3=rangesTracker.comments,l=0,len3=ref3.length;len3>l;l++){comment=ref3[l],changed=!0,delete delete_changes[comment.id],$scope.reviewPanel.resolvedThreadIds[comment.op.t]?(new_comment=null!=resolvedComments[name2=comment.id]?resolvedComments[name2]:resolvedComments[name2]={},delete entries[comment.id]):(new_comment=null!=entries[name3=comment.id]?entries[name3]:entries[name3]={},delete resolvedComments[comment.id]),new_entry={type:"comment",thread_id:comment.op.t,entry_ids:[comment.id],content:comment.op.c,offset:comment.op.p};for(key in new_entry)value=new_entry[key],new_comment[key]=value}for(change_id in delete_changes)_=delete_changes[change_id],changed=!0,delete entries[change_id],delete resolvedComments[change_id];return changed?$scope.$broadcast("entries:changed"):void 0},$scope.$on("editor:track-changes:changed",function(){var doc_id;return doc_id=$scope.editor.open_doc_id,updateEntries(doc_id),$scope.$broadcast("review-panel:recalculate-screen-positions"),$scope.$broadcast("review-panel:layout")}),$scope.$on("editor:track-changes:visibility_changed",function(){return $timeout(function(){return $scope.$broadcast("review-panel:layout",!1)})}),$scope.$on("editor:focus:changed",function(e,selection_offset_start,selection_offset_end,selection){var doc_id,entries,entry,entry_id,i,id,isChangeEntryAndWithinSelection,len,ref,ref1,ref2;doc_id=$scope.editor.open_doc_id,entries=getDocEntries(doc_id),$scope.reviewPanel.selectedEntryIds=[],$scope.reviewPanel.nVisibleSelectedChanges=0,delete entries["add-comment"],delete entries["bulk-actions"],selection&&(entries["add-comment"]={type:"add-comment",offset:selection_offset_start,length:selection_offset_end-selection_offset_start},entries["bulk-actions"]={type:"bulk-actions",offset:selection_offset_start,length:selection_offset_end-selection_offset_start});for(id in entries)if(entry=entries[id],isChangeEntryAndWithinSelection=!1,"comment"!==entry.type||$scope.reviewPanel.resolvedThreadIds[entry.thread_id]?"insert"===entry.type?(isChangeEntryAndWithinSelection=entry.offset>=selection_offset_start&&entry.offset+entry.content.length<=selection_offset_end,entry.focused=entry.offset<=selection_offset_start&&selection_offset_start<=entry.offset+entry.content.length):"delete"===entry.type?(isChangeEntryAndWithinSelection=selection_offset_start<=(ref=entry.offset)&&selection_offset_end>=ref,entry.focused=entry.offset===selection_offset_start):"aggregate-change"===entry.type?(isChangeEntryAndWithinSelection=entry.offset>=selection_offset_start&&entry.offset+entry.content.length<=selection_offset_end,
entry.focused=entry.offset<=selection_offset_start&&selection_offset_start<=entry.offset+entry.content.length):"add-comment"!==(ref1=entry.type)&&"bulk-actions"!==ref1||!selection||(entry.focused=!0):entry.focused=entry.offset<=selection_offset_start&&selection_offset_start<=entry.offset+entry.content.length,isChangeEntryAndWithinSelection){for(ref2=entry.entry_ids,i=0,len=ref2.length;len>i;i++)entry_id=ref2[i],$scope.reviewPanel.selectedEntryIds.push(entry_id);$scope.reviewPanel.nVisibleSelectedChanges++}return $scope.$broadcast("review-panel:recalculate-screen-positions"),$scope.$broadcast("review-panel:layout")}),$scope.acceptChanges=function(change_ids){return _doAcceptChanges(change_ids),event_tracking.sendMB("rp-changes-accepted",{view:$scope.ui.reviewPanelOpen?$scope.reviewPanel.subView:"mini"})},$scope.rejectChanges=function(change_ids){return _doRejectChanges(change_ids),event_tracking.sendMB("rp-changes-rejected",{view:$scope.ui.reviewPanelOpen?$scope.reviewPanel.subView:"mini"})},_doAcceptChanges=function(change_ids){return $http.post("/project/"+$scope.project_id+"/doc/"+$scope.editor.open_doc_id+"/changes/accept",{change_ids:change_ids,_csrf:window.csrfToken}),$scope.$broadcast("changes:accept",change_ids)},_doRejectChanges=function(change_ids){return $scope.$broadcast("changes:reject",change_ids)},bulkAccept=function(){return _doAcceptChanges($scope.reviewPanel.selectedEntryIds.slice()),event_tracking.sendMB("rp-bulk-accept",{view:$scope.ui.reviewPanelOpen?$scope.reviewPanel.subView:"mini",nEntries:$scope.reviewPanel.nVisibleSelectedChanges})},bulkReject=function(){return _doRejectChanges($scope.reviewPanel.selectedEntryIds.slice()),event_tracking.sendMB("rp-bulk-reject",{view:$scope.ui.reviewPanelOpen?$scope.reviewPanel.subView:"mini",nEntries:$scope.reviewPanel.nVisibleSelectedChanges})},$scope.showBulkAcceptDialog=function(){return showBulkActionsDialog(!0)},$scope.showBulkRejectDialog=function(){return showBulkActionsDialog(!1)},showBulkActionsDialog=function(isAccept){return $modal.open({templateUrl:"bulkActionsModalTemplate",controller:"BulkActionsModalController",resolve:{isAccept:function(){return isAccept},nChanges:function(){return $scope.reviewPanel.nVisibleSelectedChanges}},scope:$scope.$new()}).result.then(function(isAccept){return isAccept?bulkAccept():bulkReject()})},$scope.handleTogglerClick=function(e){return e.target.blur(),$scope.toggleReviewPanel()},$scope.addNewComment=function(){return $scope.$broadcast("comment:start_adding"),$scope.toggleReviewPanel()},$scope.addNewCommentFromKbdShortcut=function(){return $scope.project.features.trackChangesVisible?($scope.$broadcast("comment:select_line"),$scope.ui.reviewPanelOpen||$scope.toggleReviewPanel(),$timeout(function(){return $scope.$broadcast("review-panel:layout"),$scope.$broadcast("comment:start_adding")})):void 0},$scope.startNewComment=function(){return $scope.$broadcast("comment:select_line"),$timeout(function(){return $scope.$broadcast("review-panel:layout")})},$scope.submitNewComment=function(content){var doc_id,entries,length,offset,ref,thread,thread_id;if(null!=content&&""!==content&&(doc_id=$scope.editor.open_doc_id,entries=getDocEntries(doc_id),null!=entries["add-comment"]))return ref=entries["add-comment"],offset=ref.offset,length=ref.length,thread_id=RangesTracker.generateId(),thread=getThread(thread_id),thread.submitting=!0,$scope.$broadcast("comment:add",thread_id,offset,length),$http.post("/project/"+$scope.project_id+"/thread/"+thread_id+"/messages",{content:content,_csrf:window.csrfToken})["catch"](function(){return ide.showGenericMessageModal("Error submitting comment","Sorry, there was a problem submitting your comment")}),$scope.$broadcast("editor:clearSelection"),$timeout(function(){return $scope.$broadcast("review-panel:layout")}),event_tracking.sendMB("rp-new-comment",{size:content.length})},$scope.cancelNewComment=function(entry){return $timeout(function(){return $scope.$broadcast("review-panel:layout")})},$scope.startReply=function(entry){return entry.replying=!0,$timeout(function(){return $scope.$broadcast("review-panel:layout")})},$scope.submitReply=function(entry,entry_id){var content,thread,thread_id,trackingMetadata;return thread_id=entry.thread_id,content=entry.replyContent,$http.post("/project/"+$scope.project_id+"/thread/"+thread_id+"/messages",{content:content,_csrf:window.csrfToken})["catch"](function(){return ide.showGenericMessageModal("Error submitting comment","Sorry, there was a problem submitting your comment")}),trackingMetadata={view:$scope.ui.reviewPanelOpen?$scope.reviewPanel.subView:"mini",size:entry.replyContent.length,thread:thread_id},thread=getThread(thread_id),thread.submitting=!0,entry.replyContent="",entry.replying=!1,$timeout(function(){return $scope.$broadcast("review-panel:layout")}),event_tracking.sendMB("rp-comment-reply",trackingMetadata)},$scope.cancelReply=function(entry){return entry.replying=!1,entry.replyContent="",$scope.$broadcast("review-panel:layout")},$scope.resolveComment=function(entry,entry_id){return entry.focused=!1,$http.post("/project/"+$scope.project_id+"/thread/"+entry.thread_id+"/resolve",{_csrf:window.csrfToken}),_onCommentResolved(entry.thread_id,ide.$scope.user),event_tracking.sendMB("rp-comment-resolve",{view:$scope.ui.reviewPanelOpen?$scope.reviewPanel.subView:"mini"})},$scope.unresolveComment=function(thread_id){return _onCommentReopened(thread_id),$http.post("/project/"+$scope.project_id+"/thread/"+thread_id+"/reopen",{_csrf:window.csrfToken}),event_tracking.sendMB("rp-comment-reopen")},_onCommentResolved=function(thread_id,user){var thread;return thread=getThread(thread_id),null!=thread?(thread.resolved=!0,thread.resolved_by_user=formatUser(user),thread.resolved_at=(new Date).toISOString(),$scope.reviewPanel.resolvedThreadIds[thread_id]=!0,$scope.$broadcast("comment:resolve_threads",[thread_id])):void 0},_onCommentReopened=function(thread_id){var thread;return thread=getThread(thread_id),null!=thread?(delete thread.resolved,delete thread.resolved_by_user,delete thread.resolved_at,delete $scope.reviewPanel.resolvedThreadIds[thread_id],$scope.$broadcast("comment:unresolve_thread",thread_id)):void 0},_onThreadDeleted=function(thread_id){return delete $scope.reviewPanel.resolvedThreadIds[thread_id],delete $scope.reviewPanel.commentThreads[thread_id],$scope.$broadcast("comment:remove",thread_id)},_onCommentEdited=function(thread_id,comment_id,content){var i,len,message,ref,thread;if(thread=getThread(thread_id),null!=thread){for(ref=thread.messages,i=0,len=ref.length;len>i;i++)message=ref[i],message.id===comment_id&&(message.content=content);return updateEntries()}},_onCommentDeleted=function(thread_id,comment_id){var thread;return thread=getThread(thread_id),null!=thread?(thread.messages=thread.messages.filter(function(m){return m.id!==comment_id}),updateEntries()):void 0},$scope.deleteThread=function(entry_id,doc_id,thread_id){return _onThreadDeleted(thread_id),$http({method:"DELETE",url:"/project/"+$scope.project_id+"/doc/"+doc_id+"/thread/"+thread_id,headers:{"X-CSRF-Token":window.csrfToken}}),event_tracking.sendMB("rp-comment-delete")},$scope.saveEdit=function(thread_id,comment){return $http.post("/project/"+$scope.project_id+"/thread/"+thread_id+"/messages/"+comment.id+"/edit",{content:comment.content,_csrf:window.csrfToken}),$timeout(function(){return $scope.$broadcast("review-panel:layout")})},$scope.deleteComment=function(thread_id,comment){return _onCommentDeleted(thread_id,comment.id),$http({method:"DELETE",url:"/project/"+$scope.project_id+"/thread/"+thread_id+"/messages/"+comment.id,headers:{"X-CSRF-Token":window.csrfToken}}),$timeout(function(){return $scope.$broadcast("review-panel:layout")})},$scope.setSubView=function(subView){return $scope.reviewPanel.subView=subView,event_tracking.sendMB("rp-subview-change",{subView:subView})},$scope.gotoEntry=function(doc_id,entry){return ide.editorManager.openDocId(doc_id,{gotoOffset:entry.offset})},$scope.toggleFullTCStateCollapse=function(){return $scope.project.features.trackChanges?$scope.reviewPanel.fullTCStateCollapsed=!$scope.reviewPanel.fullTCStateCollapsed:$scope.openTrackChangesUpgradeModal()},_setUserTCState=function(userId,newValue,isLocal){var base,state;return null==isLocal&&(isLocal=!1),null==(base=$scope.reviewPanel.trackChangesState)[userId]&&(base[userId]={}),state=$scope.reviewPanel.trackChangesState[userId],null==state.syncState||state.syncState===UserTCSyncState.SYNCED?(state.value=newValue,state.syncState=UserTCSyncState.SYNCED):state.syncState===UserTCSyncState.PENDING&&state.value===newValue?state.syncState=UserTCSyncState.SYNCED:isLocal&&(state.value=newValue,state.syncState=UserTCSyncState.PENDING),userId===ide.$scope.user.id?$scope.editor.wantTrackChanges=newValue:void 0},_setEveryoneTCState=function(newValue,isLocal){var i,len,member,project,ref;for(null==isLocal&&(isLocal=!1),$scope.reviewPanel.trackChangesOnForEveryone=newValue,project=$scope.project,ref=project.members,i=0,len=ref.length;len>i;i++)member=ref[i],_setUserTCState(member._id,newValue,isLocal);return _setGuestsTCState(newValue,isLocal),_setUserTCState(project.owner._id,newValue,isLocal)},_setGuestsTCState=function(newValue,isLocal){return null==isLocal&&(isLocal=!1),$scope.reviewPanel.trackChangesOnForGuests=newValue,currentUserType()===UserTypes.GUEST||currentUserType()===UserTypes.ANONYMOUS?$scope.editor.wantTrackChanges=newValue:void 0},applyClientTrackChangesStateToServer=function(){var data,ref,userId,userState;if(data={},$scope.reviewPanel.trackChangesOnForEveryone)data.on=!0;else{data.on_for={},ref=$scope.reviewPanel.trackChangesState;for(userId in ref)userState=ref[userId],data.on_for[userId]=userState.value;$scope.reviewPanel.trackChangesOnForGuests&&(data.on_for_guests=!0)}return data._csrf=window.csrfToken,$http.post("/project/"+$scope.project_id+"/track_changes",data)},applyTrackChangesStateToClient=function(state){var i,len,member,project,ref,ref1,ref2;if("boolean"==typeof state)return _setEveryoneTCState(state),_setGuestsTCState(state);for(project=$scope.project,$scope.reviewPanel.trackChangesOnForEveryone=!1,_setGuestsTCState(state.__guests__===!0),ref=project.members,i=0,len=ref.length;len>i;i++)member=ref[i],_setUserTCState(member._id,null!=(ref1=state[member._id])?ref1:!1);return _setUserTCState($scope.project.owner._id,null!=(ref2=state[$scope.project.owner._id])?ref2:!1)},$scope.toggleTrackChangesForEveryone=function(onForEveryone){return _setEveryoneTCState(onForEveryone,!0),_setGuestsTCState(onForEveryone,!0),applyClientTrackChangesStateToServer()},$scope.toggleTrackChangesForGuests=function(onForGuests){return _setGuestsTCState(onForGuests,!0),applyClientTrackChangesStateToServer()},$scope.toggleTrackChangesForUser=function(onForUser,userId){return _setUserTCState(userId,onForUser,!0),applyClientTrackChangesStateToServer()},ide.socket.on("toggle-track-changes",function(state){return $scope.$apply(function(){return applyTrackChangesStateToClient(state)})}),$scope.toggleTrackChangesFromKbdShortcut=function(){return $scope.project.features.trackChangesVisible&&$scope.project.features.trackChanges?$scope.toggleTrackChangesForUser(!$scope.reviewPanel.trackChangesState[ide.$scope.user.id].value,ide.$scope.user.id):void 0},setGuestFeatureBasedOnProjectAccessLevel=function(projectPublicAccessLevel){return $scope.reviewPanel.trackChangesForGuestsAvailable="tokenBased"===projectPublicAccessLevel},onToggleTrackChangesForGuestsAvailability=function(available){return available||!$scope.reviewPanel.trackChangesOnForGuests||$scope.reviewPanel.trackChangesOnForEveryone?void 0:$scope.toggleTrackChangesForGuests(!1)},$scope.$watch("project.publicAccesLevel",setGuestFeatureBasedOnProjectAccessLevel),$scope.$watch("reviewPanel.trackChangesForGuestsAvailable",function(available){return null!=available?onToggleTrackChangesForGuestsAvailability(available):void 0}),_inited=!1,ide.$scope.$on("project:joined",function(){var project;if(!_inited)return project=ide.$scope.project,project.features.trackChanges?(null==window.trackChangesState&&(window.trackChangesState=!1),applyTrackChangesStateToClient(window.trackChangesState)):applyTrackChangesStateToClient(!1),setGuestFeatureBasedOnProjectAccessLevel(project.publicAccesLevel),_inited=!0}),_refreshingRangeUsers=!1,_refreshedForUserIds={},refreshChangeUsers=function(refresh_for_user_id){if(null!=refresh_for_user_id){if(null!=_refreshedForUserIds[refresh_for_user_id])return;_refreshedForUserIds[refresh_for_user_id]=!0}if(!_refreshingRangeUsers)return _refreshingRangeUsers=!0,$http.get("/project/"+$scope.project_id+"/changes/users").then(function(response){var i,len,ref,results,user,users;for(users=response.data,_refreshingRangeUsers=!1,$scope.users={},null!=(null!=(ref=ide.$scope.user)?ref.id:void 0)&&($scope.users[ide.$scope.user.id]=formatUser(ide.$scope.user)),results=[],i=0,len=users.length;len>i;i++)user=users[i],null!=user.id?results.push($scope.users[user.id]=formatUser(user)):results.push(void 0);return results})["catch"](function(){return _refreshingRangeUsers=!1})},_threadsLoaded=!1,ensureThreadsAreLoaded=function(){return _threadsLoaded?void 0:(_threadsLoaded=!0,$scope.reviewPanel.loadingThreads=!0,$http.get("/project/"+$scope.project_id+"/threads").then(function(response){var _,comment,i,len,ref,ref1,thread,thread_id,threads;threads=response.data,$scope.reviewPanel.loadingThreads=!1,ref=$scope.reviewPanel.resolvedThreadIds;for(thread_id in ref)_=ref[thread_id],delete $scope.reviewPanel.resolvedThreadIds[thread_id];for(thread_id in threads){for(thread=threads[thread_id],ref1=thread.messages,i=0,len=ref1.length;len>i;i++)comment=ref1[i],formatComment(comment);null!=thread.resolved_by_user&&(thread.resolved_by_user=formatUser(thread.resolved_by_user),$scope.reviewPanel.resolvedThreadIds[thread_id]=!0,$scope.$broadcast("comment:resolve_threads",[thread_id]))}return $scope.reviewPanel.commentThreads=threads,$timeout(function(){return $scope.$broadcast("review-panel:layout")})}))},formatComment=function(comment){return comment.user=formatUser(comment.user),comment.timestamp=new Date(comment.timestamp),comment},formatUser=function(user){var id,isSelf,name,ref;return id=(null!=user?user._id:void 0)||(null!=user?user.id:void 0),null==id?{email:null,name:"Anonymous",isSelf:!1,hue:ColorManager.ANONYMOUS_HUE,avatar_text:"A"}:(id===window.user_id?(name="You",isSelf=!0):(name=[user.first_name,user.last_name].filter(function(n){return null!=n&&""!==n}).join(" "),""===name&&(name=(null!=(ref=user.email)?ref.split("@")[0]:void 0)||"Unknown"),isSelf=!1),{id:id,email:user.email,name:name,isSelf:isSelf,hue:ColorManager.getHueForUserId(id),avatar_text:[user.first_name,user.last_name].filter(function(n){return null!=n}).map(function(n){return n[0]}).join("")})},$scope.openTrackChangesUpgradeModal=function(){return $modal.open({templateUrl:"trackChangesUpgradeModalTemplate",controller:"TrackChangesUpgradeModalController",scope:$scope.$new()})}})})}.call(this),function(){define("ide/review-panel/controllers/TrackChangesUpgradeModalController",["base"],function(App){return App.controller("TrackChangesUpgradeModalController",function($scope,$modalInstance){return $scope.cancel=function(){return $modalInstance.dismiss()}})})}.call(this),function(){define("ide/review-panel/controllers/BulkActionsModalController",["base"],function(App){return App.controller("BulkActionsModalController",function($scope,$modalInstance,isAccept,nChanges){return $scope.isAccept=isAccept,$scope.nChanges=nChanges,$scope.cancel=function(){return $modalInstance.dismiss()},$scope.confirm=function(){return $modalInstance.close(isAccept)}})})}.call(this),function(){define("ide/review-panel/directives/reviewPanelSorted",["base"],function(App){return App.directive("reviewPanelSorted",function($timeout){return{link:function(scope,element,attrs){var ignoreNextAceEvent,layout,list,previous_focused_entry_index,scrollAce,scrollPanel,scroller;return previous_focused_entry_index=0,layout=function(animate){var OVERVIEW_TOGGLE_HEIGHT,PADDING,TOOLBAR_HEIGHT,bottom,el,entries,entries_after,entries_before,entry,focused_entry,focused_entry_index,focused_entry_top,height,i,j,k,l,lastBottom,lastTop,len,len1,len2,len3,line_height,m,original_bottom,original_top,overflowTop,positionLayoutEl,previousBottom,previousTop,ref,top;for(null==animate&&(animate=!0),animate?element.removeClass("no-animate"):element.addClass("no-animate"),sl_console.log("LAYOUT"),scope.ui.reviewPanelOpen?(PADDING=8,TOOLBAR_HEIGHT=38,OVERVIEW_TOGGLE_HEIGHT=57):(PADDING=4,TOOLBAR_HEIGHT=4,OVERVIEW_TOGGLE_HEIGHT=0),entries=[],ref=element.find(".rp-entry-wrapper"),j=0,len=ref.length;len>j;j++)el=ref[j],entry={$indicator_el:$(el).find(".rp-entry-indicator"),$box_el:$(el).find(".rp-entry"),$callout_el:$(el).find(".rp-entry-callout"),scope:angular.element(el).scope()},scope.ui.reviewPanelOpen?entry.$layout_el=entry.$box_el:entry.$layout_el=entry.$indicator_el,entry.height=entry.$layout_el.height(),entries.push(entry);if(entries.sort(function(a,b){return a.scope.entry.offset-b.scope.entry.offset}),0!==entries.length){for(line_height=scope.reviewPanel.rendererData.lineHeight,focused_entry_index=Math.min(previous_focused_entry_index,entries.length-1),i=k=0,len1=entries.length;len1>k;i=++k)if(entry=entries[i],entry.scope.entry.focused){focused_entry_index=i;break}for(entries_after=entries.slice(focused_entry_index+1),entries_before=entries.slice(0,focused_entry_index),focused_entry=entries[focused_entry_index],previous_focused_entry_index=focused_entry_index,sl_console.log("focused_entry_index",focused_entry_index),positionLayoutEl=function($callout_el,original_top,top){return top>=original_top?($callout_el.removeClass("rp-entry-callout-inverted"),$callout_el.css({top:original_top+line_height-1,height:top-original_top})):($callout_el.addClass("rp-entry-callout-inverted"),$callout_el.css({top:top+line_height,height:original_top-top}))},focused_entry_top=Math.max(focused_entry.scope.entry.screenPos.y,TOOLBAR_HEIGHT),focused_entry.$box_el.css({top:focused_entry_top,visibility:"visible"}),focused_entry.$indicator_el.css({top:focused_entry_top}),positionLayoutEl(focused_entry.$callout_el,focused_entry.scope.entry.screenPos.y,focused_entry_top),previousBottom=focused_entry_top+focused_entry.$layout_el.height(),l=0,len2=entries_after.length;len2>l;l++)entry=entries_after[l],original_top=entry.scope.entry.screenPos.y,height=entry.height,top=Math.max(original_top,previousBottom+PADDING),previousBottom=top+height,entry.$box_el.css({top:top,visibility:"visible"}),entry.$indicator_el.css({top:top}),positionLayoutEl(entry.$callout_el,original_top,top),sl_console.log("ENTRY",{entry:entry.scope.entry,top:top});for(lastBottom=previousBottom,previousTop=focused_entry_top,entries_before.reverse(),i=m=0,len3=entries_before.length;len3>m;i=++m)entry=entries_before[i],original_top=entry.scope.entry.screenPos.y,height=entry.height,original_bottom=original_top+height,bottom=Math.min(original_bottom,previousTop-PADDING),top=bottom-height,previousTop=top,entry.$box_el.css({top:top,visibility:"visible"}),entry.$indicator_el.css({top:top}),positionLayoutEl(entry.$callout_el,original_top,top),sl_console.log("ENTRY",{entry:entry.scope.entry,top:top});return lastTop=top,overflowTop=TOOLBAR_HEIGHT>lastTop?-lastTop+TOOLBAR_HEIGHT:0,scope.$emit("review-panel:sizes",{overflowTop:overflowTop,height:previousBottom+OVERVIEW_TOGGLE_HEIGHT})}},scope.$applyAsync(function(){return layout()}),scope.$on("review-panel:layout",function(e,animate){return null==animate&&(animate=!0),scope.$applyAsync(function(){return layout(animate)})}),scope.$watch("reviewPanel.rendererData.lineHeight",function(){return layout()}),scroller=element,list=element.find(".rp-entry-list-inner"),ace.require("ace/lib/event").addMouseWheelListener(scroller[0],function(e){var deltaY,old_top,top;return deltaY=e.wheelY,old_top=parseInt(list.css("top")),top=old_top-4*deltaY,scrollAce(-top),e.preventDefault()}),ignoreNextAceEvent=!1,scrollPanel=function(scrollTop,height){var ignoreNextPanelEvent;return ignoreNextAceEvent?ignoreNextAceEvent=!1:(ignoreNextPanelEvent=!0,list.height(height),list.css({top:-scrollTop}))},scrollAce=function(scrollTop){return scope.reviewPanelEventsBridge.emit("externalScroll",scrollTop)},scope.reviewPanelEventsBridge.on("aceScroll",scrollPanel),scope.$on("$destroy",function(){return scope.reviewPanelEventsBridge.off("aceScroll")}),scope.reviewPanelEventsBridge.emit("refreshScrollPosition")}}})})}.call(this),function(){var slice=[].slice;define("ide/review-panel/directives/reviewPanelToggle",["base"],function(App){return App.directive("reviewPanelToggle",function(){return{restrict:"E",scope:{onToggle:"&",ngModel:"=",valWhenUndefined:"=?",disabled:"=?",onDisabledClick:"&?"},link:function(scope){return null==scope.disabled&&(scope.disabled=!1),scope.onChange=function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],scope.onToggle({isOn:scope.localModel})},scope.handleClick=function(){return scope.disabled&&null!=scope.onDisabledClick?scope.onDisabledClick():void 0},scope.localModel=scope.ngModel,scope.$watch("ngModel",function(value){return null!=scope.valWhenUndefined&&null==value&&(value=scope.valWhenUndefined),scope.localModel=value})},template:'<div class="rp-toggle" ng-click="handleClick();">\n	<input id="rp-toggle-{{$id}}" ng-disabled="disabled" type="checkbox" class="rp-toggle-hidden-input" ng-model="localModel" ng-change="onChange()" />\n	<label for="rp-toggle-{{$id}}" class="rp-toggle-btn"></label>\n</div>'}})})}.call(this),function(){define("ide/review-panel/directives/changeEntry",["base"],function(App){return App.directive("changeEntry",function($timeout){return{restrict:"E",templateUrl:"changeEntryTemplate",scope:{entry:"=",user:"=",permissions:"=",onAccept:"&",onReject:"&",onIndicatorClick:"&",onBodyClick:"&"},link:function(scope,element,attrs){return scope.contentLimit=40,scope.isCollapsed=!0,scope.needsCollapsing=!1,element.on("click",function(e){return $(e.target).is(".rp-entry, .rp-entry-description, .rp-entry-body, .rp-entry-action-icon i")?scope.onBodyClick():void 0}),scope.toggleCollapse=function(){return scope.isCollapsed=!scope.isCollapsed,$timeout(function(){return scope.$emit("review-panel:layout")})},scope.$watch("entry.content.length",function(contentLength){return scope.needsCollapsing=contentLength>scope.contentLimit})}}})})}.call(this),function(){define("ide/review-panel/directives/aggregateChangeEntry",["base"],function(App){return App.directive("aggregateChangeEntry",function($timeout){return{restrict:"E",templateUrl:"aggregateChangeEntryTemplate",scope:{entry:"=",user:"=",permissions:"=",onAccept:"&",onReject:"&",onIndicatorClick:"&",onBodyClick:"&"},link:function(scope,element,attrs){return scope.contentLimit=17,scope.isDeletionCollapsed=!0,scope.isInsertionCollapsed=!0,scope.deletionNeedsCollapsing=!1,scope.insertionNeedsCollapsing=!1,element.on("click",function(e){return $(e.target).is(".rp-entry, .rp-entry-description, .rp-entry-body, .rp-entry-action-icon i")?scope.onBodyClick():void 0}),scope.toggleDeletionCollapse=function(){return scope.isDeletionCollapsed=!scope.isDeletionCollapsed,$timeout(function(){return scope.$emit("review-panel:layout")})},scope.toggleInsertionCollapse=function(){return scope.isInsertionCollapsed=!scope.isInsertionCollapsed,$timeout(function(){return scope.$emit("review-panel:layout")})},scope.$watch("entry.metadata.replaced_content.length",function(deletionContentLength){return scope.deletionNeedsCollapsing=deletionContentLength>scope.contentLimit}),scope.$watch("entry.content.length",function(insertionContentLength){return scope.insertionNeedsCollapsing=insertionContentLength>scope.contentLimit})}}})})}.call(this),function(){define("ide/review-panel/directives/commentEntry",["base"],function(App){return App.directive("commentEntry",function($timeout){return{restrict:"E",templateUrl:"commentEntryTemplate",scope:{entry:"=",threads:"=",permissions:"=",onResolve:"&",onReply:"&",onIndicatorClick:"&",onSaveEdit:"&",onDelete:"&",onBodyClick:"&"},link:function(scope,element,attrs){return scope.state={animating:!1},element.on("click",function(e){return $(e.target).is(".rp-entry, .rp-comment-loaded, .rp-comment-content, .rp-comment-reply, .rp-entry-metadata")?scope.onBodyClick():void 0}),scope.handleCommentReplyKeyPress=function(ev){return 13===ev.keyCode&&!ev.shiftKey&&!ev.ctrlKey&&!ev.metaKey&&(ev.preventDefault(),scope.entry.replyContent.length>0)?(ev.target.blur(),scope.onReply()):void 0},scope.animateAndCallOnResolve=function(){return scope.state.animating=!0,element.find(".rp-entry").css("top",0),$timeout(function(){return scope.onResolve()},350),!0},scope.startEditing=function(comment){return comment.editing=!0,setTimeout(function(){return scope.$emit("review-panel:layout")})},scope.saveEdit=function(comment){return comment.editing=!1,scope.onSaveEdit({comment:comment})},scope.confirmDelete=function(comment){return comment.deleting=!0,setTimeout(function(){return scope.$emit("review-panel:layout")})},scope.cancelDelete=function(comment){return comment.deleting=!1,setTimeout(function(){return scope.$emit("review-panel:layout")})},scope.doDelete=function(comment){return comment.deleting=!1,scope.onDelete({comment:comment})},scope.saveEditOnEnter=function(ev,comment){return 13!==ev.keyCode||ev.shiftKey||ev.ctrlKey||ev.metaKey?void 0:(ev.preventDefault(),scope.saveEdit(comment))}}}})})}.call(this),function(){define("ide/review-panel/directives/addCommentEntry",["base"],function(App){return App.directive("addCommentEntry",function(){return{restrict:"E",templateUrl:"addCommentEntryTemplate",scope:{onStartNew:"&",onSubmit:"&",onCancel:"&"},link:function(scope,element,attrs){return scope.state={isAdding:!1,content:""},scope.$on("comment:start_adding",function(){return scope.startNewComment()}),scope.startNewComment=function(){return scope.state.isAdding=!0,scope.onStartNew(),setTimeout(function(){return scope.$broadcast("comment:new:open")})},scope.cancelNewComment=function(){return scope.state.isAdding=!1,scope.onCancel()},scope.handleCommentKeyPress=function(ev){return 13===ev.keyCode&&!ev.shiftKey&&!ev.ctrlKey&&!ev.metaKey&&(ev.preventDefault(),scope.state.content.length>0)?scope.submitNewComment():void 0},scope.submitNewComment=function(event){return null!=event&&"blur"===event.type&&$(event.relatedTarget).hasClass("rp-entry-button-cancel")?!0:(scope.onSubmit({content:scope.state.content}),scope.state.isAdding=!1,scope.state.content="")}}}})})}.call(this),function(){define("ide/review-panel/directives/bulkActionsEntry",["base"],function(App){return App.directive("bulkActionsEntry",function(){return{restrict:"E",templateUrl:"bulkActionsEntryTemplate",scope:{onBulkAccept:"&",onBulkReject:"&",nEntries:"="},link:function(scope,element,attrs){return scope.bulkAccept=function(){return scope.onBulkAccept()},scope.bulkReject=function(){return scope.onBulkReject()}}}})})}.call(this),function(){define("ide/review-panel/directives/resolvedCommentEntry",["base"],function(App){return App.directive("resolvedCommentEntry",function(){return{restrict:"E",templateUrl:"resolvedCommentEntryTemplate",scope:{thread:"=",permissions:"=",onUnresolve:"&",onDelete:"&"},link:function(scope,element,attrs){return scope.contentLimit=40,scope.needsCollapsing=!1,scope.isCollapsed=!0,scope.toggleCollapse=function(){return scope.isCollapsed=!scope.isCollapsed},scope.$watch("thread.content.length",function(contentLength){return scope.needsCollapsing=contentLength>scope.contentLimit})}}})})}.call(this),function(){define("ide/review-panel/directives/resolvedCommentsDropdown",["base"],function(App){return App.directive("resolvedCommentsDropdown",function(_){return{restrict:"E",templateUrl:"resolvedCommentsDropdownTemplate",scope:{entries:"=",threads:"=",resolvedIds:"=",docs:"=",permissions:"=",onOpen:"&",onUnresolve:"&",onDelete:"&",isLoading:"="},link:function(scope,element,attrs){var filterResolvedComments,getDocNameById;return scope.state={isOpen:!1},scope.toggleOpenState=function(){return scope.state.isOpen=!scope.state.isOpen,scope.state.isOpen?scope.onOpen().then(function(){return filterResolvedComments()}):void 0},scope.resolvedComments=[],scope.handleUnresolve=function(threadId){return scope.onUnresolve({threadId:threadId}),scope.resolvedComments=scope.resolvedComments.filter(function(c){return c.threadId!==threadId})},scope.handleDelete=function(entryId,docId,threadId){return scope.onDelete({entryId:entryId,docId:docId,threadId:threadId}),scope.resolvedComments=scope.resolvedComments.filter(function(c){return c.threadId!==threadId})},getDocNameById=function(docId){var doc;return doc=_.find(scope.docs,function(doc){return doc.doc.id===docId}),null!=doc?doc.path:null},filterResolvedComments=function(){var docEntries,docId,entry,entryId,ref,resolvedComment,results;scope.resolvedComments=[],ref=scope.entries,results=[];for(docId in ref)docEntries=ref[docId],results.push(function(){var ref1,results1;results1=[];for(entryId in docEntries)entry=docEntries[entryId],"comment"===entry.type&&null!=(null!=(ref1=scope.threads[entry.thread_id])?ref1.resolved:void 0)?(resolvedComment=angular.copy(scope.threads[entry.thread_id]),resolvedComment.content=entry.content,resolvedComment.threadId=entry.thread_id,resolvedComment.entryId=entryId,resolvedComment.docId=docId,resolvedComment.docName=getDocNameById(docId),results1.push(scope.resolvedComments.push(resolvedComment))):results1.push(void 0);return results1}());return results}}}})})}.call(this),function(){define("ide/review-panel/directives/reviewPanelCollapseHeight",["base"],function(App){return App.directive("reviewPanelCollapseHeight",function($parse){return{restrict:"A",link:function(scope,element,attrs){return scope.$watch(function(){return $parse(attrs.reviewPanelCollapseHeight)(scope)},function(shouldCollapse){var neededHeight;return neededHeight=element.prop("scrollHeight"),neededHeight>0?shouldCollapse?element.animate({height:0},150):element.animate({height:neededHeight},150):shouldCollapse?element.height(0):void 0})}}})})}.call(this),function(){define("ide/review-panel/filters/notEmpty",["base"],function(App){return app.filter("notEmpty",function(){return function(object){return!angular.equals({},object)}})})}.call(this),function(){define("ide/review-panel/filters/numKeys",["base"],function(App){return app.filter("numKeys",function(){return function(object){return null!=object?Object.keys(object).length:0}})})}.call(this),function(){define("ide/review-panel/filters/orderOverviewEntries",["base"],function(App){return App.filter("orderOverviewEntries",function(){return function(items){var array,key,value;array=[];for(key in items)value=items[key],value.entry_id=key,array.push(value);return array.sort(function(a,b){return a.offset-b.offset}),array}})})}.call(this),function(){define("ide/review-panel/ReviewPanelManager",["ide/review-panel/controllers/ReviewPanelController","ide/review-panel/controllers/TrackChangesUpgradeModalController","ide/review-panel/controllers/BulkActionsModalController","ide/review-panel/directives/reviewPanelSorted","ide/review-panel/directives/reviewPanelToggle","ide/review-panel/directives/changeEntry","ide/review-panel/directives/aggregateChangeEntry","ide/review-panel/directives/commentEntry","ide/review-panel/directives/addCommentEntry","ide/review-panel/directives/bulkActionsEntry","ide/review-panel/directives/resolvedCommentEntry","ide/review-panel/directives/resolvedCommentsDropdown","ide/review-panel/directives/reviewPanelCollapseHeight","ide/review-panel/filters/notEmpty","ide/review-panel/filters/numKeys","ide/review-panel/filters/orderOverviewEntries"],function(){})}.call(this),function(){define("ide/SafariScrollPatcher",[],function(){var SafariScrollPatcher;return SafariScrollPatcher=function(){function SafariScrollPatcher($scope){this.isOverAce=!1,this.pdfDiv=null,this.aceDiv=null,this.handlePdfDivMouseLeave=function(_this){return function(){return _this.pdfDiv.addEventListener("wheel",_this.dispatchToAce);
}}(this),this.handlePdfDivMouseEnter=function(_this){return function(){return _this.pdfDiv.removeEventListener("wheel",_this.dispatchToAce)}}(this),this.handleAceDivMouseLeave=function(_this){return function(){return _this.isOverAce=!1}}(this),this.handleAceDivMouseEnter=function(_this){return function(){return _this.isOverAce=!0}}(this),this.setListeners=function(_this){return function(){return _this.isOverAce=!1,null!=_this.pdfDiv&&(_this.pdfDiv.removeEventListener(_this.handlePdfDivMouseLeave),_this.pdfDiv.removeEventListener(_this.handlePdfDivMouseEnter)),null!=_this.aceDiv&&(_this.aceDiv.removeEventListener(_this.handleAceDivMouseLeave),_this.aceDiv.removeEventListener(_this.handleAceDivMouseEnter)),_this.pdfDiv=document.querySelector(".pdfjs-viewer"),_this.aceDiv=document.querySelector(".ace_content"),_this.pdfDiv.addEventListener("mouseleave",_this.handlePdfDivMouseLeave),_this.pdfDiv.addEventListener("mouseenter",_this.handlePdfDivMouseEnter),_this.aceDiv.addEventListener("mouseleave",_this.handleAceDivMouseLeave),_this.aceDiv.addEventListener("mouseenter",_this.handleAceDivMouseEnter)}}(this),this.dispatchToAce=function(_this){return function(e){return _this.isOverAce?(window.setTimeout(function(){return _this.aceDiv.dispatchEvent(e)},1),e.preventDefault()):void 0}}(this),$scope.$on("loaded",function(_this){return function(){return _this.setListeners()}}(this))}return SafariScrollPatcher}()})}.call(this),function(){define("ide/settings/services/settings",["base"],function(App){return App.factory("settings",["ide","event_tracking",function(ide,event_tracking){return{saveSettings:function(data){var changedSetting,changedSettingVal,i,key,len,ref;for(ref=Object.keys(data),i=0,len=ref.length;len>i;i++)key=ref[i],changedSetting=key,changedSettingVal=data[key],event_tracking.sendMB("setting-changed",{changedSetting:changedSetting,changedSettingVal:changedSettingVal});return data._csrf=window.csrfToken,ide.$http.post("/user/settings",data)},saveProjectSettings:function(data){var changedSetting,changedSettingVal,i,key,len,ref;for(ref=Object.keys(data),i=0,len=ref.length;len>i;i++)key=ref[i],changedSetting=key,changedSettingVal=data[key],event_tracking.sendMB("project-setting-changed",{changedSetting:changedSetting,changedSettingVal:changedSettingVal});return data._csrf=window.csrfToken,ide.$http.post("/project/"+ide.project_id+"/settings",data)},saveProjectAdminSettings:function(data){var changedSetting,changedSettingVal,i,key,len,ref;for(ref=Object.keys(data),i=0,len=ref.length;len>i;i++)key=ref[i],changedSetting=key,changedSettingVal=data[key],event_tracking.sendMB("project-admin-setting-changed",{changedSetting:changedSetting,changedSettingVal:changedSettingVal});return data._csrf=window.csrfToken,ide.$http.post("/project/"+ide.project_id+"/settings/admin",data)}}}])})}.call(this),function(){define("ide/settings/controllers/SettingsController",["base"],function(App){return App.controller("SettingsController",["$scope","settings","ide","_",function($scope,settings,ide,_){var _updateCSSFile,ref,ref1,ref2,ref3;return $scope.overallThemesList=window.overallThemes,$scope.ui={loadingStyleSheet:!1},_updateCSSFile=function(theme){var docHeadEl,newStyleSheetEl,oldStyleSheetEl;return $scope.ui.loadingStyleSheet=!0,docHeadEl=document.querySelector("head"),oldStyleSheetEl=document.getElementById("main-stylesheet"),newStyleSheetEl=document.createElement("link"),newStyleSheetEl.addEventListener("load",function(_this){return function(e){return $scope.$applyAsync(function(){return $scope.ui.loadingStyleSheet=!1,docHeadEl.removeChild(oldStyleSheetEl)})}}(this)),newStyleSheetEl.setAttribute("rel","stylesheet"),newStyleSheetEl.setAttribute("id","main-stylesheet"),newStyleSheetEl.setAttribute("href",theme.path),docHeadEl.appendChild(newStyleSheetEl)},"default"!==(ref=$scope.settings.mode)&&"vim"!==ref&&"emacs"!==ref&&($scope.settings.mode="default"),"pdfjs"!==(ref1=$scope.settings.pdfViewer)&&"native"!==ref1&&($scope.settings.pdfViewer="pdfjs"),null!=$scope.settings.fontFamily&&"monaco"!==(ref2=$scope.settings.fontFamily)&&"lucida"!==ref2&&delete $scope.settings.fontFamily,null!=$scope.settings.lineHeight&&"compact"!==(ref3=$scope.settings.lineHeight)&&"normal"!==ref3&&"wide"!==ref3&&delete $scope.settings.lineHeight,$scope.fontSizeAsStr=function(newVal){return null!=newVal&&($scope.settings.fontSize=newVal),$scope.settings.fontSize.toString()},$scope.$watch("settings.editorTheme",function(_this){return function(editorTheme,oldEditorTheme){return editorTheme!==oldEditorTheme?settings.saveSettings({editorTheme:editorTheme}):void 0}}(this)),$scope.$watch("settings.overallTheme",function(_this){return function(overallTheme,oldOverallTheme){var chosenTheme;return overallTheme!==oldOverallTheme&&(chosenTheme=_.find($scope.overallThemesList,function(theme){return theme.val===overallTheme}),null!=chosenTheme)?(_updateCSSFile(chosenTheme),settings.saveSettings({overallTheme:overallTheme})):void 0}}(this)),$scope.$watch("settings.fontSize",function(_this){return function(fontSize,oldFontSize){return fontSize!==oldFontSize?settings.saveSettings({fontSize:parseInt(fontSize,10)}):void 0}}(this)),$scope.$watch("settings.mode",function(_this){return function(mode,oldMode){return mode!==oldMode?settings.saveSettings({mode:mode}):void 0}}(this)),$scope.$watch("settings.autoComplete",function(_this){return function(autoComplete,oldAutoComplete){return autoComplete!==oldAutoComplete?settings.saveSettings({autoComplete:autoComplete}):void 0}}(this)),$scope.$watch("settings.autoPairDelimiters",function(_this){return function(autoPairDelimiters,oldAutoPairDelimiters){return autoPairDelimiters!==oldAutoPairDelimiters?settings.saveSettings({autoPairDelimiters:autoPairDelimiters}):void 0}}(this)),$scope.$watch("settings.pdfViewer",function(_this){return function(pdfViewer,oldPdfViewer){return pdfViewer!==oldPdfViewer?settings.saveSettings({pdfViewer:pdfViewer}):void 0}}(this)),$scope.$watch("settings.syntaxValidation",function(_this){return function(syntaxValidation,oldSyntaxValidation){return syntaxValidation!==oldSyntaxValidation?settings.saveSettings({syntaxValidation:syntaxValidation}):void 0}}(this)),$scope.$watch("settings.fontFamily",function(_this){return function(fontFamily,oldFontFamily){return fontFamily!==oldFontFamily?settings.saveSettings({fontFamily:fontFamily}):void 0}}(this)),$scope.$watch("settings.lineHeight",function(_this){return function(lineHeight,oldLineHeight){return lineHeight!==oldLineHeight?settings.saveSettings({lineHeight:lineHeight}):void 0}}(this)),$scope.$watch("project.spellCheckLanguage",function(_this){return function(language,oldLanguage){return _this.ignoreUpdates?void 0:null!=oldLanguage&&language!==oldLanguage?(settings.saveProjectSettings({spellCheckLanguage:language}),settings.saveSettings({spellCheckLanguage:language})):void 0}}(this)),$scope.$watch("project.compiler",function(_this){return function(compiler,oldCompiler){return _this.ignoreUpdates?void 0:null!=oldCompiler&&compiler!==oldCompiler?settings.saveProjectSettings({compiler:compiler}):void 0}}(this)),$scope.$watch("project.imageName",function(_this){return function(imageName,oldImageName){return _this.ignoreUpdates?void 0:null!=oldImageName&&imageName!==oldImageName?settings.saveProjectSettings({imageName:imageName}):void 0}}(this)),$scope.$watch("project.rootDoc_id",function(_this){return function(rootDoc_id,oldRootDoc_id){return _this.ignoreUpdates||"undefined"==typeof oldRootDoc_id?void 0:rootDoc_id!==oldRootDoc_id?settings.saveProjectSettings({rootDocId:rootDoc_id}):void 0}}(this)),ide.socket.on("compilerUpdated",function(_this){return function(compiler){return _this.ignoreUpdates=!0,$scope.$apply(function(){return $scope.project.compiler=compiler}),delete _this.ignoreUpdates}}(this)),ide.socket.on("imageNameUpdated",function(_this){return function(imageName){return _this.ignoreUpdates=!0,$scope.$apply(function(){return $scope.project.imageName=imageName}),delete _this.ignoreUpdates}}(this)),ide.socket.on("spellCheckLanguageUpdated",function(_this){return function(languageCode){return _this.ignoreUpdates=!0,$scope.$apply(function(){return $scope.project.spellCheckLanguage=languageCode}),delete _this.ignoreUpdates}}(this))}])})}.call(this),function(){define("ide/settings/controllers/ProjectNameController",["base"],function(App){var MAX_PROJECT_NAME_LENGTH;return MAX_PROJECT_NAME_LENGTH=150,App.controller("ProjectNameController",["$scope","$element","settings","ide",function($scope,$element,settings,ide){var projectNameReadOnlyEl;return projectNameReadOnlyEl=$element.find(".name")[0],$scope.state={renaming:!1,overflowed:!1},$scope.inputs={},$scope.startRenaming=function(){return $scope.inputs.name=$scope.project.name,$scope.state.renaming=!0,$scope.$emit("project:rename:start")},$scope.finishRenaming=function(){var newName,oldName;return $scope.state.renaming=!1,newName=$scope.inputs.name,$scope.project.name!==newName?(oldName=$scope.project.name,$scope.project.name=newName,settings.saveProjectSettings({name:$scope.project.name})["catch"](function(response){var data,status;return data=response.data,status=response.status,$scope.project.name=oldName,400===status?ide.showGenericMessageModal("Error renaming project",data):ide.showGenericMessageModal("Error renaming project","Please try again in a moment")})):void 0},ide.socket.on("projectNameUpdated",function(name){return $scope.$apply(function(){return $scope.project.name=name})}),$scope.$watch("project.name",function(name){return null!=name?(window.document.title=name+(" - Online LaTeX Editor "+ExposedSettings.appName),$scope.$applyAsync(function(){return $scope.state.overflowed=projectNameReadOnlyEl.scrollWidth>projectNameReadOnlyEl.clientWidth})):void 0})}])})}.call(this),function(){define("ide/settings/index",["ide/settings/services/settings","ide/settings/controllers/SettingsController","ide/settings/controllers/ProjectNameController"],function(){})}.call(this),function(){define("ide/share/controllers/ShareController",["base"],function(App){return App.controller("ShareController",["$scope","$modal","ide","projectInvites","projectMembers","event_tracking",function($scope,$modal,ide,projectInvites,projectMembers,event_tracking){return $scope.openShareProjectModal=function(isAdmin){return $scope.isAdmin=isAdmin,event_tracking.sendMBOnce("ide-open-share-modal-once"),$modal.open({templateUrl:"shareProjectModalTemplate",controller:"ShareProjectModalController",scope:$scope})},ide.socket.on("project:tokens:changed",function(_this){return function(data){return null!=data.tokens?(ide.$scope.project.tokens=data.tokens,$scope.$digest()):void 0}}(this)),ide.socket.on("project:membership:changed",function(_this){return function(data){return data.members&&projectMembers.getMembers().then(function(response){return data=response.data,data.members?$scope.project.members=data.members:void 0})["catch"](function(){return console.error("Error fetching members for project")}),data.invites?projectInvites.getInvites().then(function(response){return data=response.data,data.invites?$scope.project.invites=data.invites:void 0})["catch"](function(){return console.error("Error fetching invites for project")}):void 0}}(this))}])})}.call(this),function(){var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};define("ide/share/controllers/ShareProjectModalController",["base"],function(App){return App.controller("ShareProjectModalController",function($scope,$modalInstance,$timeout,projectMembers,projectInvites,$modal,$http,ide,validateCaptcha,settings,event_tracking){var INFINITE_COLLABORATORS,getCurrentInviteEmails,getCurrentMemberEmails,loadAutocompleteUsers;return $scope.inputs={privileges:"readAndWrite",contacts:[]},$scope.state={error:null,errorReason:null,inflight:!1,startedFreeTrial:!1,invites:[]},$modalInstance.opened.then(function(){return $timeout(function(){return $scope.$broadcast("open")},200)}),INFINITE_COLLABORATORS=-1,$scope.refreshCanAddCollaborators=function(){var allowedNoOfMembers;return allowedNoOfMembers=$scope.project.features.collaborators,$scope.canAddCollaborators=$scope.project.members.length+$scope.project.invites.length<allowedNoOfMembers||allowedNoOfMembers===INFINITE_COLLABORATORS},$scope.refreshCanAddCollaborators(),$scope.$watch("(project.members.length + project.invites.length)",function(_noOfMembers){return $scope.refreshCanAddCollaborators()}),$scope.autocompleteContacts=[],(loadAutocompleteUsers=function(){return $http.get("/user/contacts").then(function(response){var contact,data,i,len,ref,results;for(data=response.data,$scope.autocompleteContacts=data.contacts||[],ref=$scope.autocompleteContacts,results=[],i=0,len=ref.length;len>i;i++)contact=ref[i],"user"===contact.type?contact.first_name!==contact.email.split("@")[0]||contact.last_name?(contact.name=contact.first_name+" "+contact.last_name,results.push(contact.display=contact.name+" <"+contact.email+">")):results.push(contact.display=contact.email):results.push(contact.display=contact.name);return results})})(),getCurrentMemberEmails=function(){return($scope.project.members||[]).map(function(u){return u.email})},getCurrentInviteEmails=function(){return($scope.project.invites||[]).map(function(u){return u.email})},$scope.filterAutocompleteUsers=function($query){var currentMemberEmails;return currentMemberEmails=getCurrentMemberEmails(),$scope.autocompleteContacts.filter(function(contact){var i,len,ref,ref1,text;if(null!=contact.email&&(ref=contact.email,indexOf.call(currentMemberEmails,ref)>=0))return!1;for(ref1=[contact.name,contact.email],i=0,len=ref1.length;len>i;i++)if(text=ref1[i],(null!=text?text.toLowerCase().indexOf($query.toLowerCase()):void 0)>-1)return!0;return!1})},$scope.addMembers=function(){var addMembers;return addMembers=function(){var addNextMember,currentInviteEmails,currentMemberEmails,members;if(0!==$scope.inputs.contacts.length)return members=$scope.inputs.contacts,$scope.inputs.contacts=[],$scope.state.error=!1,$scope.state.errorReason=null,$scope.state.inflight=!0,null==$scope.project.invites&&($scope.project.invites=[]),currentMemberEmails=getCurrentMemberEmails(),currentInviteEmails=getCurrentInviteEmails(),(addNextMember=function(){var email,member;return 0!==members.length&&$scope.canAddCollaborators?(member=members.shift(),email="user"===member.type?member.email:member.display,email=email.toLowerCase(),indexOf.call(currentMemberEmails,email)>=0?addNextMember():validateCaptcha(function(response){var inviteId,ref,request;return $scope.grecaptchaResponse=response,request=indexOf.call(currentInviteEmails,email)>=0&&(inviteId=null!=(ref=_.find($scope.project.invites||[],function(invite){return invite.email===email}))?ref._id:void 0)?projectInvites.resendInvite(inviteId):projectInvites.sendInvite(email,$scope.inputs.privileges,$scope.grecaptchaResponse),request.then(function(response){var data,invite,ref1,users;return data=response.data,data.error?($scope.state.error=!0,$scope.state.errorReason=""+data.error,$scope.state.inflight=!1):data.invite?(invite=data.invite,$scope.project.invites.push(invite)):(users=null!=data.users?data.users:null!=data.user?[data.user]:[],(ref1=$scope.project.members).push.apply(ref1,users)),setTimeout(function(){return addNextMember()},0)})["catch"](function(httpResponse){var config,data,headers,status;return data=httpResponse.data,status=httpResponse.status,headers=httpResponse.headers,config=httpResponse.config,$scope.state.inflight=!1,$scope.state.error=!0,null!=(null!=data?data.errorReason:void 0)?$scope.state.errorReason=null!=data?data.errorReason:void 0:$scope.state.errorReason=null})})):($scope.state.inflight=!1,void $scope.$apply())})()},$timeout(addMembers,50)},$scope.removeMember=function(member){return $scope.state.error=null,$scope.state.inflight=!0,projectMembers.removeMember(member).then(function(){var index;return $scope.state.inflight=!1,index=$scope.project.members.indexOf(member),-1!==index?$scope.project.members.splice(index,1):void 0})["catch"](function(){return $scope.state.inflight=!1,$scope.state.error="Sorry, something went wrong :("})},$scope.revokeInvite=function(invite){return $scope.state.error=null,$scope.state.inflight=!0,projectInvites.revokeInvite(invite._id).then(function(){var index;return $scope.state.inflight=!1,index=$scope.project.invites.indexOf(invite),-1!==index?$scope.project.invites.splice(index,1):void 0})["catch"](function(){return $scope.state.inflight=!1,$scope.state.error="Sorry, something went wrong :("})},$scope.resendInvite=function(invite,event){return $scope.state.error=null,$scope.state.inflight=!0,projectInvites.resendInvite(invite._id).then(function(){return $scope.state.inflight=!1,event.target.blur()})["catch"](function(){return $scope.state.inflight=!1,$scope.state.error="Sorry, something went wrong resending the invite :(",event.target.blur()})},$scope.makeTokenBased=function(){return $scope.project.publicAccesLevel="tokenBased",settings.saveProjectAdminSettings({publicAccessLevel:"tokenBased"}),event_tracking.sendMB("project-make-token-based")},$scope.makePrivate=function(){return $scope.project.publicAccesLevel="private",settings.saveProjectAdminSettings({publicAccessLevel:"private"})},$scope.$watch("project.tokens.readAndWrite",function(token){return null!=token?$scope.readAndWriteTokenLink=location.origin+"/"+token:$scope.readAndWriteTokenLink=null}),$scope.$watch("project.tokens.readOnly",function(token){return null!=token?$scope.readOnlyTokenLink=location.origin+"/read/"+token:$scope.readOnlyTokenLink=null}),$scope.done=function(){return $modalInstance.close()},$scope.cancel=function(){return $modalInstance.dismiss()}})})}.call(this),function(){define("ide/share/services/projectMembers",["base"],function(App){return App.factory("projectMembers",["ide","$http",function(ide,$http){return{removeMember:function(member){return $http({url:"/project/"+ide.project_id+"/users/"+member._id,method:"DELETE",headers:{"X-Csrf-Token":window.csrfToken}})},addGroup:function(group_id,privileges){return $http.post("/project/"+ide.project_id+"/group",{group_id:group_id,privileges:privileges,_csrf:window.csrfToken})},getMembers:function(){return $http.get("/project/"+ide.project_id+"/members",{json:!0,headers:{"X-Csrf-Token":window.csrfToken}})}}}])})}.call(this),function(){define("ide/share/services/projectInvites",["base"],function(App){return App.factory("projectInvites",["ide","$http",function(ide,$http){return{sendInvite:function(email,privileges,grecaptchaResponse){return $http.post("/project/"+ide.project_id+"/invite",{email:email,privileges:privileges,_csrf:window.csrfToken,"g-recaptcha-response":grecaptchaResponse})},revokeInvite:function(inviteId){return $http({url:"/project/"+ide.project_id+"/invite/"+inviteId,method:"DELETE",headers:{"X-Csrf-Token":window.csrfToken}})},resendInvite:function(inviteId,privileges){return $http.post("/project/"+ide.project_id+"/invite/"+inviteId+"/resend",{_csrf:window.csrfToken})},getInvites:function(){return $http.get("/project/"+ide.project_id+"/invites",{json:!0,headers:{"X-Csrf-Token":window.csrfToken}})}}}])})}.call(this),function(){define("ide/share/index",["ide/share/controllers/ShareController","ide/share/controllers/ShareProjectModalController","ide/share/services/projectMembers","ide/share/services/projectInvites"],function(){})}.call(this),function(){define("ide/chat/controllers/ChatButtonController",["base"],function(App){return App.controller("ChatButtonController",function($scope,ide){var clearNewMessageNotification,flashTitle,focussed,newMessageNotificationTimeout,originalTitle;return $scope.toggleChat=function(){return $scope.ui.chatOpen=!$scope.ui.chatOpen,$scope.resetUnreadMessages()},$scope.unreadMessages=0,$scope.resetUnreadMessages=function(){return $scope.unreadMessages=0},$scope.$on("chat:resetUnreadMessages",function(e){return $scope.resetUnreadMessages()}),$scope.$on("chat:newMessage",function(e,message){var ref;return null!=message&&(null!=message&&null!=(ref=message.user)?ref.id:void 0)!==ide.$scope.user.id?($scope.ui.chatOpen||($scope.unreadMessages+=1),flashTitle()):void 0}),focussed=!0,newMessageNotificationTimeout=null,originalTitle=null,$(window).on("focus",function(){return clearNewMessageNotification(),focussed=!0}),$(window).on("blur",function(){return focussed=!1}),flashTitle=function(){var changeTitle;return focussed||null!=newMessageNotificationTimeout?void 0:(originalTitle||(originalTitle=window.document.title),(changeTitle=function(_this){return function(){return window.document.title===originalTitle?window.document.title="New Message":window.document.title=originalTitle,newMessageNotificationTimeout=setTimeout(changeTitle,800)}}(this))())},clearNewMessageNotification=function(){return clearTimeout(newMessageNotificationTimeout),newMessageNotificationTimeout=null,null!=originalTitle?window.document.title=originalTitle:void 0}})})}.call(this),function(){define("ide/chat/services/chatMessages",["base","libs/md5"],function(App){return App.factory("chatMessages",function($http,ide){var CONNECTED_USER_URL,MESSAGES_URL,MESSAGE_LIMIT,TIMESTAMP_GROUP_SIZE,appendMessage,chat,formatUser,justSent,prependMessage,prependMessages;return MESSAGES_URL="/project/"+ide.project_id+"/messages",MESSAGE_LIMIT=50,CONNECTED_USER_URL="/project/"+ide.project_id+"/connected_users",chat={state:{messages:[],loading:!1,atEnd:!1,errored:!1,nextBeforeTimestamp:null,newMessage:null}},justSent=!1,ide.socket.on("new-chat-message",function(_this){return function(message){var ref;return(null!=message&&null!=(ref=message.user)?ref.id:void 0)===ide.$scope.user.id&&justSent||ide.$scope.$apply(function(){return appendMessage(message)}),justSent=!1}}(this)),chat.sendMessage=function(message){var body;return body={content:message,_csrf:window.csrfToken},justSent=!0,appendMessage({user:ide.$scope.user,content:message,timestamp:Date.now()}),$http.post(MESSAGES_URL,body)},chat.loadMoreMessages=function(){var url;if(!chat.state.atEnd&&!chat.state.errored)return url=MESSAGES_URL+("?limit="+MESSAGE_LIMIT),null!=chat.state.nextBeforeTimestamp&&(url+="&before="+chat.state.nextBeforeTimestamp),chat.state.loading=!0,$http.get(url).then(function(response){var messages,ref,ref1;return messages=null!=(ref=response.data)?ref:[],chat.state.loading=!1,messages.length<MESSAGE_LIMIT&&(chat.state.atEnd=!0),null==messages.reverse&&"undefined"!=typeof Raven&&null!==Raven&&Raven.captureException(new Error("messages has no reverse property "+typeof messages)),"function"!=typeof messages.reverse?("undefined"!=typeof Raven&&null!==Raven&&Raven.captureException(new Error("messages.reverse not a function "+typeof messages.reverse+" "+typeof messages)),chat.state.errored=!0):(messages.reverse(),prependMessages(messages),chat.state.nextBeforeTimestamp=null!=(ref1=chat.state.messages[0])?ref1.timestamp:void 0)})},TIMESTAMP_GROUP_SIZE=3e5,prependMessage=function(message){var firstMessage,ref,shouldGroup;return firstMessage=chat.state.messages[0],shouldGroup=null!=firstMessage&&firstMessage.user.id===(null!=message&&null!=(ref=message.user)?ref.id:void 0)&&firstMessage.timestamp-message.timestamp<TIMESTAMP_GROUP_SIZE,shouldGroup?(firstMessage.timestamp=message.timestamp,firstMessage.contents.unshift(message.content)):chat.state.messages.unshift({user:formatUser(message.user),timestamp:message.timestamp,contents:[message.content]})},prependMessages=function(messages){var i,len,message,ref,results;for(ref=messages.slice(0).reverse(),results=[],i=0,len=ref.length;len>i;i++)message=ref[i],results.push(prependMessage(message));return results},appendMessage=function(message){var lastMessage,ref,shouldGroup;return chat.state.newMessage=message,lastMessage=chat.state.messages[chat.state.messages.length-1],shouldGroup=null!=lastMessage&&lastMessage.user.id===(null!=message&&null!=(ref=message.user)?ref.id:void 0)&&message.timestamp-lastMessage.timestamp<TIMESTAMP_GROUP_SIZE,shouldGroup?(lastMessage.timestamp=message.timestamp,lastMessage.contents.push(message.content)):chat.state.messages.push({user:formatUser(message.user),timestamp:message.timestamp,contents:[message.content]})},formatUser=function(user){var hash;return hash=CryptoJS.MD5(user.email.toLowerCase()),user.gravatar_url="//www.gravatar.com/avatar/"+hash,user},chat})})}.call(this),function(){define("ide/chat/controllers/ChatController",["base","ide/chat/services/chatMessages"],function(App){return App.controller("ChatController",function($scope,chatMessages,ide,$location){return $scope.chat=chatMessages.state,$scope.$watch("chat.messages",function(messages){return null!=messages?$scope.$emit("updateScrollPosition"):void 0},!0),$scope.$on("layout:chat:resize",function(){return $scope.$emit("updateScrollPosition")}),$scope.$watch("chat.newMessage",function(message){return null!=message?ide.$scope.$broadcast("chat:newMessage",message):void 0}),$scope.resetUnreadMessages=function(){return ide.$scope.$broadcast("chat:resetUnreadMessages")},$scope.sendMessage=function(){var message;return message=$scope.newMessageContent,$scope.newMessageContent="",chatMessages.sendMessage(message)},$scope.loadMoreMessages=function(){return chatMessages.loadMoreMessages()}})})}.call(this),function(){define("ide/chat/controllers/ChatMessageController",["base","ide/colors/ColorManager"],function(App,ColorManager){return App.controller("ChatMessageController",["$scope","ide",function($scope,ide){var hslColorConfigs,hue,ref,ref1,ref2,ref3;return hslColorConfigs={borderSaturation:(null!=(ref=window.uiConfig)?ref.chatMessageBorderSaturation:void 0)||"70%",borderLightness:(null!=(ref1=window.uiConfig)?ref1.chatMessageBorderLightness:void 0)||"70%",bgSaturation:(null!=(ref2=window.uiConfig)?ref2.chatMessageBgSaturation:void 0)||"60%",bgLightness:(null!=(ref3=window.uiConfig)?ref3.chatMessageBgLightness:void 0)||"97%"},hue=function(user){return null==user?0:ColorManager.getHueForUserId(user.id)},$scope.getMessageStyle=function(user){return{"border-color":"hsl("+hue(user)+", "+hslColorConfigs.borderSaturation+", "+hslColorConfigs.borderLightness+")","background-color":"hsl("+hue(user)+", "+hslColorConfigs.bgSaturation+", "+hslColorConfigs.bgLightness+")"}},$scope.getArrowStyle=function(user){return{"border-color":"hsl("+hue(user)+", "+hslColorConfigs.borderSaturation+", "+hslColorConfigs.borderLightness+")"}}}])})}.call(this),function(){define("directives/mathjax",["base"],function(App){return App.directive("mathjax",function(){return{link:function(scope,element,attrs){var alreadyConfigured,inlineMathConfig,ref,ref1,ref2;return"no-single-dollar"!==attrs.delimiter&&(inlineMathConfig="undefined"!=typeof MathJax&&null!==MathJax&&null!=(ref=MathJax.Hub)&&null!=(ref1=ref.config)?ref1.tex2jax.inlineMath:void 0,alreadyConfigured=_.find(inlineMathConfig,function(c){return"$"===c[0]&&"$"===c[1]}),null==alreadyConfigured&&"undefined"!=typeof MathJax&&null!==MathJax&&null!=(ref2=MathJax.Hub)&&ref2.Config({tex2jax:{inlineMath:inlineMathConfig.concat([["$","$"]])}})),setTimeout(function(){var ref3;return"undefined"!=typeof MathJax&&null!==MathJax&&null!=(ref3=MathJax.Hub)?ref3.Queue(["Typeset","undefined"!=typeof MathJax&&null!==MathJax?MathJax.Hub:void 0,element.get(0)]):void 0},0)}}})})}.call(this),function(){define("filters/wrapLongWords",["base"],function(App){var DEF_MIN_LENGTH,_decodeHTMLEntities,_getWrappedWordsString;return DEF_MIN_LENGTH=20,_decodeHTMLEntities=function(str){return str.replace(/&#(\d+);/g,function(match,dec){return String.fromCharCode(dec)})},_getWrappedWordsString=function(baseStr,wrapperElName,minLength){var outputStr,word,words,wordsWrapped;return minLength=minLength||DEF_MIN_LENGTH,words=baseStr.split(" "),wordsWrapped=function(){var i,len,results;for(results=[],i=0,len=words.length;len>i;i++)word=words[i],_decodeHTMLEntities(word).length>=minLength?results.push("<"+wrapperElName+' class="break-word">'+word+"</"+wrapperElName+">"):results.push(word);return results}(),outputStr=wordsWrapped.join(" ")},App.filter("wrapLongWords",function(){return function(input,minLength){return _getWrappedWordsString(input,"span",minLength)}})})}.call(this),function(){define("ide/chat/index",["ide/chat/controllers/ChatButtonController","ide/chat/controllers/ChatController","ide/chat/controllers/ChatMessageController","directives/mathjax","filters/wrapLongWords"],function(){})}.call(this),function(){define("ide/clone/controllers/CloneProjectController",["base"],function(App){return App.controller("CloneProjectController",function($scope,$modal){return $scope.openCloneProjectModal=function(){return $modal.open({templateUrl:"cloneProjectModalTemplate",controller:"CloneProjectModalController"})}})})}.call(this),function(){define("ide/clone/controllers/CloneProjectModalController",["base"],function(App){return App.controller("CloneProjectModalController",function($scope,$modalInstance,$timeout,$http,ide){var cloneProject;return $scope.inputs={projectName:ide.$scope.project.name+" (Copy)"},$scope.state={inflight:!1,error:!1},$modalInstance.opened.then(function(){return $timeout(function(){return $scope.$broadcast("open")},200)}),cloneProject=function(cloneName){return $http.post("/project/"+ide.$scope.project._id+"/clone",{_csrf:window.csrfToken,projectName:cloneName})},$scope.clone=function(){return $scope.state.inflight=!0,$scope.state.error=!1,cloneProject($scope.inputs.projectName).then(function(response){var data;return data=response.data,window.location="/project/"+data.project_id})["catch"](function(response){var data,status;return data=response.data,status=response.status,$scope.state.inflight=!1,400===status?$scope.state.error={message:data}:$scope.state.error=!0})},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}})})}.call(this),function(){define("ide/clone/index",["ide/clone/controllers/CloneProjectController","ide/clone/controllers/CloneProjectModalController"],function(){})}.call(this),function(){define("ide/hotkeys/BackspaceHighjack",[],function(){var rx;return rx=/INPUT|SELECT|TEXTAREA/i,$(document).bind("keydown keypress",function(e){return 8!==e.which||rx.test(e.target.tagName)&&!e.target.disabled&&!e.target.readOnly?void 0:e.preventDefault()})})}.call(this),function(){define("ide/hotkeys/controllers/HotkeysController",["base","ace/ace"],function(App){return App.controller("HotkeysController",function($scope,$modal,event_tracking){return $scope.openHotkeysModal=function(){return event_tracking.sendMB("ide-open-hotkeys-modal"),$modal.open({templateUrl:"hotkeysModalTemplate",controller:"HotkeysModalController",size:"lg",resolve:{trackChangesVisible:function(){return $scope.project.features.trackChangesVisible}}})}}),App.controller("HotkeysModalController",function($scope,$modalInstance,trackChangesVisible){return $scope.trackChangesVisible=trackChangesVisible,ace.require("ace/lib/useragent").isMac?$scope.ctrl="Cmd":$scope.ctrl="Ctrl",$scope.cancel=function(){return $modalInstance.dismiss()}})})}.call(this),function(){define("ide/hotkeys/index",["ide/hotkeys/BackspaceHighjack","ide/hotkeys/controllers/HotkeysController"],function(){})}.call(this),function(){define("ide/test-controls/controllers/TestControlsController",["base","ace/ace"],function(App){return App.controller("TestControlsController",function($scope){return $scope.richText=function(){var current,target;return current=window.location.toString(),target=""+current+(window.location.search?"&":"?")+"rt=true",window.location.href=target}})})}.call(this),function(){define("ide/test-controls/index",["ide/test-controls/controllers/TestControlsController"],function(){})}.call(this),function(){define("ide/wordcount/controllers/WordCountController",["base"],function(App){return App.controller("WordCountController",function($scope,$modal){return $scope.openWordCountModal=function(){return $modal.open({templateUrl:"wordCountModalTemplate",controller:"WordCountModalController"})}})})}.call(this),function(){define("ide/wordcount/controllers/WordCountModalController",["base"],function(App){
return App.controller("WordCountModalController",function($scope,$modalInstance,ide,$http){var opts;return $scope.status={loading:!0},opts={url:"/project/"+ide.project_id+"/wordcount",method:"GET",params:{clsiserverid:ide.clsiServerId}},$http(opts).then(function(response){var data;return data=response.data,$scope.status.loading=!1,$scope.data=data.texcount})["catch"](function(){return $scope.status.error=!0}),$scope.cancel=function(){return $modalInstance.dismiss("cancel")}})})}.call(this),function(){define("ide/wordcount/index",["ide/wordcount/controllers/WordCountController","ide/wordcount/controllers/WordCountModalController"],function(){})}.call(this),$.ui=$.ui||{},$.extend($.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),$.fn.extend({scrollParent:function(includeHidden){var position=this.css("position"),excludeStaticParent="absolute"===position,overflowRegex=includeHidden?/(auto|scroll|hidden)/:/(auto|scroll)/,scrollParent=this.parents().filter(function(){var parent=$(this);return excludeStaticParent&&"static"===parent.css("position")?!1:overflowRegex.test(parent.css("overflow")+parent.css("overflow-y")+parent.css("overflow-x"))}).eq(0);return"fixed"!==position&&scrollParent.length?scrollParent:$(this[0].ownerDocument||document)},uniqueId:function(){var uuid=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++uuid)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&$(this).removeAttr("id")})}}),$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName)}}):function(elem,i,match){return!!$.data(elem,match[3])},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")))},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}}),$("<a>").outerWidth(1).jquery||$.each(["Width","Height"],function(i,name){function reduce(elem,size,border,margin){return $.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0,border&&(size-=parseFloat($.css(elem,"border"+this+"Width"))||0),margin&&(size-=parseFloat($.css(elem,"margin"+this))||0)}),size}var side="Width"===name?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};$.fn["inner"+name]=function(size){return void 0===size?orig["inner"+name].call(this):this.each(function(){$(this).css(type,reduce(this,size)+"px")})},$.fn["outer"+name]=function(size,margin){return"number"!=typeof size?orig["outer"+name].call(this,size):this.each(function(){$(this).css(type,reduce(this,size,!0,margin)+"px")})}}),$.fn.addBack||($.fn.addBack=function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}),$("<a>").data("a-b","a").removeData("a-b").data("a-b")&&($.fn.removeData=function(removeData){return function(key){return arguments.length?removeData.call(this,$.camelCase(key)):removeData.call(this)}}($.fn.removeData)),$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),$.fn.extend({focus:function(orig){return function(delay,fn){return"number"==typeof delay?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus(),fn&&fn.call(elem)},delay)}):orig.apply(this,arguments)}}($.fn.focus),disableSelection:function(){var eventType="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(eventType+".ui-disableSelection",function(event){event.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(zIndex){if(void 0!==zIndex)return this.css("zIndex",zIndex);if(this.length)for(var position,value,elem=$(this[0]);elem.length&&elem[0]!==document;){if(position=elem.css("position"),("absolute"===position||"relative"===position||"fixed"===position)&&(value=parseInt(elem.css("zIndex"),10),!isNaN(value)&&0!==value))return value;elem=elem.parent()}return 0}}),$.ui.plugin={add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set)proto.plugins[i]=proto.plugins[i]||[],proto.plugins[i].push([option,set[i]])},call:function(instance,name,args,allowDisconnected){var i,set=instance.plugins[name];if(set&&(allowDisconnected||instance.element[0].parentNode&&11!==instance.element[0].parentNode.nodeType))for(i=0;i<set.length;i++)instance.options[set[i][0]]&&set[i][1].apply(instance.element,args)}};var widget_uuid=0,widget_slice=Array.prototype.slice;$.cleanData=function(orig){return function(elems){var events,elem,i;for(i=0;null!=(elem=elems[i]);i++)try{events=$._data(elem,"events"),events&&events.remove&&$(elem).triggerHandler("remove")}catch(e){}orig(elems)}}($.cleanData),$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];return name=name.split(".")[1],fullName=namespace+"-"+name,prototype||(prototype=base,base=$.Widget),$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)},$[namespace]=$[namespace]||{},existingConstructor=$[namespace][name],constructor=$[namespace][name]=function(options,element){return this._createWidget?void(arguments.length&&this._createWidget(options,element)):new constructor(options,element)},$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]}),basePrototype=new base,basePrototype.options=$.widget.extend({},basePrototype.options),$.each(prototype,function(prop,value){return $.isFunction(value)?void(proxiedPrototype[prop]=function(){var _super=function(){return base.prototype[prop].apply(this,arguments)},_superApply=function(args){return base.prototype[prop].apply(this,args)};return function(){var returnValue,__super=this._super,__superApply=this._superApply;return this._super=_super,this._superApply=_superApply,returnValue=value.apply(this,arguments),this._super=__super,this._superApply=__superApply,returnValue}}()):void(proxiedPrototype[prop]=value)}),constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?basePrototype.widgetEventPrefix||name:name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName}),existingConstructor?($.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto)}),delete existingConstructor._childConstructors):base._childConstructors.push(constructor),$.widget.bridge(name,constructor),constructor},$.widget.extend=function(target){for(var key,value,input=widget_slice.call(arguments,1),inputIndex=0,inputLength=input.length;inputLength>inputIndex;inputIndex++)for(key in input[inputIndex])value=input[inputIndex][key],input[inputIndex].hasOwnProperty(key)&&void 0!==value&&($.isPlainObject(value)?target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value):target[key]=value);return target},$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall="string"==typeof options,args=widget_slice.call(arguments,1),returnValue=this;return isMethodCall?this.each(function(){var methodValue,instance=$.data(this,fullName);return"instance"===options?(returnValue=instance,!1):instance?$.isFunction(instance[options])&&"_"!==options.charAt(0)?(methodValue=instance[options].apply(instance,args),methodValue!==instance&&void 0!==methodValue?(returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue,!1):void 0):$.error("no such method '"+options+"' for "+name+" widget instance"):$.error("cannot call methods on "+name+" prior to initialization; attempted to call method '"+options+"'")}):(args.length&&(options=$.widget.extend.apply(null,[options].concat(args))),this.each(function(){var instance=$.data(this,fullName);instance?(instance.option(options||{}),instance._init&&instance._init()):$.data(this,fullName,new object(options,this))})),returnValue}},$.Widget=function(){},$.Widget._childConstructors=[],$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0],this.element=$(element),this.uuid=widget_uuid++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=$(),this.hoverable=$(),this.focusable=$(),element!==this&&($.data(element,this.widgetFullName,this),this._on(!0,this.element,{remove:function(event){event.target===element&&this.destroy()}}),this.document=$(element.style?element.ownerDocument:element.document||element),this.window=$(this.document[0].defaultView||this.document[0].parentWindow)),this.options=$.widget.extend({},this.options,this._getCreateOptions(),options),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function(){return this.element},option:function(key,value){var parts,curOption,i,options=key;if(0===arguments.length)return $.widget.extend({},this.options);if("string"==typeof key)if(options={},parts=key.split("."),key=parts.shift(),parts.length){for(curOption=options[key]=$.widget.extend({},this.options[key]),i=0;i<parts.length-1;i++)curOption[parts[i]]=curOption[parts[i]]||{},curOption=curOption[parts[i]];if(key=parts.pop(),1===arguments.length)return void 0===curOption[key]?null:curOption[key];curOption[key]=value}else{if(1===arguments.length)return void 0===this.options[key]?null:this.options[key];options[key]=value}return this._setOptions(options),this},_setOptions:function(options){var key;for(key in options)this._setOption(key,options[key]);return this},_setOption:function(key,value){return this.options[key]=value,"disabled"===key&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!value),value&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;"boolean"!=typeof suppressDisabledCheck&&(handlers=element,element=suppressDisabledCheck,suppressDisabledCheck=!1),handlers?(element=delegateElement=$(element),this.bindings=this.bindings.add(element)):(handlers=element,element=this.element,delegateElement=this.widget()),$.each(handlers,function(event,handler){function handlerProxy(){return suppressDisabledCheck||instance.options.disabled!==!0&&!$(this).hasClass("ui-state-disabled")?("string"==typeof handler?instance[handler]:handler).apply(instance,arguments):void 0}"string"!=typeof handler&&(handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++);var match=event.match(/^([\w:-]*)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];selector?delegateElement.delegate(selector,eventName,handlerProxy):element.bind(eventName,handlerProxy)})},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,element.unbind(eventName).undelegate(eventName),this.bindings=$(this.bindings.not(element).get()),this.focusable=$(this.focusable.not(element).get()),this.hoverable=$(this.hoverable.not(element).get())},_delay:function(handler,delay){function handlerProxy(){return("string"==typeof handler?instance[handler]:handler).apply(instance,arguments)}var instance=this;return setTimeout(handlerProxy,delay||0)},_hoverable:function(element){this.hoverable=this.hoverable.add(element),this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover")},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(element){this.focusable=this.focusable.add(element),this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus")},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];if(data=data||{},event=$.Event(event),event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase(),event.target=this.element[0],orig=event.originalEvent)for(prop in orig)prop in event||(event[prop]=orig[prop]);return this.element.trigger(event,data),!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===!1||event.isDefaultPrevented())}},$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){"string"==typeof options&&(options={effect:options});var hasOptions,effectName=options?options===!0||"number"==typeof options?defaultEffect:options.effect||defaultEffect:method;options=options||{},"number"==typeof options&&(options={duration:options}),hasOptions=!$.isEmptyObject(options),options.complete=callback,options.delay&&element.delay(options.delay),hasOptions&&$.effects&&$.effects.effect[effectName]?element[method](options):effectName!==method&&element[effectName]?element[effectName](options.duration,options.easing,callback):element.queue(function(next){$(this)[method](),callback&&callback.call(element[0]),next()})}});var widget=$.widget,mouseHandled=!1;$(document).mouseup(function(){mouseHandled=!1});var mouse=$.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind("mousedown."+this.widgetName,function(event){return that._mouseDown(event)}).bind("click."+this.widgetName,function(event){return!0===$.data(event.target,that.widgetName+".preventClickEvent")?($.removeData(event.target,that.widgetName+".preventClickEvent"),event.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(event){if(!mouseHandled){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(event),this._mouseDownEvent=event;var that=this,btnIsLeft=1===event.which,elIsCancel="string"==typeof this.options.cancel&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:!1;return btnIsLeft&&!elIsCancel&&this._mouseCapture(event)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(event)&&this._mouseDelayMet(event)&&(this._mouseStarted=this._mouseStart(event)!==!1,!this._mouseStarted)?(event.preventDefault(),!0):(!0===$.data(event.target,this.widgetName+".preventClickEvent")&&$.removeData(event.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(event){return that._mouseMove(event)},this._mouseUpDelegate=function(event){return that._mouseUp(event)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),event.preventDefault(),mouseHandled=!0,!0)):!0}},_mouseMove:function(event){if(this._mouseMoved){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button)return this._mouseUp(event);if(!event.which)return this._mouseUp(event)}return(event.which||event.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(event),event.preventDefault()):(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,event)!==!1,this._mouseStarted?this._mouseDrag(event):this._mouseUp(event)),!this._mouseStarted)},_mouseUp:function(event){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,event.target===this._mouseDownEvent.target&&$.data(event.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(event)),mouseHandled=!1,!1},_mouseDistanceMet:function(event){return Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}});$.widget("ui.draggable",$.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(key,value){this._super(key,value),"handle"===key&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(event){var o=this.options;return this._blurActiveElement(event),this.helper||o.disabled||$(event.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(event),this.handle?(this._blockFrames(o.iframeFix===!0?"iframe":o.iframeFix),!0):!1)},_blockFrames:function(selector){this.iframeBlocks=this.document.find(selector).map(function(){var iframe=$(this);return $("<div>").css("position","absolute").appendTo(iframe.parent()).outerWidth(iframe.outerWidth()).outerHeight(iframe.outerHeight()).offset(iframe.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(event){var document=this.document[0];if(this.handleElement.is(event.target))try{document.activeElement&&"body"!==document.activeElement.nodeName.toLowerCase()&&$(document.activeElement).blur()}catch(error){}},_mouseStart:function(event){var o=this.options;return this.helper=this._createHelper(event),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),$.ui.ddmanager&&($.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===$(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(event),this.originalPosition=this.position=this._generatePosition(event,!1),this.originalPageX=event.pageX,this.originalPageY=event.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this._setContainment(),this._trigger("start",event)===!1?(this._clear(),!1):(this._cacheHelperProportions(),$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,event),this._normalizeRightBottom(),this._mouseDrag(event,!0),$.ui.ddmanager&&$.ui.ddmanager.dragStart(this,event),!0)},_refreshOffsets:function(event){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:event.pageX-this.offset.left,top:event.pageY-this.offset.top}},_mouseDrag:function(event,noPropagation){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(event,!0),this.positionAbs=this._convertPositionTo("absolute"),!noPropagation){var ui=this._uiHash();if(this._trigger("drag",event,ui)===!1)return this._mouseUp({}),!1;this.position=ui.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",$.ui.ddmanager&&$.ui.ddmanager.drag(this,event),!1},_mouseStop:function(event){var that=this,dropped=!1;return $.ui.ddmanager&&!this.options.dropBehaviour&&(dropped=$.ui.ddmanager.drop(this,event)),this.dropped&&(dropped=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!dropped||"valid"===this.options.revert&&dropped||this.options.revert===!0||$.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped)?$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){that._trigger("stop",event)!==!1&&that._clear()}):this._trigger("stop",event)!==!1&&this._clear(),!1},_mouseUp:function(event){return this._unblockFrames(),$.ui.ddmanager&&$.ui.ddmanager.dragStop(this,event),this.handleElement.is(event.target)&&this.element.focus(),$.ui.mouse.prototype._mouseUp.call(this,event)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(event){return this.options.handle?!!$(event.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(event){var o=this.options,helperIsFunction=$.isFunction(o.helper),helper=helperIsFunction?$(o.helper.apply(this.element[0],[event])):"clone"===o.helper?this.element.clone().removeAttr("id"):this.element;return helper.parents("body").length||helper.appendTo("parent"===o.appendTo?this.element[0].parentNode:o.appendTo),helperIsFunction&&helper[0]===this.element[0]&&this._setPositionRelative(),helper[0]===this.element[0]||/(fixed|absolute)/.test(helper.css("position"))||helper.css("position","absolute"),helper},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(obj){"string"==typeof obj&&(obj=obj.split(" ")),$.isArray(obj)&&(obj={left:+obj[0],top:+obj[1]||0}),"left"in obj&&(this.offset.click.left=obj.left+this.margins.left),"right"in obj&&(this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left),"top"in obj&&(this.offset.click.top=obj.top+this.margins.top),"bottom"in obj&&(this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top)},_isRootNode:function(element){return/(html|body)/i.test(element.tagName)||element===this.document[0]},_getParentOffset:function(){var po=this.offsetParent.offset(),document=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])&&(po.left+=this.scrollParent.scrollLeft(),po.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(po={top:0,left:0}),{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var p=this.element.position(),scrollIsRootNode=this._isRootNode(this.scrollParent[0]);return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+(scrollIsRootNode?0:this.scrollParent.scrollTop()),left:p.left-(parseInt(this.helper.css("left"),10)||0)+(scrollIsRootNode?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var isUserScrollable,c,ce,o=this.options,document=this.document[0];return this.relativeContainer=null,o.containment?"window"===o.containment?void(this.containment=[$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,$(window).scrollLeft()+$(window).width()-this.helperProportions.width-this.margins.left,$(window).scrollTop()+($(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===o.containment?void(this.containment=[0,0,$(document).width()-this.helperProportions.width-this.margins.left,($(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):o.containment.constructor===Array?void(this.containment=o.containment):("parent"===o.containment&&(o.containment=this.helper[0].parentNode),c=$(o.containment),ce=c[0],void(ce&&(isUserScrollable=/(scroll|auto)/.test(c.css("overflow")),this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(isUserScrollable?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(isUserScrollable?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=c))):void(this.containment=null)},_convertPositionTo:function(d,pos){pos||(pos=this.position);var mod="absolute"===d?1:-1,scrollIsRootNode=this._isRootNode(this.scrollParent[0]);return{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-("fixed"===this.cssPosition?-this.offset.scroll.top:scrollIsRootNode?0:this.offset.scroll.top)*mod,left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-("fixed"===this.cssPosition?-this.offset.scroll.left:scrollIsRootNode?0:this.offset.scroll.left)*mod}},_generatePosition:function(event,constrainPosition){var containment,co,top,left,o=this.options,scrollIsRootNode=this._isRootNode(this.scrollParent[0]),pageX=event.pageX,pageY=event.pageY;return scrollIsRootNode&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),constrainPosition&&(this.containment&&(this.relativeContainer?(co=this.relativeContainer.offset(),containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top]):containment=this.containment,event.pageX-this.offset.click.left<containment[0]&&(pageX=containment[0]+this.offset.click.left),event.pageY-this.offset.click.top<containment[1]&&(pageY=containment[1]+this.offset.click.top),event.pageX-this.offset.click.left>containment[2]&&(pageX=containment[2]+this.offset.click.left),event.pageY-this.offset.click.top>containment[3]&&(pageY=containment[3]+this.offset.click.top)),o.grid&&(top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,pageY=containment?top-this.offset.click.top>=containment[1]||top-this.offset.click.top>containment[3]?top:top-this.offset.click.top>=containment[1]?top-o.grid[1]:top+o.grid[1]:top,left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,pageX=containment?left-this.offset.click.left>=containment[0]||left-this.offset.click.left>containment[2]?left:left-this.offset.click.left>=containment[0]?left-o.grid[0]:left+o.grid[0]:left),"y"===o.axis&&(pageX=this.originalPageX),"x"===o.axis&&(pageY=this.originalPageY)),{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:scrollIsRootNode?0:this.offset.scroll.top),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:scrollIsRootNode?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(type,event,ui){return ui=ui||this._uiHash(),$.ui.plugin.call(this,type,[event,ui,this],!0),/^(drag|start|stop)/.test(type)&&(this.positionAbs=this._convertPositionTo("absolute"),ui.offset=this.positionAbs),$.Widget.prototype._trigger.call(this,type,event,ui)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui,draggable){var uiSortable=$.extend({},ui,{item:draggable.element});draggable.sortables=[],$(draggable.options.connectToSortable).each(function(){var sortable=$(this).sortable("instance");sortable&&!sortable.options.disabled&&(draggable.sortables.push(sortable),sortable.refreshPositions(),sortable._trigger("activate",event,uiSortable))})},stop:function(event,ui,draggable){var uiSortable=$.extend({},ui,{item:draggable.element});draggable.cancelHelperRemoval=!1,$.each(draggable.sortables,function(){var sortable=this;sortable.isOver?(sortable.isOver=0,draggable.cancelHelperRemoval=!0,sortable.cancelHelperRemoval=!1,sortable._storedCSS={position:sortable.placeholder.css("position"),top:sortable.placeholder.css("top"),left:sortable.placeholder.css("left")},sortable._mouseStop(event),sortable.options.helper=sortable.options._helper):(sortable.cancelHelperRemoval=!0,sortable._trigger("deactivate",event,uiSortable))})},drag:function(event,ui,draggable){$.each(draggable.sortables,function(){var innermostIntersecting=!1,sortable=this;sortable.positionAbs=draggable.positionAbs,sortable.helperProportions=draggable.helperProportions,sortable.offset.click=draggable.offset.click,sortable._intersectsWith(sortable.containerCache)&&(innermostIntersecting=!0,$.each(draggable.sortables,function(){return this.positionAbs=draggable.positionAbs,this.helperProportions=draggable.helperProportions,this.offset.click=draggable.offset.click,this!==sortable&&this._intersectsWith(this.containerCache)&&$.contains(sortable.element[0],this.element[0])&&(innermostIntersecting=!1),innermostIntersecting})),innermostIntersecting?(sortable.isOver||(sortable.isOver=1,draggable._parent=ui.helper.parent(),sortable.currentItem=ui.helper.appendTo(sortable.element).data("ui-sortable-item",!0),sortable.options._helper=sortable.options.helper,sortable.options.helper=function(){return ui.helper[0];
},event.target=sortable.currentItem[0],sortable._mouseCapture(event,!0),sortable._mouseStart(event,!0,!0),sortable.offset.click.top=draggable.offset.click.top,sortable.offset.click.left=draggable.offset.click.left,sortable.offset.parent.left-=draggable.offset.parent.left-sortable.offset.parent.left,sortable.offset.parent.top-=draggable.offset.parent.top-sortable.offset.parent.top,draggable._trigger("toSortable",event),draggable.dropped=sortable.element,$.each(draggable.sortables,function(){this.refreshPositions()}),draggable.currentItem=draggable.element,sortable.fromOutside=draggable),sortable.currentItem&&(sortable._mouseDrag(event),ui.position=sortable.position)):sortable.isOver&&(sortable.isOver=0,sortable.cancelHelperRemoval=!0,sortable.options._revert=sortable.options.revert,sortable.options.revert=!1,sortable._trigger("out",event,sortable._uiHash(sortable)),sortable._mouseStop(event,!0),sortable.options.revert=sortable.options._revert,sortable.options.helper=sortable.options._helper,sortable.placeholder&&sortable.placeholder.remove(),ui.helper.appendTo(draggable._parent),draggable._refreshOffsets(event),ui.position=draggable._generatePosition(event,!0),draggable._trigger("fromSortable",event),draggable.dropped=!1,$.each(draggable.sortables,function(){this.refreshPositions()}))})}}),$.ui.plugin.add("draggable","cursor",{start:function(event,ui,instance){var t=$("body"),o=instance.options;t.css("cursor")&&(o._cursor=t.css("cursor")),t.css("cursor",o.cursor)},stop:function(event,ui,instance){var o=instance.options;o._cursor&&$("body").css("cursor",o._cursor)}}),$.ui.plugin.add("draggable","opacity",{start:function(event,ui,instance){var t=$(ui.helper),o=instance.options;t.css("opacity")&&(o._opacity=t.css("opacity")),t.css("opacity",o.opacity)},stop:function(event,ui,instance){var o=instance.options;o._opacity&&$(ui.helper).css("opacity",o._opacity)}}),$.ui.plugin.add("draggable","scroll",{start:function(event,ui,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(event,ui,i){var o=i.options,scrolled=!1,scrollParent=i.scrollParentNotHidden[0],document=i.document[0];scrollParent!==document&&"HTML"!==scrollParent.tagName?(o.axis&&"x"===o.axis||(i.overflowOffset.top+scrollParent.offsetHeight-event.pageY<o.scrollSensitivity?scrollParent.scrollTop=scrolled=scrollParent.scrollTop+o.scrollSpeed:event.pageY-i.overflowOffset.top<o.scrollSensitivity&&(scrollParent.scrollTop=scrolled=scrollParent.scrollTop-o.scrollSpeed)),o.axis&&"y"===o.axis||(i.overflowOffset.left+scrollParent.offsetWidth-event.pageX<o.scrollSensitivity?scrollParent.scrollLeft=scrolled=scrollParent.scrollLeft+o.scrollSpeed:event.pageX-i.overflowOffset.left<o.scrollSensitivity&&(scrollParent.scrollLeft=scrolled=scrollParent.scrollLeft-o.scrollSpeed))):(o.axis&&"x"===o.axis||(event.pageY-$(document).scrollTop()<o.scrollSensitivity?scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed):$(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity&&(scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed))),o.axis&&"y"===o.axis||(event.pageX-$(document).scrollLeft()<o.scrollSensitivity?scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed):$(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity&&(scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed)))),scrolled!==!1&&$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(i,event)}}),$.ui.plugin.add("draggable","snap",{start:function(event,ui,i){var o=i.options;i.snapElements=[],$(o.snap.constructor!==String?o.snap.items||":data(ui-draggable)":o.snap).each(function(){var $t=$(this),$o=$t.offset();this!==i.element[0]&&i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left})})},drag:function(event,ui,inst){var ts,bs,ls,rs,l,r,t,b,i,first,o=inst.options,d=o.snapTolerance,x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(i=inst.snapElements.length-1;i>=0;i--)l=inst.snapElements[i].left-inst.margins.left,r=l+inst.snapElements[i].width,t=inst.snapElements[i].top-inst.margins.top,b=t+inst.snapElements[i].height,l-d>x2||x1>r+d||t-d>y2||y1>b+d||!$.contains(inst.snapElements[i].item.ownerDocument,inst.snapElements[i].item)?(inst.snapElements[i].snapping&&inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})),inst.snapElements[i].snapping=!1):("inner"!==o.snapMode&&(ts=Math.abs(t-y2)<=d,bs=Math.abs(b-y1)<=d,ls=Math.abs(l-x2)<=d,rs=Math.abs(r-x1)<=d,ts&&(ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top),bs&&(ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top),ls&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left),rs&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left)),first=ts||bs||ls||rs,"outer"!==o.snapMode&&(ts=Math.abs(t-y1)<=d,bs=Math.abs(b-y2)<=d,ls=Math.abs(l-x1)<=d,rs=Math.abs(r-x2)<=d,ts&&(ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top),bs&&(ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top),ls&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left),rs&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left)),!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)&&inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})),inst.snapElements[i].snapping=ts||bs||ls||rs||first)}}),$.ui.plugin.add("draggable","stack",{start:function(event,ui,instance){var min,o=instance.options,group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0)});group.length&&(min=parseInt($(group[0]).css("zIndex"),10)||0,$(group).each(function(i){$(this).css("zIndex",min+i)}),this.css("zIndex",min+group.length))}}),$.ui.plugin.add("draggable","zIndex",{start:function(event,ui,instance){var t=$(ui.helper),o=instance.options;t.css("zIndex")&&(o._zIndex=t.css("zIndex")),t.css("zIndex",o.zIndex)},stop:function(event,ui,instance){var o=instance.options;o._zIndex&&$(ui.helper).css("zIndex",o._zIndex)}});var draggable=$.ui.draggable;$.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var proportions,o=this.options,accept=o.accept;this.isover=!1,this.isout=!0,this.accept=$.isFunction(accept)?accept:function(d){return d.is(accept)},this.proportions=function(){return arguments.length?void(proportions=arguments[0]):proportions?proportions:proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(o.scope),o.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(scope){$.ui.ddmanager.droppables[scope]=$.ui.ddmanager.droppables[scope]||[],$.ui.ddmanager.droppables[scope].push(this)},_splice:function(drop){for(var i=0;i<drop.length;i++)drop[i]===this&&drop.splice(i,1)},_destroy:function(){var drop=$.ui.ddmanager.droppables[this.options.scope];this._splice(drop),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(key,value){if("accept"===key)this.accept=$.isFunction(value)?value:function(d){return d.is(value)};else if("scope"===key){var drop=$.ui.ddmanager.droppables[this.options.scope];this._splice(drop),this._addToManager(value)}this._super(key,value)},_activate:function(event){var draggable=$.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),draggable&&this._trigger("activate",event,this.ui(draggable))},_deactivate:function(event){var draggable=$.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),draggable&&this._trigger("deactivate",event,this.ui(draggable))},_over:function(event){var draggable=$.ui.ddmanager.current;draggable&&(draggable.currentItem||draggable.element)[0]!==this.element[0]&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",event,this.ui(draggable)))},_out:function(event){var draggable=$.ui.ddmanager.current;draggable&&(draggable.currentItem||draggable.element)[0]!==this.element[0]&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",event,this.ui(draggable)))},_drop:function(event,custom){var draggable=custom||$.ui.ddmanager.current,childrenIntersection=!1;return draggable&&(draggable.currentItem||draggable.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var inst=$(this).droppable("instance");return inst.options.greedy&&!inst.options.disabled&&inst.options.scope===draggable.options.scope&&inst.accept.call(inst.element[0],draggable.currentItem||draggable.element)&&$.ui.intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance,event)?(childrenIntersection=!0,!1):void 0}),childrenIntersection?!1:this.accept.call(this.element[0],draggable.currentItem||draggable.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",event,this.ui(draggable)),this.element):!1):!1},ui:function(c){return{draggable:c.currentItem||c.element,helper:c.helper,position:c.position,offset:c.positionAbs}}}),$.ui.intersect=function(){function isOverAxis(x,reference,size){return x>=reference&&reference+size>x}return function(draggable,droppable,toleranceMode,event){if(!droppable.offset)return!1;var x1=(draggable.positionAbs||draggable.position.absolute).left+draggable.margins.left,y1=(draggable.positionAbs||draggable.position.absolute).top+draggable.margins.top,x2=x1+draggable.helperProportions.width,y2=y1+draggable.helperProportions.height,l=droppable.offset.left,t=droppable.offset.top,r=l+droppable.proportions().width,b=t+droppable.proportions().height;switch(toleranceMode){case"fit":return x1>=l&&r>=x2&&y1>=t&&b>=y2;case"intersect":return l<x1+draggable.helperProportions.width/2&&x2-draggable.helperProportions.width/2<r&&t<y1+draggable.helperProportions.height/2&&y2-draggable.helperProportions.height/2<b;case"pointer":return isOverAxis(event.pageY,t,droppable.proportions().height)&&isOverAxis(event.pageX,l,droppable.proportions().width);case"touch":return(y1>=t&&b>=y1||y2>=t&&b>=y2||t>y1&&y2>b)&&(x1>=l&&r>=x1||x2>=l&&r>=x2||l>x1&&x2>r);default:return!1}}}(),$.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,event){var i,j,m=$.ui.ddmanager.droppables[t.options.scope]||[],type=event?event.type:null,list=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();droppablesLoop:for(i=0;i<m.length;i++)if(!(m[i].options.disabled||t&&!m[i].accept.call(m[i].element[0],t.currentItem||t.element))){for(j=0;j<list.length;j++)if(list[j]===m[i].element[0]){m[i].proportions().height=0;continue droppablesLoop}m[i].visible="none"!==m[i].element.css("display"),m[i].visible&&("mousedown"===type&&m[i]._activate.call(m[i],event),m[i].offset=m[i].element.offset(),m[i].proportions({width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight}))}},drop:function(draggable,event){var dropped=!1;return $.each(($.ui.ddmanager.droppables[draggable.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&$.ui.intersect(draggable,this,this.options.tolerance,event)&&(dropped=this._drop.call(this,event)||dropped),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,event)))}),dropped},dragStart:function(draggable,event){draggable.element.parentsUntil("body").bind("scroll.droppable",function(){draggable.options.refreshPositions||$.ui.ddmanager.prepareOffsets(draggable,event)})},drag:function(draggable,event){draggable.options.refreshPositions&&$.ui.ddmanager.prepareOffsets(draggable,event);var droppables=$.ui.ddmanager.droppables[draggable.options.scope]||[];$.each(droppables,function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var parentInstance,scope,parent,intersects=$.ui.intersect(draggable,this,this.options.tolerance,event),c=!intersects&&this.isover?"isout":intersects&&!this.isover?"isover":null;c&&(this.options.greedy&&(scope=this.options.scope,parent=this.element.parents(":data(ui-droppable)").filter(function(){return $(this).droppable("instance").options.scope===scope}),parent.length&&(parentInstance=$(parent[0]).droppable("instance"),parentInstance.enteredGreedyChild=parentInstance.enteredGreedyChild||"isover"===c,parentInstance.leftGreedyChild=parentInstance.leftGreedyChild||"isout"===c)),this[c]=!0,this["isout"===c?"isover":"isout"]=!1,this.c=c)}}),$.each(droppables,function(){this.enteredGreedyChild&&(this.greedyChild=!0,this.isover=!1,this.isout=!0,this.c="isout"),this.leftGreedyChild&&!this.enteredGreedyChild&&(this.greedyChild=!1,this.isover=!0,this.isout=!1,this.c="isover"),this.c&&(this["isover"===this.c?"_over":"_out"].call(this,event),this.leftGreedyChild=!1,this.enteredGreedyChild=!1,this.c=null)})},dragStop:function(draggable,event){draggable.element.parentsUntil("body").unbind("scroll.droppable"),draggable.options.refreshPositions||$.ui.ddmanager.prepareOffsets(draggable,event)}};var droppable=$.ui.droppable;!function($){var min=Math.min,max=Math.max,round=Math.floor,isStr=function(v){return"string"===$.type(v)},runPluginCallbacks=function(Instance,a_fn){function g(f){return f}if($.isArray(a_fn))for(var i=0,c=a_fn.length;c>i;i++){var fn=a_fn[i];try{isStr(fn)&&(fn=eval(fn)),$.isFunction(fn)&&g(fn)(Instance)}catch(ex){}}};$.layout={version:"1.3.rc30.79",revision:.033007,browser:{},effects:{slide:{all:{duration:"fast"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},drop:{all:{duration:"slow"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},scale:{all:{duration:"fast"}},blind:{},clip:{},explode:{},fade:{},fold:{},puff:{},size:{all:{easing:"swing"}}},config:{optionRootKeys:"effects,panes,north,south,west,east,center".split(","),allPanes:"north,south,west,east,center".split(","),borderPanes:"north,south,west,east".split(","),oppositeEdge:{north:"south",south:"north",east:"west",west:"east"},offscreenCSS:{left:"-99999px",right:"auto"},offscreenReset:"offscreenReset",hidden:{visibility:"hidden"},visible:{visibility:"visible"},resizers:{cssReq:{position:"absolute",padding:0,margin:0,fontSize:"1px",textAlign:"left",overflow:"hidden"},cssDemo:{background:"#DDD",border:"none"}},togglers:{cssReq:{position:"absolute",display:"block",padding:0,margin:0,overflow:"hidden",textAlign:"center",fontSize:"1px",cursor:"pointer",zIndex:1},cssDemo:{background:"#AAA"}},content:{cssReq:{position:"relative"},cssDemo:{overflow:"auto",padding:"10px"},cssDemoPane:{overflow:"hidden",padding:0}},panes:{cssReq:{position:"absolute",margin:0},cssDemo:{padding:"10px",background:"#FFF",border:"1px solid #BBB",overflow:"auto"}},north:{side:"top",sizeType:"Height",dir:"horz",cssReq:{top:0,bottom:"auto",left:0,right:0,width:"auto"}},south:{side:"bottom",sizeType:"Height",dir:"horz",cssReq:{top:"auto",bottom:0,left:0,right:0,width:"auto"}},east:{side:"right",sizeType:"Width",dir:"vert",cssReq:{left:"auto",right:0,top:"auto",bottom:"auto",height:"auto"}},west:{side:"left",sizeType:"Width",dir:"vert",cssReq:{left:0,right:"auto",top:"auto",bottom:"auto",height:"auto"}},center:{dir:"center",cssReq:{left:"auto",right:"auto",top:"auto",bottom:"auto",height:"auto",width:"auto"}}},callbacks:{},getParentPaneElem:function(el){var $el=$(el),layout=$el.data("layout")||$el.data("parentLayout");if(layout){var $cont=layout.container;if($cont.data("layoutPane"))return $cont;var $pane=$cont.closest("."+$.layout.defaults.panes.paneClass);if($pane.data("layoutPane"))return $pane}return null},getParentPaneInstance:function(el){var $pane=$.layout.getParentPaneElem(el);return $pane?$pane.data("layoutPane"):null},getParentLayoutInstance:function(el){var $pane=$.layout.getParentPaneElem(el);return $pane?$pane.data("parentLayout"):null},getEventObject:function(evt){return"object"==typeof evt&&evt.stopPropagation?evt:null},parsePaneName:function(evt_or_pane){var evt=$.layout.getEventObject(evt_or_pane),pane=evt_or_pane;return evt&&(evt.stopPropagation(),pane=$(this).data("layoutEdge")),pane&&!/^(west|east|north|south|center)$/.test(pane)&&($.layout.msg('LAYOUT ERROR - Invalid pane-name: "'+pane+'"'),pane="error"),pane},plugins:{draggable:!!$.fn.draggable,effects:{core:!!$.effects,slide:$.effects&&($.effects.slide||$.effects.effect&&$.effects.effect.slide)}},onCreate:[],onLoad:[],onReady:[],onDestroy:[],onUnload:[],afterOpen:[],afterClose:[],scrollbarWidth:function(){return window.scrollbarWidth||$.layout.getScrollbarSize("width")},scrollbarHeight:function(){return window.scrollbarHeight||$.layout.getScrollbarSize("height")},getScrollbarSize:function(dim){var $c=$('<div style="position: absolute; top: -10000px; left: -10000px; width: 100px; height: 100px; overflow: scroll;"></div>').appendTo("body"),d={width:$c.css("width")-$c[0].clientWidth,height:$c.height()-$c[0].clientHeight};return $c.remove(),window.scrollbarWidth=d.width,window.scrollbarHeight=d.height,dim.match(/^(width|height)$/)?d[dim]:d},showInvisibly:function($E,force){if($E&&$E.length&&(force||"none"===$E.css("display"))){var s=$E[0].style,CSS={display:s.display||"",visibility:s.visibility||""};return $E.css({display:"block",visibility:"hidden"}),CSS}return{}},getElementDimensions:function($E,inset){var b,p,ei,d={css:{},inset:{}},x=d.css,i={bottom:0},N=$.layout.cssNum,off=$E.offset();return d.offsetLeft=off.left,d.offsetTop=off.top,inset||(inset={}),$.each("Left,Right,Top,Bottom".split(","),function(idx,e){b=x["border"+e]=$.layout.borderWidth($E,e),p=x["padding"+e]=$.layout.cssNum($E,"padding"+e),ei=e.toLowerCase(),d.inset[ei]=inset[ei]>=0?inset[ei]:p,i[ei]=d.inset[ei]+b}),x.width=$E.width(),x.height=$E.height(),x.top=N($E,"top",!0),x.bottom=N($E,"bottom",!0),x.left=N($E,"left",!0),x.right=N($E,"right",!0),d.outerWidth=$E.outerWidth(),d.outerHeight=$E.outerHeight(),d.innerWidth=max(0,d.outerWidth-i.left-i.right),d.innerHeight=max(0,d.outerHeight-i.top-i.bottom),d.layoutWidth=$E.innerWidth(),d.layoutHeight=$E.innerHeight(),d},getElementStyles:function($E,list){var p,s,a,i,j,k,CSS={},style=$E[0].style,props=list.split(","),sides="Top,Bottom,Left,Right".split(","),attrs="Color,Style,Width".split(",");for(i=0;i<props.length;i++)if(p=props[i],p.match(/(border|padding|margin)$/))for(j=0;4>j;j++)if(s=sides[j],"border"===p)for(k=0;3>k;k++)a=attrs[k],CSS[p+s+a]=style[p+s+a];else CSS[p+s]=style[p+s];else CSS[p]=style[p];return CSS},cssWidth:function($E,outerWidth){if(0>=outerWidth)return 0;var bs=$.layout.browser.boxModel?$.support.boxSizing?$E.css("boxSizing"):"content-box":"border-box",b=$.layout.borderWidth,n=$.layout.cssNum,W=outerWidth;return"border-box"!==bs&&(W-=b($E,"Left")+b($E,"Right")),"content-box"===bs&&(W-=n($E,"paddingLeft")+n($E,"paddingRight")),max(0,W)},cssHeight:function($E,outerHeight){if(0>=outerHeight)return 0;var bs=$.layout.browser.boxModel?$.support.boxSizing?$E.css("boxSizing"):"content-box":"border-box",b=$.layout.borderWidth,n=$.layout.cssNum,H=outerHeight;return"border-box"!==bs&&(H-=b($E,"Top")+b($E,"Bottom")),"content-box"===bs&&(H-=n($E,"paddingTop")+n($E,"paddingBottom")),max(0,H)},cssNum:function($E,prop,allowAuto){$E.jquery||($E=$($E));var CSS=$.layout.showInvisibly($E),p=$.css($E[0],prop,!0),v=allowAuto&&"auto"==p?p:Math.round(parseFloat(p)||0);return $E.css(CSS),v},borderWidth:function(el,side){el.jquery&&(el=el[0]);var b="border"+side.substr(0,1).toUpperCase()+side.substr(1);return"none"===$.css(el,b+"Style",!0)?0:Math.round(parseFloat($.css(el,b+"Width",!0))||0)},isMouseOverElem:function(evt,el){var $E=$(el||this),d=$E.offset(),T=d.top,L=d.left,R=L+$E.outerWidth(),B=T+$E.outerHeight(),x=evt.pageX,y=evt.pageY;return $.layout.browser.msie&&0>x&&0>y||x>=L&&R>=x&&y>=T&&B>=y},msg:function(info,popup,debugTitle,debugOpts){function createLog(){var pos=$.support.fixedPosition?"fixed":"absolute",$e=$('<div id="layoutLogger" style="position: '+pos+'; top: 5px; z-index: 999999; max-width: 25%; overflow: hidden; border: 1px solid #000; border-radius: 5px; background: #FBFBFB; box-shadow: 0 2px 10px rgba(0,0,0,0.3);"><div style="font-size: 13px; font-weight: bold; padding: 5px 10px; background: #F6F6F6; border-radius: 5px 5px 0 0; cursor: move;"><span style="float: right; padding-left: 7px; cursor: pointer;" title="Remove Console" onclick="$(this).closest(\'#layoutLogger\').remove()">X</span>Layout console.log</div><ul style="font-size: 13px; font-weight: none; list-style: none; margin: 0; padding: 0 0 2px;"></ul></div>').appendTo("body");return $e.css("left",$(window).width()-$e.outerWidth()-5),$.ui.draggable&&$e.draggable({handle:":first-child"}),$e}if($.isPlainObject(info)&&window.debugData){"string"==typeof popup?(debugOpts=debugTitle,debugTitle=popup):"object"==typeof debugTitle&&(debugOpts=debugTitle,debugTitle=null);var t=debugTitle||"log( <object> )",o=$.extend({sort:!1,returnHTML:!1,display:!1},debugOpts);popup===!0||o.display?debugData(info,t,o):window.console&&console.log(debugData(info,t,o))}else if(popup)alert(info);else if(window.console)console.log(info);else{var id="#layoutLogger",$l=$(id);$l.length||($l=createLog()),$l.children("ul").append('<li style="padding: 4px 10px; margin: 0; border-top: 1px solid #CCC;">'+info.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")+"</li>")}}};var u=navigator.userAgent.toLowerCase(),m=/(chrome)[ \/]([\w.]+)/.exec(u)||/(webkit)[ \/]([\w.]+)/.exec(u)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(u)||/(msie) ([\w.]+)/.exec(u)||u.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(u)||[],b=m[1]||"",v=m[2]||0,ie="msie"===b;$.layout.browser={version:v,safari:"webkit"===b,webkit:"chrome"===b,msie:ie,isIE6:ie&&6==v,boxModel:!ie||$.support.boxModel!==!1},b&&($.layout.browser[b]=!0),ie&&$(function(){$.layout.browser.boxModel=$.support.boxModel}),$.layout.defaults={name:"",containerClass:"ui-layout-container",inset:null,scrollToBookmarkOnLoad:!0,resizeWithWindow:!0,resizeWithWindowDelay:200,resizeWithWindowMaxDelay:0,maskPanesEarly:!1,onresizeall_start:null,onresizeall_end:null,onload_start:null,onload_end:null,onunload_start:null,onunload_end:null,initPanes:!0,showErrorMessages:!0,showDebugMessages:!1,zIndex:null,zIndexes:{pane_normal:0,content_mask:1,resizer_normal:2,pane_sliding:100,pane_animate:1e3,resizer_drag:1e4},errors:{pane:"pane",selector:"selector",addButtonError:"Error Adding Button\nInvalid ",containerMissing:"UI Layout Initialization Error\nThe specified layout-container does not exist.",centerPaneMissing:"UI Layout Initialization Error\nThe center-pane element does not exist.\nThe center-pane is a required element.",noContainerHeight:"UI Layout Initialization Warning\nThe layout-container \"CONTAINER\" has no height.\nTherefore the layout is 0-height and hence 'invisible'!",callbackError:"UI Layout Callback Error\nThe EVENT callback is not a valid function."},panes:{applyDemoStyles:!1,closable:!0,resizable:!0,slidable:!0,initClosed:!1,initHidden:!1,contentSelector:".ui-layout-content",contentIgnoreSelector:".ui-layout-ignore",findNestedContent:!1,paneClass:"ui-layout-pane",resizerClass:"ui-layout-resizer",togglerClass:"ui-layout-toggler",buttonClass:"ui-layout-button",minSize:0,maxSize:0,spacing_open:6,spacing_closed:6,togglerLength_open:50,togglerLength_closed:50,togglerAlign_open:"center",togglerAlign_closed:"center",togglerContent_open:"",togglerContent_closed:"",resizerDblClickToggle:!0,autoResize:!0,autoReopen:!0,resizerDragOpacity:1,maskContents:!1,maskObjects:!1,maskZindex:null,resizingGrid:!1,livePaneResizing:!1,liveContentResizing:!1,liveResizingTolerance:1,sliderCursor:"pointer",slideTrigger_open:"click",slideTrigger_close:"mouseleave",slideDelay_open:300,slideDelay_close:300,hideTogglerOnSlide:!1,preventQuickSlideClose:$.layout.browser.webkit,preventPrematureSlideClose:!1,tips:{Open:"Open",Close:"Close",Resize:"Resize",Slide:"Slide Open",Pin:"Pin",Unpin:"Un-Pin",noRoomToOpen:"Not enough room to show this panel.",minSizeWarning:"Panel has reached its minimum size",maxSizeWarning:"Panel has reached its maximum size"},showOverflowOnHover:!1,enableCursorHotkey:!0,customHotkeyModifier:"SHIFT",fxName:"slide",fxSpeed:null,fxSettings:{},fxOpacityFix:!0,animatePaneSizing:!1,children:null,containerSelector:"",initChildren:!0,destroyChildren:!0,resizeChildren:!0,triggerEventsOnLoad:!1,triggerEventsDuringLiveResize:!0,onshow_start:null,onshow_end:null,onhide_start:null,onhide_end:null,onopen_start:null,onopen_end:null,onclose_start:null,onclose_end:null,onresize_start:null,onresize_end:null,onsizecontent_start:null,onsizecontent_end:null,onswap_start:null,onswap_end:null,ondrag_start:null,ondrag_end:null},north:{paneSelector:".ui-layout-north",size:"auto",resizerCursor:"n-resize",customHotkey:""},south:{paneSelector:".ui-layout-south",size:"auto",resizerCursor:"s-resize",customHotkey:""},east:{paneSelector:".ui-layout-east",size:200,resizerCursor:"e-resize",customHotkey:""},west:{paneSelector:".ui-layout-west",size:200,resizerCursor:"w-resize",customHotkey:""},center:{paneSelector:".ui-layout-center",minWidth:0,minHeight:0}},$.layout.optionsMap={layout:"name,instanceKey,stateManagement,effects,inset,zIndexes,errors,zIndex,scrollToBookmarkOnLoad,showErrorMessages,maskPanesEarly,outset,resizeWithWindow,resizeWithWindowDelay,resizeWithWindowMaxDelay,onresizeall,onresizeall_start,onresizeall_end,onload,onload_start,onload_end,onunload,onunload_start,onunload_end".split(","),center:"paneClass,contentSelector,contentIgnoreSelector,findNestedContent,applyDemoStyles,triggerEventsOnLoad,showOverflowOnHover,maskContents,maskObjects,liveContentResizing,containerSelector,children,initChildren,resizeChildren,destroyChildren,onresize,onresize_start,onresize_end,onsizecontent,onsizecontent_start,onsizecontent_end".split(","),noDefault:"paneSelector,resizerCursor,customHotkey".split(",")},$.layout.transformData=function(hash,addKeys){var branch,optKey,keys,key,val,i,c,json=addKeys?{panes:{},center:{}}:{};if("object"!=typeof hash)return json;for(optKey in hash)for(branch=json,val=hash[optKey],keys=optKey.split("__"),c=keys.length-1,i=0;c>=i;i++)key=keys[i],i===c?$.isPlainObject(val)?branch[key]=$.layout.transformData(val):branch[key]=val:(branch[key]||(branch[key]={}),branch=branch[key]);return json},$.layout.backwardCompatibility={map:{applyDefaultStyles:"applyDemoStyles",childOptions:"children",initChildLayout:"initChildren",destroyChildLayout:"destroyChildren",resizeChildLayout:"resizeChildren",resizeNestedLayout:"resizeChildren",resizeWhileDragging:"livePaneResizing",resizeContentWhileDragging:"liveContentResizing",triggerEventsWhileDragging:"triggerEventsDuringLiveResize",maskIframesOnResize:"maskContents",useStateCookie:"stateManagement.enabled","cookie.autoLoad":"stateManagement.autoLoad","cookie.autoSave":"stateManagement.autoSave","cookie.keys":"stateManagement.stateKeys","cookie.name":"stateManagement.cookie.name","cookie.domain":"stateManagement.cookie.domain","cookie.path":"stateManagement.cookie.path","cookie.expires":"stateManagement.cookie.expires","cookie.secure":"stateManagement.cookie.secure",noRoomToOpenTip:"tips.noRoomToOpen",togglerTip_open:"tips.Close",togglerTip_closed:"tips.Open",resizerTip:"tips.Resize",sliderTip:"tips.Slide"},renameOptions:function(opts){function getBranch(path,create){for(var k,a=path.split("."),c=a.length-1,D={branch:opts,key:a[c]},i=0;c>i;i++)k=a[i],void 0==D.branch[k]?create?D.branch=D.branch[k]={}:D.branch={}:D.branch=D.branch[k];return D}var oldData,newData,value,map=$.layout.backwardCompatibility.map;for(var itemPath in map)oldData=getBranch(itemPath),value=oldData.branch[oldData.key],void 0!==value&&(newData=getBranch(map[itemPath],!0),newData.branch[newData.key]=value,delete oldData.branch[oldData.key])},renameAllOptions:function(opts){var ren=$.layout.backwardCompatibility.renameOptions;return ren(opts),opts.defaults&&("object"!=typeof opts.panes&&(opts.panes={}),$.extend(!0,opts.panes,opts.defaults),delete opts.defaults),opts.panes&&ren(opts.panes),$.each($.layout.config.allPanes,function(i,pane){opts[pane]&&ren(opts[pane])}),opts}},$.fn.layout=function(opts){function keyDown(evt){if(!evt)return!0;var code=evt.keyCode;if(33>code)return!0;var o,k,m,pane,PANE={38:"north",40:"south",37:"west",39:"east"},SHIFT=(evt.altKey,evt.shiftKey),CTRL=evt.ctrlKey,CURSOR=CTRL&&code>=37&&40>=code;return CURSOR&&options[PANE[code]].enableCursorHotkey?pane=PANE[code]:(CTRL||SHIFT)&&$.each(_c.borderPanes,function(i,p){return o=options[p],k=o.customHotkey,m=o.customHotkeyModifier,(SHIFT&&"SHIFT"==m||CTRL&&"CTRL"==m||CTRL&&SHIFT)&&k&&code===(isNaN(k)||9>=k?k.toUpperCase().charCodeAt(0):k)?(pane=p,!1):void 0}),pane&&$Ps[pane]&&options[pane].closable&&!state[pane].isHidden?(toggle(pane),evt.stopPropagation(),evt.returnValue=!1,!1):!0}function allowOverflow(el){if(isInitialized()){this&&this.tagName&&(el=this);var $P;if(isStr(el)?$P=$Ps[el]:$(el).data("layoutRole")?$P=$(el):$(el).parents().each(function(){return $(this).data("layoutRole")?($P=$(this),!1):void 0}),$P&&$P.length){var pane=$P.data("layoutEdge"),s=state[pane];if(s.cssSaved&&resetOverflow(pane),s.isSliding||s.isResizing||s.isClosed)return void(s.cssSaved=!1);var newCSS={zIndex:options.zIndexes.resizer_normal+1},curCSS={},of=$P.css("overflow"),ofX=$P.css("overflowX"),ofY=$P.css("overflowY");"visible"!=of&&(curCSS.overflow=of,newCSS.overflow="visible"),ofX&&!ofX.match(/(visible|auto)/)&&(curCSS.overflowX=ofX,newCSS.overflowX="visible"),ofY&&!ofY.match(/(visible|auto)/)&&(curCSS.overflowY=ofX,newCSS.overflowY="visible"),s.cssSaved=curCSS,$P.css(newCSS),$.each(_c.allPanes,function(i,p){p!=pane&&resetOverflow(p)})}}}function resetOverflow(el){if(isInitialized()){this&&this.tagName&&(el=this);var $P;if(isStr(el)?$P=$Ps[el]:$(el).data("layoutRole")?$P=$(el):$(el).parents().each(function(){return $(this).data("layoutRole")?($P=$(this),!1):void 0}),$P&&$P.length){var pane=$P.data("layoutEdge"),s=state[pane],CSS=s.cssSaved||{};s.isSliding||s.isResizing||$P.css("zIndex",options.zIndexes.pane_normal),$P.css(CSS),s.cssSaved=!1}}}var browser=$.layout.browser,_c=$.layout.config,cssW=$.layout.cssWidth,cssH=$.layout.cssHeight,elDims=$.layout.getElementDimensions,styles=$.layout.getElementStyles,evtObj=$.layout.getEventObject,evtPane=$.layout.parsePaneName,options=$.extend(!0,{},$.layout.defaults),effects=options.effects=$.extend(!0,{},$.layout.effects),state={id:"layout"+$.now(),initialized:!1,paneResizing:!1,panesSliding:{},container:{innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0,layoutWidth:0,layoutHeight:0},north:{childIdx:0},south:{childIdx:0},east:{childIdx:0},west:{childIdx:0},center:{childIdx:0}},children={north:null,south:null,east:null,west:null,center:null},timer={data:{},set:function(s,fn,ms){timer.clear(s),timer.data[s]=setTimeout(fn,ms)},clear:function(s){var t=timer.data;t[s]&&(clearTimeout(t[s]),delete t[s])}},_log=function(msg,popup,debug){var o=options;return(o.showErrorMessages&&!debug||debug&&o.showDebugMessages)&&$.layout.msg(o.name+" / "+msg,popup!==!1),
!1},_runCallbacks=function(evtName,pane,skipBoundEvents){function g(f){return f}var hasPane=pane&&isStr(pane),s=hasPane?state[pane]:state,o=hasPane?options[pane]:options,lName=options.name,lng=evtName+(evtName.match(/_/)?"":"_end"),shrt=lng.match(/_end$/)?lng.substr(0,lng.length-4):"",fn=o[lng]||o[shrt],retVal="NC",args=[],$P;return hasPane||"boolean"!==$.type(pane)||(skipBoundEvents=pane,pane=""),fn&&(isStr(fn)&&(fn.match(/,/)?(args=fn.split(","),fn=eval(args[0])):fn=eval(fn)),$.isFunction(fn)&&(retVal=args.length?g(fn)(args[1]):hasPane?g(fn)(pane,$Ps[pane],s,o,lName):g(fn)(Instance,s,o,lName))),skipBoundEvents||retVal===!1||(hasPane?($P=$Ps[pane],o=options[pane],s=state[pane],$P.triggerHandler("layoutpane"+lng,[pane,$P,s,o,lName]),shrt&&$P.triggerHandler("layoutpane"+shrt,[pane,$P,s,o,lName])):($N.triggerHandler("layout"+lng,[Instance,s,o,lName]),shrt&&$N.triggerHandler("layout"+shrt,[Instance,s,o,lName]))),hasPane&&"onresize_end"===evtName&&resizeChildren(pane+"",!0),retVal},_fixIframe=function(pane){if(!browser.mozilla){var $P=$Ps[pane];"IFRAME"===state[pane].tagName?$P.css(_c.hidden).css(_c.visible):$P.find("IFRAME").css(_c.hidden).css(_c.visible)}},cssSize=function(pane,outerSize){var fn="horz"==_c[pane].dir?cssH:cssW;return fn($Ps[pane],outerSize)},cssMinDims=function(pane){var $P=$Ps[pane],dir=_c[pane].dir,d={minWidth:1001-cssW($P,1e3),minHeight:1001-cssH($P,1e3)};return"horz"===dir&&(d.minSize=d.minHeight),"vert"===dir&&(d.minSize=d.minWidth),d},setOuterWidth=function(el,outerWidth,autoHide){var w,$E=el;isStr(el)?$E=$Ps[el]:el.jquery||($E=$(el)),w=cssW($E,outerWidth),$E.css({width:w}),w>0?autoHide&&$E.data("autoHidden")&&$E.innerHeight()>0&&($E.show().data("autoHidden",!1),browser.mozilla||$E.css(_c.hidden).css(_c.visible)):autoHide&&!$E.data("autoHidden")&&$E.hide().data("autoHidden",!0)},setOuterHeight=function(el,outerHeight,autoHide){var h,$E=el;isStr(el)?$E=$Ps[el]:el.jquery||($E=$(el)),h=cssH($E,outerHeight),$E.css({height:h,visibility:"visible"}),h>0&&$E.innerWidth()>0?autoHide&&$E.data("autoHidden")&&($E.show().data("autoHidden",!1),browser.mozilla||$E.css(_c.hidden).css(_c.visible)):autoHide&&!$E.data("autoHidden")&&$E.hide().data("autoHidden",!0)},_parseSize=function(pane,size,dir){if(dir||(dir=_c[pane].dir),isStr(size)&&size.match(/%/)&&(size="100%"===size?-1:parseInt(size,10)/100),0===size)return 0;if(size>=1)return parseInt(size,10);var o=options,avail=0;if("horz"==dir?avail=sC.innerHeight-($Ps.north?o.north.spacing_open:0)-($Ps.south?o.south.spacing_open:0):"vert"==dir&&(avail=sC.innerWidth-($Ps.west?o.west.spacing_open:0)-($Ps.east?o.east.spacing_open:0)),-1===size)return avail;if(size>0)return round(avail*size);if("center"==pane)return 0;var dim="horz"===dir?"height":"width",$P=$Ps[pane],$C="height"===dim?$Cs[pane]:!1,vis=$.layout.showInvisibly($P),szP=$P.css(dim),szC=$C?$C.css(dim):0;return $P.css(dim,"auto"),$C&&$C.css(dim,"auto"),size="height"===dim?$P.outerHeight():$P.outerWidth(),$P.css(dim,szP).css(vis),$C&&$C.css(dim,szC),size},getPaneSize=function(pane,inclSpace){var $P=$Ps[pane],o=options[pane],s=state[pane],oSp=inclSpace?o.spacing_open:0,cSp=inclSpace?o.spacing_closed:0;return!$P||s.isHidden?0:s.isClosed||s.isSliding&&inclSpace?cSp:"horz"===_c[pane].dir?$P.outerHeight()+oSp:$P.outerWidth()+oSp},setSizeLimits=function(pane,slide){if(isInitialized()){var o=options[pane],s=state[pane],c=_c[pane],dir=c.dir,isSliding=(c.sizeType.toLowerCase(),void 0!=slide?slide:s.isSliding),paneSpacing=($Ps[pane],o.spacing_open),altPane=_c.oppositeEdge[pane],altS=state[altPane],$altP=$Ps[altPane],altPaneSize=!$altP||altS.isVisible===!1||altS.isSliding?0:"horz"==dir?$altP.outerHeight():$altP.outerWidth(),altPaneSpacing=(!$altP||altS.isHidden?0:options[altPane][altS.isClosed!==!1?"spacing_closed":"spacing_open"])||0,containerSize="horz"==dir?sC.innerHeight:sC.innerWidth,minCenterDims=cssMinDims("center"),minCenterSize="horz"==dir?max(options.center.minHeight,minCenterDims.minHeight):max(options.center.minWidth,minCenterDims.minWidth),limitSize=containerSize-paneSpacing-(isSliding?0:_parseSize("center",minCenterSize,dir)+altPaneSize+altPaneSpacing),minSize=s.minSize=max(_parseSize(pane,o.minSize),cssMinDims(pane).minSize),maxSize=s.maxSize=min(o.maxSize?_parseSize(pane,o.maxSize):1e5,limitSize),r=s.resizerPosition={},top=sC.inset.top,left=sC.inset.left,W=sC.innerWidth,H=sC.innerHeight,rW=o.spacing_open;switch(pane){case"north":r.min=top+minSize,r.max=top+maxSize;break;case"west":r.min=left+minSize,r.max=left+maxSize;break;case"south":r.min=top+H-maxSize-rW,r.max=top+H-minSize-rW;break;case"east":r.min=left+W-maxSize-rW,r.max=left+W-minSize-rW}}},calcNewCenterPaneDims=function(){var d={top:getPaneSize("north",!0),bottom:getPaneSize("south",!0),left:getPaneSize("west",!0),right:getPaneSize("east",!0),width:0,height:0};return d.width=sC.innerWidth-d.left-d.right,d.height=sC.innerHeight-d.bottom-d.top,d.top+=sC.inset.top,d.bottom+=sC.inset.bottom,d.left+=sC.inset.left,d.right+=sC.inset.right,d},getHoverClasses=function(el,allStates){var $El=$(el),type=$El.data("layoutRole"),pane=$El.data("layoutEdge"),o=options[pane],root=o[type+"Class"],_pane="-"+pane,_open="-open",_closed="-closed",_slide="-sliding",_hover="-hover ",_state=$El.hasClass(root+_closed)?_closed:_open,_alt=_state===_closed?_open:_closed,classes=root+_hover+(root+_pane+_hover)+(root+_state+_hover)+(root+_pane+_state+_hover);return allStates&&(classes+=root+_alt+_hover+(root+_pane+_alt+_hover)),"resizer"==type&&$El.hasClass(root+_slide)&&(classes+=root+_slide+_hover+(root+_pane+_slide+_hover)),$.trim(classes)},addHover=function(evt,el){var $E=$(el||this);evt&&"toggler"===$E.data("layoutRole")&&evt.stopPropagation(),$E.addClass(getHoverClasses($E))},removeHover=function(evt,el){var $E=$(el||this);$E.removeClass(getHoverClasses($E,!0))},onResizerEnter=function(evt){var pane=$(this).data("layoutEdge"),s=state[pane];s.isClosed||s.isResizing||state.paneResizing||($.fn.disableSelection&&$("body").disableSelection(),options.maskPanesEarly&&showMasks(pane,{resizing:!0}))},onResizerLeave=function(evt,el){var e=el||this,pane=$(e).data("layoutEdge"),name=pane+"ResizerLeave";timer.clear(pane+"_openSlider"),timer.clear(name),el?state.paneResizing||($.fn.enableSelection&&$("body").enableSelection(),options.maskPanesEarly&&hideMasks()):timer.set(name,function(){onResizerLeave(evt,e)},200)},_create=function(){initOptions();var o=options,s=state;return s.creatingLayout=!0,runPluginCallbacks(Instance,$.layout.onCreate),!1===_runCallbacks("onload_start")?"cancel":(_initContainer(),initHotkeys(),$(window).bind("unload."+sID,unload),runPluginCallbacks(Instance,$.layout.onLoad),o.initPanes&&_initLayoutElements(),delete s.creatingLayout,state.initialized)},isInitialized=function(){return state.initialized||state.creatingLayout?!0:_initLayoutElements()},_initLayoutElements=function(retry){var o=options;if(!$N.is(":visible"))return!retry&&browser.webkit&&"BODY"===$N[0].tagName&&setTimeout(function(){_initLayoutElements(!0)},50),!1;if(!getPane("center").length)return _log(o.errors.centerPaneMissing);if(state.creatingLayout=!0,$.extend(sC,elDims($N,o.inset)),initPanes(),o.scrollToBookmarkOnLoad){var l=self.location;l.hash&&l.replace(l.hash)}return Instance.hasParentLayout?o.resizeWithWindow=!1:o.resizeWithWindow&&$(window).bind("resize."+sID,windowResize),delete state.creatingLayout,state.initialized=!0,runPluginCallbacks(Instance,$.layout.onReady),_runCallbacks("onload_end"),!0},createChildren=function(evt_or_pane,opts){var pane=evtPane.call(this,evt_or_pane),$P=$Ps[pane];if($P){var $C=$Cs[pane],s=state[pane],o=options[pane],sm=options.stateManagement||{},cos=opts?o.children=opts:o.children;if($.isPlainObject(cos))cos=[cos];else if(!cos||!$.isArray(cos))return;$.each(cos,function(idx,co){if($.isPlainObject(co)){var $containers=co.containerSelector?$P.find(co.containerSelector):$C||$P;$containers.each(function(){var $cont=$(this),child=$cont.data("layout");if(!child){if(setInstanceKey({container:$cont,options:co},s),sm.includeChildren&&state.stateData[pane]){var paneChildren=state.stateData[pane].children||{},childState=paneChildren[co.instanceKey],co_sm=co.stateManagement||(co.stateManagement={autoLoad:!0});co_sm.autoLoad===!0&&childState&&(co_sm.autoSave=!1,co_sm.includeChildren=!0,co_sm.autoLoad=$.extend(!0,{},childState))}child=$cont.layout(co),child&&refreshChildren(pane,child)}})}})}},setInstanceKey=function(child,parentPaneState){var $c=child.container,o=child.options,sm=o.stateManagement,key=o.instanceKey||$c.data("layoutInstanceKey");return key||(key=(sm&&sm.cookie?sm.cookie.name:"")||o.name),key=key?key.replace(/[^\w-]/gi,"_").replace(/_{2,}/g,"_"):"layout"+ ++parentPaneState.childIdx,o.instanceKey=key,$c.data("layoutInstanceKey",key),key},refreshChildren=function(pane,newChild){var o,$P=$Ps[pane],pC=children[pane],s=state[pane];$.isPlainObject(pC)&&($.each(pC,function(key,child){child.destroyed&&delete pC[key]}),$.isEmptyObject(pC)&&(pC=children[pane]=null)),newChild||pC||(newChild=$P.data("layout")),newChild&&(newChild.hasParentLayout=!0,o=newChild.options,setInstanceKey(newChild,s),pC||(pC=children[pane]={}),pC[o.instanceKey]=newChild.container.data("layout")),Instance[pane].children=children[pane],newChild||createChildren(pane)},windowResize=function(){var o=options,delay=Number(o.resizeWithWindowDelay);10>delay&&(delay=100),timer.clear("winResize"),timer.set("winResize",function(){timer.clear("winResize"),timer.clear("winResizeRepeater");var dims=elDims($N,o.inset);(dims.innerWidth!==sC.innerWidth||dims.innerHeight!==sC.innerHeight)&&resizeAll()},delay),timer.data.winResizeRepeater||setWindowResizeRepeater()},setWindowResizeRepeater=function(){var delay=Number(options.resizeWithWindowMaxDelay);delay>0&&timer.set("winResizeRepeater",function(){setWindowResizeRepeater(),resizeAll()},delay)},unload=function(){_runCallbacks("onunload_start"),runPluginCallbacks(Instance,$.layout.onUnload),_runCallbacks("onunload_end")},_initContainer=function(){var $parent,n,N=$N[0],$H=$("html"),tag=sC.tagName=N.tagName,id=sC.id=N.id,cls=sC.className=N.className,o=options,name=o.name,props="position,margin,padding,border",css="layoutCSS",CSS={},hid="hidden",parent=$N.data("parentLayout"),pane=$N.data("layoutEdge"),isChild=parent&&pane,num=$.layout.cssNum;sC.selector=$N.selector.split(".slice")[0],sC.ref=(o.name?o.name+" layout / ":"")+tag+(id?"#"+id:cls?".["+cls+"]":""),sC.isBody="BODY"===tag,isChild||sC.isBody||($parent=$N.closest("."+$.layout.defaults.panes.paneClass),parent=$parent.data("parentLayout"),pane=$parent.data("layoutEdge"),isChild=parent&&pane),$N.data({layout:Instance,layoutContainer:sID}).addClass(o.containerClass);var layoutMethods={destroy:"",initPanes:"",resizeAll:"resizeAll",resize:"resizeAll"};for(name in layoutMethods)$N.bind("layout"+name.toLowerCase()+"."+sID,Instance[layoutMethods[name]||name]);isChild&&(Instance.hasParentLayout=!0,parent.refreshChildren(pane,Instance)),$N.data(css)||(sC.isBody?($N.data(css,$.extend(styles($N,props),{height:$N.css("height"),overflow:$N.css("overflow"),overflowX:$N.css("overflowX"),overflowY:$N.css("overflowY")})),$H.data(css,$.extend(styles($H,"padding"),{height:"auto",overflow:$H.css("overflow"),overflowX:$H.css("overflowX"),overflowY:$H.css("overflowY")}))):$N.data(css,styles($N,props+",top,bottom,left,right,width,height,overflow,overflowX,overflowY")));try{if(CSS={overflow:hid,overflowX:hid,overflowY:hid},$N.css(CSS),o.inset&&!$.isPlainObject(o.inset)&&(n=parseInt(o.inset,10)||0,o.inset={top:n,bottom:n,left:n,right:n}),sC.isBody)o.outset?$.isPlainObject(o.outset)||(n=parseInt(o.outset,10)||0,o.outset={top:n,bottom:n,left:n,right:n}):o.outset={top:num($H,"paddingTop"),bottom:num($H,"paddingBottom"),left:num($H,"paddingLeft"),right:num($H,"paddingRight")},$H.css(CSS).css({height:"100%",border:"none",padding:0,margin:0}),browser.isIE6?($N.css({width:"100%",height:"100%",border:"none",padding:0,margin:0,position:"relative"}),o.inset||(o.inset=elDims($N).inset)):($N.css({width:"auto",height:"auto",margin:0,position:"absolute"}),$N.css(o.outset)),$.extend(sC,elDims($N,o.inset));else{var p=$N.css("position");p&&p.match(/(fixed|absolute|relative)/)||$N.css("position","relative"),$N.is(":visible")&&($.extend(sC,elDims($N,o.inset)),sC.innerHeight<1&&_log(o.errors.noContainerHeight.replace(/CONTAINER/,sC.ref)))}num($N,"minWidth")&&$N.parent().css("overflowX","auto"),num($N,"minHeight")&&$N.parent().css("overflowY","auto")}catch(ex){}},initHotkeys=function(panes){panes=panes?panes.split(","):_c.borderPanes,$.each(panes,function(i,pane){var o=options[pane];return o.enableCursorHotkey||o.customHotkey?($(document).bind("keydown."+sID,keyDown),!1):void 0})},initOptions=function(){function createFxOptions(pane){var o=options[pane],d=options.panes;o.fxSettings||(o.fxSettings={}),d.fxSettings||(d.fxSettings={}),$.each(["_open","_close","_size"],function(i,n){var sName="fxName"+n,sSpeed="fxSpeed"+n,sSettings="fxSettings"+n,fxName=o[sName]=o[sName]||d[sName]||o.fxName||d.fxName||"none",fxExists=$.effects&&($.effects[fxName]||$.effects.effect&&$.effects.effect[fxName]);"none"!==fxName&&options.effects[fxName]&&fxExists||(fxName=o[sName]="none");var fx=options.effects[fxName]||{},fx_all=fx.all||null,fx_pane=fx[pane]||null;o[sSpeed]=o[sSpeed]||d[sSpeed]||o.fxSpeed||d.fxSpeed||null,o[sSettings]=$.extend(!0,{},fx_all,fx_pane,d.fxSettings,o.fxSettings,d[sSettings],o[sSettings])}),delete o.fxName,delete o.fxSpeed,delete o.fxSettings}var data,d,key,val,i,c,o;if(opts=$.layout.transformData(opts,!0),opts=$.layout.backwardCompatibility.renameAllOptions(opts),!$.isEmptyObject(opts.panes)){for(data=$.layout.optionsMap.noDefault,i=0,c=data.length;c>i;i++)key=data[i],delete opts.panes[key];for(data=$.layout.optionsMap.layout,i=0,c=data.length;c>i;i++)key=data[i],delete opts.panes[key]}data=$.layout.optionsMap.layout;var rootKeys=$.layout.config.optionRootKeys;for(key in opts)val=opts[key],$.inArray(key,rootKeys)<0&&$.inArray(key,data)<0&&(opts.panes[key]||(opts.panes[key]=$.isPlainObject(val)?$.extend(!0,{},val):val),delete opts[key]);$.extend(!0,options,opts),$.each(_c.allPanes,function(i,pane){if(_c[pane]=$.extend(!0,{},_c.panes,_c[pane]),d=options.panes,o=options[pane],"center"===pane)for(data=$.layout.optionsMap.center,i=0,c=data.length;c>i;i++)key=data[i],opts.center[key]||!opts.panes[key]&&o[key]||(o[key]=d[key]);else o=options[pane]=$.extend(!0,{},d,o),createFxOptions(pane),o.resizerClass||(o.resizerClass="ui-layout-resizer"),o.togglerClass||(o.togglerClass="ui-layout-toggler");o.paneClass||(o.paneClass="ui-layout-pane")});var zo=opts.zIndex,z=options.zIndexes;zo>0&&(z.pane_normal=zo,z.content_mask=max(zo+1,z.content_mask),z.resizer_normal=max(zo+2,z.resizer_normal)),delete options.panes},getPane=function(pane){var sel=options[pane].paneSelector;if("#"===sel.substr(0,1))return $N.find(sel).eq(0);var $P=$N.children(sel).eq(0);return $P.length?$P:$N.children("form:first").children(sel).eq(0)},initPanes=function(evt){evtPane(evt),$.each(_c.allPanes,function(idx,pane){addPane(pane,!0)}),initHandles(),$.each(_c.borderPanes,function(i,pane){$Ps[pane]&&state[pane].isVisible&&(setSizeLimits(pane),makePaneFit(pane))}),sizeMidPanes("center"),$.each(_c.allPanes,function(idx,pane){afterInitPane(pane)})},addPane=function(pane,force){if(force||isInitialized()){var size,minSize,maxSize,o=options[pane],s=state[pane],c=_c[pane],dir=c.dir,isCenter=(s.fx,o.spacing_open||0,"center"===pane),CSS={},$P=$Ps[pane];if($P?removePane(pane,!1,!0,!1):$Cs[pane]=!1,$P=$Ps[pane]=getPane(pane),!$P.length)return void($Ps[pane]=!1);if(!$P.data("layoutCSS")){var props="position,top,left,bottom,right,width,height,overflow,zIndex,display,backgroundColor,padding,margin,border";$P.data("layoutCSS",styles($P,props))}Instance[pane]={name:pane,pane:$Ps[pane],content:$Cs[pane],options:options[pane],state:state[pane],children:children[pane]},$P.data({parentLayout:Instance,layoutPane:Instance[pane],layoutEdge:pane,layoutRole:"pane"}).css(c.cssReq).css("zIndex",options.zIndexes.pane_normal).css(o.applyDemoStyles?c.cssDemo:{}).addClass(o.paneClass+" "+o.paneClass+"-"+pane).bind("mouseenter."+sID,addHover).bind("mouseleave."+sID,removeHover);var name,paneMethods={hide:"",show:"",toggle:"",close:"",open:"",slideOpen:"",slideClose:"",slideToggle:"",size:"sizePane",sizePane:"sizePane",sizeContent:"",sizeHandles:"",enableClosable:"",disableClosable:"",enableSlideable:"",disableSlideable:"",enableResizable:"",disableResizable:"",swapPanes:"swapPanes",swap:"swapPanes",move:"swapPanes",removePane:"removePane",remove:"removePane",createChildren:"",resizeChildren:"",resizeAll:"resizeAll",resizeLayout:"resizeAll"};for(name in paneMethods)$P.bind("layoutpane"+name.toLowerCase()+"."+sID,Instance[paneMethods[name]||name]);initContent(pane,!1),isCenter||(size=s.size=_parseSize(pane,o.size),minSize=_parseSize(pane,o.minSize)||1,maxSize=_parseSize(pane,o.maxSize)||1e5,size>0&&(size=max(min(size,maxSize),minSize)),s.autoResize=o.autoResize,s.isClosed=!1,s.isSliding=!1,s.isResizing=!1,s.isHidden=!1,s.pins||(s.pins=[])),s.tagName=$P[0].tagName,s.edge=pane,s.noRoom=!1,s.isVisible=!0,setPanePosition(pane),"horz"===dir?CSS.height=cssH($P,size):"vert"===dir&&(CSS.width=cssW($P,size)),$P.css(CSS),"horz"!=dir&&sizeMidPanes(pane,!0),state.initialized&&(initHandles(pane),initHotkeys(pane)),o.initClosed&&o.closable&&!o.initHidden?close(pane,!0,!0):o.initHidden||o.initClosed?hide(pane):s.noRoom||$P.css("display","block"),$P.css("visibility","visible"),o.showOverflowOnHover&&$P.hover(allowOverflow,resetOverflow),state.initialized&&afterInitPane(pane)}},afterInitPane=function(pane){var $P=$Ps[pane],s=state[pane],o=options[pane];$P&&($P.data("layout")&&refreshChildren(pane,$P.data("layout")),s.isVisible&&(state.initialized?resizeAll():sizeContent(pane),o.triggerEventsOnLoad?_runCallbacks("onresize_end",pane):resizeChildren(pane,!0)),o.initChildren&&o.children&&createChildren(pane))},setPanePosition=function(panes){panes=panes?panes.split(","):_c.borderPanes,$.each(panes,function(i,pane){var $P=$Ps[pane],$R=$Rs[pane],s=(options[pane],state[pane]),side=_c[pane].side,CSS={};if($P){switch(pane){case"north":CSS.top=sC.inset.top,CSS.left=sC.inset.left,CSS.right=sC.inset.right;break;case"south":CSS.bottom=sC.inset.bottom,CSS.left=sC.inset.left,CSS.right=sC.inset.right;break;case"west":CSS.left=sC.inset.left;break;case"east":CSS.right=sC.inset.right;break;case"center":}$P.css(CSS),$R&&s.isClosed?$R.css(side,sC.inset[side]):$R&&!s.isHidden&&$R.css(side,sC.inset[side]+getPaneSize(pane))}})},initHandles=function(panes){panes=panes?panes.split(","):_c.borderPanes,$.each(panes,function(i,pane){var $P=$Ps[pane];if($Rs[pane]=!1,$Ts[pane]=!1,$P){var o=options[pane],s=state[pane],paneId=(_c[pane],"#"===o.paneSelector.substr(0,1)?o.paneSelector.substr(1):""),rClass=o.resizerClass,tClass=o.togglerClass,_pane=(s.isVisible?o.spacing_open:o.spacing_closed,"-"+pane),I=(s.isVisible?"-open":"-closed",Instance[pane]),$R=I.resizer=$Rs[pane]=$("<div></div>"),$T=I.toggler=o.closable?$Ts[pane]=$("<div></div>"):!1;!s.isVisible&&o.slidable&&$R.attr("title",o.tips.Slide).css("cursor",o.sliderCursor),$R.attr("id",paneId?paneId+"-resizer":"").data({parentLayout:Instance,layoutPane:Instance[pane],layoutEdge:pane,layoutRole:"resizer"}).css(_c.resizers.cssReq).css("zIndex",options.zIndexes.resizer_normal).css(o.applyDemoStyles?_c.resizers.cssDemo:{}).addClass(rClass+" "+rClass+_pane).hover(addHover,removeHover).hover(onResizerEnter,onResizerLeave).appendTo($N),o.resizerDblClickToggle&&$R.bind("dblclick."+sID,toggle),$T&&($T.attr("id",paneId?paneId+"-toggler":"").data({parentLayout:Instance,layoutPane:Instance[pane],layoutEdge:pane,layoutRole:"toggler"}).css(_c.togglers.cssReq).css(o.applyDemoStyles?_c.togglers.cssDemo:{}).addClass(tClass+" "+tClass+_pane).hover(addHover,removeHover).bind("mouseenter",onResizerEnter).appendTo($R),o.togglerContent_open&&$("<span>"+o.togglerContent_open+"</span>").data({layoutEdge:pane,layoutRole:"togglerContent"}).data("layoutRole","togglerContent").data("layoutEdge",pane).addClass("content content-open").css("display","none").appendTo($T),o.togglerContent_closed&&$("<span>"+o.togglerContent_closed+"</span>").data({layoutEdge:pane,layoutRole:"togglerContent"}).addClass("content content-closed").css("display","none").appendTo($T),enableClosable(pane)),initResizable(pane),s.isVisible?setAsOpen(pane):(setAsClosed(pane),bindStartSlidingEvents(pane,!0))}}),sizeHandles()},initContent=function(pane,resize){if(isInitialized()){var $C,o=options[pane],sel=o.contentSelector,I=Instance[pane],$P=$Ps[pane];sel&&($C=I.content=$Cs[pane]=o.findNestedContent?$P.find(sel).eq(0):$P.children(sel).eq(0)),$C&&$C.length?($C.data("layoutRole","content"),$C.data("layoutCSS")||$C.data("layoutCSS",styles($C,"height")),$C.css(_c.content.cssReq),o.applyDemoStyles&&($C.css(_c.content.cssDemo),$P.css(_c.content.cssDemoPane)),$P.css("overflowX").match(/(scroll|auto)/)&&$P.css("overflow","hidden"),state[pane].content={},resize!==!1&&sizeContent(pane)):I.content=$Cs[pane]=!1}},initResizable=function(panes){var draggingAvailable=$.layout.plugins.draggable;panes=panes?panes.split(","):_c.borderPanes,$.each(panes,function(idx,pane){var o=options[pane];if(!draggingAvailable||!$Ps[pane]||!o.resizable)return o.resizable=!1,!0;var r,live,s=state[pane],z=options.zIndexes,c=_c[pane],side="horz"==c.dir?"top":"left",$R=($Ps[pane],$Rs[pane]),base=o.resizerClass,lastPos=0,resizerClass=base+"-drag",resizerPaneClass=base+"-"+pane+"-drag",helperClass=base+"-dragging",helperPaneClass=base+"-"+pane+"-dragging",helperLimitClass=base+"-dragging-limit",helperPaneLimitClass=base+"-"+pane+"-dragging-limit",helperClassesSet=!1;s.isClosed||$R.attr("title",o.tips.Resize).css("cursor",o.resizerCursor),$R.draggable({containment:$N[0],axis:"horz"==c.dir?"y":"x",delay:0,distance:1,grid:o.resizingGrid,helper:"clone",opacity:o.resizerDragOpacity,addClasses:!1,zIndex:z.resizer_drag,start:function(e,ui){return o=options[pane],s=state[pane],live=o.livePaneResizing,!1===_runCallbacks("ondrag_start",pane)?!1:(s.isResizing=!0,state.paneResizing=pane,timer.clear(pane+"_closeSlider"),setSizeLimits(pane),r=s.resizerPosition,lastPos=ui.position[side],$R.addClass(resizerClass+" "+resizerPaneClass),helperClassesSet=!1,$("body").disableSelection(),void showMasks(pane,{resizing:!0}))},drag:function(e,ui){helperClassesSet||(ui.helper.addClass(helperClass+" "+helperPaneClass).css({right:"auto",bottom:"auto"}).children().css("visibility","hidden"),helperClassesSet=!0,s.isSliding&&$Ps[pane].css("zIndex",z.pane_sliding));var limit=0;ui.position[side]<r.min?(ui.position[side]=r.min,limit=-1):ui.position[side]>r.max&&(ui.position[side]=r.max,limit=1),limit?(ui.helper.addClass(helperLimitClass+" "+helperPaneLimitClass),window.defaultStatus=limit>0&&pane.match(/(north|west)/)||0>limit&&pane.match(/(south|east)/)?o.tips.maxSizeWarning:o.tips.minSizeWarning):(ui.helper.removeClass(helperLimitClass+" "+helperPaneLimitClass),window.defaultStatus=""),live&&Math.abs(ui.position[side]-lastPos)>=o.liveResizingTolerance&&(lastPos=ui.position[side],resizePanes(e,ui,pane))},stop:function(e,ui){$("body").enableSelection(),window.defaultStatus="",$R.removeClass(resizerClass+" "+resizerPaneClass),s.isResizing=!1,state.paneResizing=!1,resizePanes(e,ui,pane,!0)}})});var resizePanes=function(evt,ui,pane,resizingDone){var resizerPos,dragPos=ui.position,c=_c[pane],o=options[pane],s=state[pane];switch(pane){case"north":resizerPos=dragPos.top;break;case"west":resizerPos=dragPos.left;break;case"south":resizerPos=sC.layoutHeight-dragPos.top-o.spacing_open;break;case"east":resizerPos=sC.layoutWidth-dragPos.left-o.spacing_open}var newSize=resizerPos-sC.inset[c.side];if(resizingDone)!1!==_runCallbacks("ondrag_end",pane)&&manualSizePane(pane,newSize,!1,!0),hideMasks(!0),s.isSliding&&showMasks(pane,{resizing:!0});else{if(Math.abs(newSize-s.size)<o.liveResizingTolerance)return;manualSizePane(pane,newSize,!1,!0),sizeMasks()}}},sizeMask=function(){var $M=$(this),pane=$M.data("layoutMask"),s=state[pane];"IFRAME"==s.tagName&&s.isVisible&&$M.css({top:s.offsetTop,left:s.offsetLeft,width:s.outerWidth,height:s.outerHeight})},sizeMasks=function(){$Ms.each(sizeMask)},showMasks=function(pane,args){var o,s,c=_c[pane],panes=["center"],z=options.zIndexes,a=$.extend({objectsOnly:!1,animation:!1,resizing:!0,sliding:state[pane].isSliding},args);a.resizing&&panes.push(pane),a.sliding&&panes.push(_c.oppositeEdge[pane]),"horz"===c.dir&&(panes.push("west"),panes.push("east")),$.each(panes,function(i,p){s=state[p],o=options[p],s.isVisible&&(o.maskObjects||!a.objectsOnly&&o.maskContents)&&getMasks(p).each(function(){sizeMask.call(this),this.style.zIndex=s.isSliding?z.pane_sliding+1:z.pane_normal+1,this.style.display="block"})})},hideMasks=function(force){if(force||!state.paneResizing)$Ms.hide();else if(!force&&!$.isEmptyObject(state.panesSliding))for(var p,$M,i=$Ms.length-1;i>=0;i--)$M=$Ms.eq(i),p=$M.data("layoutMask"),options[p].maskObjects||$M.hide()},getMasks=function(pane){for(var $M,$Masks=$([]),i=0,c=$Ms.length;c>i;i++)$M=$Ms.eq(i),$M.data("layoutMask")===pane&&($Masks=$Masks.add($M));return $Masks.length?$Masks:createMasks(pane)},createMasks=function(pane){var isIframe,el,$M,css,i,$P=$Ps[pane],s=state[pane],o=options[pane],z=options.zIndexes,$Masks=$([]);if(!o.maskContents&&!o.maskObjects)return $Masks;for(i=0;i<(o.maskObjects?2:1);i++)isIframe=o.maskObjects&&0==i,el=document.createElement(isIframe?"iframe":"div"),$M=$(el).data("layoutMask",pane),el.className="ui-layout-mask ui-layout-mask-"+pane,css=el.style,css.display="block",css.position="absolute",css.background="#FFF",isIframe&&(el.frameborder=0,el.src="about:blank",css.opacity=0,css.filter="Alpha(Opacity='0')",css.border=0),"IFRAME"==s.tagName?(css.zIndex=z.pane_normal+1,$N.append(el)):($M.addClass("ui-layout-mask-inside-pane"),css.zIndex=o.maskZindex||z.content_mask,css.top=0,css.left=0,css.width="100%",css.height="100%",$P.append(el)),$Masks=$Masks.add(el),$Ms=$Ms.add(el);return $Masks},destroy=function(evt_or_destroyChildren,destroyChildren){$(window).unbind("."+sID),$(document).unbind("."+sID),"object"==typeof evt_or_destroyChildren?evtPane(evt_or_destroyChildren):destroyChildren=evt_or_destroyChildren,$N.clearQueue().removeData("layout").removeData("layoutContainer").removeClass(options.containerClass).unbind("."+sID),$Ms.remove(),$.each(_c.allPanes,function(i,pane){removePane(pane,!1,!0,destroyChildren)});var css="layoutCSS";$N.data(css)&&!$N.data("layoutRole")&&$N.css($N.data(css)).removeData(css),"BODY"===sC.tagName&&($N=$("html")).data(css)&&$N.css($N.data(css)).removeData(css),runPluginCallbacks(Instance,$.layout.onDestroy),unload();for(var n in Instance)n.match(/^(container|options)$/)||delete Instance[n];return Instance.destroyed=!0,Instance},removePane=function(evt_or_pane,remove,skipResize,destroyChild){if(isInitialized()){var pane=evtPane.call(this,evt_or_pane),$P=$Ps[pane],$C=$Cs[pane],$R=$Rs[pane],$T=$Ts[pane];$P&&$.isEmptyObject($P.data())&&($P=!1),$C&&$.isEmptyObject($C.data())&&($C=!1),$R&&$.isEmptyObject($R.data())&&($R=!1),$T&&$.isEmptyObject($T.data())&&($T=!1),$P&&$P.stop(!0,!0);var o=options[pane],s=state[pane],d="layout",css="layoutCSS",pC=children[pane],hasChildren=$.isPlainObject(pC)&&!$.isEmptyObject(pC),destroy=void 0!==destroyChild?destroyChild:o.destroyChildren;if(hasChildren&&destroy&&($.each(pC,function(key,child){child.destroyed||child.destroy(!0),child.destroyed&&delete pC[key]}),$.isEmptyObject(pC)&&(pC=children[pane]=null,hasChildren=!1)),$P&&remove&&!hasChildren)$P.remove();else if($P&&$P[0]){var root=o.paneClass,pRoot=root+"-"+pane,_open="-open",_sliding="-sliding",_closed="-closed",classes=[root,root+_open,root+_closed,root+_sliding,pRoot,pRoot+_open,pRoot+_closed,pRoot+_sliding];$.merge(classes,getHoverClasses($P,!0)),$P.removeClass(classes.join(" ")).removeData("parentLayout").removeData("layoutPane").removeData("layoutRole").removeData("layoutEdge").removeData("autoHidden").unbind("."+sID),hasChildren&&$C?($C.width($C.width()),$.each(pC,function(key,child){child.resizeAll()})):$C&&$C.css($C.data(css)).removeData(css).removeData("layoutRole"),$P.data(d)||$P.css($P.data(css)).removeData(css)}$T&&$T.remove(),$R&&$R.remove(),Instance[pane]=$Ps[pane]=$Cs[pane]=$Rs[pane]=$Ts[pane]=!1,s={removed:!0},skipResize||resizeAll()}},_hidePane=function(pane){var $P=$Ps[pane],o=options[pane],s=$P[0].style;o.useOffscreenClose?($P.data(_c.offscreenReset)||$P.data(_c.offscreenReset,{left:s.left,right:s.right}),$P.css(_c.offscreenCSS)):$P.hide().removeData(_c.offscreenReset)},_showPane=function(pane){var $P=$Ps[pane],o=options[pane],off=_c.offscreenCSS,old=$P.data(_c.offscreenReset),s=$P[0].style;$P.show().removeData(_c.offscreenReset),o.useOffscreenClose&&old&&(s.left==off.left&&(s.left=old.left),s.right==off.right&&(s.right=old.right))},hide=function(evt_or_pane,noAnimation){if(isInitialized()){var pane=evtPane.call(this,evt_or_pane),o=options[pane],s=state[pane],$P=$Ps[pane],$R=$Rs[pane];$P&&!s.isHidden&&(state.initialized&&!1===_runCallbacks("onhide_start",pane)||(s.isSliding=!1,delete state.panesSliding[pane],$R&&$R.hide(),!state.initialized||s.isClosed?(s.isClosed=!0,s.isHidden=!0,s.isVisible=!1,state.initialized||_hidePane(pane),sizeMidPanes("horz"===_c[pane].dir?"":"center"),(state.initialized||o.triggerEventsOnLoad)&&_runCallbacks("onhide_end",pane)):(s.isHiding=!0,close(pane,!1,noAnimation))))}},show=function(evt_or_pane,openPane,noAnimation,noAlert){if(isInitialized()){var pane=evtPane.call(this,evt_or_pane),s=(options[pane],state[pane]),$P=$Ps[pane];$Rs[pane];$P&&s.isHidden&&!1!==_runCallbacks("onshow_start",pane)&&(s.isShowing=!0,s.isSliding=!1,delete state.panesSliding[pane],openPane===!1?close(pane,!0):open(pane,!1,noAnimation,noAlert))}},toggle=function(evt_or_pane,slide){if(isInitialized()){var evt=evtObj(evt_or_pane),pane=evtPane.call(this,evt_or_pane),s=state[pane];evt&&evt.stopImmediatePropagation(),s.isHidden?show(pane):s.isClosed?open(pane,!!slide):close(pane)}},_closePane=function(pane,setHandles){var s=($Ps[pane],state[pane]);_hidePane(pane),s.isClosed=!0,s.isVisible=!1,setHandles&&setAsClosed(pane)},close=function(evt_or_pane,force,noAnimation,skipCallback){function close_2(){s.isMoving=!1,bindStartSlidingEvents(pane,!0);var altPane=_c.oppositeEdge[pane];state[altPane].noRoom&&(setSizeLimits(altPane),makePaneFit(altPane)),skipCallback||!state.initialized&&!o.triggerEventsOnLoad||(isShowing||_runCallbacks("onclose_end",pane),isShowing&&_runCallbacks("onshow_end",pane),isHiding&&_runCallbacks("onhide_end",pane))}var pane=evtPane.call(this,evt_or_pane);if(!state.initialized&&$Ps[pane])return void _closePane(pane,!0);if(isInitialized()){var doFX,isShowing,isHiding,wasSliding,$P=$Ps[pane],o=($Rs[pane],$Ts[pane],options[pane]),s=state[pane];_c[pane];$N.queue(function(queueNext){if(!$P||!o.closable&&!s.isShowing&&!s.isHiding||!force&&s.isClosed&&!s.isShowing)return queueNext();var abort=!s.isShowing&&!1===_runCallbacks("onclose_start",pane);return isShowing=s.isShowing,isHiding=s.isHiding,wasSliding=s.isSliding,delete s.isShowing,delete s.isHiding,abort?queueNext():(doFX=!noAnimation&&!s.isClosed&&"none"!=o.fxName_close,s.isMoving=!0,s.isClosed=!0,s.isVisible=!1,isHiding?s.isHidden=!0:isShowing&&(s.isHidden=!1),s.isSliding?bindStopSlidingEvents(pane,!1):sizeMidPanes("horz"===_c[pane].dir?"":"center",!1),setAsClosed(pane),void(doFX?(lockPaneForFX(pane,!0),$P.hide(o.fxName_close,o.fxSettings_close,o.fxSpeed_close,function(){lockPaneForFX(pane,!1),s.isClosed&&close_2(),queueNext()})):(_hidePane(pane),close_2(),queueNext())))})}},setAsClosed=function(pane){if($Rs[pane]){var $R=($Ps[pane],$Rs[pane]),$T=$Ts[pane],o=options[pane],side=(state[pane],_c[pane].side),rClass=o.resizerClass,tClass=o.togglerClass,_pane="-"+pane,_open="-open",_sliding="-sliding",_closed="-closed";$R.css(side,sC.inset[side]).removeClass(rClass+_open+" "+rClass+_pane+_open).removeClass(rClass+_sliding+" "+rClass+_pane+_sliding).addClass(rClass+_closed+" "+rClass+_pane+_closed),
o.resizable&&$.layout.plugins.draggable&&$R.draggable("disable").removeClass("ui-state-disabled").css("cursor","default").attr("title",""),$T&&($T.removeClass(tClass+_open+" "+tClass+_pane+_open).addClass(tClass+_closed+" "+tClass+_pane+_closed).attr("title",o.tips.Open),$T.children(".content-open").hide(),$T.children(".content-closed").css("display","block")),syncPinBtns(pane,!1),state.initialized&&sizeHandles()}},open=function(evt_or_pane,slide,noAnimation,noAlert){function open_2(){s.isMoving=!1,_fixIframe(pane),s.isSliding||sizeMidPanes("vert"==_c[pane].dir?"center":"",!1),setAsOpen(pane)}if(isInitialized()){var doFX,isShowing,pane=evtPane.call(this,evt_or_pane),$P=$Ps[pane],o=($Rs[pane],$Ts[pane],options[pane]),s=state[pane];_c[pane];$N.queue(function(queueNext){if(!$P||!o.resizable&&!o.closable&&!s.isShowing||s.isVisible&&!s.isSliding)return queueNext();if(s.isHidden&&!s.isShowing)return queueNext(),void show(pane,!0);s.autoResize&&s.size!=o.size?sizePane(pane,o.size,!0,!0,!0):setSizeLimits(pane,slide);var cbReturn=_runCallbacks("onopen_start",pane);return"abort"===cbReturn?queueNext():("NC"!==cbReturn&&setSizeLimits(pane,slide),s.minSize>s.maxSize?(syncPinBtns(pane,!1),!noAlert&&o.tips.noRoomToOpen&&alert(o.tips.noRoomToOpen),queueNext()):(slide?bindStopSlidingEvents(pane,!0):s.isSliding?bindStopSlidingEvents(pane,!1):o.slidable&&bindStartSlidingEvents(pane,!1),s.noRoom=!1,makePaneFit(pane),isShowing=s.isShowing,delete s.isShowing,doFX=!noAnimation&&s.isClosed&&"none"!=o.fxName_open,s.isMoving=!0,s.isVisible=!0,s.isClosed=!1,isShowing&&(s.isHidden=!1),void(doFX?(lockPaneForFX(pane,!0),$P.show(o.fxName_open,o.fxSettings_open,o.fxSpeed_open,function(){lockPaneForFX(pane,!1),s.isVisible&&open_2(),queueNext()})):(_showPane(pane),open_2(),queueNext()))))})}},setAsOpen=function(pane,skipCallback){var $P=$Ps[pane],$R=$Rs[pane],$T=$Ts[pane],o=options[pane],s=state[pane],side=_c[pane].side,rClass=o.resizerClass,tClass=o.togglerClass,_pane="-"+pane,_open="-open",_closed="-closed",_sliding="-sliding";$R.css(side,sC.inset[side]+getPaneSize(pane)).removeClass(rClass+_closed+" "+rClass+_pane+_closed).addClass(rClass+_open+" "+rClass+_pane+_open),s.isSliding?$R.addClass(rClass+_sliding+" "+rClass+_pane+_sliding):$R.removeClass(rClass+_sliding+" "+rClass+_pane+_sliding),removeHover(0,$R),o.resizable&&$.layout.plugins.draggable?$R.draggable("enable").css("cursor",o.resizerCursor).attr("title",o.tips.Resize):s.isSliding||$R.css("cursor","default"),$T&&($T.removeClass(tClass+_closed+" "+tClass+_pane+_closed).addClass(tClass+_open+" "+tClass+_pane+_open).attr("title",o.tips.Close),removeHover(0,$T),$T.children(".content-closed").hide(),$T.children(".content-open").css("display","block")),syncPinBtns(pane,!s.isSliding),$.extend(s,elDims($P)),state.initialized&&(sizeHandles(),sizeContent(pane,!0)),!skipCallback&&(state.initialized||o.triggerEventsOnLoad)&&$P.is(":visible")&&(_runCallbacks("onopen_end",pane),s.isShowing&&_runCallbacks("onshow_end",pane),state.initialized&&_runCallbacks("onresize_end",pane))},slideOpen=function(evt_or_pane){function open_NOW(){s.isClosed?s.isMoving||open(pane,!0):bindStopSlidingEvents(pane,!0)}if(isInitialized()){var evt=evtObj(evt_or_pane),pane=evtPane.call(this,evt_or_pane),s=state[pane],delay=options[pane].slideDelay_open;evt&&evt.stopImmediatePropagation(),s.isClosed&&evt&&"mouseenter"===evt.type&&delay>0?timer.set(pane+"_openSlider",open_NOW,delay):open_NOW()}},slideClose=function(evt_or_pane){function close_NOW(){s.isClosed?bindStopSlidingEvents(pane,!1):s.isMoving||close(pane)}if(isInitialized()){var evt=evtObj(evt_or_pane),pane=evtPane.call(this,evt_or_pane),o=options[pane],s=state[pane],delay=s.isMoving?1e3:300;if(!s.isClosed&&!s.isResizing)if("click"===o.slideTrigger_close)close_NOW();else{if(o.preventQuickSlideClose&&s.isMoving)return;if(o.preventPrematureSlideClose&&evt&&$.layout.isMouseOverElem(evt,$Ps[pane]))return;evt?timer.set(pane+"_closeSlider",close_NOW,max(o.slideDelay_close,delay)):close_NOW()}}},slideToggle=function(evt_or_pane){var pane=evtPane.call(this,evt_or_pane);toggle(pane,!0)},lockPaneForFX=function(pane,doLock){var $P=$Ps[pane],s=state[pane],o=options[pane],z=options.zIndexes;doLock?(showMasks(pane,{animation:!0,objectsOnly:!0}),$P.css({zIndex:z.pane_animate}),"south"==pane?$P.css({top:sC.inset.top+sC.innerHeight-$P.outerHeight()}):"east"==pane&&$P.css({left:sC.inset.left+sC.innerWidth-$P.outerWidth()})):(hideMasks(),$P.css({zIndex:s.isSliding?z.pane_sliding:z.pane_normal}),"south"==pane?$P.css({top:"auto"}):"east"!=pane||$P.css("left").match(/\-99999/)||$P.css({left:"auto"}),browser.msie&&o.fxOpacityFix&&"slide"!=o.fxName_open&&$P.css("filter")&&1==$P.css("opacity")&&$P[0].style.removeAttribute("filter"))},bindStartSlidingEvents=function(pane,enable){var o=options[pane],$R=($Ps[pane],$Rs[pane]),evtName=o.slideTrigger_open.toLowerCase();!$R||enable&&!o.slidable||(evtName.match(/mouseover/)?evtName=o.slideTrigger_open="mouseenter":evtName.match(/(click|dblclick|mouseenter)/)||(evtName=o.slideTrigger_open="click"),o.resizerDblClickToggle&&evtName.match(/click/)&&$R[enable?"unbind":"bind"]("dblclick."+sID,toggle),$R[enable?"bind":"unbind"](evtName+"."+sID,slideOpen).css("cursor",enable?o.sliderCursor:"default").attr("title",enable?o.tips.Slide:""))},bindStopSlidingEvents=function(pane,enable){function cancelMouseOut(evt){timer.clear(pane+"_closeSlider"),evt.stopPropagation()}var o=options[pane],s=state[pane],z=(_c[pane],options.zIndexes),evtName=o.slideTrigger_close.toLowerCase(),action=enable?"bind":"unbind",$P=$Ps[pane],$R=$Rs[pane];timer.clear(pane+"_closeSlider"),enable?(s.isSliding=!0,state.panesSliding[pane]=!0,bindStartSlidingEvents(pane,!1)):(s.isSliding=!1,delete state.panesSliding[pane]),$P.css("zIndex",enable?z.pane_sliding:z.pane_normal),$R.css("zIndex",enable?z.pane_sliding+2:z.resizer_normal),evtName.match(/(click|mouseleave)/)||(evtName=o.slideTrigger_close="mouseleave"),$R[action](evtName,slideClose),"mouseleave"===evtName&&($P[action]("mouseleave."+sID,slideClose),$R[action]("mouseenter."+sID,cancelMouseOut),$P[action]("mouseenter."+sID,cancelMouseOut)),enable?"click"!==evtName||o.resizable||($R.css("cursor",enable?o.sliderCursor:"default"),$R.attr("title",enable?o.tips.Close:"")):timer.clear(pane+"_closeSlider")},makePaneFit=function(pane,isOpening,skipCallback,force){var o=options[pane],s=state[pane],c=_c[pane],$P=$Ps[pane],$R=$Rs[pane],isSidePane="vert"===c.dir,hasRoom=!1;if(("center"===pane||isSidePane&&s.noVerticalRoom)&&(hasRoom=s.maxHeight>=0,hasRoom&&s.noRoom?(_showPane(pane),$R&&$R.show(),s.isVisible=!0,s.noRoom=!1,isSidePane&&(s.noVerticalRoom=!1),_fixIframe(pane)):hasRoom||s.noRoom||(_hidePane(pane),$R&&$R.hide(),s.isVisible=!1,s.noRoom=!0)),"center"===pane);else if(s.minSize<=s.maxSize){if(hasRoom=!0,s.size>s.maxSize)sizePane(pane,s.maxSize,skipCallback,!0,force);else if(s.size<s.minSize)sizePane(pane,s.minSize,skipCallback,!0,force);else if($R&&s.isVisible&&$P.is(":visible")){var pos=s.size+sC.inset[c.side];$.layout.cssNum($R,c.side)!=pos&&$R.css(c.side,pos)}s.noRoom&&(s.wasOpen&&o.closable?o.autoReopen?open(pane,!1,!0,!0):s.noRoom=!1:show(pane,s.wasOpen,!0,!0))}else s.noRoom||(s.noRoom=!0,s.wasOpen=!s.isClosed&&!s.isSliding,s.isClosed||(o.closable?close(pane,!0,!0):hide(pane,!0)))},manualSizePane=function(evt_or_pane,size,skipCallback,noAnimation,force){if(isInitialized()){var pane=evtPane.call(this,evt_or_pane),o=options[pane],s=state[pane],forceResize=force||o.livePaneResizing&&!s.isResizing;s.autoResize=!1,sizePane(pane,size,skipCallback,noAnimation,forceResize)}},sizePane=function(evt_or_pane,size,skipCallback,noAnimation,force){function sizePane_2(){for(var actual="width"===dimName?$P.outerWidth():$P.outerHeight(),tries=[{pane:pane,count:1,target:size,actual:actual,correct:size===actual,attempt:size,cssSize:newSize}],lastTry=tries[0],thisTry={},msg="Inaccurate size after resizing the "+pane+"-pane.";!(lastTry.correct||(thisTry={pane:pane,count:lastTry.count+1,target:size},lastTry.actual>size?thisTry.attempt=max(0,lastTry.attempt-(lastTry.actual-size)):thisTry.attempt=max(0,lastTry.attempt+(size-lastTry.actual)),thisTry.cssSize=cssSize(pane,thisTry.attempt),$P.css(dimName,thisTry.cssSize),thisTry.actual="width"==dimName?$P.outerWidth():$P.outerHeight(),thisTry.correct=size===thisTry.actual,1===tries.length&&(_log(msg,!1,!0),_log(lastTry,!1,!0)),_log(thisTry,!1,!0),tries.length>3));)tries.push(thisTry),lastTry=tries[tries.length-1];s.size=size,$.extend(s,elDims($P)),s.isVisible&&$P.is(":visible")&&($R&&$R.css(side,size+sC.inset[side]),sizeContent(pane)),!skipCallback&&!skipResizeWhileDragging&&state.initialized&&s.isVisible&&_runCallbacks("onresize_end",pane),skipCallback||(s.isSliding||sizeMidPanes("horz"==_c[pane].dir?"":"center",skipResizeWhileDragging,force),sizeHandles());var altPane=_c.oppositeEdge[pane];oldSize>size&&state[altPane].noRoom&&(setSizeLimits(altPane),makePaneFit(altPane,!1,skipCallback)),tries.length>1&&_log(msg+"\nSee the Error Console for details.",!0,!0)}if(isInitialized()){var oldSize,newSize,pane=evtPane.call(this,evt_or_pane),o=options[pane],s=state[pane],$P=$Ps[pane],$R=$Rs[pane],side=_c[pane].side,dimName=_c[pane].sizeType.toLowerCase(),skipResizeWhileDragging=s.isResizing&&!o.triggerEventsDuringLiveResize,doFX=noAnimation!==!0&&o.animatePaneSizing;$N.queue(function(queueNext){if(setSizeLimits(pane),oldSize=s.size,size=_parseSize(pane,size),size=max(size,_parseSize(pane,o.minSize)),size=min(size,s.maxSize),size<s.minSize)return queueNext(),void makePaneFit(pane,!1,skipCallback);if(!force&&size===oldSize)return queueNext();if(s.newSize=size,!skipCallback&&state.initialized&&s.isVisible&&_runCallbacks("onresize_start",pane),newSize=cssSize(pane,size),doFX&&$P.is(":visible")){var fx=$.layout.effects.size[pane]||$.layout.effects.size.all,easing=o.fxSettings_size.easing||fx.easing,z=options.zIndexes,props={};props[dimName]=newSize+"px",s.isMoving=!0,$P.css({zIndex:z.pane_animate}).show().animate(props,o.fxSpeed_size,easing,function(){$P.css({zIndex:s.isSliding?z.pane_sliding:z.pane_normal}),s.isMoving=!1,delete s.newSize,sizePane_2(),queueNext()})}else $P.css(dimName,newSize),delete s.newSize,$P.is(":visible")?sizePane_2():(s.size=size,$.extend(s,elDims($P))),queueNext()})}},sizeMidPanes=function(panes,skipCallback,force){panes=(panes?panes:"east,west,center").split(","),$.each(panes,function(i,pane){if($Ps[pane]){var o=options[pane],s=state[pane],$P=$Ps[pane],hasRoom=($Rs[pane],!0),CSS={},visCSS=$.layout.showInvisibly($P),newCenter=calcNewCenterPaneDims();if($.extend(s,elDims($P)),"center"===pane){if(!force&&s.isVisible&&newCenter.width===s.outerWidth&&newCenter.height===s.outerHeight)return $P.css(visCSS),!0;if($.extend(s,cssMinDims(pane),{maxWidth:newCenter.width,maxHeight:newCenter.height}),CSS=newCenter,s.newWidth=CSS.width,s.newHeight=CSS.height,CSS.width=cssW($P,CSS.width),CSS.height=cssH($P,CSS.height),hasRoom=CSS.width>=0&&CSS.height>=0,!state.initialized&&o.minWidth>newCenter.width){var reqPx=o.minWidth-s.outerWidth,minE=options.east.minSize||0,minW=options.west.minSize||0,sizeE=state.east.size,sizeW=state.west.size,newE=sizeE,newW=sizeW;if(reqPx>0&&state.east.isVisible&&sizeE>minE&&(newE=max(sizeE-minE,sizeE-reqPx),reqPx-=sizeE-newE),reqPx>0&&state.west.isVisible&&sizeW>minW&&(newW=max(sizeW-minW,sizeW-reqPx),reqPx-=sizeW-newW),0===reqPx)return sizeE&&sizeE!=minE&&sizePane("east",newE,!0,!0,force),sizeW&&sizeW!=minW&&sizePane("west",newW,!0,!0,force),sizeMidPanes("center",skipCallback,force),void $P.css(visCSS)}}else{if(s.isVisible&&!s.noVerticalRoom&&$.extend(s,elDims($P),cssMinDims(pane)),!force&&!s.noVerticalRoom&&newCenter.height===s.outerHeight)return $P.css(visCSS),!0;CSS.top=newCenter.top,CSS.bottom=newCenter.bottom,s.newSize=newCenter.height,CSS.height=cssH($P,newCenter.height),s.maxHeight=CSS.height,hasRoom=s.maxHeight>=0,hasRoom||(s.noVerticalRoom=!0)}if(hasRoom?(!skipCallback&&state.initialized&&_runCallbacks("onresize_start",pane),$P.css(CSS),"center"!==pane&&sizeHandles(pane),!s.noRoom||s.isClosed||s.isHidden||makePaneFit(pane),s.isVisible&&($.extend(s,elDims($P)),state.initialized&&sizeContent(pane))):!s.noRoom&&s.isVisible&&makePaneFit(pane),$P.css(visCSS),delete s.newSize,delete s.newWidth,delete s.newHeight,!s.isVisible)return!0;if("center"===pane){var fix=browser.isIE6||!browser.boxModel;$Ps.north&&(fix||"IFRAME"==state.north.tagName)&&$Ps.north.css("width",cssW($Ps.north,sC.innerWidth)),$Ps.south&&(fix||"IFRAME"==state.south.tagName)&&$Ps.south.css("width",cssW($Ps.south,sC.innerWidth))}!skipCallback&&state.initialized&&_runCallbacks("onresize_end",pane)}})},resizeAll=function(evt_or_refresh){var oldW=sC.innerWidth,oldH=sC.innerHeight;if(evtPane(evt_or_refresh),$N.is(":visible")){if(!state.initialized)return void _initLayoutElements();if(evt_or_refresh===!0&&$.isPlainObject(options.outset)&&$N.css(options.outset),$.extend(sC,elDims($N,options.inset)),sC.outerHeight){if(evt_or_refresh===!0&&setPanePosition(),!1===_runCallbacks("onresizeall_start"))return!1;var $P,o,s;sC.innerHeight<oldH,sC.innerWidth<oldW;$.each(["south","north","east","west"],function(i,pane){$Ps[pane]&&(o=options[pane],s=state[pane],s.autoResize&&s.size!=o.size?sizePane(pane,o.size,!0,!0,!0):(setSizeLimits(pane),makePaneFit(pane,!1,!0,!0)))}),sizeMidPanes("",!0,!0),sizeHandles(),$.each(_c.allPanes,function(i,pane){$P=$Ps[pane],$P&&state[pane].isVisible&&_runCallbacks("onresize_end",pane)}),_runCallbacks("onresizeall_end")}}},resizeChildren=function(evt_or_pane,skipRefresh){var pane=evtPane.call(this,evt_or_pane);if(options[pane].resizeChildren){skipRefresh||refreshChildren(pane);var pC=children[pane];$.isPlainObject(pC)&&$.each(pC,function(key,child){child.destroyed||child.resizeAll()})}},sizeContent=function(evt_or_panes,remeasure){if(isInitialized()){var panes=evtPane.call(this,evt_or_panes);panes=panes?panes.split(","):_c.allPanes,$.each(panes,function(idx,pane){function _below($E){return max(s.css.paddingBottom,parseInt($E.css("marginBottom"),10)||0)}function _measure(){var ignore=options[pane].contentIgnoreSelector,$Fs=$C.nextAll().not(".ui-layout-mask").not(ignore||":lt(0)"),$Fs_vis=$Fs.filter(":visible"),$F=$Fs_vis.filter(":last");m={top:$C[0].offsetTop,height:$C.outerHeight(),numFooters:$Fs.length,hiddenFooters:$Fs.length-$Fs_vis.length,spaceBelow:0},m.spaceAbove=m.top,m.bottom=m.top+m.height,$F.length?m.spaceBelow=$F[0].offsetTop+$F.outerHeight()-m.bottom+_below($F):m.spaceBelow=_below($C)}var $P=$Ps[pane],$C=$Cs[pane],o=options[pane],s=state[pane],m=s.content;if(!$P||!$C||!$P.is(":visible"))return!0;if(($C.length||(initContent(pane,!1),$C))&&!1!==_runCallbacks("onsizecontent_start",pane)){(!s.isMoving&&!s.isResizing||o.liveContentResizing||remeasure||void 0==m.top)&&(_measure(),m.hiddenFooters>0&&"hidden"===$P.css("overflow")&&($P.css("overflow","visible"),_measure(),$P.css("overflow","hidden")));var newH=s.innerHeight-(m.spaceAbove-s.css.paddingTop)-(m.spaceBelow-s.css.paddingBottom);$C.is(":visible")&&m.height==newH||(setOuterHeight($C,newH,!0),m.height=newH),state.initialized&&_runCallbacks("onsizecontent_end",pane)}})}},sizeHandles=function(evt_or_panes){var panes=evtPane.call(this,evt_or_panes);panes=panes?panes.split(","):_c.borderPanes,$.each(panes,function(i,pane){var $TC,o=options[pane],s=state[pane],$P=$Ps[pane],$R=$Rs[pane],$T=$Ts[pane];if($P&&$R){var paneLen,left,offset,dir=_c[pane].dir,_state=s.isClosed?"_closed":"_open",spacing=o["spacing"+_state],togAlign=o["togglerAlign"+_state],togLen=o["togglerLength"+_state];if(0===spacing)return void $R.hide();if(s.noRoom||s.isHidden||$R.show(),"horz"===dir?(paneLen=sC.innerWidth,s.resizerLength=paneLen,left=$.layout.cssNum($P,"left"),$R.css({width:cssW($R,paneLen),height:cssH($R,spacing),left:left>-9999?left:sC.inset.left})):(paneLen=$P.outerHeight(),s.resizerLength=paneLen,$R.css({height:cssH($R,paneLen),width:cssW($R,spacing),top:sC.inset.top+getPaneSize("north",!0)})),removeHover(o,$R),$T){if(0===togLen||s.isSliding&&o.hideTogglerOnSlide)return void $T.hide();if($T.show(),!(togLen>0)||"100%"===togLen||togLen>paneLen)togLen=paneLen,offset=0;else if(isStr(togAlign))switch(togAlign){case"top":case"left":offset=0;break;case"bottom":case"right":offset=paneLen-togLen;break;case"middle":case"center":default:offset=round((paneLen-togLen)/2)}else{var x=parseInt(togAlign,10);offset=togAlign>=0?x:paneLen-togLen+x}if("horz"===dir){var width=cssW($T,togLen);$T.css({width:width,height:cssH($T,spacing),left:offset,top:0}),$T.children(".content").each(function(){$TC=$(this),$TC.css("marginLeft",round((width-$TC.outerWidth())/2))})}else{var height=cssH($T,togLen);$T.css({height:height,width:cssW($T,spacing),top:offset,left:0}),$T.children(".content").each(function(){$TC=$(this),$TC.css("marginTop",round((height-$TC.outerHeight())/2))})}removeHover(0,$T)}state.initialized||!o.initHidden&&!s.isHidden||($R.hide(),$T&&$T.hide())}})},enableClosable=function(evt_or_pane){if(isInitialized()){var pane=evtPane.call(this,evt_or_pane),$T=$Ts[pane],o=options[pane];$T&&(o.closable=!0,$T.bind("click."+sID,function(evt){evt.stopPropagation(),toggle(pane)}).css("visibility","visible").css("cursor","pointer").attr("title",state[pane].isClosed?o.tips.Open:o.tips.Close).show())}},disableClosable=function(evt_or_pane,hide){if(isInitialized()){var pane=evtPane.call(this,evt_or_pane),$T=$Ts[pane];$T&&(options[pane].closable=!1,state[pane].isClosed&&open(pane,!1,!0),$T.unbind("."+sID).css("visibility",hide?"hidden":"visible").css("cursor","default").attr("title",""))}},enableSlidable=function(evt_or_pane){if(isInitialized()){var pane=evtPane.call(this,evt_or_pane),$R=$Rs[pane];$R&&$R.data("draggable")&&(options[pane].slidable=!0,state[pane].isClosed&&bindStartSlidingEvents(pane,!0))}},disableSlidable=function(evt_or_pane){if(isInitialized()){var pane=evtPane.call(this,evt_or_pane),$R=$Rs[pane];$R&&(options[pane].slidable=!1,state[pane].isSliding?close(pane,!1,!0):(bindStartSlidingEvents(pane,!1),$R.css("cursor","default").attr("title",""),removeHover(null,$R[0])))}},enableResizable=function(evt_or_pane){if(isInitialized()){var pane=evtPane.call(this,evt_or_pane),$R=$Rs[pane],o=options[pane];$R&&$R.data("draggable")&&(o.resizable=!0,$R.draggable("enable"),state[pane].isClosed||$R.css("cursor",o.resizerCursor).attr("title",o.tips.Resize))}},disableResizable=function(evt_or_pane){if(isInitialized()){var pane=evtPane.call(this,evt_or_pane),$R=$Rs[pane];$R&&$R.data("draggable")&&(options[pane].resizable=!1,$R.draggable("disable").css("cursor","default").attr("title",""),removeHover(null,$R[0]))}},swapPanes=function(evt_or_pane1,pane2){function copy(n){var $P=$Ps[n],$C=$Cs[n];return $P?{pane:n,P:$P?$P[0]:!1,C:$C?$C[0]:!1,state:$.extend(!0,{},state[n]),options:$.extend(!0,{},options[n])}:!1}function move(oPane,pane){if(oPane){var re,size,P=oPane.P,C=oPane.C,oldPane=oPane.pane,c=_c[pane],s=$.extend(!0,{},state[pane]),o=options[pane],fx={resizerCursor:o.resizerCursor};$.each("fxName,fxSpeed,fxSettings".split(","),function(i,k){fx[k+"_open"]=o[k+"_open"],fx[k+"_close"]=o[k+"_close"],fx[k+"_size"]=o[k+"_size"]}),$Ps[pane]=$(P).data({layoutPane:Instance[pane],layoutEdge:pane}).css(_c.hidden).css(c.cssReq),$Cs[pane]=C?$(C):!1,options[pane]=$.extend(!0,{},oPane.options,fx),state[pane]=$.extend(!0,{},oPane.state),re=new RegExp(o.paneClass+"-"+oldPane,"g"),P.className=P.className.replace(re,o.paneClass+"-"+pane),initHandles(pane),c.dir!=_c[oldPane].dir?(size=sizes[pane]||0,setSizeLimits(pane),size=max(size,state[pane].minSize),manualSizePane(pane,size,!0,!0)):$Rs[pane].css(c.side,sC.inset[c.side]+(state[pane].isVisible?getPaneSize(pane):0)),oPane.state.isVisible&&!s.isVisible?setAsOpen(pane,!0):(setAsClosed(pane),bindStartSlidingEvents(pane,!0)),oPane=null}}if(isInitialized()){var pane1=evtPane.call(this,evt_or_pane1);if(state[pane1].edge=pane2,state[pane2].edge=pane1,!1===_runCallbacks("onswap_start",pane1)||!1===_runCallbacks("onswap_start",pane2))return state[pane1].edge=pane1,void(state[pane2].edge=pane2);var oPane1=copy(pane1),oPane2=copy(pane2),sizes={};sizes[pane1]=oPane1?oPane1.state.size:0,sizes[pane2]=oPane2?oPane2.state.size:0,$Ps[pane1]=!1,$Ps[pane2]=!1,state[pane1]={},state[pane2]={},$Ts[pane1]&&$Ts[pane1].remove(),$Ts[pane2]&&$Ts[pane2].remove(),$Rs[pane1]&&$Rs[pane1].remove(),$Rs[pane2]&&$Rs[pane2].remove(),$Rs[pane1]=$Rs[pane2]=$Ts[pane1]=$Ts[pane2]=!1,move(oPane1,pane2),move(oPane2,pane1),oPane1=oPane2=sizes=null,$Ps[pane1]&&$Ps[pane1].css(_c.visible),$Ps[pane2]&&$Ps[pane2].css(_c.visible),resizeAll(),_runCallbacks("onswap_end",pane1),_runCallbacks("onswap_end",pane2)}},syncPinBtns=function(pane,doPin){$.layout.plugins.buttons&&$.each(state[pane].pins,function(i,selector){$.layout.buttons.setPinState(Instance,$(selector),pane,doPin)})};try{var $N=$(this).eq(0);if(!$N.length)return _log(options.errors.containerMissing);if($N.data("layoutContainer")&&$N.data("layout"))return $N.data("layout")}catch(e){console.log("eeeee",e)}var $Ps={},$Cs={},$Rs={},$Ts={},$Ms=$([]),sC=state.container,sID=state.id,Instance={options:options,state:state,container:$N,panes:$Ps,contents:$Cs,resizers:$Rs,togglers:$Ts,hide:hide,show:show,toggle:toggle,open:open,close:close,slideOpen:slideOpen,slideClose:slideClose,slideToggle:slideToggle,setSizeLimits:setSizeLimits,_sizePane:sizePane,sizePane:manualSizePane,sizeContent:sizeContent,swapPanes:swapPanes,showMasks:showMasks,hideMasks:hideMasks,initContent:initContent,addPane:addPane,removePane:removePane,createChildren:createChildren,refreshChildren:refreshChildren,enableClosable:enableClosable,disableClosable:disableClosable,enableSlidable:enableSlidable,disableSlidable:disableSlidable,enableResizable:enableResizable,disableResizable:disableResizable,allowOverflow:allowOverflow,resetOverflow:resetOverflow,destroy:destroy,initPanes:isInitialized,resizeAll:resizeAll,runCallbacks:_runCallbacks,hasParentLayout:!1,children:children,north:!1,south:!1,west:!1,east:!1,center:!1};return"cancel"===_create()?null:Instance}}(jQuery),function($){$.ui||($.ui={}),$.ui.cookie={acceptsCookies:!!navigator.cookieEnabled,read:function(name){for(var pair,c=document.cookie,cs=c?c.split(";"):[],i=0,n=cs.length;n>i;i++)if(pair=$.trim(cs[i]).split("="),pair[0]==name)return decodeURIComponent(pair[1]);return null},write:function(name,val,cookieOpts){var params="",date="",clear=!1,o=cookieOpts||{},x=o.expires||null,t=$.type(x);"date"===t?date=x:"string"===t&&x>0&&(x=parseInt(x,10),t="number"),"number"===t&&(date=new Date,x>0?date.setDate(date.getDate()+x):(date.setFullYear(1970),clear=!0)),date&&(params+=";expires="+date.toUTCString()),o.path&&(params+=";path="+o.path),o.domain&&(params+=";domain="+o.domain),o.secure&&(params+=";secure"),document.cookie=name+"="+(clear?"":encodeURIComponent(val))+params},clear:function(name){$.ui.cookie.write(name,"",{expires:-1})}},$.cookie||($.cookie=function(k,v,o){var C=$.ui.cookie;if(null===v)C.clear(k);else{if(void 0===v)return C.read(k);C.write(k,v,o)}}),$.layout.plugins.stateManagement=!0,$.layout.config.optionRootKeys.push("stateManagement"),$.layout.defaults.stateManagement={enabled:!1,autoSave:!0,autoLoad:!0,animateLoad:!0,includeChildren:!0,stateKeys:"north.size,south.size,east.size,west.size,north.isClosed,south.isClosed,east.isClosed,west.isClosed,north.isHidden,south.isHidden,east.isHidden,west.isHidden",cookie:{name:"",domain:"",path:"",expires:"",secure:!1}},$.layout.optionsMap.layout.push("stateManagement"),$.layout.state={saveCookie:function(inst,keys,cookieOpts){var o=inst.options,sm=o.stateManagement,oC=$.extend(!0,{},sm.cookie,cookieOpts||null),data=inst.state.stateData=inst.readState(keys||sm.stateKeys);return $.ui.cookie.write(oC.name||o.name||"Layout",$.layout.state.encodeJSON(data),oC),$.extend(!0,{},data)},deleteCookie:function(inst){var o=inst.options;$.ui.cookie.clear(o.stateManagement.cookie.name||o.name||"Layout")},readCookie:function(inst){var o=inst.options,c=$.ui.cookie.read(o.stateManagement.cookie.name||o.name||"Layout");return c?$.layout.state.decodeJSON(c):{}},loadCookie:function(inst){var c=$.layout.state.readCookie(inst);return c&&(inst.state.stateData=$.extend(!0,{},c),inst.loadState(c)),c},loadState:function(inst,data,opts){if($.isPlainObject(data)&&!$.isEmptyObject(data)){data=inst.state.stateData=$.layout.transformData(data);var smo=inst.options.stateManagement;if(opts=$.extend({animateLoad:!1,includeChildren:smo.includeChildren},opts),inst.state.initialized){var o,c,h,state,open,noAnimate=!opts.animateLoad;if($.each($.layout.config.borderPanes,function(idx,pane){o=data[pane],$.isPlainObject(o)&&(s=o.size,c=o.initClosed,h=o.initHidden,ar=o.autoResize,state=inst.state[pane],open=state.isVisible,ar&&(state.autoResize=ar),open||inst._sizePane(pane,s,!1,!1,!1),h===!0?inst.hide(pane,noAnimate):c===!0?inst.close(pane,!1,noAnimate):c===!1?inst.open(pane,!1,noAnimate):h===!1&&inst.show(pane,!1,noAnimate),open&&inst._sizePane(pane,s,!1,!1,noAnimate))}),opts.includeChildren){var paneStateChildren,childState;$.each(inst.children,function(pane,paneChildren){paneStateChildren=data[pane]?data[pane].children:0,paneStateChildren&&paneChildren&&$.each(paneChildren,function(stateKey,child){childState=paneStateChildren[stateKey],child&&childState&&child.loadState(childState)})})}}else{var o=$.extend(!0,{},data);$.each($.layout.config.allPanes,function(idx,pane){o[pane]&&delete o[pane].children}),$.extend(!0,inst.options,o)}}},readState:function(inst,opts){"string"===$.type(opts)&&(opts={keys:opts}),opts||(opts={});var pair,pane,key,val,ps,pC,branch,sm=inst.options.stateManagement,ic=opts.includeChildren,recurse=void 0!==ic?ic:sm.includeChildren,keys=opts.stateKeys||sm.stateKeys,alt={isClosed:"initClosed",isHidden:"initHidden"},state=inst.state,panes=$.layout.config.allPanes,data={};$.isArray(keys)&&(keys=keys.join(",")),keys=keys.replace(/__/g,".").split(",");for(var i=0,n=keys.length;n>i;i++)pair=keys[i].split("."),pane=pair[0],key=pair[1],$.inArray(pane,panes)<0||(val=state[pane][key],void 0!=val&&("isClosed"==key&&state[pane].isSliding&&(val=!0),(data[pane]||(data[pane]={}))[alt[key]?alt[key]:key]=val));return recurse&&$.each(panes,function(idx,pane){pC=inst.children[pane],ps=state.stateData[pane],$.isPlainObject(pC)&&!$.isEmptyObject(pC)&&(branch=data[pane]||(data[pane]={}),branch.children||(branch.children={}),$.each(pC,function(key,child){child.state.initialized?branch.children[key]=$.layout.state.readState(child):ps&&ps.children&&ps.children[key]&&(branch.children[key]=$.extend(!0,{},ps.children[key]))}))}),data},encodeJSON:function(JSON){function parse(h){var k,v,t,D=[],i=0,a=$.isArray(h);for(k in h)v=h[k],t=typeof v,"string"==t?v='"'+v+'"':"object"==t&&(v=parse(v)),D[i++]=(a?"":'"'+k+'":')+v;return(a?"[":"{")+D.join(",")+(a?"]":"}")}return parse(JSON)},decodeJSON:function(str){try{return $.parseJSON?$.parseJSON(str):window.eval("("+str+")")||{}}catch(e){return{}}},_create:function(inst){var _=$.layout.state,o=inst.options,sm=o.stateManagement;if($.extend(inst,{readCookie:function(){return _.readCookie(inst)},deleteCookie:function(){_.deleteCookie(inst)},saveCookie:function(keys,cookieOpts){return _.saveCookie(inst,keys,cookieOpts)},loadCookie:function(){return _.loadCookie(inst)},loadState:function(stateData,opts){_.loadState(inst,stateData,opts)},readState:function(keys){return _.readState(inst,keys)},encodeJSON:_.encodeJSON,decodeJSON:_.decodeJSON}),inst.state.stateData={},sm.autoLoad)if($.isPlainObject(sm.autoLoad))$.isEmptyObject(sm.autoLoad)||inst.loadState(sm.autoLoad);else if(sm.enabled)if($.isFunction(sm.autoLoad)){var d={};try{d=sm.autoLoad(inst,inst.state,inst.options,inst.options.name||"")}catch(e){}d&&$.isPlainObject(d)&&!$.isEmptyObject(d)&&inst.loadState(d)}else inst.loadCookie()},_unload:function(inst){var sm=inst.options.stateManagement;if(sm.enabled&&sm.autoSave)if($.isFunction(sm.autoSave))try{sm.autoSave(inst,inst.state,inst.options,inst.options.name||"")}catch(e){}else inst.saveCookie()}},$.layout.onCreate.push($.layout.state._create),$.layout.onUnload.push($.layout.state._unload),$.layout.plugins.buttons=!0,$.layout.defaults.autoBindCustomButtons=!1,$.layout.optionsMap.layout.push("autoBindCustomButtons"),$.layout.buttons={init:function(inst){var name,pre="ui-layout-button-",layout=inst.options.name||"";$.each("toggle,open,close,pin,toggle-slide,open-slide".split(","),function(i,action){$.each($.layout.config.borderPanes,function(ii,pane){$("."+pre+action+"-"+pane).each(function(){name=$(this).data("layoutName")||$(this).attr("layoutName"),(void 0==name||name===layout)&&inst.bindButton(this,action,pane)})})})},get:function(inst,selector,pane,action){var $E=$(selector),o=inst.options,err=o.errors.addButtonError;if($E.length)if($.inArray(pane,$.layout.config.borderPanes)<0)$.layout.msg(err+" "+o.errors.pane+": "+pane,!0),$E=$("");else{var btn=o[pane].buttonClass+"-"+action;$E.addClass(btn+" "+btn+"-"+pane).data("layoutName",o.name)}else $.layout.msg(err+" "+o.errors.selector+": "+selector,!0);return $E},bind:function(inst,selector,action,pane){var _=$.layout.buttons;switch(action.toLowerCase()){case"toggle":_.addToggle(inst,selector,pane);break;case"open":_.addOpen(inst,selector,pane);break;case"close":_.addClose(inst,selector,pane);break;case"pin":_.addPin(inst,selector,pane);break;case"toggle-slide":_.addToggle(inst,selector,pane,!0);break;case"open-slide":_.addOpen(inst,selector,pane,!0)}return inst},addToggle:function(inst,selector,pane,slide){return $.layout.buttons.get(inst,selector,pane,"toggle").click(function(evt){inst.toggle(pane,!!slide),evt.stopPropagation()}),inst},addOpen:function(inst,selector,pane,slide){return $.layout.buttons.get(inst,selector,pane,"open").attr("title",inst.options[pane].tips.Open).click(function(evt){inst.open(pane,!!slide),evt.stopPropagation()}),inst},addClose:function(inst,selector,pane){return $.layout.buttons.get(inst,selector,pane,"close").attr("title",inst.options[pane].tips.Close).click(function(evt){inst.close(pane),evt.stopPropagation()}),inst},addPin:function(inst,selector,pane){var _=$.layout.buttons,$E=_.get(inst,selector,pane,"pin");if($E.length){var s=inst.state[pane];$E.click(function(evt){_.setPinState(inst,$(this),pane,s.isSliding||s.isClosed),s.isSliding||s.isClosed?inst.open(pane):inst.close(pane),evt.stopPropagation()}),_.setPinState(inst,$E,pane,!s.isClosed&&!s.isSliding),s.pins.push(selector)}return inst},setPinState:function(inst,$Pin,pane,doPin){var updown=$Pin.attr("pin");if(!updown||doPin!==("down"==updown)){var o=inst.options[pane],pin=o.buttonClass+"-pin",side=pin+"-"+pane,UP=pin+"-up "+side+"-up",DN=pin+"-down "+side+"-down";$Pin.attr("pin",doPin?"down":"up").attr("title",doPin?o.tips.Unpin:o.tips.Pin).removeClass(doPin?UP:DN).addClass(doPin?DN:UP)}},syncPinBtns:function(inst,pane,doPin){$.each(inst.state[pane].pins,function(i,selector){$.layout.buttons.setPinState(inst,$(selector),pane,doPin)})},_load:function(inst){var _=$.layout.buttons;$.extend(inst,{bindButton:function(sel,action,pane){return _.bind(inst,sel,action,pane)},addToggleBtn:function(sel,pane,slide){return _.addToggle(inst,sel,pane,slide)},addOpenBtn:function(sel,pane,slide){return _.addOpen(inst,sel,pane,slide)},addCloseBtn:function(sel,pane){return _.addClose(inst,sel,pane)},addPinBtn:function(sel,pane){return _.addPin(inst,sel,pane)}});for(var i=0;4>i;i++){var pane=$.layout.config.borderPanes[i];inst.state[pane].pins=[]}inst.options.autoBindCustomButtons&&_.init(inst)},_unload:function(inst){}},$.layout.onLoad.push($.layout.buttons._load),$.layout.plugins.browserZoom=!0,$.layout.defaults.browserZoomCheckInterval=1e3,$.layout.optionsMap.layout.push("browserZoomCheckInterval"),$.layout.browserZoom={_init:function(inst){$.layout.browserZoom.ratio()!==!1&&$.layout.browserZoom._setTimer(inst)},_setTimer:function(inst){if(!inst.destroyed){var o=inst.options,s=inst.state,ms=inst.hasParentLayout?5e3:Math.max(o.browserZoomCheckInterval,100);setTimeout(function(){if(!inst.destroyed&&o.resizeWithWindow){var d=$.layout.browserZoom.ratio();d!==s.browserZoom&&(s.browserZoom=d,
inst.resizeAll()),$.layout.browserZoom._setTimer(inst)}},ms)}},ratio:function(){function calc(x,y){return(parseInt(x,10)/parseInt(y,10)*100).toFixed()}var r,sW,cW,w=window,s=screen,d=document,dE=d.documentElement||d.body,b=$.layout.browser,v=b.version;return b.msie&&v>8||!b.msie?!1:s.deviceXDPI&&s.systemXDPI?calc(s.deviceXDPI,s.systemXDPI):b.webkit&&(r=d.body.getBoundingClientRect)?calc(r.left-r.right,d.body.offsetWidth):b.webkit&&(sW=w.outerWidth)?calc(sW,w.innerWidth):(sW=s.width)&&(cW=dE.clientWidth)?calc(sW,cW):!1}},$.layout.onReady.push($.layout.browserZoom._init)}(jQuery),define("libs/jquery-layout",function(){}),function(){define("ide/directives/layout",["base","libs/jquery-layout"],function(App){return App.directive("layout",["$parse","$compile","ide",function($parse,$compile,ide){return{compile:function(){return{pre:function(scope,element,attrs){var customTogglerEl,customTogglerMsgWhenClosed,customTogglerMsgWhenOpen,customTogglerPane,customTogglerScope,event,hasCustomToggler,i,layoutObj,len,name,oldWidth,onExternalResize,onInternalResize,onPaneClose,onPaneOpen,options,overflowPane,overflowPaneEl,overflowPaneZVal,ref,ref1,repositionControls,repositionCustomToggler,resetOpenStates,spacingClosed,spacingOpen,state;if(name=attrs.layout,customTogglerPane=attrs.customTogglerPane,customTogglerMsgWhenOpen=attrs.customTogglerMsgWhenOpen,customTogglerMsgWhenClosed=attrs.customTogglerMsgWhenClosed,hasCustomToggler=null!=customTogglerPane&&null!=customTogglerMsgWhenOpen&&null!=customTogglerMsgWhenClosed,spacingOpen=null!=attrs.spacingOpen?parseInt(attrs.spacingOpen,10):window.uiConfig.defaultResizerSizeOpen,spacingClosed=null!=attrs.spacingClosed?parseInt(attrs.spacingClosed,10):window.uiConfig.defaultResizerSizeClosed,options={spacing_open:spacingOpen,spacing_closed:spacingClosed,slidable:!1,enableCursorHotkey:!1,onopen:function(_this){return function(pane){return onPaneOpen(pane)}}(this),onclose:function(_this){return function(pane){return onPaneClose(pane)}}(this),onresize:function(_this){return function(){return onInternalResize()}}(this),maskIframesOnResize:scope.$eval(attrs.maskIframesOnResize||"false"),east:{size:scope.$eval(attrs.initialSizeEast),initClosed:scope.$eval(attrs.initClosedEast)},west:{size:scope.$eval(attrs.initialSizeEast),initClosed:scope.$eval(attrs.initClosedWest)}},null!=(state=ide.localStorage("layout."+name))&&(null!=state.east&&(null==attrs.minimumRestoreSizeEast||state.east.size>=attrs.minimumRestoreSizeEast&&!state.east.initClosed)&&(options.east=state.east),null!=state.west&&(null==attrs.minimumRestoreSizeWest||state.west.size>=attrs.minimumRestoreSizeWest&&!state.west.initClosed)&&(options.west=state.west)),null!=window.uiConfig.eastResizerCursor&&(options.east.resizerCursor=window.uiConfig.eastResizerCursor),null!=window.uiConfig.westResizerCursor&&(options.west.resizerCursor=window.uiConfig.westResizerCursor),repositionControls=function(){var controls;return state=element.layout().readState(),null!=state.east?(controls=element.find("> .ui-layout-resizer-controls"),state.east.initClosed?controls.hide():(controls.show(),controls.css({right:state.east.size}))):void 0},repositionCustomToggler=function(){var paneState,positionAnchor;if("undefined"!=typeof customTogglerEl&&null!==customTogglerEl)return state=element.layout().readState(),positionAnchor="east"===customTogglerPane?"right":"left",paneState=state[customTogglerPane],null!=paneState?customTogglerEl.css(positionAnchor,paneState.initClosed?0:paneState.size):void 0},resetOpenStates=function(){var openEast;return state=element.layout().readState(),null!=attrs.openEast&&null!=state.east?(openEast=$parse(attrs.openEast),openEast.assign(scope,!state.east.initClosed)):void 0},onInternalResize=function(){return state=element.layout().readState(),scope.$broadcast("layout:"+name+":resize",state),repositionControls(),hasCustomToggler&&repositionCustomToggler(),resetOpenStates()},oldWidth=element.width(),onExternalResize=function(){var eastState,newInternalWidth;return null!=attrs.resizeProportionally&&scope.$eval(attrs.resizeProportionally)&&(eastState=element.layout().readState().east,null!=eastState)?(newInternalWidth=eastState.size/oldWidth*element.width(),oldWidth=element.width(),void element.layout().sizePane("east",newInternalWidth)):element.layout().resizeAll()},element.layout(options),element.layout().resizeAll(),null!=attrs.resizeOn)for(ref=attrs.resizeOn.split(","),i=0,len=ref.length;len>i;i++)event=ref[i],scope.$on(event,function(){return onExternalResize()});return hasCustomToggler&&(state=element.layout().readState(),customTogglerScope=scope.$new(),customTogglerScope.isOpen=!0,customTogglerScope.isVisible=!0,(null!=(ref1=state[customTogglerPane])?ref1.initClosed:void 0)===!0&&(customTogglerScope.isOpen=!1),customTogglerScope.tooltipMsgWhenOpen=customTogglerMsgWhenOpen,customTogglerScope.tooltipMsgWhenClosed=customTogglerMsgWhenClosed,customTogglerScope.tooltipPlacement="east"===customTogglerPane?"left":"right",customTogglerScope.handleClick=function(){return element.layout().toggle(customTogglerPane),repositionCustomToggler()},customTogglerEl=$compile('<a href ng-show="isVisible" class="custom-toggler custom-toggler-'+customTogglerPane+'" ng-class="isOpen ? \'custom-toggler-open\' : \'custom-toggler-closed\'" tooltip="{{ isOpen ? tooltipMsgWhenOpen : tooltipMsgWhenClosed }}" tooltip-placement="{{ tooltipPlacement }}" ng-click="handleClick()">')(customTogglerScope),element.append(customTogglerEl)),onPaneOpen=function(pane){return hasCustomToggler||pane===customTogglerPane?customTogglerEl.scope().$applyAsync(function(){return customTogglerEl.scope().isOpen=!0}):void 0},onPaneClose=function(pane){return hasCustomToggler||pane===customTogglerPane?customTogglerEl.scope().$applyAsync(function(){return customTogglerEl.scope().isOpen=!1}):void 0},$(window).unload(function(){return ide.localStorage("layout."+name,element.layout().readState())}),null!=attrs.openEast&&scope.$watch(attrs.openEast,function(value,oldValue){return null!=value&&value!==oldValue&&(value?element.layout().open("east"):element.layout().close("east")),setTimeout(function(){return scope.$digest()},0)}),null!=attrs.allowOverflowOn&&(layoutObj=element.layout(),overflowPane=scope.$eval(attrs.allowOverflowOn),overflowPaneEl=layoutObj.panes[overflowPane],layoutObj.allowOverflow(overflowPane),overflowPaneZVal=overflowPaneEl.zIndex(),overflowPaneEl.css("z-index",overflowPaneZVal+1)),resetOpenStates(),onInternalResize(),null!=attrs.layoutDisabled?scope.$watch(attrs.layoutDisabled,function(value){return value?element.layout().hide("east"):element.layout().show("east"),hasCustomToggler?customTogglerEl.scope().$applyAsync(function(){return customTogglerEl.scope().isOpen=!value,customTogglerEl.scope().isVisible=!value}):void 0}):void 0},post:function(scope,element,attrs){var name,state;return name=attrs.layout,state=element.layout().readState(),scope.$broadcast("layout:"+name+":linked",state)}}}}}])})}.call(this),function(){var load;load=function(){var BADCHAR_RX,BADFILE_RX,BLOCKEDFILE_RX,MAX_PATH,SafePath;return BADCHAR_RX=/[\/\\\*\u0000-\u001F\u007F\u0080-\u009F\uD800-\uDFFF]/g,BADFILE_RX=/(^\.$)|(^\.\.$)|(^\s+)|(\s+$)/g,BLOCKEDFILE_RX=/^(prototype|constructor|toString|toLocaleString|valueOf|hasOwnProperty|isPrototypeOf|propertyIsEnumerable|__defineGetter__|__lookupGetter__|__defineSetter__|__lookupSetter__|__proto__)$/,MAX_PATH=1024,SafePath={clean:function(filename){return filename=filename.replace(BADCHAR_RX,"_"),filename=filename.replace(BADFILE_RX,function(match){return new Array(match.length+1).join("_")}),filename=filename.replace(BLOCKEDFILE_RX,"@$1")},isCleanFilename:function(filename){return SafePath.isAllowedLength(filename)&&!BADCHAR_RX.test(filename)&&!BADFILE_RX.test(filename)&&!BLOCKEDFILE_RX.test(filename)},isAllowedLength:function(pathname){return pathname.length>0&&pathname.length<=MAX_PATH}}},"undefined"!=typeof define&&null!==define?define("ide/directives/SafePath",[],load):module.exports=load()}.call(this),function(){define("ide/directives/validFile",["base","ide/directives/SafePath"],function(App,SafePath){return App.directive("validFile",function(){return{require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){return ngModelCtrl.$validators.validFile=function(filename){return SafePath.isCleanFilename(filename)}}}})})}.call(this),function(){define("ide/services/ide",["base"],function(App){return App.factory("ide",["$http","queuedHttp","$modal","$q","$filter","$timeout",function($http,queuedHttp,$modal,$q,$filter,$timeout){var ide;return ide={},ide.$http=$http,ide.queuedHttp=queuedHttp,ide.$q=$q,ide.$filter=$filter,ide.$timeout=$timeout,this.recentEvents=[],ide.pushEvent=function(_this){return function(type,meta){return null==meta&&(meta={}),_this.recentEvents.push({type:type,meta:meta,date:new Date}),_this.recentEvents.length>40?_this.recentEvents.shift():void 0}}(this),ide.reportError=function(_this){return function(error,meta){var errorObj,i,key,len,ref,ref1,ref2,ref3,ref4,ref5;if(null==meta&&(meta={}),meta.client_id=null!=(ref=_this.socket)&&null!=(ref1=ref.socket)?ref1.sessionid:void 0,meta.transport=null!=(ref2=_this.socket)&&null!=(ref3=ref2.socket)&&null!=(ref4=ref3.transport)?ref4.name:void 0,meta.client_now=new Date,meta.recent_events=_this.recentEvents,errorObj={},"object"==typeof error)for(ref5=Object.getOwnPropertyNames(error),i=0,len=ref5.length;len>i;i++)key=ref5[i],errorObj[key]=error[key];else"string"==typeof error&&(errorObj.message=error);return $http.post("/error/client",{error:errorObj,meta:meta,_csrf:window.csrfToken})}}(this),ide.showGenericMessageModal=function(title,message){return $modal.open({templateUrl:"genericMessageModalTemplate",controller:"GenericMessageModalController",resolve:{title:function(){return title},message:function(){return message}}})},ide.showLockEditorMessageModal=function(title,message){return $modal.open({templateUrl:"lockEditorModalTemplate",controller:"GenericMessageModalController",backdrop:"static",keyboard:!1,resolve:{title:function(){return title},message:function(){return message}},windowClass:"lock-editor-modal"})},ide}]),App.controller("GenericMessageModalController",["$scope","$modalInstance","title","message",function($scope,$modalInstance,title,message){return $scope.title=title,$scope.message=message,$scope.done=function(){return $modalInstance.close()}}])})}.call(this),function(){define("ide/tpr-webmodule/controllers/ReferencesController",["base"],function(App){return App.controller("ReferencesController",function($scope,$modal,ide,$http){var features,user;return user=ide.$scope.user,features=null!=user?user.features:void 0,$scope.thirdPartyReferencesEnabled=(null!=features?features.mendeley:void 0)||(null!=features?features.references:void 0),$scope.openNewDocModal=function(){return $modal.open({templateUrl:"newFileModalTemplate",controller:"NewFileModalController",size:"lg",resolve:{parent_folder:function(){return null},type:function(){return"mendeley"}}})}})})}.call(this),function(){define("ide/tpr-webmodule/controllers/MendeleyLinkedFileModalController",["base"],function(App){return App.controller("MendeleyLinkedFileModalController",["$scope","ide","$timeout","$window","$interval","event_tracking","sixpack",function($scope,ide,$timeout,$window,$interval,event_tracking,sixpack){var _handleError,_init,_reset,features,provider,ref,ref1,ref2,validate;return provider="mendeley",features=null!=(ref=ide.$scope.user)?ref.features:void 0,$scope.userHasProviderFeature=(null!=features?features.mendeley:void 0)||(null!=features?features.references:void 0),$scope.userHasProviderLink=null!=(ref1=ide.$scope.user)&&null!=(ref2=ref1.refProviders)?ref2[provider]:void 0,$scope.canLoadBibtex=function(){return $scope.userHasProviderFeature&&$scope.userHasProviderLink},$scope.state={fetchingGroups:!1,inflight:!1,error:!1,errorType:"default"},$scope.data={isInitialized:!1,groups:null,selectedGroupId:null},_handleError=function(err){return _reset(401===err.status?{error:"expired"}:403===err.status?{error:"forbidden"}:400===err.status?{error:"default"}:{error:!0})},_reset=function(opts){return null==opts&&(opts={}),$scope.state.fetchingGroups=!1,$scope.state.fetchingBibtexPreview=!1,$scope.state.inflight=!1,null!=opts.error?($scope.state.error=!0,opts.error===!0?$scope.state.errorType="default":$scope.state.errorType=opts.error):$scope.state.error=!1},$scope.hasGroups=function(){return null!=$scope.data.groups&&$scope.data.groups.length>0},$scope.fetchGroups=function(){return $scope.canLoadBibtex()?(_reset(),$scope.state.fetchingGroups=!0,ide.$http.get("/mendeley/groups",{disableAutoLoginRedirect:!0}).then(function(resp){var data;return data=resp.data,$scope.data.groups=data.groups,$scope.data.selectedGroup=null,$scope.data.isInitialized=!0,_reset()})["catch"](function(err){return console.warn(err),_handleError(err)})):void 0},validate=function(){var isInitialized,name,ref3;return ref3=$scope.data,name=ref3.name,isInitialized=ref3.isInitialized,null==name||0===name.length?$scope.state.valid=!1:null==isInitialized?$scope.state.valid=!1:$scope.state.valid=!0},$scope.$watch("data.name",validate),$scope.$on("create",function(){var payload;if($scope.data.isInitialized&&$scope.data.isInitialized&&$scope.data.name)return payload=$scope.hasGroups()&&$scope.data.selectedGroupId?{group_id:$scope.data.selectedGroupId}:{},event_tracking.send("references-mendeley","modal","import-bibtex"),$scope.state.inflight=!0,ide.fileTreeManager.createLinkedFile($scope.data.name,$scope.parent_folder,"mendeley",payload).then(function(){return $scope.$emit("references:should-reindex",{}),$scope.$emit("done"),_reset()})["catch"](function(err){return _handleError(err)})}),_init=function(){return $scope.canLoadBibtex()?($scope.state.fetchingGroups=!0,$timeout(function(){return $scope.fetchGroups()},500)):void 0},_init(),$scope.startFreeTrial=function(source){var go,plan,w;return plan="collaborator_free_trial_7_days","function"==typeof ga&&ga("send","event","subscription-funnel","upgraded-free-trial",source),w=window.open(),go=function(){return $scope.startedFreeTrial=!0,w.location="/user/subscription/new?planCode="+plan+"&ssp=true"},$scope.shouldABTestPlans?sixpack.participate("plans-1610",["default","heron","ibis"],function(chosenVariation,rawResponse){return("heron"===chosenVariation||"ibis"===chosenVariation)&&(plan="collaborator_"+chosenVariation),go()}):go()},$scope.linkAccount=function(){var authWindow,poller;return authWindow=$window.open("/"+provider+"/oauth","reference-auth","width=700,height=500"),event_tracking.send("references-"+provider,"modal","start-link-account"),poller=$interval(function(){var e,pathname,ref3;try{pathname=null!=authWindow&&null!=(ref3=authWindow.location)?ref3.pathname:void 0}catch(error){e=error,pathname=null}return"/user/settings"===pathname?(authWindow.close(),event_tracking.send("references-"+provider,"modal","end-link-account"),$scope.userHasProviderLink=!0,ide.$scope.user.refProviders[provider]=!0,$timeout($scope.fetchGroups(),500),$interval.cancel(poller)):void 0},1e3),!0},window._S=$scope}])})}.call(this),function(){define("ide/tpr-webmodule/index",["ide/tpr-webmodule/controllers/ReferencesController","ide/tpr-webmodule/controllers/MendeleyLinkedFileModalController"],function(){})}.call(this),function(){define("ide/templates/controllers/TemplatesController",["base","ide/permissions/PermissionsManager","moment"],function(App,PermissionsManager,moment){return App.controller("TemplatesController",function($scope,$modal,ide){return $scope.openPublishTemplateModal=function(){var modal,resetState;return resetState=function(){return $scope.problemTalkingToTemplateApi=!1},resetState(),modal=$modal.open({templateUrl:"publishProjectAsTemplateModalTemplate",controller:"PublishProjectAsTemplateModalController",scope:$scope}),modal.result.then(resetState,resetState)}}),App.controller("PublishProjectAsTemplateModalController",function($scope,$modalInstance,ide,$http){var problemTalkingToTemplateApi,refreshPublishedStatus,updateProjectDescription,user_id;return user_id=ide.$scope.user.id,$scope.templateDetails={exists:!1},$scope.state={publishInflight:!1,unpublishInflight:!1},problemTalkingToTemplateApi=function(){return $scope.problemTalkingToTemplateApi=!0},refreshPublishedStatus=function(){return $http.get("/project/"+ide.project_id+"/template").then(function(response){var data;return data=response.data,$scope.templateDetails=data,$scope.templateDetails.publishedDate=moment(data.publishedDate).format("Do MMM YYYY, h:mm a"),$scope.templateDetails.description=data.description})["catch"](function(){return problemTalkingToTemplateApi()})},refreshPublishedStatus(),$scope.$watch($scope.problemTalkingToTemplateApi,function(value){return null!=value?refreshPublishedStatus():void 0}),updateProjectDescription=function(){return $http.post("/project/"+ide.project_id+"/template/description",{description:$scope.templateDetails.description,_csrf:window.csrfToken})},$modalInstance.result["finally"](function(){return updateProjectDescription()}),$scope.publishTemplate=function(){return $scope.state.publishInflight=!0,updateProjectDescription().then(function(){return $http.post("/project/"+ide.project_id+"/template/publish",{_csrf:window.csrfToken}).then(function(){return refreshPublishedStatus(),$scope.state.publishInflight=!1})["catch"](function(){return problemTalkingToTemplateApi()})})["catch"](function(){return problemTalkingToTemplateApi()})},$scope.unpublishTemplate=function(){return $scope.state.unpublishInflight=!0,$http.post("/project/"+ide.project_id+"/template/unpublish",{_csrf:window.csrfToken}).then(function(){return refreshPublishedStatus(),$scope.state.unpublishInflight=!1})["catch"](function(){return problemTalkingToTemplateApi()})},$scope.cancel=function(){return $modalInstance.dismiss()}})})}.call(this),function(){define("ide/templates/index",["ide/templates/controllers/TemplatesController"],function(){})}.call(this),function(){define("ide/rich-text/rich_text_adapter",[],function(){var RichTextAdapter,getExtension,isPreviewable;return RichTextAdapter=function(){function RichTextAdapter(fileTreeManager){this.fileTreeManager=fileTreeManager}return RichTextAdapter.prototype.fileExistsForPath=function(path){var entity;return entity=this.fileTreeManager.findEntityByPath(path),!!entity},RichTextAdapter.prototype.getPreviewUrlForPath=function(path){var entity,extension,i,len,queryString,ref;for(ref=["",".png",".pdf",".jpg",".jpeg"],i=0,len=ref.length;len>i&&(extension=ref[i],!(entity=this.fileTreeManager.findEntityByPath(""+path+extension)));i++);return entity?(queryString=isPreviewable(entity)?"?format=png":"","/project/"+window.project_id+"/file/"+entity.id+queryString):null},RichTextAdapter}(),isPreviewable=function(entity){return["eps","pdf"].includes(getExtension(entity))},getExtension=function(entity){var ref,ref1;return null!=entity&&null!=(ref=entity.name)&&null!=(ref1=ref.split(".").pop())?ref1.toLowerCase():void 0},RichTextAdapter})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};define("ide/rich-text/directives/spell_check/spell_check_adapter",[],function(){var SpellCheckAdapter;return SpellCheckAdapter=function(){function SpellCheckAdapter(editor){this.editor=editor,this.replaceWord=bind(this.replaceWord,this),this.highlightedWordManager=this.editor.highlightedWordManager}return SpellCheckAdapter.prototype.getLines=function(){return this.editor.getCodeMirror().getValue().split("\n")},SpellCheckAdapter.prototype.normalizeChangeEvent=function(e){return{start:{row:e.from.line},end:{row:e.to.line},action:null!=e.removed?"remove":"insert"}},SpellCheckAdapter.prototype.getCoordsFromContextMenuEvent=function(e){return e.stopPropagation(),{x:e.pageX,y:e.pageY}},SpellCheckAdapter.prototype.isContextMenuEventOnBottomHalf=function(e){var clientY,editorBoundingRect,relativeYPos;return clientY=e.clientY,editorBoundingRect=e.currentTarget.getBoundingClientRect(),relativeYPos=(clientY-editorBoundingRect.top)/editorBoundingRect.height,relativeYPos>.5},SpellCheckAdapter.prototype.preventContextMenuEventDefault=function(e){return e.preventDefault()},SpellCheckAdapter.prototype.getHighlightFromCoords=function(coords){var position;return position=this.editor.getCodeMirror().coordsChar({left:coords.x,top:coords.y}),this.highlightedWordManager.findHighlightAtPosition(position)},SpellCheckAdapter.prototype.selectHighlightedWord=function(highlight){var position;return position=highlight.marker.find(),this.editor.getCodeMirror().setSelection(position.from,position.to)},SpellCheckAdapter.prototype.replaceWord=function(highlight,newWord){var codeMirror;return codeMirror=this.editor.getCodeMirror(),codeMirror.replaceSelection(newWord),codeMirror.focus()},SpellCheckAdapter}()})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};define("ide/rich-text/autocomplete_adapter",["ide/editor/directives/aceEditor/auto-complete/snippets/TopHundredSnippets","ide/editor/directives/aceEditor/auto-complete/snippets/Environments"],function(TopHundredCommands,Environments){var AutocompleteAdapter;return AutocompleteAdapter=function(){function AutocompleteAdapter($scope,metadata,bibtexReferences){this.$scope=$scope,this.metadata=metadata,this.bibtexReferences=bibtexReferences,this.onChange=bind(this.onChange,this),this.debouncer={}}return AutocompleteAdapter.prototype.getCommandCompletions=function(handleCompletionPicked){return[].concat(TopHundredCommands,this.getCommandCompletionsFromMetadata()).map(function(snippet){return{text:snippet.caption,displayText:snippet.caption,hint:handleCompletionPicked}})},AutocompleteAdapter.prototype.getCommandCompletionsFromMetadata=function(){return _.flatten(this.metadata.getAllPackages())},AutocompleteAdapter.prototype.getBeginCommandArguments=function(){return Environments.all},AutocompleteAdapter.prototype.getBibtexArguments=function(){return this.bibtexReferences},AutocompleteAdapter.prototype.getReferenceArguments=function(){return this.metadata.getAllLabels()},AutocompleteAdapter.prototype.onChange=function(cm){var line,lineText;return line=cm.getCursor().line,lineText=cm.getLine(line),lineText.length>1e4?void 0:/\\(usepackage|RequirePackage|label)(\[.*])?({.*})?/.test(lineText)?this.metadata.scheduleLoadDocMetaFromServer(this.$scope.docId):void 0},AutocompleteAdapter}()})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};define("ide/rich-text/directives/cursor_position/cursor_position_adapter",[],function(){var CursorPositionAdapter,VIEWPORT_MARGIN;return VIEWPORT_MARGIN=10,CursorPositionAdapter=function(){function CursorPositionAdapter(editor){this.editor=editor,this.getCursor=bind(this.getCursor,this)}return CursorPositionAdapter.prototype.convertToAcePos=function(arg){var ch,line;return line=arg.line,ch=arg.ch,{row:line,column:ch}},CursorPositionAdapter.prototype.convertFromAcePos=function(arg){var column,row;return row=arg.row,column=arg.column,{line:row,ch:column}},CursorPositionAdapter.prototype.getCursor=function(){return this.convertToAcePos(this.editor.getCodeMirror().getCursor())},CursorPositionAdapter.prototype.getEditorScrollPosition=function(){var viewport;return viewport=this.editor.getCodeMirror().getViewport(),viewport.from+VIEWPORT_MARGIN},CursorPositionAdapter.prototype.setCursor=function(pos){return pos=pos.cursorPosition||{row:0,column:0},this.editor.getCodeMirror().setCursor(this.convertFromAcePos(pos))},CursorPositionAdapter.prototype.setEditorScrollPosition=function(pos){var codeMirror,height;return pos=pos.firstVisibleLine||0,codeMirror=this.editor.getCodeMirror(),height=codeMirror.heightAtLine(pos,"local"),codeMirror.scrollTo(null,height)},CursorPositionAdapter.prototype.clearSelection=function(){},CursorPositionAdapter.prototype.gotoLine=function(line,ch){var codeMirror;return codeMirror=this.editor.getCodeMirror(),codeMirror.setCursor({line:line,ch:ch}),codeMirror.focus()},CursorPositionAdapter.prototype.gotoOffset=function(){},CursorPositionAdapter}()})}.call(this),function(){define("ide/rich-text/directives/cm_editor",["base","ide/rich-text/rich_text_adapter","ide/editor/directives/aceEditor/spell-check/SpellCheckManager","ide/rich-text/directives/spell_check/spell_check_adapter","ide/rich-text/autocomplete_adapter","ide/editor/directives/aceEditor/cursor-position/CursorPositionManager","ide/rich-text/directives/cursor_position/cursor_position_adapter"],function(App,RichTextAdapter,SpellCheckManager,SpellCheckAdapter,AutocompleteAdapter,CursorPositionManager,CursorPositionAdapter){return App.directive("cmEditor",function(ide,metadata,localStorage,$cacheFactory,$http,$q){return{scope:{bundle:"=",formattingEvents:"=",initCodeMirror:"=",sharejsDoc:"=",readOnly:"=",spellCheck:"=",spellCheckLanguage:"=",autoComplete:"=",autoCloseBrackets:"=",fontSize:"=",lineHeight:"=",docId:"=",onSave:"="},link:function(scope,element,attrs){var attachToCM,autocompleteAdapter,bodyEl,cursorPositionManager,detachFromCM,editor,event,getSetting,handleChangeForSpellCheck,i,init,initCursorPosition,initSpellCheck,keyBindingsAdapter,len,ref,setUpFormattingEventListeners,setUpMetadataEventListener,switchAttachment,tearDownCursorPosition,tearDownFormattingEventListeners,tearDownMetadataEventListener,tearDownSpellCheck,triggerEditorInitEvent,triggerSyncToPdf;if(bodyEl=element.find(".cm-editor-body"),editor=null,cursorPositionManager=null,autocompleteAdapter=new AutocompleteAdapter(scope,metadata,scope.$root._references),keyBindingsAdapter={triggerRecompile:scope.onSave,triggerSyncToPdf:triggerSyncToPdf},scope.name="editor",init=function(){return editor=new scope.bundle.Editor(bodyEl[0],new RichTextAdapter(ide.fileTreeManager),autocompleteAdapter,keyBindingsAdapter,getSetting),initCursorPosition(),switchAttachment(scope.sharejsDoc),setUpFormattingEventListeners()},switchAttachment=function(sharejsDoc,oldSharejsDoc){return sharejsDoc!==oldSharejsDoc?(null!=oldSharejsDoc&&(scope.$broadcast("beforeChangeDocument"),detachFromCM(oldSharejsDoc)),null!=sharejsDoc&&attachToCM(sharejsDoc),null!=sharejsDoc&&null!=oldSharejsDoc?scope.$broadcast("afterChangeDocument"):void 0):void 0},scope.$watch("sharejsDoc",switchAttachment),scope.$watch("readOnly",function(value){return null!=value?editor.setReadOnly(value):void 0}),setUpFormattingEventListeners=function(){return scope.formattingEvents.on("section",function(){return editor.wrapSection()}),scope.formattingEvents.on("subsection",function(){return editor.wrapSubsection()}),scope.formattingEvents.on("bold",function(){return editor.wrapBold()}),scope.formattingEvents.on("italic",function(){return editor.wrapItalic()}),scope.formattingEvents.on("inlineMath",function(){return editor.wrapInlineMath()}),scope.formattingEvents.on("displayMath",function(){return editor.wrapDisplayMath()}),scope.formattingEvents.on("numberedList",function(){return editor.wrapNumberedList()}),scope.formattingEvents.on("bulletList",function(){return editor.wrapBulletList()})},tearDownFormattingEventListeners=function(){return scope.formattingEvents.off("section"),scope.formattingEvents.off("subsection"),scope.formattingEvents.off("bold"),scope.formattingEvents.off("italic"),scope.formattingEvents.off("inlineMath"),scope.formattingEvents.off("displayMath"),scope.formattingEvents.off("numberedList"),scope.formattingEvents.off("bulletList")},triggerEditorInitEvent=_.once(function(){return scope.$broadcast("editorInit")}),attachToCM=function(sharejsDoc){return scope.$applyAsync(function(){return editor.openDoc(sharejsDoc.getSnapshot()),sharejsDoc.attachToCM(editor.getCodeMirror()),editor.enable(),sharejsDoc.on("remoteop.richtext",function(){return editor.update()}),editor.getCodeMirror().clearHistory(),triggerEditorInitEvent(),initSpellCheck(),setUpMetadataEventListener()})},detachFromCM=function(sharejsDoc){return tearDownSpellCheck(),tearDownMetadataEventListener(),sharejsDoc.detachFromCM(),sharejsDoc.off("remoteop.richtext")},handleChangeForSpellCheck=function(_,event){return this.spellCheckManager.onChange(event)},initSpellCheck=function(){var codeMirror,spellCheckCache;return spellCheckCache=$cacheFactory.get("spellCheck-"+scope.name)||$cacheFactory("spellCheck-"+scope.name,{capacity:1e3}),this.spellCheckManager=new SpellCheckManager(scope,spellCheckCache,$http,$q,new SpellCheckAdapter(editor)),this.spellCheckManager.init(),codeMirror=editor.getCodeMirror(),codeMirror.on("change",handleChangeForSpellCheck),$(codeMirror.getWrapperElement()).on("contextmenu",this.spellCheckManager.onContextMenu),codeMirror.on("scroll",this.spellCheckManager.onScroll)},tearDownSpellCheck=function(){var codeMirror;return codeMirror=editor.getCodeMirror(),codeMirror.off("change",handleChangeForSpellCheck),$(codeMirror.getWrapperElement()).off("contextmenu",this.spellCheckManager.onContextMenu),codeMirror.off("scroll",this.spellCheckManager.onScroll)},initCursorPosition=function(){return cursorPositionManager=new CursorPositionManager(scope,new CursorPositionAdapter(editor),localStorage),editor.getCodeMirror().on("cursorActivity",cursorPositionManager.onCursorChange),$(window).on("unload",cursorPositionManager.onUnload)},tearDownCursorPosition=function(){return editor.getCodeMirror().off("cursorActivity",cursorPositionManager.onCursorChange),$(window).off("unload",cursorPositionManager.onUnload)},triggerSyncToPdf=function(){return cursorPositionManager.onSyncToPdf()},setUpMetadataEventListener=function(){return editor.getCodeMirror().on("change",autocompleteAdapter.onChange)},tearDownMetadataEventListener=function(){return editor.getCodeMirror().off("change",autocompleteAdapter.onChange)},getSetting=function(key){return scope[key]},scope.$on("$destroy",function(){return scope.$broadcast("changeEditor"),tearDownSpellCheck(),tearDownCursorPosition(),tearDownFormattingEventListeners(),tearDownMetadataEventListener(),detachFromCM(scope.sharejsDoc),editor.disable()}),init(),null!=attrs.resizeOn)for(ref=attrs.resizeOn.split(","),i=0,len=ref.length;len>i;i++)event=ref[i],scope.$on(event,function(){var ref1;return null!=editor&&null!=(ref1=editor.getCodeMirror())?ref1.refresh():void 0});return scope.$watch("fontSize",function(value){var ref1;return bodyEl.css({"font-size":value+"px"}),null!=editor&&null!=(ref1=editor.getCodeMirror())?ref1.refresh():void 0}),scope.$watch("lineHeight",function(value){var lineHeight,ref1;if(value){switch(value){case"compact":lineHeight=1.33;break;case"normal":lineHeight=1.6;break;case"wide":lineHeight=2;break;default:lineHeight=1.6}return bodyEl.css({"line-height":lineHeight}),null!=editor&&null!=(ref1=editor.getCodeMirror())?ref1.refresh():void 0}})},template:'<div class="cm-editor-wrapper rich-text">\n  <div class="cm-editor-body"></div>\n  <spell-menu\n    open="spellMenu.open"\n    top="spellMenu.top"\n    left="spellMenu.left"\n    layout-from-bottom="spellMenu.layoutFromBottom"\n    highlight="spellMenu.highlight"\n    replace-word="replaceWord(highlight, suggestion)"\n    learn-word="learnWord(highlight)"\n  ></spell-menu>\n</div>'}})})}.call(this),function(){define("ide/rich-text/directives/formatting_buttons",["base"],function(App){var BUTTON_WIDTH,OVERFLOWED_BUTTON_WIDTH;return BUTTON_WIDTH=33,OVERFLOWED_BUTTON_WIDTH=70,App.directive("formattingButtons",function(){return{scope:{buttons:"=",opening:"=",isFullscreenEditor:"="},link:function(scope,element,attrs){var debouncedMeasure,measure,setUpWindowResizeListeners,split,tearDownResizeListeners,unbindOpeningWatcher;return scope.showMore=!1,scope.shownButtons=[],scope.overflowedButtons=[],unbindOpeningWatcher=scope.$watch("opening",function(isOpening){return isOpening?void 0:(measure(),setUpWindowResizeListeners(),unbindOpeningWatcher())}),measure=function(){var availableSpace,noOfShowableButtons;return availableSpace=element.width(),noOfShowableButtons=Math.floor(availableSpace/BUTTON_WIDTH),noOfShowableButtons<scope.buttons.length?(scope.showMore=!0,availableSpace-=OVERFLOWED_BUTTON_WIDTH,
noOfShowableButtons=Math.floor(availableSpace/BUTTON_WIDTH),split(noOfShowableButtons)):(scope.showMore=!1,split(noOfShowableButtons))},split=function(splitIndex){return scope.$applyAsync(function(){return scope.shownButtons=scope.buttons.slice(0,splitIndex),scope.overflowedButtons=scope.buttons.slice(splitIndex)})},debouncedMeasure=_.debounce(measure,300),setUpWindowResizeListeners=function(){var event,i,len,ref,results;if($(window).on("resize",debouncedMeasure),null!=attrs.resizeOn){for(ref=attrs.resizeOn.split(","),results=[],i=0,len=ref.length;len>i;i++)event=ref[i],results.push(scope.$on(event,debouncedMeasure));return results}},tearDownResizeListeners=function(){return $(window).off("resize",debouncedMeasure)},scope.$watch("$destroy",function(){return tearDownResizeListeners()}),scope.$watch("isFullscreenEditor",function(oldVal,newVal){return oldVal!==newVal?debouncedMeasure():void 0})},templateUrl:"formattingButtonsTpl"}})})}.call(this),function(){define("ide/rich-text/controllers/editor_loader_controller",["base","utils/EventEmitter"],function(App,EventEmitter){return App.controller("EditorLoaderController",function($scope,localStorage){return $scope.richText={bundle:null,formattingEvents:new EventEmitter},$scope.$watch("editor.showRichText",function(val){return localStorage("editor.mode."+$scope.project_id,val===!0?"rich-text":"source"),val&&!$scope.richText.bundle?requirejs(["rich-text"],function(bundle){return $scope.$applyAsync(function(){return $scope.richText.bundle=bundle})}):void 0})})})}.call(this),function(){define("ide/rich-text/controllers/editor_toolbar_controller",["base"],function(App){return App.controller("EditorToolbarController",function($scope,ide){return $scope.buttons=[{iconText:"§",iconClass:"formatting-icon",title:"Insert Section Heading",handleClick:function(){return $scope.richText.formattingEvents.trigger("section")}},{iconText:"§",iconClass:"formatting-icon formatting-icon--small",title:"Insert Subsection Heading",handleClick:function(){return $scope.richText.formattingEvents.trigger("subsection")}},{iconClass:"formatting-icon fa fa-bold",title:"Format Bold",handleClick:function(){return $scope.richText.formattingEvents.trigger("bold")}},{iconClass:"formatting-icon fa fa-italic",title:"Format Italic",handleClick:function(){return $scope.richText.formattingEvents.trigger("italic")}},{iconText:"π",iconClass:"formatting-icon formatting-icon--serif",title:"Insert Inline Math",handleClick:function(){return $scope.richText.formattingEvents.trigger("inlineMath")}},{iconText:"Σ",iconClass:"formatting-icon formatting-icon--serif",title:"Insert Math on its own line",handleClick:function(){return $scope.richText.formattingEvents.trigger("displayMath")}},{iconClass:"formatting-icon fa fa-list-ol",title:"Insert Numbered List",handleClick:function(){return $scope.richText.formattingEvents.trigger("numberedList")}},{iconClass:"formatting-icon fa fa-list-ul",title:"Insert Bullet Point List",handleClick:function(){return $scope.richText.formattingEvents.trigger("bulletList")}}]})})}.call(this),function(){define("ide/rich-text/index",["ide/rich-text/directives/cm_editor","ide/rich-text/directives/formatting_buttons","ide/rich-text/controllers/editor_loader_controller","ide/rich-text/controllers/editor_toolbar_controller"],function(){})}.call(this),function(){define("ide/references-search/controllers/ReferencesSearchController",["base","ace/ace"],function(App){var Range,getLastCommandFragment;return Range=ace.require("ace/range").Range,getLastCommandFragment=function(lineUpToCursor){var m;return(m=lineUpToCursor.match(/(\\[^\\]+)$/))?m[1]:null},App.controller("ReferencesSearchController",function($scope,$modal,ide,$timeout,sixpack,event_tracking,$rootScope){var _abTestStartDate,_userSignUpDate,editor;return $scope.searchFeatureEnabled=function(){return!0},$scope.searchFeatureEnabled()?($scope.searchEnabled=!1,_abTestStartDate=new Date(Date.UTC(2016,6,22)),_userSignUpDate=new Date(window.user.signUpDate),$scope.shouldABTestBibSearch=_userSignUpDate>_abTestStartDate,$scope.isCursorAtCitation=function(editor){var citeMatch,commandFragment,lineUpToCursor,pos,range;return pos=editor.getCursorPosition(),range=new Range(pos.row,0,pos.row,pos.column),lineUpToCursor=editor.getSession().getTextRange(range),commandFragment=getLastCommandFragment(lineUpToCursor),commandFragment&&(citeMatch=commandFragment.match(/^~?\\([a-z]*cite[a-z]*(?:\[.*])?){([^}]*, *)?(\w*)/))?!0:!1},$scope._hintNode=null,$scope._buildHintNode=function(){var hintNode;return event_tracking.sendMBOnce("bib-search-hint-shown-once"),(hintNode=$(".sl_references_search_hint")[0])?(hintNode.style.display="block",hintNode.style.visibility="visible",hintNode):void console.log("Error: could not find .sl_references_search_hint node in dom")},$scope.updateHintNode=function(editor){var container,newNode,oldHide,popup,ref,ref1,ref2,ref3,ref4;if((null!=editor&&null!=(ref=editor.completer)&&null!=(ref1=ref.popup)?ref1.isOpen:void 0)===!0&&!$scope._hintNode&&$scope.isCursorAtCitation(editor)){if(newNode=$scope._buildHintNode(),container=null!=editor&&null!=(ref2=editor.completer)&&null!=(ref3=ref2.popup)&&null!=(ref4=ref3.renderer)?ref4.container:void 0,!container)return void console.log("Error attaching search hint: could not find popup container");container.style.overflow="visible",$(container).append(newNode),$scope._hintNode=newNode,popup=editor.completer.popup,popup.hide._sl_patched||(oldHide=popup.hide.bind(popup),popup.hide=function(){return $timeout(function(){return $scope.isCursorAtCitation(editor)?void 0:$scope._hideHint()},0),oldHide()},popup.hide._sl_patched=!0)}return $scope._hintNode?$scope.isCursorAtCitation(editor)?$scope._showHint():$scope._hideHint():void 0},$scope._showHint=function(){return $scope._hintNode?$scope._hintNode.style.visibility="visible":void 0},$scope._hideHint=function(){return $scope._hintNode?$scope._hintNode.style.visibility="hidden":void 0},$scope._inited=!1,$scope._sixpackParticipating=!1,$scope.setup=function(){var handleControlSpace,oldExec,ref,ref1,startAutocomplete;if($scope.settings.autoComplete!==!1&&!$scope._inited)return"undefined"==typeof editor||null===editor?void console.log("no editor found"):(startAutocomplete="undefined"!=typeof editor&&null!==editor&&null!=(ref=editor.commands)&&null!=(ref1=ref.commands)?ref1.startAutocomplete:void 0,startAutocomplete?startAutocomplete._sl_patched?void 0:(oldExec=startAutocomplete.exec,startAutocomplete.exec=function(ed,a,b,c,d){return $timeout(function(){return $scope.updateHintNode(ed)},0),oldExec(ed)},startAutocomplete._sl_patched=!0,handleControlSpace=function(ed){var isAtCitation,ref2,ref3,ref4,ref5,ref6;return $timeout(function(){return $scope.updateHintNode(ed)},0),isAtCitation=$scope.isCursorAtCitation(ed),(null!=ed&&null!=(ref2=ed.completer)&&null!=(ref3=ref2.popup)?ref3.isOpen:void 0)===!0&&isAtCitation===!0?(event_tracking.sendMB("bib-search-modal-opened"),$scope.shouldABTestBibSearch&&sixpack.convert("bib-search-highlight"),$scope.searchEnabled=(null!=ide&&null!=(ref4=ide.$scope)&&null!=(ref5=ref4.project)&&null!=(ref6=ref5.features)?ref6.referencesSearch:void 0)===!0,$scope.openReferencesSearchModal()):startAutocomplete.exec(ed)},$scope.handleOpenSearch=function(){return handleControlSpace(editor)},ide.browserIsSafari?document.querySelector("#editor").onkeyup=function(e){return e.ctrlKey&&32===e.keyCode?handleControlSpace(editor):void 0}:editor.commands.addCommand({name:"triggerReferencesSearchPopup",exec:handleControlSpace,bindKey:startAutocomplete.bindKey}),$scope._inited=!0):void console.log("could not find startAutocomplete command"))},editor=null,$rootScope.$on("editor:inited",function(event,_editor){return editor=_editor,setTimeout($scope.setup)}),$scope.insertKeyAtCursor=function(key){var lastSeparatorPosition,lineBeyondCursor,lineUpToCursor,needsClosingBrace,pos,session;return null==editor?void console.log("no editor found"):(pos=editor.getCursorPosition(),session=editor.getSession(),lineUpToCursor=editor.getSession().getTextRange(new Range(pos.row,0,pos.row,pos.column)),lineBeyondCursor=editor.getSession().getTextRange(new Range(pos.row,pos.column,pos.row,99999)),needsClosingBrace=!lineBeyondCursor.match(/^[^{]*}/),lastSeparatorPosition=Math.max(lineUpToCursor.lastIndexOf("{"),lineUpToCursor.lastIndexOf(","),lineUpToCursor.lastIndexOf(" ")),lastSeparatorPosition<pos.column-1?(session.remove(new Range(pos.row,lastSeparatorPosition+1,pos.row,pos.column)),pos=editor.getCursorPosition(),session.insert(pos,key)):session.insert(pos,key),needsClosingBrace?session.insert(editor.getCursorPosition(),"}"):void 0)},$scope.openReferencesSearchModal=function(){var modal;return modal=$modal.open({templateUrl:"referencesSearchModalTemplate",controller:"ReferencesSearchModalController",scope:$scope,size:"lg",animation:!1,backdrop:!0,backdropClass:"references-search-modal-backdrop",keyboard:!0}),modal.result.then(function(keyString){return $scope.insertKeyAtCursor(keyString)})},ide.referencesSearchManager={openReferencesModal:function(providerStr){return $scope.openReferencesSearchModal(providerStr)}}):void 0})})}.call(this),function(){define("ide/references-search/controllers/ReferencesSearchModalController",["base"],function(App){return App.controller("ReferencesSearchModalController",function($scope,$modalInstance,$window,$timeout,ide,event_tracking){return $scope.searchFeatureEnabled()?($scope.state={queryText:"",searchResults:null,selectedIndex:null,currentlySearching:!1,error:!1},$scope.handleInputKeyDown=function(e){var ref,ref1;return 40===e.keyCode?(e.preventDefault(),void $scope.moveSelectionForward()):38===e.keyCode?(e.preventDefault(),void $scope.moveSelectionBackward()):9===e.keyCode?(e.preventDefault(),void(e.shiftKey?$scope.moveSelectionBackward():$scope.moveSelectionForward())):13===e.keyCode?(e.preventDefault(),void $scope.acceptSelectedSearchResult()):37===(ref=e.keyCode)||39===ref?void($scope.state.selectedIndex=null):8===(ref1=e.keyCode)?($scope.state.selectedIndex=null,void $timeout($scope.doAutoSearch,0)):void(16===e.keyCode||e.altKey||e.ctrlKey||e.metaKey||$timeout($scope.doAutoSearch,0))},$scope.doAutoSearch=function(){var state;return state=$scope.state,state.queryText&&state.queryText.length>=3?$scope.doSearch():void 0},$scope.moveSelectionForward=function(){var lastIndex;if(null===$scope.state.selectedIndex){if($scope.state.searchResults&&$scope.state.searchResults.length>0)return $scope.state.selectedIndex=0}else if($scope.state.searchResults&&$scope.state.searchResults.length>0&&($scope.state.selectedIndex++,lastIndex=$scope.state.searchResults.length-1,$scope.state.selectedIndex>lastIndex))return $scope.state.selectedIndex=lastIndex},$scope.moveSelectionBackward=function(){if(null===$scope.state.selectedIndex);else if($scope.state.searchResults&&$scope.state.searchResults.length>0&&($scope.state.selectedIndex--,$scope.state.selectedIndex<0))return $scope.state.selectedIndex=null},$scope.doSearch=function(){var opts;if(""!==$scope.state.queryText)return opts={query:$scope.state.queryText,_csrf:window.csrfToken},$scope.state.currentlySearching=!0,ide.$http.post("/project/"+$scope.project_id+"/references/search",{query:$scope.state.queryText,_csrf:window.csrfToken}).then(function(successResponse){return $scope.state.searchResults=successResponse.data.hits,$scope.state.selectedIndex=null,$scope.state.currentlySearching=!1,$scope.state.error=!1},function(errorResponse){return console.error(">> error searching references",errorResponse),$scope.state.selectedIndex=null,$scope.state.currentlySearching=!1,$scope.state.error=!0}),$timeout(function(){return $scope.state.currentlySearching=!1},3e4)},$scope.selectIndex=function(index){return $scope.state.searchResults?$scope.state.selectedIndex=index:void 0},$scope.acceptSelectedSearchResult=function(){var result;return $scope.state.searchResults&&null!==$scope.state.selectedIndex?(event_tracking.sendMB("bib-search-result-inserted"),result=$scope.state.searchResults[$scope.state.selectedIndex],$modalInstance.close(result._source.EntryKey)):void 0},$scope.cancel=function(){return $modalInstance.dismiss("cancel")}):void 0})})}.call(this),function(){define("ide/references-search/index",["ide/references-search/controllers/ReferencesSearchController","ide/references-search/controllers/ReferencesSearchModalController"],function(){})}.call(this),function(){define("ide/publish-modal/controllers/PublishController",["base"],function(App){return App.controller("PublishController",function($scope,$modal){return $scope.openPublishProjectModal=function(){return $modal.open({templateUrl:"publishProjectModalTemplate",scope:$scope,size:"lg"}),requirejs(["publish-modal"],function(pm){var downloadLink,initParams,modalBody;return $scope.pdf.url&&(downloadLink=$scope.pdf.downloadUrl),initParams={projectId:$scope.project_id,pdfUrl:downloadLink,logs:$scope.pdf.logEntries,hasFolders:window._ide.fileTreeManager.projectContainsFolder(),firstName:$scope.user.first_name,lastName:$scope.user.last_name,title:$scope.project.name},modalBody=document.getElementsByClassName("modal-body-publish")[0],pm.init(modalBody,initParams)})}})})}.call(this),function(){define("ide/publish-modal/index",["ide/publish-modal/controllers/PublishController"],function(){})}.call(this),function(){define("ide/github-sync/controllers/GithubSyncController",["base"],function(App){return App.controller("GithubSyncController",function($scope,$modal,ide){return $scope.openGithubSyncModal=function(){return $modal.open({templateUrl:"githubSyncModalTemplate",controller:"GithubSyncModalController",scope:$scope})},ide.githubSyncManager={openGithubSyncModal:function(){return $scope.openGithubSyncModal()}}})})}.call(this),function(){define("ide/github-sync/controllers/GithubSyncModalController",["base"],function(App){return App.controller("GithubSyncModalController",function($scope,$modalInstance,$http,$modal,$window,$interval,ide){return $scope.cancel=function(){return $modalInstance.dismiss()},$scope.openExportToGithubModal=function(){return $modalInstance.dismiss(),$modal.open({templateUrl:"githubSyncExportModalTemplate",controller:"GithubSyncExportModalController"})},$scope.openMergeModal=function(mergeImmediately){var template;return null==mergeImmediately&&(mergeImmediately=!1),$modalInstance.dismiss(),template=mergeImmediately?"githubSyncPullFromGithubModalTemplate":"githubSyncPushToGithubModalTemplate",$modal.open({templateUrl:template,controller:"GithubSyncMergeModalController",resolve:{mergeImmediately:function(){return mergeImmediately}}})},$scope.startFreeTrial=function(source){return"function"==typeof ga&&ga("send","event","subscription-funnel","upgraded-free-trial",source),window.open("/user/subscription/new?planCode=student_free_trial_7_days"),$scope.startedFreeTrial=!0},$scope.linkAccount=function(){var authWindow,poller;return authWindow=$window.open("/github-sync/beginAuth","github-sync-auth","width=700,height=500"),poller=$interval(function(){var e,pathname,ref,ref1;try{pathname=null!=authWindow&&null!=(ref=authWindow.location)?ref.pathname:void 0}catch(error){e=error,pathname=null}return"/github-sync/linked"===(null!=authWindow&&null!=(ref1=authWindow.location)?ref1.pathname:void 0)?(authWindow.close(),$scope.loadStatus(),$interval.cancel(poller)):void 0},1e3),!0},($scope.loadStatus=function(){return $scope.status={loading:!0,error:!1,user:{enabled:null},project:{enabled:null},commits:{loading:!0,commits:[]}},$http.get("/user/github-sync/status",{disableAutoLoginRedirect:!0}).then(function(response){var data,userStatus;return data=response.data,userStatus=data,$scope.status.user=userStatus,$http.get("/project/"+ide.project_id+"/github-sync/status",{disableAutoLoginRedirect:!0}).then(function(response){var projectStatus;return projectStatus=response.data,$scope.status.project=projectStatus,$scope.status.loading=!1,$scope.status.project.enabled?$http.get("/project/"+ide.project_id+"/github-sync/commits/unmerged",{disableAutoLoginRedirect:!0}).then(function(response){var commits;return commits=response.data,$scope.status.commits.commits=commits,$scope.status.commits.loading=!1})["catch"](function(response){var status;return data=response.data,status=response.status,null!=status?$scope.status.error={status:status}:$scope.status.error=!0}):void 0})["catch"](function(response){var status;return data=response.data,status=response.status,null!=status?$scope.status.error={status:status}:$scope.status.error=!0})})["catch"](function(response){var data,status;return data=response.data,status=response.status,null!=status?$scope.status.error={status:status}:$scope.status.error=!0})})()})})}.call(this),function(){define("ide/github-sync/controllers/GithubSyncExportModalController",["base"],function(App){return App.controller("GithubSyncExportModalController",function($scope,$modalInstance,$http,ide){return $scope.cancel=function(){return $modalInstance.dismiss()},$scope.status={loading:!0,error:!1},$scope.form={org:null,name:ide.$scope.project.name,"private":"false",description:""},$http.get("/user/github-sync/orgs",{disableAutoLoginRedirect:!0}).then(function(response){var data;return data=response.data,$scope.status.user=data.user,$scope.status.orgs=data.orgs,$scope.status.loading=!1,$scope.form.org=$scope.status.user.login})["catch"](function(response){var data,status;return data=response.data,status=response.status,$scope.status.error={message:null!=data?data.error:void 0,statusCode:status}}),$scope.create=function(){var data;return $scope.status.inflight=!0,data={_csrf:window.csrfToken,name:$scope.form.name,description:$scope.form.description,"private":"true"===$scope.form["private"]},null!=$scope.form.org&&$scope.form.org!==$scope.status.user.login&&(data.org=$scope.form.org),$http.post("/project/"+ide.project_id+"/github-sync/export",data).then(function(){return $scope.status.inflight=!1,$modalInstance.dismiss(),ide.githubSyncManager.openGithubSyncModal()})["catch"](function(response){return data=response.data,$scope.form.error=data.error,$scope.status.inflight=!1})}})})}.call(this),function(){define("ide/github-sync/controllers/GithubSyncMergeModalController",["base"],function(App){return App.controller("GithubSyncMergeModalController",function($scope,$modalInstance,$http,ide,mergeImmediately){return $scope.cancel=function(){return $modalInstance.dismiss()},$scope.status={},$scope.form={message:""},$scope.merge=function(){var data;return ide.editorManager.startIgnoringExternalUpdates(),$scope.status.inflight=!0,data={_csrf:window.csrfToken,message:$scope.form.message},$http.post("/project/"+ide.project_id+"/github-sync/merge",data).then(function(){return $scope.status.inflight=!1,$modalInstance.dismiss(),ide.githubSyncManager.openGithubSyncModal(),ide.editorManager.stopIgnoringExternalUpdates()})["catch"](function(response){return data=response.data,$scope.form.error=data.error,$scope.status.inflight=!1,ide.editorManager.stopIgnoringExternalUpdates()})},mergeImmediately?$scope.merge():void 0})})}.call(this),function(){define("ide/github-sync/index",["ide/github-sync/controllers/GithubSyncController","ide/github-sync/controllers/GithubSyncModalController","ide/github-sync/controllers/GithubSyncExportModalController","ide/github-sync/controllers/GithubSyncMergeModalController"],function(){})}.call(this),function(){define("ide/dropbox/controllers/DropboxController",["base","ide/permissions/PermissionsManager"],function(App,PermissionsManager){var ONE_MIN_MILI,POLLING_INTERVAL,cachedState;return POLLING_INTERVAL=15,ONE_MIN_MILI=6e4,cachedState={gotLinkStatus:!1,startedLinkProcess:!1,userIsLinkedToDropbox:!1,hasDropboxFeature:!1},App.controller("DropboxController",function($scope,$modal,ide){return $scope.openDropboxModal=function(){return $modal.open({templateUrl:"dropboxModalTemplate",controller:"DropboxModalController",scope:$scope})}}),App.controller("DropboxModalController",function($scope,$modalInstance,ide,$timeout,$http){var user_id;return user_id=ide.$scope.user.id,$scope.dbState=cachedState,$scope.dbState.hasDropboxFeature=$scope.project.features.dropbox,$http.get("/dropbox/status").then(function(response){var dropboxStatus;return dropboxStatus=response.data,$scope.dbState.gotLinkStatus=!0,dropboxStatus.registered?($scope.dbState.userIsLinkedToDropbox=!0,cachedState=$scope.dbState):void 0}),$scope.linkToDropbox=function(){return window.open("/user/settings#dropboxSettings"),$scope.startedLinkProcess=!0},$scope.cancel=function(){return $modalInstance.dismiss()}})})}.call(this),function(){define("ide/dropbox/index",["ide/dropbox/controllers/DropboxController"],function(){})}.call(this),function(){define("analytics/AbTestingManager",["base","libs/md5"],function(App){var oldKeys;return oldKeys=["sl_abt_multi_currency_editor_eu-eu","sl_abt_multi_currency_eu-eu","sl_abt_multi_currency_editor_eu-usd","sl_abt_multi_currency_eu-usd","sl_abt_trial_len_14d","sl_abt_trial_len_7d","sl_abt_trial_len_30d","sl_utt","sl_utt_trial_len","sl_utt_multi_currency"],App.factory("abTestManager",function($http,ipCookie){var _buildCookieKey,_checkIfStepIsNext,_getTestCookie,_getUsersHash,_persistCookieStep,getABTestBucket,processTestWithStep;return _.each(oldKeys,function(oldKey){return ipCookie.remove(oldKey)}),_buildCookieKey=function(testName,bucket){var key;return key="sl_abt_"+testName+"_"+bucket},_getTestCookie=function(testName,bucket){var cookie,cookieKey;return cookieKey=_buildCookieKey(testName,bucket),cookie=ipCookie(cookieKey)},_persistCookieStep=function(testName,bucket,newStep){var cookieKey;return cookieKey=_buildCookieKey(testName,bucket),ipCookie(cookieKey,{step:newStep},{expires:100,path:"/"}),ga("send","event","ab_tests",testName+":"+bucket,"step-"+newStep)},_checkIfStepIsNext=function(cookieStep,newStep){return null==cookieStep&&0!==newStep?!1:0===newStep?!0:cookieStep+1===newStep?!0:!1},_getUsersHash=function(testName){var hash,sl_user_test_token,user_uuid;return sl_user_test_token="sl_utt_"+testName,user_uuid=ipCookie(sl_user_test_token),null==user_uuid&&(user_uuid=Math.random(),ipCookie(sl_user_test_token,user_uuid,{expires:365,path:"/"})),hash=CryptoJS.MD5(user_uuid+":"+testName)},{processTestWithStep:processTestWithStep=function(testName,bucket,newStep){var currentCookieStep,ref;return currentCookieStep=null!=(ref=_getTestCookie(testName,bucket))?ref.step:void 0,_checkIfStepIsNext(currentCookieStep,newStep)?_persistCookieStep(testName,bucket,newStep):void 0},getABTestBucket:getABTestBucket=function(test_name,buckets){var bucketIndex,hash;return hash=_getUsersHash(test_name),bucketIndex=parseInt(hash.toString().slice(0,2),16)%((null!=buckets?buckets.length:void 0)||2),buckets[bucketIndex]}}}),App.controller("AbTestController",function($scope,abTestManager){var testKeys;return testKeys=_.keys(window.ab),_.each(window.ab,function(event){return abTestManager.processTestWithStep(event.testName,event.bucket,event.step)})})})}.call(this),function(){define("directives/focus",["base"],function(App){var selectName;return App.directive("focusWhen",function($timeout){return{restrict:"A",link:function(scope,element,attr){return scope.$watch(attr.focusWhen,function(value){return value?$timeout(function(){return element.focus()}):void 0})}}}),App.directive("focusOn",function($timeout){return{restrict:"A",link:function(scope,element,attrs){return scope.$on(attrs.focusOn,function(){return element.focus()})}}}),App.directive("selectWhen",function($timeout){return{restrict:"A",link:function(scope,element,attr){return scope.$watch(attr.selectWhen,function(value){return value?$timeout(function(){return element.select()}):void 0})}}}),App.directive("selectOn",function($timeout){return{restrict:"A",link:function(scope,element,attrs){return scope.$on(attrs.selectOn,function(){return element.select()})}}}),App.directive("selectNameWhen",function($timeout){return{restrict:"A",link:function(scope,element,attrs){return scope.$watch(attrs.selectNameWhen,function(value){return value?$timeout(function(){return selectName(element)}):void 0})}}}),App.directive("selectNameOn",function(){return{restrict:"A",link:function(scope,element,attrs){return scope.$on(attrs.selectNameOn,function(){return selectName(element)})}}}),App.directive("focus",function($timeout){return{scope:{trigger:"@focus"},link:function(scope,element){return scope.$watch("trigger",function(value){return"true"===value?$timeout(function(){return element[0].focus()}):void 0})}}}),selectName=function(element){var name,selectionEnd;return element.focus(),name=element.val(),null!=element[0].setSelectionRange?(selectionEnd=name.lastIndexOf("."),-1===selectionEnd&&(selectionEnd=name.length),element[0].setSelectionRange(0,selectionEnd)):void 0}})}.call(this),function(global){var qq=function(element){"use strict";return{hide:function(){return element.style.display="none",this},attach:function(type,fn){return element.addEventListener?element.addEventListener(type,fn,!1):element.attachEvent&&element.attachEvent("on"+type,fn),function(){qq(element).detach(type,fn)}},detach:function(type,fn){return element.removeEventListener?element.removeEventListener(type,fn,!1):element.attachEvent&&element.detachEvent("on"+type,fn),this},contains:function(descendant){return descendant?element===descendant?!0:element.contains?element.contains(descendant):!!(8&descendant.compareDocumentPosition(element)):!1},insertBefore:function(elementB){return elementB.parentNode.insertBefore(element,elementB),this},remove:function(){return element.parentNode.removeChild(element),this},css:function(styles){if(null==element.style)throw new qq.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return null!=styles.opacity&&"string"!=typeof element.style.opacity&&"undefined"!=typeof element.filters&&(styles.filter="alpha(opacity="+Math.round(100*styles.opacity)+")"),qq.extend(element.style,styles),this},hasClass:function(name,considerParent){var re=new RegExp("(^| )"+name+"( |$)");return re.test(element.className)||!(!considerParent||!re.test(element.parentNode.className))},addClass:function(name){return qq(element).hasClass(name)||(element.className+=" "+name),this},removeClass:function(name){var re=new RegExp("(^| )"+name+"( |$)");return element.className=element.className.replace(re," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(className,first){var candidates,result=[];return first&&element.querySelector?element.querySelector("."+className):element.querySelectorAll?element.querySelectorAll("."+className):(candidates=element.getElementsByTagName("*"),qq.each(candidates,function(idx,val){qq(val).hasClass(className)&&result.push(val)}),first?result[0]:result)},getFirstByClass:function(className){return qq(element).getByClass(className,!0)},children:function(){for(var children=[],child=element.firstChild;child;)1===child.nodeType&&children.push(child),child=child.nextSibling;return children},setText:function(text){return element.innerText=text,element.textContent=text,this},clearText:function(){return qq(element).setText("")},hasAttribute:function(attrName){var attrVal;return element.hasAttribute?element.hasAttribute(attrName)?null==/^false$/i.exec(element.getAttribute(attrName)):!1:(attrVal=element[attrName],void 0===attrVal?!1:null==/^false$/i.exec(attrVal))}}};!function(){"use strict";qq.canvasToBlob=function(canvas,mime,quality){return qq.dataUriToBlob(canvas.toDataURL(mime,quality))},qq.dataUriToBlob=function(dataUri){var arrayBuffer,byteString,intArray,mimeString,createBlob=function(data,mime){var BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,blobBuilder=BlobBuilder&&new BlobBuilder;return blobBuilder?(blobBuilder.append(data),blobBuilder.getBlob(mime)):new Blob([data],{type:mime})};return byteString=dataUri.split(",")[0].indexOf("base64")>=0?atob(dataUri.split(",")[1]):decodeURI(dataUri.split(",")[1]),mimeString=dataUri.split(",")[0].split(":")[1].split(";")[0],arrayBuffer=new ArrayBuffer(byteString.length),intArray=new Uint8Array(arrayBuffer),qq.each(byteString,function(idx,character){intArray[idx]=character.charCodeAt(0)}),createBlob(arrayBuffer,mimeString)},qq.log=function(message,level){window.console&&(level&&"info"!==level?window.console[level]?window.console[level](message):window.console.log("<"+level+"> "+message):window.console.log(message))},qq.isObject=function(variable){return variable&&!variable.nodeType&&"[object Object]"===Object.prototype.toString.call(variable)},qq.isFunction=function(variable){return"function"==typeof variable},qq.isArray=function(value){return"[object Array]"===Object.prototype.toString.call(value)||value&&window.ArrayBuffer&&value.buffer&&value.buffer.constructor===ArrayBuffer},qq.isItemList=function(maybeItemList){return"[object DataTransferItemList]"===Object.prototype.toString.call(maybeItemList)},qq.isNodeList=function(maybeNodeList){return"[object NodeList]"===Object.prototype.toString.call(maybeNodeList)||maybeNodeList.item&&maybeNodeList.namedItem},qq.isString=function(maybeString){return"[object String]"===Object.prototype.toString.call(maybeString)},qq.trimStr=function(string){return String.prototype.trim?string.trim():string.replace(/^\s+|\s+$/g,"")},qq.format=function(str){var args=Array.prototype.slice.call(arguments,1),newStr=str,nextIdxToReplace=newStr.indexOf("{}");return qq.each(args,function(idx,val){var strBefore=newStr.substring(0,nextIdxToReplace),strAfter=newStr.substring(nextIdxToReplace+2);return newStr=strBefore+val+strAfter,nextIdxToReplace=newStr.indexOf("{}",nextIdxToReplace+val.length),0>nextIdxToReplace?!1:void 0}),newStr},qq.isFile=function(maybeFile){return window.File&&"[object File]"===Object.prototype.toString.call(maybeFile)},qq.isFileList=function(maybeFileList){return window.FileList&&"[object FileList]"===Object.prototype.toString.call(maybeFileList)},qq.isFileOrInput=function(maybeFileOrInput){return qq.isFile(maybeFileOrInput)||qq.isInput(maybeFileOrInput)},qq.isInput=function(maybeInput,notFile){var evaluateType=function(type){var normalizedType=type.toLowerCase();return notFile?"file"!==normalizedType:"file"===normalizedType};return window.HTMLInputElement&&"[object HTMLInputElement]"===Object.prototype.toString.call(maybeInput)&&maybeInput.type&&evaluateType(maybeInput.type)?!0:maybeInput.tagName&&"input"===maybeInput.tagName.toLowerCase()&&maybeInput.type&&evaluateType(maybeInput.type)?!0:!1},qq.isBlob=function(maybeBlob){return window.Blob&&"[object Blob]"===Object.prototype.toString.call(maybeBlob)?!0:void 0},qq.isXhrUploadSupported=function(){var input=document.createElement("input");return input.type="file",void 0!==input.multiple&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&"undefined"!=typeof qq.createXhrInstance().upload},qq.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(error){return qq.log("Neither XHR or ActiveX are supported!","error"),null}},qq.isFolderDropSupported=function(dataTransfer){return dataTransfer.items&&dataTransfer.items.length>0&&dataTransfer.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){return!qq.androidStock()&&qq.isXhrUploadSupported()&&(void 0!==File.prototype.slice||void 0!==File.prototype.webkitSlice||void 0!==File.prototype.mozSlice)},qq.sliceBlob=function(fileOrBlob,start,end){var slicer=fileOrBlob.slice||fileOrBlob.mozSlice||fileOrBlob.webkitSlice;return slicer.call(fileOrBlob,start,end)},qq.arrayBufferToHex=function(buffer){var bytesAsHex="",bytes=new Uint8Array(buffer);return qq.each(bytes,function(idx,byt){var byteAsHexStr=byt.toString(16);byteAsHexStr.length<2&&(byteAsHexStr="0"+byteAsHexStr),bytesAsHex+=byteAsHexStr}),bytesAsHex},qq.readBlobToHex=function(blob,startOffset,length){var initialBlob=qq.sliceBlob(blob,startOffset,startOffset+length),fileReader=new FileReader,promise=new qq.Promise;return fileReader.onload=function(){promise.success(qq.arrayBufferToHex(fileReader.result));
},fileReader.onerror=promise.failure,fileReader.readAsArrayBuffer(initialBlob),promise},qq.extend=function(first,second,extendNested){return qq.each(second,function(prop,val){extendNested&&qq.isObject(val)?(void 0===first[prop]&&(first[prop]={}),qq.extend(first[prop],val,!0)):first[prop]=val}),first},qq.override=function(target,sourceFn){var super_={},source=sourceFn(super_);return qq.each(source,function(srcPropName,srcPropVal){void 0!==target[srcPropName]&&(super_[srcPropName]=target[srcPropName]),target[srcPropName]=srcPropVal}),target},qq.indexOf=function(arr,elt,from){if(arr.indexOf)return arr.indexOf(elt,from);from=from||0;var len=arr.length;for(0>from&&(from+=len);len>from;from+=1)if(arr.hasOwnProperty(from)&&arr[from]===elt)return from;return-1},qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"==c?r:3&r|8;return v.toString(16)})},qq.ie=function(){return-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("Trident")},qq.ie7=function(){return-1!==navigator.userAgent.indexOf("MSIE 7")},qq.ie8=function(){return-1!==navigator.userAgent.indexOf("MSIE 8")},qq.ie10=function(){return-1!==navigator.userAgent.indexOf("MSIE 10")},qq.ie11=function(){return qq.ie()&&-1!==navigator.userAgent.indexOf("rv:11")},qq.edge=function(){return navigator.userAgent.indexOf("Edge")>=0},qq.safari=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")},qq.chrome=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Google")},qq.opera=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Opera")},qq.firefox=function(){return!qq.edge()&&!qq.ie11()&&-1!==navigator.userAgent.indexOf("Mozilla")&&void 0!==navigator.vendor&&""===navigator.vendor},qq.windows=function(){return"Win32"===navigator.platform},qq.android=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")},qq.androidStock=function(){return qq.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0},qq.ios6=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 6_")},qq.ios7=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 7_")},qq.ios8=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_")},qq.ios800=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_0 ")},qq.ios=function(){return-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("iPod")||-1!==navigator.userAgent.indexOf("iPhone")},qq.iosChrome=function(){return qq.ios()&&-1!==navigator.userAgent.indexOf("CriOS")},qq.iosSafari=function(){return qq.ios()&&!qq.iosChrome()&&-1!==navigator.userAgent.indexOf("Safari")},qq.iosSafariWebView=function(){return qq.ios()&&!qq.iosChrome()&&!qq.iosSafari()},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.toElement=function(){var div=document.createElement("div");return function(html){div.innerHTML=html;var element=div.firstChild;return div.removeChild(element),element}}(),qq.each=function(iterableItem,callback){var keyOrIndex,retVal;if(iterableItem)if(window.Storage&&iterableItem.constructor===window.Storage)for(keyOrIndex=0;keyOrIndex<iterableItem.length&&(retVal=callback(iterableItem.key(keyOrIndex),iterableItem.getItem(iterableItem.key(keyOrIndex))),retVal!==!1);keyOrIndex++);else if(qq.isArray(iterableItem)||qq.isItemList(iterableItem)||qq.isNodeList(iterableItem))for(keyOrIndex=0;keyOrIndex<iterableItem.length&&(retVal=callback(keyOrIndex,iterableItem[keyOrIndex]),retVal!==!1);keyOrIndex++);else if(qq.isString(iterableItem))for(keyOrIndex=0;keyOrIndex<iterableItem.length&&(retVal=callback(keyOrIndex,iterableItem.charAt(keyOrIndex)),retVal!==!1);keyOrIndex++);else for(keyOrIndex in iterableItem)if(Object.prototype.hasOwnProperty.call(iterableItem,keyOrIndex)&&(retVal=callback(keyOrIndex,iterableItem[keyOrIndex]),retVal===!1))break},qq.bind=function(oldFunc,context){if(qq.isFunction(oldFunc)){var args=Array.prototype.slice.call(arguments,2);return function(){var newArgs=qq.extend([],args);return arguments.length&&(newArgs=newArgs.concat(Array.prototype.slice.call(arguments))),oldFunc.apply(context,newArgs)}}throw new Error("first parameter must be a function!")},qq.obj2url=function(obj,temp,prefixDone){var uristrings=[],prefix="&",add=function(nextObj,i){var nextTemp=temp?/\[\]$/.test(temp)?temp:temp+"["+i+"]":i;"undefined"!==nextTemp&&"undefined"!==i&&uristrings.push("object"==typeof nextObj?qq.obj2url(nextObj,nextTemp,!0):"[object Function]"===Object.prototype.toString.call(nextObj)?encodeURIComponent(nextTemp)+"="+encodeURIComponent(nextObj()):encodeURIComponent(nextTemp)+"="+encodeURIComponent(nextObj))};return!prefixDone&&temp?(prefix=/\?/.test(temp)?/\?$/.test(temp)?"":"&":"?",uristrings.push(temp),uristrings.push(qq.obj2url(obj))):"[object Array]"===Object.prototype.toString.call(obj)&&"undefined"!=typeof obj?qq.each(obj,function(idx,val){add(val,idx)}):"undefined"!=typeof obj&&null!==obj&&"object"==typeof obj?qq.each(obj,function(prop,val){add(val,prop)}):uristrings.push(encodeURIComponent(temp)+"="+encodeURIComponent(obj)),temp?uristrings.join(prefix):uristrings.join(prefix).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(obj,formData,arrayKeyName){return formData||(formData=new FormData),qq.each(obj,function(key,val){key=arrayKeyName?arrayKeyName+"["+key+"]":key,qq.isObject(val)?qq.obj2FormData(val,formData,key):qq.isFunction(val)?formData.append(key,val()):formData.append(key,val)}),formData},qq.obj2Inputs=function(obj,form){var input;return form||(form=document.createElement("form")),qq.obj2FormData(obj,{append:function(key,val){input=document.createElement("input"),input.setAttribute("name",key),input.setAttribute("value",val),form.appendChild(input)}}),form},qq.parseJson=function(json){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qq.getExtension=function(filename){var extIdx=filename.lastIndexOf(".")+1;return extIdx>0?filename.substr(extIdx,filename.length-extIdx):void 0},qq.getFilename=function(blobOrFileInput){return qq.isInput(blobOrFileInput)?blobOrFileInput.value.replace(/.*(\/|\\)/,""):qq.isFile(blobOrFileInput)&&null!==blobOrFileInput.fileName&&void 0!==blobOrFileInput.fileName?blobOrFileInput.fileName:blobOrFileInput.name},qq.DisposeSupport=function(){var disposers=[];return{dispose:function(){var disposer;do disposer=disposers.shift(),disposer&&disposer();while(disposer)},attach:function(){var args=arguments;this.addDisposer(qq(args[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(disposeFunction){disposers.push(disposeFunction)}}}}(),function(){"use strict";"function"==typeof define&&define.amd?define("fineuploader",[],function(){return qq}):"undefined"!=typeof module&&module.exports?module.exports=qq:global.qq=qq}(),function(){"use strict";qq.Error=function(message){this.message="[Fine Uploader "+qq.version+"] "+message},qq.Error.prototype=new Error}(),qq.version="5.15.4",qq.supportedFeatures=function(){"use strict";function testSupportsFileInputElement(){var tempInput,supported=!0;try{tempInput=document.createElement("input"),tempInput.type="file",qq(tempInput).hide(),tempInput.disabled&&(supported=!1)}catch(ex){supported=!1}return supported}function isChrome21OrHigher(){return(qq.chrome()||qq.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/)}function isChrome14OrHigher(){return(qq.chrome()||qq.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)}function isCrossOriginXhrSupported(){if(window.XMLHttpRequest){var xhr=qq.createXhrInstance();return void 0!==xhr.withCredentials}return!1}function isXdrSupported(){return void 0!==window.XDomainRequest}function isCrossOriginAjaxSupported(){return isCrossOriginXhrSupported()?!0:isXdrSupported()}function isFolderSelectionSupported(){return void 0!==document.createElement("input").webkitdirectory}function isLocalStorageSupported(){try{return!!window.localStorage&&qq.isFunction(window.localStorage.setItem)}catch(error){return!1}}function isDragAndDropSupported(){var span=document.createElement("span");return("draggable"in span||"ondragstart"in span&&"ondrop"in span)&&!qq.android()&&!qq.ios()}var supportsUploading,supportsUploadingBlobs,supportsFileDrop,supportsAjaxFileUploading,supportsFolderDrop,supportsChunking,supportsResume,supportsUploadViaPaste,supportsUploadCors,supportsDeleteFileXdr,supportsDeleteFileCorsXhr,supportsDeleteFileCors,supportsFolderSelection,supportsImagePreviews,supportsUploadProgress;return supportsUploading=testSupportsFileInputElement(),supportsAjaxFileUploading=supportsUploading&&qq.isXhrUploadSupported(),supportsUploadingBlobs=supportsAjaxFileUploading&&!qq.androidStock(),supportsFileDrop=supportsAjaxFileUploading&&isDragAndDropSupported(),supportsFolderDrop=supportsFileDrop&&isChrome21OrHigher(),supportsChunking=supportsAjaxFileUploading&&qq.isFileChunkingSupported(),supportsResume=supportsAjaxFileUploading&&supportsChunking&&isLocalStorageSupported(),supportsUploadViaPaste=supportsAjaxFileUploading&&isChrome14OrHigher(),supportsUploadCors=supportsUploading&&(void 0!==window.postMessage||supportsAjaxFileUploading),supportsDeleteFileCorsXhr=isCrossOriginXhrSupported(),supportsDeleteFileXdr=isXdrSupported(),supportsDeleteFileCors=isCrossOriginAjaxSupported(),supportsFolderSelection=isFolderSelectionSupported(),supportsImagePreviews=supportsAjaxFileUploading&&void 0!==window.FileReader,supportsUploadProgress=function(){return supportsAjaxFileUploading?!qq.androidStock()&&!qq.iosChrome():!1}(),{ajaxUploading:supportsAjaxFileUploading,blobUploading:supportsUploadingBlobs,canDetermineSize:supportsAjaxFileUploading,chunking:supportsChunking,deleteFileCors:supportsDeleteFileCors,deleteFileCorsXdr:supportsDeleteFileXdr,deleteFileCorsXhr:supportsDeleteFileCorsXhr,dialogElement:!!window.HTMLDialogElement,fileDrop:supportsFileDrop,folderDrop:supportsFolderDrop,folderSelection:supportsFolderSelection,imagePreviews:supportsImagePreviews,imageValidation:supportsImagePreviews,itemSizeValidation:supportsAjaxFileUploading,pause:supportsChunking,progressBar:supportsUploadProgress,resume:supportsResume,scaling:supportsImagePreviews&&supportsUploadingBlobs,tiffPreviews:qq.safari(),unlimitedScaledImageSize:!qq.ios(),uploading:supportsUploading,uploadCors:supportsUploadCors,uploadCustomHeaders:supportsAjaxFileUploading,uploadNonMultipart:supportsAjaxFileUploading,uploadViaPaste:supportsUploadViaPaste}}(),qq.isGenericPromise=function(maybePromise){"use strict";return!!(maybePromise&&maybePromise.then&&qq.isFunction(maybePromise.then))},qq.Promise=function(){"use strict";var successArgs,failureArgs,successCallbacks=[],failureCallbacks=[],doneCallbacks=[],state=0;qq.extend(this,{then:function(onSuccess,onFailure){return 0===state?(onSuccess&&successCallbacks.push(onSuccess),onFailure&&failureCallbacks.push(onFailure)):-1===state?onFailure&&onFailure.apply(null,failureArgs):onSuccess&&onSuccess.apply(null,successArgs),this},done:function(callback){return 0===state?doneCallbacks.push(callback):callback.apply(null,void 0===failureArgs?successArgs:failureArgs),this},success:function(){return state=1,successArgs=arguments,successCallbacks.length&&qq.each(successCallbacks,function(idx,callback){callback.apply(null,successArgs)}),doneCallbacks.length&&qq.each(doneCallbacks,function(idx,callback){callback.apply(null,successArgs)}),this},failure:function(){return state=-1,failureArgs=arguments,failureCallbacks.length&&qq.each(failureCallbacks,function(idx,callback){callback.apply(null,failureArgs)}),doneCallbacks.length&&qq.each(doneCallbacks,function(idx,callback){callback.apply(null,failureArgs)}),this}})},qq.BlobProxy=function(referenceBlob,onCreate){"use strict";qq.extend(this,{referenceBlob:referenceBlob,create:function(){return onCreate(referenceBlob)}})},qq.UploadButton=function(o){"use strict";function createInput(){var input=document.createElement("input");return input.setAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME,buttonId),input.setAttribute("title",options.title),self.setMultiple(options.multiple,input),options.folders&&qq.supportedFeatures.folderSelection&&input.setAttribute("webkitdirectory",""),options.acceptFiles&&input.setAttribute("accept",options.acceptFiles),input.setAttribute("type","file"),input.setAttribute("name",options.name),qq(input).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:qq.ie()&&!qq.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),!qq.ie7()&&qq(input).css({height:"100%"}),options.element.appendChild(input),disposeSupport.attach(input,"change",function(){options.onChange(input)}),disposeSupport.attach(input,"mouseover",function(){qq(options.element).addClass(options.hoverClass)}),disposeSupport.attach(input,"mouseout",function(){qq(options.element).removeClass(options.hoverClass)}),disposeSupport.attach(input,"focus",function(){qq(options.element).addClass(options.focusClass)}),disposeSupport.attach(input,"blur",function(){qq(options.element).removeClass(options.focusClass)}),input}var input,buttonId,self=this,disposeSupport=new qq.DisposeSupport,options={acceptFiles:null,element:null,focusClass:"qq-upload-button-focus",folders:!1,hoverClass:"qq-upload-button-hover",ios8BrowserCrashWorkaround:!1,multiple:!1,name:"qqfile",onChange:function(input){},title:null};qq.extend(options,o),buttonId=qq.getUniqueId(),qq(options.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),qq.extend(this,{getInput:function(){return input},getButtonId:function(){return buttonId},setMultiple:function(isMultiple,optInput){var input=optInput||this.getInput();options.ios8BrowserCrashWorkaround&&qq.ios8()&&(qq.iosChrome()||qq.iosSafariWebView())?input.setAttribute("multiple",""):isMultiple?input.setAttribute("multiple",""):input.removeAttribute("multiple")},setAcceptFiles:function(acceptFiles){acceptFiles!==options.acceptFiles&&input.setAttribute("accept",acceptFiles)},reset:function(){input.parentNode&&qq(input).remove(),qq(options.element).removeClass(options.focusClass),input=null,input=createInput()}}),input=createInput()},qq.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id",qq.UploadData=function(uploaderProxy){"use strict";function getDataByIds(idOrIds){if(qq.isArray(idOrIds)){var entries=[];return qq.each(idOrIds,function(idx,id){entries.push(data[id])}),entries}return data[idOrIds]}function getDataByUuids(uuids){if(qq.isArray(uuids)){var entries=[];return qq.each(uuids,function(idx,uuid){entries.push(data[byUuid[uuid]])}),entries}return data[byUuid[uuids]]}function getDataByStatus(status){var statusResults=[],statuses=[].concat(status);return qq.each(statuses,function(index,statusEnum){var statusResultIndexes=byStatus[statusEnum];void 0!==statusResultIndexes&&qq.each(statusResultIndexes,function(i,dataIndex){statusResults.push(data[dataIndex])})}),statusResults}var data=[],byUuid={},byStatus={},byProxyGroupId={},byBatchId={};qq.extend(this,{addFile:function(spec){var status=spec.status||qq.status.SUBMITTING,id=data.push({name:spec.name,originalName:spec.name,uuid:spec.uuid,size:null==spec.size?-1:spec.size,status:status})-1;return spec.batchId&&(data[id].batchId=spec.batchId,void 0===byBatchId[spec.batchId]&&(byBatchId[spec.batchId]=[]),byBatchId[spec.batchId].push(id)),spec.proxyGroupId&&(data[id].proxyGroupId=spec.proxyGroupId,void 0===byProxyGroupId[spec.proxyGroupId]&&(byProxyGroupId[spec.proxyGroupId]=[]),byProxyGroupId[spec.proxyGroupId].push(id)),data[id].id=id,byUuid[spec.uuid]=id,void 0===byStatus[status]&&(byStatus[status]=[]),byStatus[status].push(id),spec.onBeforeStatusChange&&spec.onBeforeStatusChange(id),uploaderProxy.onStatusChange(id,null,status),id},retrieve:function(optionalFilter){return qq.isObject(optionalFilter)&&data.length?void 0!==optionalFilter.id?getDataByIds(optionalFilter.id):void 0!==optionalFilter.uuid?getDataByUuids(optionalFilter.uuid):optionalFilter.status?getDataByStatus(optionalFilter.status):void 0:qq.extend([],data,!0)},reset:function(){data=[],byUuid={},byStatus={},byBatchId={}},setStatus:function(id,newStatus){var oldStatus=data[id].status,byStatusOldStatusIndex=qq.indexOf(byStatus[oldStatus],id);byStatus[oldStatus].splice(byStatusOldStatusIndex,1),data[id].status=newStatus,void 0===byStatus[newStatus]&&(byStatus[newStatus]=[]),byStatus[newStatus].push(id),uploaderProxy.onStatusChange(id,oldStatus,newStatus)},uuidChanged:function(id,newUuid){var oldUuid=data[id].uuid;data[id].uuid=newUuid,byUuid[newUuid]=id,delete byUuid[oldUuid]},updateName:function(id,newName){data[id].name=newName},updateSize:function(id,newSize){data[id].size=newSize},setParentId:function(targetId,parentId){data[targetId].parentId=parentId},getIdsInProxyGroup:function(id){var proxyGroupId=data[id].proxyGroupId;return proxyGroupId?byProxyGroupId[proxyGroupId]:[]},getIdsInBatch:function(id){var batchId=data[id].batchId;return byBatchId[batchId]}})},qq.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},function(){"use strict";qq.basePublicApi={addBlobs:function(blobDataOrArray,params,endpoint){this.addFiles(blobDataOrArray,params,endpoint)},addInitialFiles:function(cannedFileList){var self=this;qq.each(cannedFileList,function(index,cannedFile){self._addCannedFile(cannedFile)})},addFiles:function(data,params,endpoint){this._maybeHandleIos8SafariWorkaround();var batchId=0===this._storedIds.length?qq.getUniqueId():this._currentBatchId,processBlob=qq.bind(function(blob){this._handleNewFile({blob:blob,name:this._options.blobs.defaultName},batchId,verifiedFiles)},this),processBlobData=qq.bind(function(blobData){this._handleNewFile(blobData,batchId,verifiedFiles)},this),processCanvas=qq.bind(function(canvas){var blob=qq.canvasToBlob(canvas);this._handleNewFile({blob:blob,name:this._options.blobs.defaultName+".png"},batchId,verifiedFiles)},this),processCanvasData=qq.bind(function(canvasData){var normalizedQuality=canvasData.quality&&canvasData.quality/100,blob=qq.canvasToBlob(canvasData.canvas,canvasData.type,normalizedQuality);this._handleNewFile({blob:blob,name:canvasData.name},batchId,verifiedFiles)},this),processFileOrInput=qq.bind(function(fileOrInput){if(qq.isInput(fileOrInput)&&qq.supportedFeatures.ajaxUploading){var files=Array.prototype.slice.call(fileOrInput.files),self=this;qq.each(files,function(idx,file){self._handleNewFile(file,batchId,verifiedFiles)})}else this._handleNewFile(fileOrInput,batchId,verifiedFiles)},this),normalizeData=function(){qq.isFileList(data)&&(data=Array.prototype.slice.call(data)),data=[].concat(data)},self=this,verifiedFiles=[];this._currentBatchId=batchId,data&&(normalizeData(),qq.each(data,function(idx,fileContainer){qq.isFileOrInput(fileContainer)?processFileOrInput(fileContainer):qq.isBlob(fileContainer)?processBlob(fileContainer):qq.isObject(fileContainer)?fileContainer.blob&&fileContainer.name?processBlobData(fileContainer):fileContainer.canvas&&fileContainer.name&&processCanvasData(fileContainer):fileContainer.tagName&&"canvas"===fileContainer.tagName.toLowerCase()?processCanvas(fileContainer):self.log(fileContainer+" is not a valid file container!  Ignoring!","warn")}),this.log("Received "+verifiedFiles.length+" files."),this._prepareItemsForUpload(verifiedFiles,params,endpoint))},cancel:function(id){this._handler.cancel(id)},cancelAll:function(){var storedIdsCopy=[],self=this;qq.extend(storedIdsCopy,this._storedIds),qq.each(storedIdsCopy,function(idx,storedFileId){self.cancel(storedFileId)}),this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(id){var uploadData=this._uploadData.retrieve({id:id});return qq.supportedFeatures.pause&&this._options.chunking.enabled?uploadData.status===qq.status.PAUSED?(this.log(qq.format("Paused file ID {} ({}) will be continued.  Not paused.",id,this.getName(id))),this._uploadFile(id),!0):(this.log(qq.format("Ignoring continue for file ID {} ({}).  Not paused.",id,this.getName(id)),"error"),!1):!1},deleteFile:function(id){return this._onSubmitDelete(id)},doesExist:function(fileOrBlobId){return this._handler.isValid(fileOrBlobId)},drawThumbnail:function(fileId,imgOrCanvas,maxSize,fromServer,customResizeFunction){var fileOrUrl,options,promiseToReturn=new qq.Promise;return this._imageGenerator?(fileOrUrl=this._thumbnailUrls[fileId],options={customResizeFunction:customResizeFunction,maxSize:maxSize>0?maxSize:null,scale:maxSize>0},!fromServer&&qq.supportedFeatures.imagePreviews&&(fileOrUrl=this.getFile(fileId)),null==fileOrUrl?promiseToReturn.failure({container:imgOrCanvas,error:"File or URL not found."}):this._imageGenerator.generate(fileOrUrl,imgOrCanvas,options).then(function(modifiedContainer){promiseToReturn.success(modifiedContainer)},function(container,reason){promiseToReturn.failure({container:container,error:reason||"Problem generating thumbnail"})})):promiseToReturn.failure({container:imgOrCanvas,error:"Missing image generator module"}),promiseToReturn},getButton:function(fileId){return this._getButton(this._buttonIdsForFileIds[fileId])},getEndpoint:function(fileId){return this._endpointStore.get(fileId)},getFile:function(fileOrBlobId){return this._handler.getFile(fileOrBlobId)||null},getInProgress:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED]}).length},getName:function(id){return this._uploadData.retrieve({id:id}).name},getParentId:function(id){var uploadDataEntry=this.getUploads({id:id}),parentId=null;return uploadDataEntry&&void 0!==uploadDataEntry.parentId&&(parentId=uploadDataEntry.parentId),parentId},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(id){return this._uploadData.retrieve({id:id}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var allowedItems=this._currentItemLimit;return allowedItems>0?allowedItems-this._netUploadedOrQueued:null},getUploads:function(optionalFilter){return this._uploadData.retrieve(optionalFilter)},getUuid:function(id){return this._uploadData.retrieve({id:id}).uuid},log:function(str,level){!this._options.debug||level&&"info"!==level?level&&"info"!==level&&qq.log("[Fine Uploader "+qq.version+"] "+str,level):qq.log("[Fine Uploader "+qq.version+"] "+str)},pauseUpload:function(id){var uploadData=this._uploadData.retrieve({id:id});if(!qq.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(qq.indexOf([qq.status.UPLOADING,qq.status.UPLOAD_RETRYING],uploadData.status)>=0){if(this._handler.pause(id))return this._uploadData.setStatus(id,qq.status.PAUSED),!0;this.log(qq.format("Unable to pause file ID {} ({}).",id,this.getName(id)),"error")}else this.log(qq.format("Ignoring pause for file ID {} ({}).  Not in progress.",id,this.getName(id)),"error");return!1},removeFileRef:function(id){this._handler.expunge(id)},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],qq.each(this._buttons,function(idx,button){button.reset()}),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._buttonIdsForFileIds=[],this._pasteHandler&&this._pasteHandler.reset(),this._options.session.refreshOnReset&&this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._totalProgress&&this._totalProgress.reset()},retry:function(id){return this._manualRetry(id)},scaleImage:function(id,specs){var self=this;return qq.Scaler.prototype.scaleImage(id,specs,{log:qq.bind(self.log,self),getFile:qq.bind(self.getFile,self),uploadData:self._uploadData})},setCustomHeaders:function(headers,id){this._customHeadersStore.set(headers,id)},setDeleteFileCustomHeaders:function(headers,id){this._deleteFileCustomHeadersStore.set(headers,id)},setDeleteFileEndpoint:function(endpoint,id){this._deleteFileEndpointStore.set(endpoint,id)},setDeleteFileParams:function(params,id){this._deleteFileParamsStore.set(params,id)},setEndpoint:function(endpoint,id){this._endpointStore.set(endpoint,id)},setForm:function(elementOrId){this._updateFormSupportAndParams(elementOrId)},setItemLimit:function(newItemLimit){this._currentItemLimit=newItemLimit},setName:function(id,newName){this._uploadData.updateName(id,newName)},setParams:function(params,id){this._paramsStore.set(params,id)},setUuid:function(id,newUuid){return this._uploadData.uuidChanged(id,newUuid)},setStatus:function(id,newStatus){var fileRecord=this.getUploads({id:id});if(!fileRecord)throw new qq.Error(id+" is not a valid file ID.");switch(newStatus){case qq.status.DELETED:this._onDeleteComplete(id,null,!1);break;case qq.status.DELETE_FAILED:this._onDeleteComplete(id,null,!0);break;default:var errorMessage="Method setStatus called on '"+name+"' not implemented yet for "+newStatus;throw this.log(errorMessage),new qq.Error(errorMessage)}},uploadStoredFiles:function(){0===this._storedIds.length?this._itemError("noFilesError"):this._uploadStoredFiles()}},qq.basePrivateApi={_addCannedFile:function(sessionData){var self=this;return this._uploadData.addFile({uuid:sessionData.uuid,name:sessionData.name,size:sessionData.size,status:qq.status.UPLOAD_SUCCESSFUL,onBeforeStatusChange:function(id){sessionData.deleteFileEndpoint&&self.setDeleteFileEndpoint(sessionData.deleteFileEndpoint,id),sessionData.deleteFileParams&&self.setDeleteFileParams(sessionData.deleteFileParams,id),sessionData.thumbnailUrl&&(self._thumbnailUrls[id]=sessionData.thumbnailUrl),self._netUploaded++,self._netUploadedOrQueued++}})},_annotateWithButtonId:function(file,associatedInput){qq.isFile(file)&&(file.qqButtonId=this._getButtonId(associatedInput))},_batchError:function(message){this._options.callbacks.onError(null,null,message,void 0)},_createDeleteHandler:function(){var self=this;return new qq.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,cors:this._options.cors,log:qq.bind(self.log,self),onDelete:function(id){self._onDelete(id),self._options.callbacks.onDelete(id)},onDeleteComplete:function(id,xhrOrXdr,isError){self._onDeleteComplete(id,xhrOrXdr,isError),self._options.callbacks.onDeleteComplete(id,xhrOrXdr,isError)}})},_createPasteHandler:function(){var self=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:qq.bind(self.log,self),pasteReceived:function(blob){self._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(self._options.callbacks.onPasteReceived,self,blob),onSuccess:qq.bind(self._handlePasteSuccess,self,blob),identifier:"pasted image"})}}})},_createStore:function(initialValue,_readOnlyValues_){var store={},catchall=initialValue,perIdReadOnlyValues={},readOnlyValues=_readOnlyValues_,copy=function(orig){return qq.isObject(orig)?qq.extend({},orig):orig},getReadOnlyValues=function(){return qq.isFunction(readOnlyValues)?readOnlyValues():readOnlyValues},includeReadOnlyValues=function(id,existing){readOnlyValues&&qq.isObject(existing)&&qq.extend(existing,getReadOnlyValues()),perIdReadOnlyValues[id]&&qq.extend(existing,perIdReadOnlyValues[id])};return{set:function(val,id){null==id?(store={},catchall=copy(val)):store[id]=copy(val)},get:function(id){var values;return values=null!=id&&store[id]?store[id]:copy(catchall),includeReadOnlyValues(id,values),copy(values)},addReadOnly:function(id,values){qq.isObject(store)&&(null===id?qq.isFunction(values)?readOnlyValues=values:(readOnlyValues=readOnlyValues||{},qq.extend(readOnlyValues,values)):(perIdReadOnlyValues[id]=perIdReadOnlyValues[id]||{},qq.extend(perIdReadOnlyValues[id],values)))},remove:function(fileId){return delete store[fileId]},reset:function(){store={},perIdReadOnlyValues={},catchall=initialValue}}},_createUploadDataTracker:function(){var self=this;return new qq.UploadData({getName:function(id){return self.getName(id)},getUuid:function(id){return self.getUuid(id)},getSize:function(id){return self.getSize(id)},onStatusChange:function(id,oldStatus,newStatus){self._onUploadStatusChange(id,oldStatus,newStatus),self._options.callbacks.onStatusChange(id,oldStatus,newStatus),self._maybeAllComplete(id,newStatus),self._totalProgress&&setTimeout(function(){self._totalProgress.onStatusChange(id,oldStatus,newStatus)},0)}})},_createUploadButton:function(spec){function allowMultiple(){return qq.supportedFeatures.ajaxUploading?self._options.workarounds.iosEmptyVideos&&qq.ios()&&!qq.ios6()&&self._isAllowedExtension(allowedExtensions,".mov")?!1:void 0===spec.multiple?self._options.multiple:spec.multiple:!1}var button,self=this,acceptFiles=spec.accept||this._options.validation.acceptFiles,allowedExtensions=spec.allowedExtensions||this._options.validation.allowedExtensions;return button=new qq.UploadButton({acceptFiles:acceptFiles,element:spec.element,focusClass:this._options.classes.buttonFocus,folders:spec.folders,hoverClass:this._options.classes.buttonHover,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash,multiple:allowMultiple(),name:this._options.request.inputName,onChange:function(input){self._onInputChange(input)},title:null==spec.title?this._options.text.fileInputTitle:spec.title}),this._disposeSupport.addDisposer(function(){button.dispose()}),self._buttons.push(button),button},_createUploadHandler:function(additionalOptions,namespace){var self=this,lastOnProgress={},options={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:qq.bind(self.log,self),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(id,name,loaded,total){0>loaded||0>total||(lastOnProgress[id]?(lastOnProgress[id].loaded!==loaded||lastOnProgress[id].total!==total)&&(self._onProgress(id,name,loaded,total),self._options.callbacks.onProgress(id,name,loaded,total)):(self._onProgress(id,name,loaded,total),self._options.callbacks.onProgress(id,name,loaded,total)),lastOnProgress[id]={loaded:loaded,total:total})},onComplete:function(id,name,result,xhr){delete lastOnProgress[id];var retVal,status=self.getUploads({id:id}).status;status!==qq.status.UPLOAD_SUCCESSFUL&&status!==qq.status.UPLOAD_FAILED&&(retVal=self._onComplete(id,name,result,xhr),retVal instanceof qq.Promise?retVal.done(function(){self._options.callbacks.onComplete(id,name,result,xhr)}):self._options.callbacks.onComplete(id,name,result,xhr))},onCancel:function(id,name,cancelFinalizationEffort){var promise=new qq.Promise;return self._handleCheckedCallback({name:"onCancel",callback:qq.bind(self._options.callbacks.onCancel,self,id,name),onFailure:promise.failure,onSuccess:function(){cancelFinalizationEffort.then(function(){self._onCancel(id,name)}),promise.success()},identifier:id}),promise},onUploadPrep:qq.bind(this._onUploadPrep,this),onUpload:function(id,name){self._onUpload(id,name),self._options.callbacks.onUpload(id,name)},onUploadChunk:function(id,name,chunkData){self._onUploadChunk(id,chunkData),self._options.callbacks.onUploadChunk(id,name,chunkData)},onUploadChunkSuccess:function(id,chunkData,result,xhr){self._options.callbacks.onUploadChunkSuccess.apply(self,arguments)},onResume:function(id,name,chunkData){return self._options.callbacks.onResume(id,name,chunkData)},onAutoRetry:function(id,name,responseJSON,xhr){return self._onAutoRetry.apply(self,arguments);
},onUuidChanged:function(id,newUuid){self.log("Server requested UUID change from '"+self.getUuid(id)+"' to '"+newUuid+"'"),self.setUuid(id,newUuid)},getName:qq.bind(self.getName,self),getUuid:qq.bind(self.getUuid,self),getSize:qq.bind(self.getSize,self),setSize:qq.bind(self._setSize,self),getDataByUuid:function(uuid){return self.getUploads({uuid:uuid})},isQueued:function(id){var status=self.getUploads({id:id}).status;return status===qq.status.QUEUED||status===qq.status.SUBMITTED||status===qq.status.UPLOAD_RETRYING||status===qq.status.PAUSED},getIdsInProxyGroup:self._uploadData.getIdsInProxyGroup,getIdsInBatch:self._uploadData.getIdsInBatch};return qq.each(this._options.request,function(prop,val){options[prop]=val}),options.customHeaders=this._customHeadersStore,additionalOptions&&qq.each(additionalOptions,function(key,val){options[key]=val}),new qq.UploadHandlerController(options,namespace)},_fileOrBlobRejected:function(id){this._netUploadedOrQueued--,this._uploadData.setStatus(id,qq.status.REJECTED)},_formatSize:function(bytes){if(0===bytes)return bytes+this._options.text.sizeSymbols[0];var i=-1;do bytes/=1e3,i++;while(bytes>999);return Math.max(bytes,.1).toFixed(1)+this._options.text.sizeSymbols[i]},_generateExtraButtonSpecs:function(){var self=this;this._extraButtonSpecs={},qq.each(this._options.extraButtons,function(idx,extraButtonOptionEntry){var multiple=extraButtonOptionEntry.multiple,validation=qq.extend({},self._options.validation,!0),extraButtonSpec=qq.extend({},extraButtonOptionEntry);void 0===multiple&&(multiple=self._options.multiple),extraButtonSpec.validation&&qq.extend(validation,extraButtonOptionEntry.validation,!0),qq.extend(extraButtonSpec,{multiple:multiple,validation:validation},!0),self._initExtraButton(extraButtonSpec)})},_getButton:function(buttonId){var extraButtonsSpec=this._extraButtonSpecs[buttonId];return extraButtonsSpec?extraButtonsSpec.element:buttonId===this._defaultButtonId?this._options.button:void 0},_getButtonId:function(buttonOrFileInputOrFile){var inputs,fileInput,fileBlobOrInput=buttonOrFileInputOrFile;if(fileBlobOrInput instanceof qq.BlobProxy&&(fileBlobOrInput=fileBlobOrInput.referenceBlob),fileBlobOrInput&&!qq.isBlob(fileBlobOrInput)){if(qq.isFile(fileBlobOrInput))return fileBlobOrInput.qqButtonId;if("input"===fileBlobOrInput.tagName.toLowerCase()&&"file"===fileBlobOrInput.type.toLowerCase())return fileBlobOrInput.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME);if(inputs=fileBlobOrInput.getElementsByTagName("input"),qq.each(inputs,function(idx,input){return"file"===input.getAttribute("type")?(fileInput=input,!1):void 0}),fileInput)return fileInput.getAttribute(qq.UploadButton.BUTTON_ID_ATTR_NAME)}},_getNotFinished:function(){return this._uploadData.retrieve({status:[qq.status.UPLOADING,qq.status.UPLOAD_RETRYING,qq.status.QUEUED,qq.status.SUBMITTING,qq.status.SUBMITTED,qq.status.PAUSED]}).length},_getValidationBase:function(buttonId){var extraButtonSpec=this._extraButtonSpecs[buttonId];return extraButtonSpec?extraButtonSpec.validation:this._options.validation},_getValidationDescriptor:function(fileWrapper){return fileWrapper.file instanceof qq.BlobProxy?{name:qq.getFilename(fileWrapper.file.referenceBlob),size:fileWrapper.file.referenceBlob.size}:{name:this.getUploads({id:fileWrapper.id}).name,size:this.getUploads({id:fileWrapper.id}).size}},_getValidationDescriptors:function(fileWrappers){var self=this,fileDescriptors=[];return qq.each(fileWrappers,function(idx,fileWrapper){fileDescriptors.push(self._getValidationDescriptor(fileWrapper))}),fileDescriptors},_handleCameraAccess:function(){if(this._options.camera.ios&&qq.ios()){var acceptIosCamera="image/*;capture=camera",button=this._options.camera.button,buttonId=button?this._getButtonId(button):this._defaultButtonId,optionRoot=this._options;buttonId&&buttonId!==this._defaultButtonId&&(optionRoot=this._extraButtonSpecs[buttonId]),optionRoot.multiple=!1,null===optionRoot.validation.acceptFiles?optionRoot.validation.acceptFiles=acceptIosCamera:optionRoot.validation.acceptFiles+=","+acceptIosCamera,qq.each(this._buttons,function(idx,button){return button.getButtonId()===buttonId?(button.setMultiple(optionRoot.multiple),button.setAcceptFiles(optionRoot.acceptFiles),!1):void 0})}},_handleCheckedCallback:function(details){var self=this,callbackRetVal=details.callback();return qq.isGenericPromise(callbackRetVal)?(this.log(details.name+" - waiting for "+details.name+" promise to be fulfilled for "+details.identifier),callbackRetVal.then(function(successParam){self.log(details.name+" promise success for "+details.identifier),details.onSuccess(successParam)},function(){details.onFailure?(self.log(details.name+" promise failure for "+details.identifier),details.onFailure()):self.log(details.name+" promise failure for "+details.identifier)})):(callbackRetVal!==!1?details.onSuccess(callbackRetVal):details.onFailure?(this.log(details.name+" - return value was 'false' for "+details.identifier+".  Invoking failure callback."),details.onFailure()):this.log(details.name+" - return value was 'false' for "+details.identifier+".  Will not proceed."),callbackRetVal)},_handleNewFile:function(file,batchId,newFileWrapperList){var self=this,uuid=qq.getUniqueId(),size=-1,name=qq.getFilename(file),actualFile=file.blob||file,handler=this._customNewFileHandler?this._customNewFileHandler:qq.bind(self._handleNewFileGeneric,self);!qq.isInput(actualFile)&&actualFile.size>=0&&(size=actualFile.size),handler(actualFile,name,uuid,size,newFileWrapperList,batchId,this._options.request.uuidName,{uploadData:self._uploadData,paramsStore:self._paramsStore,addFileToHandler:function(id,file){self._handler.add(id,file),self._netUploadedOrQueued++,self._trackButton(id)}})},_handleNewFileGeneric:function(file,name,uuid,size,fileList,batchId){var id=this._uploadData.addFile({uuid:uuid,name:name,size:size,batchId:batchId});this._handler.add(id,file),this._trackButton(id),this._netUploadedOrQueued++,fileList.push({id:id,file:file})},_handlePasteSuccess:function(blob,extSuppliedName){var extension=blob.type.split("/")[1],name=extSuppliedName;null==name&&(name=this._options.paste.defaultName),name+="."+extension,this.addFiles({name:name,blob:blob})},_handleDeleteSuccess:function(id){if(this.getUploads({id:id}).status!==qq.status.DELETED){var name=this.getName(id);this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(id),this._uploadData.setStatus(id,qq.status.DELETED),this.log("Delete request for '"+name+"' has succeeded.")}},_handleDeleteFailed:function(id,xhrOrXdr){var name=this.getName(id);this._uploadData.setStatus(id,qq.status.DELETE_FAILED),this.log("Delete request for '"+name+"' has failed.","error"),xhrOrXdr&&void 0!==xhrOrXdr.withCredentials?this._options.callbacks.onError(id,name,"Delete request failed with response code "+xhrOrXdr.status,xhrOrXdr):this._options.callbacks.onError(id,name,"Delete request failed",xhrOrXdr)},_initExtraButton:function(spec){var button=this._createUploadButton({accept:spec.validation.acceptFiles,allowedExtensions:spec.validation.allowedExtensions,element:spec.element,folders:spec.folders,multiple:spec.multiple,title:spec.fileInputTitle});this._extraButtonSpecs[button.getButtonId()]=spec},_initFormSupportAndParams:function(){this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible:function(){return qq.DeleteFileAjaxRequester&&this._options.deleteFile.enabled?this._options.cors.expected?qq.supportedFeatures.deleteFileCorsXhr?!0:qq.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr?!0:!1:!0:!1},_isAllowedExtension:function(allowed,fileName){var valid=!1;return allowed.length?(qq.each(allowed,function(idx,allowedExt){if(qq.isString(allowedExt)){var extRegex=new RegExp("\\."+allowedExt+"$","i");if(null!=fileName.match(extRegex))return valid=!0,!1}}),valid):!0},_itemError:function(code,maybeNameOrNames,item){function r(name,replacement){message=message.replace(name,replacement)}var extensionsForMessage,placeholderMatch,message=this._options.messages[code],allowedExtensions=[],names=[].concat(maybeNameOrNames),name=names[0],buttonId=this._getButtonId(item),validationBase=this._getValidationBase(buttonId);return qq.each(validationBase.allowedExtensions,function(idx,allowedExtension){qq.isString(allowedExtension)&&allowedExtensions.push(allowedExtension)}),extensionsForMessage=allowedExtensions.join(", ").toLowerCase(),r("{file}",this._options.formatFileName(name)),r("{extensions}",extensionsForMessage),r("{sizeLimit}",this._formatSize(validationBase.sizeLimit)),r("{minSizeLimit}",this._formatSize(validationBase.minSizeLimit)),placeholderMatch=message.match(/(\{\w+\})/g),null!==placeholderMatch&&qq.each(placeholderMatch,function(idx,placeholder){r(placeholder,names[idx])}),this._options.callbacks.onError(null,name,message,void 0),message},_manualRetry:function(id,callback){return this._onBeforeManualRetry(id)?(this._netUploadedOrQueued++,this._uploadData.setStatus(id,qq.status.UPLOAD_RETRYING),callback?callback(id):this._handler.retry(id),!0):void 0},_maybeAllComplete:function(id,status){var self=this,notFinished=this._getNotFinished();status===qq.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(id):status===qq.status.UPLOAD_FAILED&&this._failedSinceLastAllComplete.push(id),0===notFinished&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout(function(){self._onAllComplete(self._succeededSinceLastAllComplete,self._failedSinceLastAllComplete)},0)},_maybeHandleIos8SafariWorkaround:function(){var self=this;if(this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari())throw setTimeout(function(){window.alert(self._options.messages.unsupportedBrowserIos8Safari)},0),new qq.Error(this._options.messages.unsupportedBrowserIos8Safari)},_maybeParseAndSendUploadError:function(id,name,response,xhr){if(!response.success)if(xhr&&200!==xhr.status&&!response.error)this._options.callbacks.onError(id,name,"XHR returned response code "+xhr.status,xhr);else{var errorReason=response.error?response.error:this._options.text.defaultResponseError;this._options.callbacks.onError(id,name,errorReason,xhr)}},_maybeProcessNextItemAfterOnValidateCallback:function(validItem,items,index,params,endpoint){var self=this;if(items.length>index)if(validItem||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var validationDescriptor=self._getValidationDescriptor(items[index]),buttonId=self._getButtonId(items[index].file),button=self._getButton(buttonId);self._handleCheckedCallback({name:"onValidate",callback:qq.bind(self._options.callbacks.onValidate,self,validationDescriptor,button),onSuccess:qq.bind(self._onValidateCallbackSuccess,self,items,index,params,endpoint),onFailure:qq.bind(self._onValidateCallbackFailure,self,items,index,params,endpoint),identifier:"Item '"+validationDescriptor.name+"', size: "+validationDescriptor.size})},0);else if(!validItem)for(;index<items.length;index++)self._fileOrBlobRejected(items[index].id)},_onAllComplete:function(successful,failed){this._totalProgress&&this._totalProgress.onAllComplete(successful,failed,this._preventRetries),this._options.callbacks.onAllComplete(qq.extend([],successful),qq.extend([],failed)),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[]},_onAutoRetry:function(id,name,responseJSON,xhr,callback){var self=this;if(self._preventRetries[id]=responseJSON[self._options.retry.preventRetryResponseProperty],self._shouldAutoRetry(id,name,responseJSON)){var retryWaitPeriod=1e3*self._options.retry.autoAttemptDelay;return self._maybeParseAndSendUploadError.apply(self,arguments),self._options.callbacks.onAutoRetry(id,name,self._autoRetries[id]),self._onBeforeAutoRetry(id,name),self._uploadData.setStatus(id,qq.status.UPLOAD_RETRYING),self._retryTimeouts[id]=setTimeout(function(){self.log("Starting retry for "+name+"..."),callback?callback(id):self._handler.retry(id)},retryWaitPeriod),!0}},_onBeforeAutoRetry:function(id,name){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+name+"...")},_onBeforeManualRetry:function(id){var fileName,itemLimit=this._currentItemLimit;return this._preventRetries[id]?(this.log("Retries are forbidden for id "+id,"warn"),!1):this._handler.isValid(id)?(fileName=this.getName(id),this._options.callbacks.onManualRetry(id,fileName)===!1?!1:itemLimit>0&&this._netUploadedOrQueued+1>itemLimit?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+fileName+"' (id: "+id+")..."),!0)):(this.log("'"+id+"' is not a valid file ID","error"),!1)},_onCancel:function(id,name){this._netUploadedOrQueued--,clearTimeout(this._retryTimeouts[id]);var storedItemIndex=qq.indexOf(this._storedIds,id);!this._options.autoUpload&&storedItemIndex>=0&&this._storedIds.splice(storedItemIndex,1),this._uploadData.setStatus(id,qq.status.CANCELED)},_onComplete:function(id,name,result,xhr){return result.success?(result.thumbnailUrl&&(this._thumbnailUrls[id]=result.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(id,qq.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(id,qq.status.UPLOAD_FAILED),result[this._options.retry.preventRetryResponseProperty]===!0&&(this._preventRetries[id]=!0)),this._maybeParseAndSendUploadError(id,name,result,xhr),result.success?!0:!1},_onDelete:function(id){this._uploadData.setStatus(id,qq.status.DELETING)},_onDeleteComplete:function(id,xhrOrXdr,isError){this.getName(id);isError?this._handleDeleteFailed(id,xhrOrXdr):this._handleDeleteSuccess(id)},_onInputChange:function(input){var fileIndex;if(qq.supportedFeatures.ajaxUploading){for(fileIndex=0;fileIndex<input.files.length;fileIndex++)this._annotateWithButtonId(input.files[fileIndex],input);this.addFiles(input.files)}else input.value.length>0&&this.addFiles(input);qq.each(this._buttons,function(idx,button){button.reset()})},_onProgress:function(id,name,loaded,total){this._totalProgress&&this._totalProgress.onIndividualProgress(id,loaded,total)},_onSubmit:function(id,name){},_onSubmitCallbackSuccess:function(id,name){this._onSubmit.apply(this,arguments),this._uploadData.setStatus(id,qq.status.SUBMITTED),this._onSubmitted.apply(this,arguments),this._options.autoUpload?(this._options.callbacks.onSubmitted.apply(this,arguments),this._uploadFile(id)):(this._storeForLater(id),this._options.callbacks.onSubmitted.apply(this,arguments))},_onSubmitDelete:function(id,onSuccessCallback,additionalMandatedParams){var adjustedOnSuccessCallback,uuid=this.getUuid(id);return onSuccessCallback&&(adjustedOnSuccessCallback=qq.bind(onSuccessCallback,this,id,uuid,additionalMandatedParams)),this._isDeletePossible()?(this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,id),onSuccess:adjustedOnSuccessCallback||qq.bind(this._deleteHandler.sendDelete,this,id,uuid,additionalMandatedParams),identifier:id}),!0):(this.log("Delete request ignored for ID "+id+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onSubmitted:function(id){},_onTotalProgress:function(loaded,total){this._options.callbacks.onTotalProgress(loaded,total)},_onUploadPrep:function(id){},_onUpload:function(id,name){this._uploadData.setStatus(id,qq.status.UPLOADING)},_onUploadChunk:function(id,chunkData){},_onUploadStatusChange:function(id,oldStatus,newStatus){newStatus===qq.status.PAUSED&&clearTimeout(this._retryTimeouts[id])},_onValidateBatchCallbackFailure:function(fileWrappers){var self=this;qq.each(fileWrappers,function(idx,fileWrapper){self._fileOrBlobRejected(fileWrapper.id)})},_onValidateBatchCallbackSuccess:function(validationDescriptors,items,params,endpoint,button){var errorMessage,itemLimit=this._currentItemLimit,proposedNetFilesUploadedOrQueued=this._netUploadedOrQueued;0===itemLimit||itemLimit>=proposedNetFilesUploadedOrQueued?items.length>0?this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,validationDescriptors[0],button),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,items,0,params,endpoint),onFailure:qq.bind(this._onValidateCallbackFailure,this,items,0,params,endpoint),identifier:"Item '"+items[0].file.name+"', size: "+items[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(items),errorMessage=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,proposedNetFilesUploadedOrQueued).replace(/\{itemLimit\}/g,itemLimit),this._batchError(errorMessage))},_onValidateCallbackFailure:function(items,index,params,endpoint){var nextIndex=index+1;this._fileOrBlobRejected(items[index].id,items[index].file.name),this._maybeProcessNextItemAfterOnValidateCallback(!1,items,nextIndex,params,endpoint)},_onValidateCallbackSuccess:function(items,index,params,endpoint){var self=this,nextIndex=index+1,validationDescriptor=this._getValidationDescriptor(items[index]);this._validateFileOrBlobData(items[index],validationDescriptor).then(function(){self._upload(items[index].id,params,endpoint),self._maybeProcessNextItemAfterOnValidateCallback(!0,items,nextIndex,params,endpoint)},function(){self._maybeProcessNextItemAfterOnValidateCallback(!1,items,nextIndex,params,endpoint)})},_prepareItemsForUpload:function(items,params,endpoint){if(0===items.length)return void this._itemError("noFilesError");var validationDescriptors=this._getValidationDescriptors(items),buttonId=this._getButtonId(items[0].file),button=this._getButton(buttonId);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,validationDescriptors,button),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,validationDescriptors,items,params,endpoint,button),onFailure:qq.bind(this._onValidateBatchCallbackFailure,this,items),identifier:"batch validation"})},_preventLeaveInProgress:function(){var self=this;this._disposeSupport.attach(window,"beforeunload",function(e){return self.getInProgress()?(e=e||window.event,e.returnValue=self._options.messages.onLeave,self._options.messages.onLeave):void 0})},_refreshSessionData:function(){var self=this,options=this._options.session;qq.Session&&null!=this._options.session.endpoint&&(this._session||(qq.extend(options,{cors:this._options.cors}),options.log=qq.bind(this.log,this),options.addFileRecord=qq.bind(this._addCannedFile,this),this._session=new qq.Session(options)),setTimeout(function(){self._session.refresh().then(function(response,xhrOrXdr){self._sessionRequestComplete(),self._options.callbacks.onSessionRequestComplete(response,!0,xhrOrXdr)},function(response,xhrOrXdr){self._options.callbacks.onSessionRequestComplete(response,!1,xhrOrXdr)})},0))},_sessionRequestComplete:function(){},_setSize:function(id,newSize){this._uploadData.updateSize(id,newSize),this._totalProgress&&this._totalProgress.onNewSize(id)},_shouldAutoRetry:function(id,name,responseJSON){var uploadData=this._uploadData.retrieve({id:id});return!this._preventRetries[id]&&this._options.retry.enableAuto&&uploadData.status!==qq.status.PAUSED&&(void 0===this._autoRetries[id]&&(this._autoRetries[id]=0),this._autoRetries[id]<this._options.retry.maxAutoAttempts)?(this._autoRetries[id]+=1,!0):!1},_storeForLater:function(id){this._storedIds.push(id)},_trackButton:function(id){var buttonId;buttonId=qq.supportedFeatures.ajaxUploading?this._handler.getFile(id).qqButtonId:this._getButtonId(this._handler.getInput(id)),buttonId&&(this._buttonIdsForFileIds[id]=buttonId)},_updateFormSupportAndParams:function(formElementOrId){this._options.form.element=formElementOrId,this._formSupport=qq.FormSupport&&new qq.FormSupport(this._options.form,qq.bind(this.uploadStoredFiles,this),qq.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm&&(this._paramsStore.addReadOnly(null,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&this.setEndpoint(this._formSupport.newEndpoint))},_upload:function(id,params,endpoint){var name=this.getName(id);params&&this.setParams(params,id),endpoint&&this.setEndpoint(endpoint,id),this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,id,name),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,id,name),onFailure:qq.bind(this._fileOrBlobRejected,this,id,name),identifier:id})},_uploadFile:function(id){this._handler.upload(id)||this._uploadData.setStatus(id,qq.status.QUEUED)},_uploadStoredFiles:function(){for(var idToUpload,stillSubmitting,self=this;this._storedIds.length;)idToUpload=this._storedIds.shift(),this._uploadFile(idToUpload);stillSubmitting=this.getUploads({status:qq.status.SUBMITTING}).length,stillSubmitting&&(qq.log("Still waiting for "+stillSubmitting+" files to clear submit queue. Will re-parse stored IDs array shortly."),setTimeout(function(){self._uploadStoredFiles()},1e3))},_validateFileOrBlobData:function(fileWrapper,validationDescriptor){var self=this,file=function(){return fileWrapper.file instanceof qq.BlobProxy?fileWrapper.file.referenceBlob:fileWrapper.file}(),name=validationDescriptor.name,size=validationDescriptor.size,buttonId=this._getButtonId(fileWrapper.file),validationBase=this._getValidationBase(buttonId),validityChecker=new qq.Promise;return validityChecker.then(function(){},function(){self._fileOrBlobRejected(fileWrapper.id,name)}),qq.isFileOrInput(file)&&!this._isAllowedExtension(validationBase.allowedExtensions,name)?(this._itemError("typeError",name,file),validityChecker.failure()):this._options.validation.allowEmpty||0!==size?size>0&&validationBase.sizeLimit&&size>validationBase.sizeLimit?(this._itemError("sizeError",name,file),validityChecker.failure()):size>0&&size<validationBase.minSizeLimit?(this._itemError("minSizeError",name,file),validityChecker.failure()):(qq.ImageValidation&&qq.supportedFeatures.imagePreviews&&qq.isFile(file)?new qq.ImageValidation(file,qq.bind(self.log,self)).validate(validationBase.image).then(validityChecker.success,function(errorCode){self._itemError(errorCode+"ImageError",name,file),validityChecker.failure()}):validityChecker.success(),validityChecker):(this._itemError("emptyError",name,file),validityChecker.failure())},_wrapCallbacks:function(){var self,safeCallback,prop;self=this,safeCallback=function(name,callback,args){var errorMsg;try{return callback.apply(self,args)}catch(exception){errorMsg=exception.message||exception.toString(),self.log("Caught exception in '"+name+"' callback - "+errorMsg,"error")}};for(prop in this._options.callbacks)!function(){var callbackName,callbackFunc;callbackName=prop,callbackFunc=self._options.callbacks[callbackName],self._options.callbacks[callbackName]=function(){return safeCallback(callbackName,callbackFunc,arguments)}}()}}}(),function(){"use strict";qq.FineUploaderBasic=function(o){var self=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{customHeaders:{},endpoint:"/server/upload",filenameParam:"qqfilename",forceMultipart:!0,inputName:"qqfile",method:"POST",params:{},paramsInBody:!0,totalFileSizeName:"qqtotalfilesize",uuidName:"qquuid"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0},allowEmpty:!1},callbacks:{onSubmit:function(id,name){},onSubmitted:function(id,name){},onComplete:function(id,name,responseJSON,maybeXhr){},onAllComplete:function(successful,failed){},onCancel:function(id,name){},onUpload:function(id,name){},onUploadChunk:function(id,name,chunkData){},onUploadChunkSuccess:function(id,chunkData,responseJSON,xhr){},onResume:function(id,fileName,chunkData){},onProgress:function(id,name,loaded,total){},onTotalProgress:function(loaded,total){},onError:function(id,name,reason,maybeXhrOrXdr){},onAutoRetry:function(id,name,attemptNumber){},onManualRetry:function(id,name){},onValidateBatch:function(fileOrBlobData){},onValidate:function(fileOrBlobData){},onSubmitDelete:function(id){},onDelete:function(id){},onDeleteComplete:function(id,xhrOrXdr,isError){},onPasteReceived:function(blob){},onStatusChange:function(id,oldStatus,newStatus){},onSessionRequestComplete:function(response,success,xhrOrXdr){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},mandatory:!1,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:2e6,success:{endpoint:null}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(fileOrBlobName){return fileOrBlobName},text:{defaultResponseError:"Upload failure reason unknown",fileInputTitle:"file input",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{customResizer:null,sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]},workarounds:{iosEmptyVideos:!0,ios8SafariUploads:!0,ios8BrowserCrash:!1}},qq.extend(this._options,o,!0),this._buttons=[],this._extraButtonSpecs={},this._buttonIdsForFileIds=[],this._wrapCallbacks(),this._disposeSupport=new qq.DisposeSupport,this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._initFormSupportAndParams(),this._customHeadersStore=this._createStore(this._options.request.customHeaders),this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders),this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params),this._endpointStore=this._createStore(this._options.request.endpoint),this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint),this._handler=this._createUploadHandler(),this._deleteHandler=qq.DeleteFileAjaxRequester&&this._createDeleteHandler(),this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button,title:this._options.text.fileInputTitle}).getButtonId()),this._generateExtraButtonSpecs(),this._handleCameraAccess(),this._options.paste.targetElement&&(qq.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error")),this._preventLeaveInProgress(),this._imageGenerator=qq.ImageGenerator&&new qq.ImageGenerator(qq.bind(this.log,this)),this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._scaler=qq.Scaler&&new qq.Scaler(this._options.scaling,qq.bind(this.log,this))||{},this._scaler.enabled&&(this._customNewFileHandler=qq.bind(this._scaler.handleNewFile,this._scaler)),qq.TotalProgress&&qq.supportedFeatures.progressBar&&(this._totalProgress=new qq.TotalProgress(qq.bind(this._onTotalProgress,this),function(id){var entry=self._uploadData.retrieve({id:id});return entry&&entry.size||0})),this._currentItemLimit=this._options.validation.itemLimit},qq.FineUploaderBasic.prototype=qq.basePublicApi,qq.extend(qq.FineUploaderBasic.prototype,qq.basePrivateApi)}(),qq.AjaxRequester=function(o){"use strict";function isSimpleMethod(){return qq.indexOf(["GET","POST","HEAD"],options.method)>=0}function containsNonSimpleHeaders(headers){var containsNonSimple=!1;return qq.each(containsNonSimple,function(idx,header){return qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],header)<0?(containsNonSimple=!0,!1):void 0}),containsNonSimple}function isXdr(xhr){return options.cors.expected&&void 0===xhr.withCredentials}function getCorsAjaxTransport(){var xhrOrXdr;return(window.XMLHttpRequest||window.ActiveXObject)&&(xhrOrXdr=qq.createXhrInstance(),void 0===xhrOrXdr.withCredentials&&(xhrOrXdr=new XDomainRequest,xhrOrXdr.onload=function(){},xhrOrXdr.onerror=function(){},xhrOrXdr.ontimeout=function(){},xhrOrXdr.onprogress=function(){})),xhrOrXdr}function getXhrOrXdr(id,suppliedXhr){var xhrOrXdr=requestData[id].xhr;return xhrOrXdr||(xhrOrXdr=suppliedXhr?suppliedXhr:options.cors.expected?getCorsAjaxTransport():qq.createXhrInstance(),requestData[id].xhr=xhrOrXdr),xhrOrXdr}function dequeue(id){var nextId,i=qq.indexOf(queue,id),max=options.maxConnections;delete requestData[id],queue.splice(i,1),queue.length>=max&&max>i&&(nextId=queue[max-1],sendRequest(nextId))}function onComplete(id,xdrError){var xhr=getXhrOrXdr(id),method=options.method,isError=xdrError===!0;dequeue(id),isError?log(method+" request for "+id+" has failed","error"):isXdr(xhr)||isResponseSuccessful(xhr.status)||(isError=!0,log(method+" request for "+id+" has failed - response code "+xhr.status,"error")),options.onComplete(id,xhr,isError)}function getParams(id){var params,onDemandParams=requestData[id].additionalParams,mandatedParams=options.mandatedParams;return options.paramsStore.get&&(params=options.paramsStore.get(id)),onDemandParams&&qq.each(onDemandParams,function(name,val){params=params||{},params[name]=val}),mandatedParams&&qq.each(mandatedParams,function(name,val){params=params||{},params[name]=val}),params}function sendRequest(id,optXhr){var url,xhr=getXhrOrXdr(id,optXhr),method=options.method,params=getParams(id),payload=requestData[id].payload;return options.onSend(id),url=createUrl(id,params,requestData[id].additionalQueryParams),isXdr(xhr)?(xhr.onload=getXdrLoadHandler(id),xhr.onerror=getXdrErrorHandler(id)):xhr.onreadystatechange=getXhrReadyStateChangeHandler(id),registerForUploadProgress(id),xhr.open(method,url,!0),options.cors.expected&&options.cors.sendCredentials&&!isXdr(xhr)&&(xhr.withCredentials=!0),setHeaders(id),log("Sending "+method+" request for "+id),payload?xhr.send(payload):shouldParamsBeInQueryString||!params?xhr.send():params&&options.contentType&&options.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?xhr.send(qq.obj2url(params,"")):params&&options.contentType&&options.contentType.toLowerCase().indexOf("application/json")>=0?xhr.send(JSON.stringify(params)):xhr.send(params),
xhr}function createUrl(id,params,additionalQueryParams){var endpoint=options.endpointStore.get(id),addToPath=requestData[id].addToPath;return void 0!=addToPath&&(endpoint+="/"+addToPath),shouldParamsBeInQueryString&&params&&(endpoint=qq.obj2url(params,endpoint)),additionalQueryParams&&(endpoint=qq.obj2url(additionalQueryParams,endpoint)),endpoint}function getXhrReadyStateChangeHandler(id){return function(){4===getXhrOrXdr(id).readyState&&onComplete(id)}}function registerForUploadProgress(id){var onProgress=options.onProgress;onProgress&&(getXhrOrXdr(id).upload.onprogress=function(e){e.lengthComputable&&onProgress(id,e.loaded,e.total)})}function getXdrLoadHandler(id){return function(){onComplete(id)}}function getXdrErrorHandler(id){return function(){onComplete(id,!0)}}function setHeaders(id){var xhr=getXhrOrXdr(id),customHeaders=options.customHeaders,onDemandHeaders=requestData[id].additionalHeaders||{},method=options.method,allHeaders={};isXdr(xhr)||(options.acceptHeader&&xhr.setRequestHeader("Accept",options.acceptHeader),options.allowXRequestedWithAndCacheControl&&(options.cors.expected&&isSimpleMethod()&&!containsNonSimpleHeaders(customHeaders)||(xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("Cache-Control","no-cache"))),!options.contentType||"POST"!==method&&"PUT"!==method||xhr.setRequestHeader("Content-Type",options.contentType),qq.extend(allHeaders,qq.isFunction(customHeaders)?customHeaders(id):customHeaders),qq.extend(allHeaders,onDemandHeaders),qq.each(allHeaders,function(name,val){xhr.setRequestHeader(name,val)}))}function isResponseSuccessful(responseCode){return qq.indexOf(options.successfulResponseCodes[options.method],responseCode)>=0}function prepareToSend(id,optXhr,addToPath,additionalParams,additionalQueryParams,additionalHeaders,payload){requestData[id]={addToPath:addToPath,additionalParams:additionalParams,additionalQueryParams:additionalQueryParams,additionalHeaders:additionalHeaders,payload:payload};var len=queue.push(id);return len<=options.maxConnections?sendRequest(id,optXhr):void 0}var log,shouldParamsBeInQueryString,queue=[],requestData={},options={acceptHeader:null,validMethods:["PATCH","POST","PUT"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],PATCH:[200,201,202,203,204],POST:[200,201,202,203,204],PUT:[200,201,202,203,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(str,level){},onSend:function(id){},onComplete:function(id,xhrOrXdr,isError){},onProgress:null};if(qq.extend(options,o),log=options.log,qq.indexOf(options.validMethods,options.method)<0)throw new Error("'"+options.method+"' is not a supported method for this type of request!");shouldParamsBeInQueryString="GET"===options.method||"DELETE"===options.method,qq.extend(this,{initTransport:function(id){var path,params,headers,payload,cacheBuster,additionalQueryParams;return{withPath:function(appendToPath){return path=appendToPath,this},withParams:function(additionalParams){return params=additionalParams,this},withQueryParams:function(_additionalQueryParams_){return additionalQueryParams=_additionalQueryParams_,this},withHeaders:function(additionalHeaders){return headers=additionalHeaders,this},withPayload:function(thePayload){return payload=thePayload,this},withCacheBuster:function(){return cacheBuster=!0,this},send:function(optXhr){return cacheBuster&&qq.indexOf(["GET","DELETE"],options.method)>=0&&(params.qqtimestamp=(new Date).getTime()),prepareToSend(id,optXhr,path,params,additionalQueryParams,headers,payload)}}},canceled:function(id){dequeue(id)}})},qq.UploadHandler=function(spec){"use strict";var proxy=spec.proxy,fileState={},onCancel=proxy.onCancel,getName=proxy.getName;qq.extend(this,{add:function(id,fileItem){fileState[id]=fileItem,fileState[id].temp={}},cancel:function(id){var self=this,cancelFinalizationEffort=new qq.Promise,onCancelRetVal=onCancel(id,getName(id),cancelFinalizationEffort);onCancelRetVal.then(function(){self.isValid(id)&&(fileState[id].canceled=!0,self.expunge(id)),cancelFinalizationEffort.success()})},expunge:function(id){delete fileState[id]},getThirdPartyFileId:function(id){return fileState[id].key},isValid:function(id){return void 0!==fileState[id]},reset:function(){fileState={}},_getFileState:function(id){return fileState[id]},_setThirdPartyFileId:function(id,thirdPartyFileId){fileState[id].key=thirdPartyFileId},_wasCanceled:function(id){return!!fileState[id].canceled}})},qq.UploadHandlerController=function(o,namespace){"use strict";var preventRetryResponse,log,handler,controller=this,chunkingPossible=!1,concurrentChunkingPossible=!1,options={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(str,level){},onProgress:function(id,fileName,loaded,total){},onComplete:function(id,fileName,response,xhr){},onCancel:function(id,fileName){},onUploadPrep:function(id){},onUpload:function(id,fileName){},onUploadChunk:function(id,fileName,chunkData){},onUploadChunkSuccess:function(id,chunkData,response,xhr){},onAutoRetry:function(id,fileName,response,xhr){},onResume:function(id,fileName,chunkData){},onUuidChanged:function(id,newUuid){},getName:function(id){},setSize:function(id,newSize){},isQueued:function(id){},getIdsInProxyGroup:function(id){},getIdsInBatch:function(id){}},chunked={done:function(id,chunkIdx,response,xhr){var chunkData=handler._getChunkData(id,chunkIdx);handler._getFileState(id).attemptingResume=!1,delete handler._getFileState(id).temp.chunkProgress[chunkIdx],handler._getFileState(id).loaded+=chunkData.size,options.onUploadChunkSuccess(id,handler._getChunkDataForCallback(chunkData),response,xhr)},finalize:function(id){var size=options.getSize(id),name=options.getName(id);log("All chunks have been uploaded for "+id+" - finalizing...."),handler.finalizeChunks(id).then(function(response,xhr){log("Finalize successful for "+id);var normaizedResponse=upload.normalizeResponse(response,!0);options.onProgress(id,name,size,size),handler._maybeDeletePersistedChunkData(id),upload.cleanup(id,normaizedResponse,xhr)},function(response,xhr){var normaizedResponse=upload.normalizeResponse(response,!1);log("Problem finalizing chunks for file ID "+id+" - "+normaizedResponse.error,"error"),normaizedResponse.reset&&chunked.reset(id),options.onAutoRetry(id,name,normaizedResponse,xhr)||upload.cleanup(id,normaizedResponse,xhr)})},handleFailure:function(chunkIdx,id,response,xhr){var name=options.getName(id);log("Chunked upload request failed for "+id+", chunk "+chunkIdx),handler.clearCachedChunk(id,chunkIdx);var inProgressIdx,responseToReport=upload.normalizeResponse(response,!1);responseToReport.reset?chunked.reset(id):(inProgressIdx=qq.indexOf(handler._getFileState(id).chunking.inProgress,chunkIdx),inProgressIdx>=0&&(handler._getFileState(id).chunking.inProgress.splice(inProgressIdx,1),handler._getFileState(id).chunking.remaining.unshift(chunkIdx))),handler._getFileState(id).temp.ignoreFailure||(concurrentChunkingPossible&&(handler._getFileState(id).temp.ignoreFailure=!0,log(qq.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.",JSON.stringify(Object.keys(handler._getXhrs(id))),JSON.stringify(handler._getFileState(id).chunking.inProgress))),qq.each(handler._getXhrs(id),function(ckid,ckXhr){log(qq.format("Attempting to abort file {}.{}. XHR readyState {}. ",id,ckid,ckXhr.readyState)),ckXhr.abort(),ckXhr._cancelled=!0}),handler.moveInProgressToRemaining(id),connectionManager.free(id,!0)),options.onAutoRetry(id,name,responseToReport,xhr)||upload.cleanup(id,responseToReport,xhr))},hasMoreParts:function(id){return!!handler._getFileState(id).chunking.remaining.length},nextPart:function(id){var nextIdx=handler._getFileState(id).chunking.remaining.shift();return nextIdx>=handler._getTotalChunks(id)&&(nextIdx=null),nextIdx},reset:function(id){log("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+id,"error"),handler._maybeDeletePersistedChunkData(id),handler.reevaluateChunking(id),handler._getFileState(id).loaded=0},sendNext:function(id){var size=options.getSize(id),name=options.getName(id),chunkIdx=chunked.nextPart(id),chunkData=handler._getChunkData(id,chunkIdx),resuming=handler._getFileState(id).attemptingResume,inProgressChunks=handler._getFileState(id).chunking.inProgress||[];null==handler._getFileState(id).loaded&&(handler._getFileState(id).loaded=0),resuming&&options.onResume(id,name,chunkData)===!1&&(chunked.reset(id),chunkIdx=chunked.nextPart(id),chunkData=handler._getChunkData(id,chunkIdx),resuming=!1),null==chunkIdx&&0===inProgressChunks.length?chunked.finalize(id):(log(qq.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.",id,chunkIdx,chunkData.start+1,chunkData.end,size)),options.onUploadChunk(id,name,handler._getChunkDataForCallback(chunkData)),inProgressChunks.push(chunkIdx),handler._getFileState(id).chunking.inProgress=inProgressChunks,concurrentChunkingPossible&&connectionManager.open(id,chunkIdx),concurrentChunkingPossible&&connectionManager.available()&&handler._getFileState(id).chunking.remaining.length&&chunked.sendNext(id),0===chunkData.blob.size?(log(qq.format("Chunk {} for file {} will not be uploaded, zero sized chunk.",chunkIdx,id),"error"),chunked.handleFailure(chunkIdx,id,"File is no longer available",null)):handler.uploadChunk(id,chunkIdx,resuming).then(function(response,xhr){log("Chunked upload request succeeded for "+id+", chunk "+chunkIdx),handler.clearCachedChunk(id,chunkIdx);var inProgressChunks=handler._getFileState(id).chunking.inProgress||[],responseToReport=upload.normalizeResponse(response,!0),inProgressChunkIdx=qq.indexOf(inProgressChunks,chunkIdx);log(qq.format("Chunk {} for file {} uploaded successfully.",chunkIdx,id)),chunked.done(id,chunkIdx,responseToReport,xhr),inProgressChunkIdx>=0&&inProgressChunks.splice(inProgressChunkIdx,1),handler._maybePersistChunkedState(id),chunked.hasMoreParts(id)||0!==inProgressChunks.length?chunked.hasMoreParts(id)?chunked.sendNext(id):log(qq.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}",id,JSON.stringify(inProgressChunks))):chunked.finalize(id)},function(response,xhr){chunked.handleFailure(chunkIdx,id,response,xhr)}).done(function(){handler.clearXhr(id,chunkIdx)}))}},connectionManager={_open:[],_openChunks:{},_waiting:[],available:function(){var max=options.maxConnections,openChunkEntriesCount=0,openChunksCount=0;return qq.each(connectionManager._openChunks,function(fileId,openChunkIndexes){openChunkEntriesCount++,openChunksCount+=openChunkIndexes.length}),max-(connectionManager._open.length-openChunkEntriesCount+openChunksCount)},free:function(id,dontAllowNext){var nextId,allowNext=!dontAllowNext,waitingIndex=qq.indexOf(connectionManager._waiting,id),connectionsIndex=qq.indexOf(connectionManager._open,id);delete connectionManager._openChunks[id],upload.getProxyOrBlob(id)instanceof qq.BlobProxy&&(log("Generated blob upload has ended for "+id+", disposing generated blob."),delete handler._getFileState(id).file),waitingIndex>=0?connectionManager._waiting.splice(waitingIndex,1):allowNext&&connectionsIndex>=0&&(connectionManager._open.splice(connectionsIndex,1),nextId=connectionManager._waiting.shift(),nextId>=0&&(connectionManager._open.push(nextId),upload.start(nextId)))},getWaitingOrConnected:function(){var waitingOrConnected=[];return qq.each(connectionManager._openChunks,function(fileId,chunks){chunks&&chunks.length&&waitingOrConnected.push(parseInt(fileId))}),qq.each(connectionManager._open,function(idx,fileId){connectionManager._openChunks[fileId]||waitingOrConnected.push(parseInt(fileId))}),waitingOrConnected=waitingOrConnected.concat(connectionManager._waiting)},isUsingConnection:function(id){return qq.indexOf(connectionManager._open,id)>=0},open:function(id,chunkIdx){return null==chunkIdx&&connectionManager._waiting.push(id),connectionManager.available()?(null==chunkIdx?(connectionManager._waiting.pop(),connectionManager._open.push(id)):!function(){var openChunksEntry=connectionManager._openChunks[id]||[];openChunksEntry.push(chunkIdx),connectionManager._openChunks[id]=openChunksEntry}(),!0):!1},reset:function(){connectionManager._waiting=[],connectionManager._open=[]}},simple={send:function(id,name){handler._getFileState(id).loaded=0,log("Sending simple upload request for "+id),handler.uploadFile(id).then(function(response,optXhr){log("Simple upload request succeeded for "+id);var responseToReport=upload.normalizeResponse(response,!0),size=options.getSize(id);options.onProgress(id,name,size,size),upload.maybeNewUuid(id,responseToReport),upload.cleanup(id,responseToReport,optXhr)},function(response,optXhr){log("Simple upload request failed for "+id);var responseToReport=upload.normalizeResponse(response,!1);options.onAutoRetry(id,name,responseToReport,optXhr)||upload.cleanup(id,responseToReport,optXhr)})}},upload={cancel:function(id){log("Cancelling "+id),options.paramsStore.remove(id),connectionManager.free(id)},cleanup:function(id,response,optXhr){var name=options.getName(id);options.onComplete(id,name,response,optXhr),handler._getFileState(id)&&handler._clearXhrs&&handler._clearXhrs(id),connectionManager.free(id)},getProxyOrBlob:function(id){return handler.getProxy&&handler.getProxy(id)||handler.getFile&&handler.getFile(id)},initHandler:function(){var handlerType=namespace?qq[namespace]:qq.traditional,handlerModuleSubtype=qq.supportedFeatures.ajaxUploading?"Xhr":"Form";handler=new handlerType[handlerModuleSubtype+"UploadHandler"](options,{getDataByUuid:options.getDataByUuid,getName:options.getName,getSize:options.getSize,getUuid:options.getUuid,log:log,onCancel:options.onCancel,onProgress:options.onProgress,onUuidChanged:options.onUuidChanged}),handler._removeExpiredChunkingRecords&&handler._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(id){return options.isQueued(id)},maybeDefer:function(id,blob){return blob&&!handler.getFile(id)&&blob instanceof qq.BlobProxy?(options.onUploadPrep(id),log("Attempting to generate a blob on-demand for "+id),blob.create().then(function(generatedBlob){log("Generated an on-demand blob for "+id),handler.updateBlob(id,generatedBlob),options.setSize(id,generatedBlob.size),handler.reevaluateChunking(id),upload.maybeSendDeferredFiles(id)},function(errorMessage){var errorResponse={};errorMessage&&(errorResponse.error=errorMessage),log(qq.format("Failed to generate blob for ID {}.  Error message: {}.",id,errorMessage),"error"),options.onComplete(id,options.getName(id),qq.extend(errorResponse,preventRetryResponse),null),upload.maybeSendDeferredFiles(id),connectionManager.free(id)}),!1):upload.maybeSendDeferredFiles(id)},maybeSendDeferredFiles:function(id){var idsInGroup=options.getIdsInProxyGroup(id),uploadedThisId=!1;return idsInGroup&&idsInGroup.length?(log("Maybe ready to upload proxy group file "+id),qq.each(idsInGroup,function(idx,idInGroup){if(upload.isDeferredEligibleForUpload(idInGroup)&&handler.getFile(idInGroup))uploadedThisId=idInGroup===id,upload.now(idInGroup);else if(upload.isDeferredEligibleForUpload(idInGroup))return!1})):(uploadedThisId=!0,upload.now(id)),uploadedThisId},maybeNewUuid:function(id,response){void 0!==response.newUuid&&options.onUuidChanged(id,response.newUuid)},normalizeResponse:function(originalResponse,successful){var response=originalResponse;return qq.isObject(originalResponse)||(response={},qq.isString(originalResponse)&&!successful&&(response.error=originalResponse)),response.success=successful,response},now:function(id){var name=options.getName(id);if(!controller.isValid(id))throw new qq.Error(id+" is not a valid file ID to upload!");options.onUpload(id,name),chunkingPossible&&handler._shouldChunkThisFile(id)?chunked.sendNext(id):simple.send(id,name)},start:function(id){var blobToUpload=upload.getProxyOrBlob(id);return blobToUpload?upload.maybeDefer(id,blobToUpload):(upload.now(id),!0)}};qq.extend(this,{add:function(id,file){handler.add.apply(this,arguments)},upload:function(id){return connectionManager.open(id)?upload.start(id):!1},retry:function(id){return concurrentChunkingPossible&&(handler._getFileState(id).temp.ignoreFailure=!1),connectionManager.isUsingConnection(id)?upload.start(id):controller.upload(id)},cancel:function(id){var cancelRetVal=handler.cancel(id);qq.isGenericPromise(cancelRetVal)?cancelRetVal.then(function(){upload.cancel(id)}):cancelRetVal!==!1&&upload.cancel(id)},cancelAll:function(){var i,waitingOrConnected=connectionManager.getWaitingOrConnected();if(waitingOrConnected.length)for(i=waitingOrConnected.length-1;i>=0;i--)controller.cancel(waitingOrConnected[i]);connectionManager.reset()},getFile:function(id){return handler.getProxy&&handler.getProxy(id)?handler.getProxy(id).referenceBlob:handler.getFile&&handler.getFile(id)},isProxied:function(id){return!(!handler.getProxy||!handler.getProxy(id))},getInput:function(id){return handler.getInput?handler.getInput(id):void 0},reset:function(){log("Resetting upload handler"),controller.cancelAll(),connectionManager.reset(),handler.reset()},expunge:function(id){return controller.isValid(id)?handler.expunge(id):void 0},isValid:function(id){return handler.isValid(id)},getResumableFilesData:function(){return handler.getResumableFilesData?handler.getResumableFilesData():[]},getThirdPartyFileId:function(id){return controller.isValid(id)?handler.getThirdPartyFileId(id):void 0},pause:function(id){return controller.isResumable(id)&&handler.pause&&controller.isValid(id)&&handler.pause(id)?(connectionManager.free(id),handler.moveInProgressToRemaining(id),!0):!1},isResumable:function(id){return!!handler.isResumable&&handler.isResumable(id)}}),qq.extend(options,o),log=options.log,chunkingPossible=options.chunking.enabled&&qq.supportedFeatures.chunking,concurrentChunkingPossible=chunkingPossible&&options.chunking.concurrent.enabled,preventRetryResponse=function(){var response={};return response[options.preventRetryParam]=!0,response}(),upload.initHandler()},qq.WindowReceiveMessage=function(o){"use strict";var options={log:function(message,level){}},callbackWrapperDetachers={};qq.extend(options,o),qq.extend(this,{receiveMessage:function(id,callback){var onMessageCallbackWrapper=function(event){callback(event.data)};window.postMessage?callbackWrapperDetachers[id]=qq(window).attach("message",onMessageCallbackWrapper):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(id){if(window.postMessage){var detacher=callbackWrapperDetachers[id];detacher&&detacher()}}})},qq.FormUploadHandler=function(spec){"use strict";function expungeFile(id){delete detachLoadEvents[id],isCors&&(clearTimeout(postMessageCallbackTimers[id]),delete postMessageCallbackTimers[id],corsMessageReceiver.stopReceivingMessages(id));var iframe=document.getElementById(handler._getIframeName(id));iframe&&(iframe.setAttribute("src","javascript:false;"),qq(iframe).remove())}function getFileIdForIframeName(iframeName){return iframeName.split("_")[0]}function initIframeForUpload(name){var iframe=qq.toElement("<iframe src='javascript:false;' name='"+name+"' />");return iframe.setAttribute("id",name),iframe.style.display="none",document.body.appendChild(iframe),iframe}function registerPostMessageCallback(iframe,callback){var iframeName=iframe.id,fileId=getFileIdForIframeName(iframeName),uuid=getUuid(fileId);onloadCallbacks[uuid]=callback,detachLoadEvents[fileId]=qq(iframe).attach("load",function(){handler.getInput(fileId)&&(log("Received iframe load event for CORS upload request (iframe name "+iframeName+")"),postMessageCallbackTimers[iframeName]=setTimeout(function(){var errorMessage="No valid message received from loaded iframe for iframe name "+iframeName;log(errorMessage,"error"),callback({error:errorMessage})},1e3))}),corsMessageReceiver.receiveMessage(iframeName,function(message){log("Received the following window message: '"+message+"'");var onloadCallback,response=(getFileIdForIframeName(iframeName),handler._parseJsonResponse(message)),uuid=response.uuid;uuid&&onloadCallbacks[uuid]?(log("Handling response for iframe name "+iframeName),clearTimeout(postMessageCallbackTimers[iframeName]),delete postMessageCallbackTimers[iframeName],handler._detachLoadEvent(iframeName),onloadCallback=onloadCallbacks[uuid],delete onloadCallbacks[uuid],corsMessageReceiver.stopReceivingMessages(iframeName),onloadCallback(response)):uuid||log("'"+message+"' does not contain a UUID - ignoring.")})}var options=spec.options,handler=this,proxy=spec.proxy,formHandlerInstanceId=qq.getUniqueId(),onloadCallbacks={},detachLoadEvents={},postMessageCallbackTimers={},isCors=options.isCors,inputName=options.inputName,getUuid=proxy.getUuid,log=proxy.log,corsMessageReceiver=new qq.WindowReceiveMessage({log:log});qq.extend(this,new qq.UploadHandler(spec)),qq.override(this,function(super_){return{add:function(id,fileInput){super_.add(id,{input:fileInput}),fileInput.setAttribute("name",inputName),fileInput.parentNode&&qq(fileInput).remove()},expunge:function(id){expungeFile(id),super_.expunge(id)},isValid:function(id){return super_.isValid(id)&&void 0!==handler._getFileState(id).input}}}),qq.extend(this,{getInput:function(id){return handler._getFileState(id).input},_attachLoadEvent:function(iframe,callback){var responseDescriptor;isCors?registerPostMessageCallback(iframe,callback):detachLoadEvents[iframe.id]=qq(iframe).attach("load",function(){if(log("Received response for "+iframe.id),iframe.parentNode){try{if(iframe.contentDocument&&iframe.contentDocument.body&&"false"==iframe.contentDocument.body.innerHTML)return}catch(error){log("Error when attempting to access iframe during handling of upload response ("+error.message+")","error"),responseDescriptor={success:!1}}callback(responseDescriptor)}})},_createIframe:function(id){var iframeName=handler._getIframeName(id);return initIframeForUpload(iframeName)},_detachLoadEvent:function(id){void 0!==detachLoadEvents[id]&&(detachLoadEvents[id](),delete detachLoadEvents[id])},_getIframeName:function(fileId){return fileId+"_"+formHandlerInstanceId},_initFormForUpload:function(spec){var method=spec.method,endpoint=spec.endpoint,params=spec.params,paramsInBody=spec.paramsInBody,targetName=spec.targetName,form=qq.toElement("<form method='"+method+"' enctype='multipart/form-data'></form>"),url=endpoint;return paramsInBody?qq.obj2Inputs(params,form):url=qq.obj2url(params,endpoint),form.setAttribute("action",url),form.setAttribute("target",targetName),form.style.display="none",document.body.appendChild(form),form},_parseJsonResponse:function(innerHtmlOrMessage){var response={};try{response=qq.parseJson(innerHtmlOrMessage)}catch(error){log("Error when attempting to parse iframe upload response ("+error.message+")","error")}return response}})},qq.XhrUploadHandler=function(spec){"use strict";function abort(id){qq.each(handler._getXhrs(id),function(xhrId,xhr){var ajaxRequester=handler._getAjaxRequester(id,xhrId);xhr.onreadystatechange=null,xhr.upload.onprogress=null,xhr.abort(),ajaxRequester&&ajaxRequester.canceled&&ajaxRequester.canceled(id)})}var handler=this,namespace=spec.options.namespace,proxy=spec.proxy,chunking=spec.options.chunking,resume=spec.options.resume,chunkFiles=chunking&&spec.options.chunking.enabled&&qq.supportedFeatures.chunking,resumeEnabled=resume&&spec.options.resume.enabled&&chunkFiles&&qq.supportedFeatures.resume,getName=proxy.getName,getSize=proxy.getSize,getUuid=proxy.getUuid,getEndpoint=proxy.getEndpoint,getDataByUuid=proxy.getDataByUuid,onUuidChanged=proxy.onUuidChanged,onProgress=proxy.onProgress,log=proxy.log;qq.extend(this,new qq.UploadHandler(spec)),qq.override(this,function(super_){return{add:function(id,blobOrProxy){if(qq.isFile(blobOrProxy)||qq.isBlob(blobOrProxy))super_.add(id,{file:blobOrProxy});else{if(!(blobOrProxy instanceof qq.BlobProxy))throw new Error("Passed obj is not a File, Blob, or proxy");super_.add(id,{proxy:blobOrProxy})}handler._initTempState(id),resumeEnabled&&handler._maybePrepareForResume(id)},expunge:function(id){abort(id),handler._maybeDeletePersistedChunkData(id),handler._clearXhrs(id),super_.expunge(id)}}}),qq.extend(this,{clearCachedChunk:function(id,chunkIdx){delete handler._getFileState(id).temp.cachedChunks[chunkIdx]},clearXhr:function(id,chunkIdx){var tempState=handler._getFileState(id).temp;tempState.xhrs&&delete tempState.xhrs[chunkIdx],tempState.ajaxRequesters&&delete tempState.ajaxRequesters[chunkIdx]},finalizeChunks:function(id,responseParser){var lastChunkIdx=handler._getTotalChunks(id)-1,xhr=handler._getXhr(id,lastChunkIdx);return responseParser?(new qq.Promise).success(responseParser(xhr),xhr):(new qq.Promise).success({},xhr)},getFile:function(id){return handler.isValid(id)&&handler._getFileState(id).file},getProxy:function(id){return handler.isValid(id)&&handler._getFileState(id).proxy},getResumableFilesData:function(){var resumableFilesData=[];return handler._iterateResumeRecords(function(key,uploadData){handler.moveInProgressToRemaining(null,uploadData.chunking.inProgress,uploadData.chunking.remaining);var data={name:uploadData.name,remaining:uploadData.chunking.remaining,size:uploadData.size,uuid:uploadData.uuid};uploadData.key&&(data.key=uploadData.key),resumableFilesData.push(data)}),resumableFilesData},isResumable:function(id){return!!chunking&&handler.isValid(id)&&!handler._getFileState(id).notResumable},moveInProgressToRemaining:function(id,optInProgress,optRemaining){var inProgress=optInProgress||handler._getFileState(id).chunking.inProgress,remaining=optRemaining||handler._getFileState(id).chunking.remaining;inProgress&&(log(qq.format("Moving these chunks from in-progress {}, to remaining.",JSON.stringify(inProgress))),inProgress.reverse(),qq.each(inProgress,function(idx,chunkIdx){remaining.unshift(chunkIdx)}),inProgress.length=0)},pause:function(id){return handler.isValid(id)?(log(qq.format("Aborting XHR upload for {} '{}' due to pause instruction.",id,getName(id))),handler._getFileState(id).paused=!0,abort(id),!0):void 0},reevaluateChunking:function(id){if(chunking&&handler.isValid(id)){var totalChunks,i,state=handler._getFileState(id);if(delete state.chunking,state.chunking={},totalChunks=handler._getTotalChunks(id),totalChunks>1||chunking.mandatory){for(state.chunking.enabled=!0,state.chunking.parts=totalChunks,state.chunking.remaining=[],i=0;totalChunks>i;i++)state.chunking.remaining.push(i);handler._initTempState(id)}else state.chunking.enabled=!1}},updateBlob:function(id,newBlob){handler.isValid(id)&&(handler._getFileState(id).file=newBlob)},_clearXhrs:function(id){var tempState=handler._getFileState(id).temp;qq.each(tempState.ajaxRequesters,function(chunkId){delete tempState.ajaxRequesters[chunkId]}),qq.each(tempState.xhrs,function(chunkId){delete tempState.xhrs[chunkId]})},_createXhr:function(id,optChunkIdx){return handler._registerXhr(id,optChunkIdx,qq.createXhrInstance())},_getAjaxRequester:function(id,optChunkIdx){var chunkIdx=null==optChunkIdx?-1:optChunkIdx;return handler._getFileState(id).temp.ajaxRequesters[chunkIdx]},_getChunkData:function(id,chunkIndex){var chunkSize=chunking.partSize,fileSize=getSize(id),fileOrBlob=handler.getFile(id),startBytes=chunkSize*chunkIndex,endBytes=startBytes+chunkSize>=fileSize?fileSize:startBytes+chunkSize,totalChunks=handler._getTotalChunks(id),cachedChunks=this._getFileState(id).temp.cachedChunks,blob=cachedChunks[chunkIndex]||qq.sliceBlob(fileOrBlob,startBytes,endBytes);return cachedChunks[chunkIndex]=blob,{part:chunkIndex,start:startBytes,end:endBytes,count:totalChunks,blob:blob,size:endBytes-startBytes}},_getChunkDataForCallback:function(chunkData){return{partIndex:chunkData.part,startByte:chunkData.start+1,endByte:chunkData.end,totalParts:chunkData.count}},_getLocalStorageId:function(id){var formatVersion="5.0",name=getName(id),size=getSize(id),chunkSize=chunking.partSize,endpoint=getEndpoint(id);return qq.format("qq{}resume{}-{}-{}-{}-{}",namespace,formatVersion,name,size,chunkSize,endpoint)},_getMimeType:function(id){return handler.getFile(id).type},_getPersistableData:function(id){return handler._getFileState(id).chunking},_getTotalChunks:function(id){if(chunking){var fileSize=getSize(id),chunkSize=chunking.partSize;return Math.ceil(fileSize/chunkSize)}},_getXhr:function(id,optChunkIdx){var chunkIdx=null==optChunkIdx?-1:optChunkIdx;return handler._getFileState(id).temp.xhrs[chunkIdx]},_getXhrs:function(id){return handler._getFileState(id).temp.xhrs},_iterateResumeRecords:function(callback){resumeEnabled&&qq.each(localStorage,function(key,item){if(0===key.indexOf(qq.format("qq{}resume",namespace))){var uploadData=JSON.parse(item);callback(key,uploadData)}})},_initTempState:function(id){handler._getFileState(id).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(id){handler._getFileState(id).notResumable=!0},_maybeDeletePersistedChunkData:function(id){var localStorageId;return resumeEnabled&&handler.isResumable(id)&&(localStorageId=handler._getLocalStorageId(id),localStorageId&&localStorage.getItem(localStorageId))?(localStorage.removeItem(localStorageId),!0):!1},_maybePrepareForResume:function(id){var localStorageId,persistedData,state=handler._getFileState(id);resumeEnabled&&void 0===state.key&&(localStorageId=handler._getLocalStorageId(id),persistedData=localStorage.getItem(localStorageId),persistedData&&(persistedData=JSON.parse(persistedData),getDataByUuid(persistedData.uuid)?handler._markNotResumable(id):(log(qq.format("Identified file with ID {} and name of {} as resumable.",id,getName(id))),onUuidChanged(id,persistedData.uuid),state.key=persistedData.key,state.chunking=persistedData.chunking,state.loaded=persistedData.loaded,state.attemptingResume=!0,handler.moveInProgressToRemaining(id))))},_maybePersistChunkedState:function(id){var localStorageId,persistedData,state=handler._getFileState(id);if(resumeEnabled&&handler.isResumable(id)){localStorageId=handler._getLocalStorageId(id),persistedData={name:getName(id),size:getSize(id),uuid:getUuid(id),key:state.key,chunking:state.chunking,loaded:state.loaded,lastUpdated:Date.now()};try{localStorage.setItem(localStorageId,JSON.stringify(persistedData))}catch(error){log(qq.format("Unable to save resume data for '{}' due to error: '{}'.",id,error.toString()),"warn")}}},_registerProgressHandler:function(id,chunkIdx,chunkSize){var xhr=handler._getXhr(id,chunkIdx),name=getName(id),progressCalculator={simple:function(loaded,total){var fileSize=getSize(id);loaded===total?onProgress(id,name,fileSize,fileSize):onProgress(id,name,loaded>=fileSize?fileSize-1:loaded,fileSize)},chunked:function(loaded,total){var chunkProgress=handler._getFileState(id).temp.chunkProgress,totalSuccessfullyLoadedForFile=handler._getFileState(id).loaded,loadedForRequest=loaded,totalForRequest=total,totalFileSize=getSize(id),estActualChunkLoaded=loadedForRequest-(totalForRequest-chunkSize),totalLoadedForFile=totalSuccessfullyLoadedForFile;chunkProgress[chunkIdx]=estActualChunkLoaded,qq.each(chunkProgress,function(chunkIdx,chunkLoaded){totalLoadedForFile+=chunkLoaded}),onProgress(id,name,totalLoadedForFile,totalFileSize)}};xhr.upload.onprogress=function(e){if(e.lengthComputable){var type=null==chunkSize?"simple":"chunked";progressCalculator[type](e.loaded,e.total)}}},_registerXhr:function(id,optChunkIdx,xhr,optAjaxRequester){var xhrsId=null==optChunkIdx?-1:optChunkIdx,tempState=handler._getFileState(id).temp;return tempState.xhrs=tempState.xhrs||{},tempState.ajaxRequesters=tempState.ajaxRequesters||{},tempState.xhrs[xhrsId]=xhr,optAjaxRequester&&(tempState.ajaxRequesters[xhrsId]=optAjaxRequester),xhr},_removeExpiredChunkingRecords:function(){var expirationDays=resume.recordsExpireIn;handler._iterateResumeRecords(function(key,uploadData){var expirationDate=new Date(uploadData.lastUpdated);expirationDate.setDate(expirationDate.getDate()+expirationDays),expirationDate.getTime()<=Date.now()&&(log("Removing expired resume record with key "+key),
localStorage.removeItem(key))})},_shouldChunkThisFile:function(id){var state=handler._getFileState(id);return state.chunking||handler.reevaluateChunking(id),state.chunking.enabled}})},qq.DeleteFileAjaxRequester=function(o){"use strict";function getMandatedParams(){return"POST"===options.method.toUpperCase()?{_method:"DELETE"}:{}}var requester,options={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(id){return{}},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(str,level){},onDelete:function(id){},onDeleteComplete:function(id,xhrOrXdr,isError){}};qq.extend(options,o),requester=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:options.method,endpointStore:options.endpointStore,paramsStore:options.paramsStore,mandatedParams:getMandatedParams(),maxConnections:options.maxConnections,customHeaders:function(id){return options.customHeaders.get(id)},log:options.log,onSend:options.onDelete,onComplete:options.onDeleteComplete,cors:options.cors})),qq.extend(this,{sendDelete:function(id,uuid,additionalMandatedParams){var additionalOptions=additionalMandatedParams||{};options.log("Submitting delete file request for "+id),"DELETE"===options.method?requester.initTransport(id).withPath(uuid).withParams(additionalOptions).send():(additionalOptions[options.uuidParamName]=uuid,requester.initTransport(id).withParams(additionalOptions).send())}})},function(){function detectSubsampling(img){var ctx,iw=img.naturalWidth,ih=img.naturalHeight,canvas=document.createElement("canvas");return iw*ih>1048576?(canvas.width=canvas.height=1,ctx=canvas.getContext("2d"),ctx.drawImage(img,-iw+1,0),0===ctx.getImageData(0,0,1,1).data[3]):!1}function detectVerticalSquash(img,iw,ih){var ctx,data,alpha,ratio,canvas=document.createElement("canvas"),sy=0,ey=ih,py=ih;for(canvas.width=1,canvas.height=ih,ctx=canvas.getContext("2d"),ctx.drawImage(img,0,0),data=ctx.getImageData(0,0,1,ih).data;py>sy;)alpha=data[4*(py-1)+3],0===alpha?ey=py:sy=py,py=ey+sy>>1;return ratio=py/ih,0===ratio?1:ratio}function renderImageToDataURL(img,blob,options,doSquash){var canvas=document.createElement("canvas"),mime=options.mime||"image/jpeg",promise=new qq.Promise;return renderImageToCanvas(img,blob,canvas,options,doSquash).then(function(){promise.success(canvas.toDataURL(mime,options.quality||.8))}),promise}function maybeCalculateDownsampledDimensions(spec){var maxPixels=5241e3;if(!qq.ios())throw new qq.Error("Downsampled dimensions can only be reliably calculated for iOS!");return spec.origHeight*spec.origWidth>maxPixels?{newHeight:Math.round(Math.sqrt(maxPixels*(spec.origHeight/spec.origWidth))),newWidth:Math.round(Math.sqrt(maxPixels*(spec.origWidth/spec.origHeight)))}:void 0}function renderImageToCanvas(img,blob,canvas,options,doSquash){var modifiedDimensions,iw=img.naturalWidth,ih=img.naturalHeight,width=options.width,height=options.height,ctx=canvas.getContext("2d"),promise=new qq.Promise;return ctx.save(),options.resize?renderImageToCanvasWithCustomResizer({blob:blob,canvas:canvas,image:img,imageHeight:ih,imageWidth:iw,orientation:options.orientation,resize:options.resize,targetHeight:height,targetWidth:width}):(qq.supportedFeatures.unlimitedScaledImageSize||(modifiedDimensions=maybeCalculateDownsampledDimensions({origWidth:width,origHeight:height}),modifiedDimensions&&(qq.log(qq.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",width,height,modifiedDimensions.newWidth,modifiedDimensions.newHeight),"warn"),width=modifiedDimensions.newWidth,height=modifiedDimensions.newHeight)),transformCoordinate(canvas,width,height,options.orientation),qq.ios()?!function(){detectSubsampling(img)&&(iw/=2,ih/=2);var tmpCtx,sx,dx,d=1024,tmpCanvas=document.createElement("canvas"),vertSquashRatio=doSquash?detectVerticalSquash(img,iw,ih):1,dw=Math.ceil(d*width/iw),dh=Math.ceil(d*height/ih/vertSquashRatio),sy=0,dy=0;for(tmpCanvas.width=tmpCanvas.height=d,tmpCtx=tmpCanvas.getContext("2d");ih>sy;){for(sx=0,dx=0;iw>sx;)tmpCtx.clearRect(0,0,d,d),tmpCtx.drawImage(img,-sx,-sy),ctx.drawImage(tmpCanvas,0,0,d,d,dx,dy,dw,dh),sx+=d,dx+=dw;sy+=d,dy+=dh}ctx.restore(),tmpCanvas=tmpCtx=null}():ctx.drawImage(img,0,0,width,height),canvas.qqImageRendered&&canvas.qqImageRendered(),promise.success(),promise)}function renderImageToCanvasWithCustomResizer(resizeInfo){var blob=resizeInfo.blob,image=resizeInfo.image,imageHeight=resizeInfo.imageHeight,imageWidth=resizeInfo.imageWidth,orientation=resizeInfo.orientation,promise=new qq.Promise,resize=resizeInfo.resize,sourceCanvas=document.createElement("canvas"),sourceCanvasContext=sourceCanvas.getContext("2d"),targetCanvas=resizeInfo.canvas,targetHeight=resizeInfo.targetHeight,targetWidth=resizeInfo.targetWidth;return transformCoordinate(sourceCanvas,imageWidth,imageHeight,orientation),targetCanvas.height=targetHeight,targetCanvas.width=targetWidth,sourceCanvasContext.drawImage(image,0,0),resize({blob:blob,height:targetHeight,image:image,sourceCanvas:sourceCanvas,targetCanvas:targetCanvas,width:targetWidth}).then(function(){targetCanvas.qqImageRendered&&targetCanvas.qqImageRendered(),promise.success()},promise.failure),promise}function transformCoordinate(canvas,width,height,orientation){switch(orientation){case 5:case 6:case 7:case 8:canvas.width=height,canvas.height=width;break;default:canvas.width=width,canvas.height=height}var ctx=canvas.getContext("2d");switch(orientation){case 2:ctx.translate(width,0),ctx.scale(-1,1);break;case 3:ctx.translate(width,height),ctx.rotate(Math.PI);break;case 4:ctx.translate(0,height),ctx.scale(1,-1);break;case 5:ctx.rotate(.5*Math.PI),ctx.scale(1,-1);break;case 6:ctx.rotate(.5*Math.PI),ctx.translate(0,-height);break;case 7:ctx.rotate(.5*Math.PI),ctx.translate(width,-height),ctx.scale(-1,1);break;case 8:ctx.rotate(-.5*Math.PI),ctx.translate(-width,0)}}function MegaPixImage(srcImage,errorCallback){var self=this;window.Blob&&srcImage instanceof Blob&&!function(){var img=new Image,URL=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!URL)throw Error("No createObjectURL function found to create blob url");img.src=URL.createObjectURL(srcImage),self.blob=srcImage,srcImage=img}(),srcImage.naturalWidth||srcImage.naturalHeight||(srcImage.onload=function(){var listeners=self.imageLoadListeners;listeners&&(self.imageLoadListeners=null,setTimeout(function(){for(var i=0,len=listeners.length;len>i;i++)listeners[i]()},0))},srcImage.onerror=errorCallback,this.imageLoadListeners=[]),this.srcImage=srcImage}MegaPixImage.prototype.render=function(target,options){options=options||{};var opt,self=this,imgWidth=this.srcImage.naturalWidth,imgHeight=this.srcImage.naturalHeight,width=options.width,height=options.height,maxWidth=options.maxWidth,maxHeight=options.maxHeight,doSquash=!this.blob||"image/jpeg"===this.blob.type,tagName=target.tagName.toLowerCase();return this.imageLoadListeners?void this.imageLoadListeners.push(function(){self.render(target,options)}):(width&&!height?height=imgHeight*width/imgWidth<<0:height&&!width?width=imgWidth*height/imgHeight<<0:(width=imgWidth,height=imgHeight),maxWidth&&width>maxWidth&&(width=maxWidth,height=imgHeight*width/imgWidth<<0),maxHeight&&height>maxHeight&&(height=maxHeight,width=imgWidth*height/imgHeight<<0),opt={width:width,height:height},qq.each(options,function(optionsKey,optionsValue){opt[optionsKey]=optionsValue}),"img"===tagName?!function(){var oldTargetSrc=target.src;renderImageToDataURL(self.srcImage,self.blob,opt,doSquash).then(function(dataUri){target.src=dataUri,oldTargetSrc===target.src&&target.onload()})}():"canvas"===tagName&&renderImageToCanvas(this.srcImage,this.blob,target,opt,doSquash),void("function"==typeof this.onrender&&this.onrender(target)))},qq.MegaPixImage=MegaPixImage}(),qq.ImageGenerator=function(log){"use strict";function isImg(el){return"img"===el.tagName.toLowerCase()}function isCanvas(el){return"canvas"===el.tagName.toLowerCase()}function isImgCorsSupported(){return void 0!==(new Image).crossOrigin}function isCanvasSupported(){var canvas=document.createElement("canvas");return canvas.getContext&&canvas.getContext("2d")}function determineMimeOfFileName(nameWithPath){var pathSegments=nameWithPath.split("/"),name=pathSegments[pathSegments.length-1].split("?")[0],extension=qq.getExtension(name);switch(extension=extension&&extension.toLowerCase()){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function isCrossOrigin(url){var targetProtocol,targetHostname,targetPort,targetAnchor=document.createElement("a");return targetAnchor.href=url,targetProtocol=targetAnchor.protocol,targetPort=targetAnchor.port,targetHostname=targetAnchor.hostname,targetProtocol.toLowerCase()!==window.location.protocol.toLowerCase()?!0:targetHostname.toLowerCase()!==window.location.hostname.toLowerCase()?!0:targetPort===window.location.port||qq.ie()?!1:!0}function registerImgLoadListeners(img,promise){img.onload=function(){img.onload=null,img.onerror=null,promise.success(img)},img.onerror=function(){img.onload=null,img.onerror=null,log("Problem drawing thumbnail!","error"),promise.failure(img,"Problem drawing thumbnail!")}}function registerCanvasDrawImageListener(canvas,promise){canvas.qqImageRendered=function(){promise.success(canvas)}}function registerThumbnailRenderedListener(imgOrCanvas,promise){var registered=isImg(imgOrCanvas)||isCanvas(imgOrCanvas);return isImg(imgOrCanvas)?registerImgLoadListeners(imgOrCanvas,promise):isCanvas(imgOrCanvas)?registerCanvasDrawImageListener(imgOrCanvas,promise):(promise.failure(imgOrCanvas),log(qq.format("Element container of type {} is not supported!",imgOrCanvas.tagName),"error")),registered}function draw(fileOrBlob,container,options){var drawPreview=new qq.Promise,identifier=new qq.Identify(fileOrBlob,log),maxSize=options.maxSize,orient=null==options.orient?!0:options.orient,megapixErrorHandler=function(){container.onerror=null,container.onload=null,log("Could not render preview, file may be too large!","error"),drawPreview.failure(container,"Browser cannot render image!")};return identifier.isPreviewable().then(function(mime){var dummyExif={parse:function(){return(new qq.Promise).success()}},exif=orient?new qq.Exif(fileOrBlob,log):dummyExif,mpImg=new qq.MegaPixImage(fileOrBlob,megapixErrorHandler);registerThumbnailRenderedListener(container,drawPreview)&&exif.parse().then(function(exif){var orientation=exif&&exif.Orientation;mpImg.render(container,{maxWidth:maxSize,maxHeight:maxSize,orientation:orientation,mime:mime,resize:options.customResizeFunction})},function(failureMsg){log(qq.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",failureMsg)),mpImg.render(container,{maxWidth:maxSize,maxHeight:maxSize,mime:mime,resize:options.customResizeFunction})})},function(){log("Not previewable"),drawPreview.failure(container,"Not previewable")}),drawPreview}function drawOnCanvasOrImgFromUrl(url,canvasOrImg,draw,maxSize,customResizeFunction){var tempImg=new Image,tempImgRender=new qq.Promise;registerThumbnailRenderedListener(tempImg,tempImgRender),isCrossOrigin(url)&&(tempImg.crossOrigin="anonymous"),tempImg.src=url,tempImgRender.then(function(){registerThumbnailRenderedListener(canvasOrImg,draw);var mpImg=new qq.MegaPixImage(tempImg);mpImg.render(canvasOrImg,{maxWidth:maxSize,maxHeight:maxSize,mime:determineMimeOfFileName(url),resize:customResizeFunction})},draw.failure)}function drawOnImgFromUrlWithCssScaling(url,img,draw,maxSize){registerThumbnailRenderedListener(img,draw),qq(img).css({maxWidth:maxSize+"px",maxHeight:maxSize+"px"}),img.src=url}function drawFromUrl(url,container,options){var draw=new qq.Promise,scale=options.scale,maxSize=scale?options.maxSize:null;return scale&&isImg(container)?isCanvasSupported()?isCrossOrigin(url)&&!isImgCorsSupported()?drawOnImgFromUrlWithCssScaling(url,container,draw,maxSize):drawOnCanvasOrImgFromUrl(url,container,draw,maxSize):drawOnImgFromUrlWithCssScaling(url,container,draw,maxSize):isCanvas(container)?drawOnCanvasOrImgFromUrl(url,container,draw,maxSize):registerThumbnailRenderedListener(container,draw)&&(container.src=url),draw}qq.extend(this,{generate:function(fileBlobOrUrl,container,options){return qq.isString(fileBlobOrUrl)?(log("Attempting to update thumbnail based on server response."),drawFromUrl(fileBlobOrUrl,container,options||{})):(log("Attempting to draw client-side image preview."),draw(fileBlobOrUrl,container,options||{}))}}),this._testing={},this._testing.isImg=isImg,this._testing.isCanvas=isCanvas,this._testing.isCrossOrigin=isCrossOrigin,this._testing.determineMimeOfFileName=determineMimeOfFileName},qq.Exif=function(fileOrBlob,log){"use strict";function parseLittleEndian(hex){for(var result=0,pow=0;hex.length>0;)result+=parseInt(hex.substring(0,2),16)*Math.pow(2,pow),hex=hex.substring(2,hex.length),pow+=8;return result}function seekToApp1(offset,promise){var theOffset=offset,thePromise=promise;return void 0===theOffset&&(theOffset=2,thePromise=new qq.Promise),qq.readBlobToHex(fileOrBlob,theOffset,4).then(function(hex){var segmentLength,match=/^ffe([0-9])/.exec(hex);match?"1"!==match[1]?(segmentLength=parseInt(hex.slice(4,8),16),seekToApp1(theOffset+segmentLength+2,thePromise)):thePromise.success(theOffset):thePromise.failure("No EXIF header to be found!")}),thePromise}function getApp1Offset(){var promise=new qq.Promise;return qq.readBlobToHex(fileOrBlob,0,6).then(function(hex){0!==hex.indexOf("ffd8")?promise.failure("Not a valid JPEG!"):seekToApp1().then(function(offset){promise.success(offset)},function(error){promise.failure(error)})}),promise}function isLittleEndian(app1Start){var promise=new qq.Promise;return qq.readBlobToHex(fileOrBlob,app1Start+10,2).then(function(hex){promise.success("4949"===hex)}),promise}function getDirEntryCount(app1Start,littleEndian){var promise=new qq.Promise;return qq.readBlobToHex(fileOrBlob,app1Start+18,2).then(function(hex){return littleEndian?promise.success(parseLittleEndian(hex)):void promise.success(parseInt(hex,16))}),promise}function getIfd(app1Start,dirEntries){var offset=app1Start+20,bytes=12*dirEntries;return qq.readBlobToHex(fileOrBlob,offset,bytes)}function getDirEntries(ifdHex){for(var entries=[],offset=0;offset+24<=ifdHex.length;)entries.push(ifdHex.slice(offset,offset+24)),offset+=24;return entries}function getTagValues(littleEndian,dirEntries){var TAG_VAL_OFFSET=16,tagsToFind=qq.extend([],TAG_IDS),vals={};return qq.each(dirEntries,function(idx,entry){var tagValHex,tagName,tagValLength,idHex=entry.slice(0,4),id=littleEndian?parseLittleEndian(idHex):parseInt(idHex,16),tagsToFindIdx=tagsToFind.indexOf(id);return tagsToFindIdx>=0&&(tagName=TAG_INFO[id].name,tagValLength=TAG_INFO[id].bytes,tagValHex=entry.slice(TAG_VAL_OFFSET,TAG_VAL_OFFSET+2*tagValLength),vals[tagName]=littleEndian?parseLittleEndian(tagValHex):parseInt(tagValHex,16),tagsToFind.splice(tagsToFindIdx,1)),0===tagsToFind.length?!1:void 0}),vals}var TAG_IDS=[274],TAG_INFO={274:{name:"Orientation",bytes:2}};qq.extend(this,{parse:function(){var parser=new qq.Promise,onParseFailure=function(message){log(qq.format("EXIF header parse failed: '{}' ",message)),parser.failure(message)};return getApp1Offset().then(function(app1Offset){log(qq.format("Moving forward with EXIF header parsing for '{}'",void 0===fileOrBlob.name?"blob":fileOrBlob.name)),isLittleEndian(app1Offset).then(function(littleEndian){log(qq.format("EXIF Byte order is {} endian",littleEndian?"little":"big")),getDirEntryCount(app1Offset,littleEndian).then(function(dirEntryCount){log(qq.format("Found {} APP1 directory entries",dirEntryCount)),getIfd(app1Offset,dirEntryCount).then(function(ifdHex){var dirEntries=getDirEntries(ifdHex),tagValues=getTagValues(littleEndian,dirEntries);log("Successfully parsed some EXIF tags"),parser.success(tagValues)},onParseFailure)},onParseFailure)},onParseFailure)},onParseFailure),parser}}),this._testing={},this._testing.parseLittleEndian=parseLittleEndian},qq.Identify=function(fileOrBlob,log){"use strict";function isIdentifiable(magicBytes,questionableBytes){var identifiable=!1,magicBytesEntries=[].concat(magicBytes);return qq.each(magicBytesEntries,function(idx,magicBytesArrayEntry){return 0===questionableBytes.indexOf(magicBytesArrayEntry)?(identifiable=!0,!1):void 0}),identifiable}qq.extend(this,{isPreviewable:function(){var self=this,identifier=new qq.Promise,previewable=!1,name=void 0===fileOrBlob.name?"blob":fileOrBlob.name;return log(qq.format("Attempting to determine if {} can be rendered in this browser",name)),log("First pass: check type attribute of blob object."),this.isPreviewableSync()?(log("Second pass: check for magic bytes in file header."),qq.readBlobToHex(fileOrBlob,0,4).then(function(hex){qq.each(self.PREVIEWABLE_MIME_TYPES,function(mime,bytes){return isIdentifiable(bytes,hex)?(("image/tiff"!==mime||qq.supportedFeatures.tiffPreviews)&&(previewable=!0,identifier.success(mime)),!1):void 0}),log(qq.format("'{}' is {} able to be rendered in this browser",name,previewable?"":"NOT")),previewable||identifier.failure()},function(){log("Error reading file w/ name '"+name+"'.  Not able to be rendered in this browser."),identifier.failure()})):identifier.failure(),identifier},isPreviewableSync:function(){var fileMime=fileOrBlob.type,isRecognizedImage=qq.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),fileMime)>=0,previewable=!1,name=void 0===fileOrBlob.name?"blob":fileOrBlob.name;return isRecognizedImage&&(previewable="image/tiff"===fileMime?qq.supportedFeatures.tiffPreviews:!0),!previewable&&log(name+" is not previewable in this browser per the blob's type attr"),previewable}})},qq.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]},qq.ImageValidation=function(blob,log){"use strict";function hasNonZeroLimits(limits){var atLeastOne=!1;return qq.each(limits,function(limit,value){return value>0?(atLeastOne=!0,!1):void 0}),atLeastOne}function getWidthHeight(){var sizeDetermination=new qq.Promise;return new qq.Identify(blob,log).isPreviewable().then(function(){var image=new Image,url=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;url?(image.onerror=function(){log("Cannot determine dimensions for image.  May be too large.","error"),sizeDetermination.failure()},image.onload=function(){sizeDetermination.success({width:this.width,height:this.height})},image.src=url.createObjectURL(blob)):(log("No createObjectURL function available to generate image URL!","error"),sizeDetermination.failure())},sizeDetermination.failure),sizeDetermination}function getFailingLimit(limits,dimensions){var failingLimit;return qq.each(limits,function(limitName,limitValue){if(limitValue>0){var limitMatcher=/(max|min)(Width|Height)/.exec(limitName),dimensionPropName=limitMatcher[2].charAt(0).toLowerCase()+limitMatcher[2].slice(1),actualValue=dimensions[dimensionPropName];switch(limitMatcher[1]){case"min":if(limitValue>actualValue)return failingLimit=limitName,!1;break;case"max":if(actualValue>limitValue)return failingLimit=limitName,!1}}}),failingLimit}this.validate=function(limits){var validationEffort=new qq.Promise;return log("Attempting to validate image."),hasNonZeroLimits(limits)?getWidthHeight().then(function(dimensions){var failingLimit=getFailingLimit(limits,dimensions);failingLimit?validationEffort.failure(failingLimit):validationEffort.success()},validationEffort.success):validationEffort.success(),validationEffort}},qq.Session=function(spec){"use strict";function isJsonResponseValid(response){return qq.isArray(response)?!0:void options.log("Session response is not an array.","error")}function handleFileItems(fileItems,success,xhrOrXdr,promise){var someItemsIgnored=!1;success=success&&isJsonResponseValid(fileItems),success&&qq.each(fileItems,function(idx,fileItem){if(null==fileItem.uuid)someItemsIgnored=!0,options.log(qq.format("Session response item {} did not include a valid UUID - ignoring.",idx),"error");else if(null==fileItem.name)someItemsIgnored=!0,options.log(qq.format("Session response item {} did not include a valid name - ignoring.",idx),"error");else try{return options.addFileRecord(fileItem),!0}catch(err){someItemsIgnored=!0,options.log(err.message,"error")}return!1}),promise[success&&!someItemsIgnored?"success":"failure"](fileItems,xhrOrXdr)}var options={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(sessionData){},log:function(message,level){}};qq.extend(options,spec,!0),this.refresh=function(){var refreshEffort=new qq.Promise,refreshCompleteCallback=function(response,success,xhrOrXdr){handleFileItems(response,success,xhrOrXdr,refreshEffort)},requesterOptions=qq.extend({},options),requester=new qq.SessionAjaxRequester(qq.extend(requesterOptions,{onComplete:refreshCompleteCallback}));return requester.queryServer(),refreshEffort}},qq.SessionAjaxRequester=function(spec){"use strict";function onComplete(id,xhrOrXdr,isError){var response=null;if(null!=xhrOrXdr.responseText)try{response=qq.parseJson(xhrOrXdr.responseText)}catch(err){options.log("Problem parsing session response: "+err.message,"error"),isError=!0}options.onComplete(response,!isError,xhrOrXdr)}var requester,options={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(response,success,xhrOrXdr){},log:function(str,level){}};qq.extend(options,spec),requester=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return options.endpoint}},customHeaders:options.customHeaders,log:options.log,onComplete:onComplete,cors:options.cors})),qq.extend(this,{queryServer:function(){var params=qq.extend({},options.params);options.log("Session query request."),requester.initTransport("sessionRefresh").withParams(params).withCacheBuster().send()}})},qq.Scaler=function(spec,log){"use strict";var customResizeFunction=spec.customResizer,includeOriginal=spec.sendOriginal,orient=spec.orient,defaultType=spec.defaultType,defaultQuality=spec.defaultQuality/100,failedToScaleText=spec.failureText,includeExif=spec.includeExif,sizes=this._getSortedSizes(spec.sizes);qq.extend(this,{enabled:qq.supportedFeatures.scaling&&sizes.length>0,getFileRecords:function(originalFileUuid,originalFileName,originalBlobOrBlobData){var self=this,records=[],originalBlob=originalBlobOrBlobData.blob?originalBlobOrBlobData.blob:originalBlobOrBlobData,identifier=new qq.Identify(originalBlob,log);return identifier.isPreviewableSync()?(qq.each(sizes,function(idx,sizeRecord){var outputType=self._determineOutputType({defaultType:defaultType,requestedType:sizeRecord.type,refType:originalBlob.type});records.push({uuid:qq.getUniqueId(),name:self._getName(originalFileName,{name:sizeRecord.name,type:outputType,refType:originalBlob.type}),blob:new qq.BlobProxy(originalBlob,qq.bind(self._generateScaledImage,self,{customResizeFunction:customResizeFunction,maxSize:sizeRecord.maxSize,orient:orient,type:outputType,quality:defaultQuality,failedText:failedToScaleText,includeExif:includeExif,log:log}))})}),records.push({uuid:originalFileUuid,name:originalFileName,size:originalBlob.size,blob:includeOriginal?originalBlob:null})):records.push({uuid:originalFileUuid,name:originalFileName,size:originalBlob.size,blob:originalBlob}),records},handleNewFile:function(file,name,uuid,size,fileList,batchId,uuidParamName,api){var self=this,scaledIds=(file.qqButtonId||file.blob&&file.blob.qqButtonId,[]),originalId=null,addFileToHandler=api.addFileToHandler,uploadData=api.uploadData,paramsStore=api.paramsStore,proxyGroupId=qq.getUniqueId();qq.each(self.getFileRecords(uuid,name,file),function(idx,record){var id,blobSize=record.size;record.blob instanceof qq.BlobProxy&&(blobSize=-1),id=uploadData.addFile({uuid:record.uuid,name:record.name,size:blobSize,batchId:batchId,proxyGroupId:proxyGroupId}),record.blob instanceof qq.BlobProxy?scaledIds.push(id):originalId=id,record.blob?(addFileToHandler(id,record.blob),fileList.push({id:id,file:record.blob})):uploadData.setStatus(id,qq.status.REJECTED)}),null!==originalId&&(qq.each(scaledIds,function(idx,scaledId){var params={qqparentuuid:uploadData.retrieve({id:originalId}).uuid,qqparentsize:uploadData.retrieve({id:originalId}).size};params[uuidParamName]=uploadData.retrieve({id:scaledId}).uuid,uploadData.setParentId(scaledId,originalId),paramsStore.addReadOnly(scaledId,params)}),scaledIds.length&&!function(){var param={};param[uuidParamName]=uploadData.retrieve({id:originalId}).uuid,paramsStore.addReadOnly(originalId,param)}())}})},qq.extend(qq.Scaler.prototype,{scaleImage:function(id,specs,api){"use strict";if(!qq.supportedFeatures.scaling)throw new qq.Error("Scaling is not supported in this browser!");var scalingEffort=new qq.Promise,log=api.log,file=api.getFile(id),uploadData=api.uploadData.retrieve({id:id}),name=uploadData&&uploadData.name,uuid=uploadData&&uploadData.uuid,scalingOptions={customResizer:specs.customResizer,sendOriginal:!1,orient:specs.orient,defaultType:specs.type||null,defaultQuality:specs.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:specs.maxSize}]},scaler=new qq.Scaler(scalingOptions,log);return qq.Scaler&&qq.supportedFeatures.imagePreviews&&file?qq.bind(function(){var record=scaler.getFileRecords(uuid,name,file)[0];record&&record.blob instanceof qq.BlobProxy?record.blob.create().then(scalingEffort.success,scalingEffort.failure):(log(id+" is not a scalable image!","error"),scalingEffort.failure())},this)():(scalingEffort.failure(),log("Could not generate requested scaled image for "+id+".  Scaling is either not possible in this browser, or the file could not be located.","error")),scalingEffort},_determineOutputType:function(spec){"use strict";var requestedType=spec.requestedType,defaultType=spec.defaultType,referenceType=spec.refType;return defaultType||requestedType?requestedType&&qq.indexOf(Object.keys(qq.Identify.prototype.PREVIEWABLE_MIME_TYPES),requestedType)>=0?"image/tiff"===requestedType?qq.supportedFeatures.tiffPreviews?requestedType:defaultType:requestedType:defaultType:"image/jpeg"!==referenceType?"image/png":referenceType},_getName:function(originalName,scaledVersionProperties){"use strict";var startOfExt=originalName.lastIndexOf("."),versionType=scaledVersionProperties.type||"image/png",referenceType=scaledVersionProperties.refType,scaledName="",scaledExt=qq.getExtension(originalName),nameAppendage="";return scaledVersionProperties.name&&scaledVersionProperties.name.trim().length&&(nameAppendage=" ("+scaledVersionProperties.name+")"),startOfExt>=0?(scaledName=originalName.substr(0,startOfExt),referenceType!==versionType&&(scaledExt=versionType.split("/")[1]),scaledName+=nameAppendage+"."+scaledExt):scaledName=originalName+nameAppendage,scaledName},_getSortedSizes:function(sizes){"use strict";return sizes=qq.extend([],sizes),sizes.sort(function(a,b){return a.maxSize>b.maxSize?1:a.maxSize<b.maxSize?-1:0})},_generateScaledImage:function(spec,sourceFile){"use strict";var self=this,customResizeFunction=spec.customResizeFunction,log=spec.log,maxSize=spec.maxSize,orient=spec.orient,type=spec.type,quality=spec.quality,failedText=spec.failedText,includeExif=spec.includeExif&&"image/jpeg"===sourceFile.type&&"image/jpeg"===type,scalingEffort=new qq.Promise,imageGenerator=new qq.ImageGenerator(log),canvas=document.createElement("canvas");return log("Attempting to generate scaled version for "+sourceFile.name),imageGenerator.generate(sourceFile,canvas,{maxSize:maxSize,orient:orient,customResizeFunction:customResizeFunction}).then(function(){var scaledImageDataUri=canvas.toDataURL(type,quality),signalSuccess=function(){log("Success generating scaled version for "+sourceFile.name);var blob=qq.dataUriToBlob(scaledImageDataUri);scalingEffort.success(blob)};includeExif?self._insertExifHeader(sourceFile,scaledImageDataUri,log).then(function(scaledImageDataUriWithExif){scaledImageDataUri=scaledImageDataUriWithExif,signalSuccess()},function(){log("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error"),signalSuccess()}):signalSuccess()},function(){log("Failed attempt to generate scaled version for "+sourceFile.name,"error"),scalingEffort.failure(failedText)}),scalingEffort},_insertExifHeader:function(originalImage,scaledImageDataUri,log){"use strict";var reader=new FileReader,insertionEffort=new qq.Promise,originalImageDataUri="";return reader.onload=function(){originalImageDataUri=reader.result,insertionEffort.success(qq.ExifRestorer.restore(originalImageDataUri,scaledImageDataUri))},reader.onerror=function(){log("Problem reading "+originalImage.name+" during attempt to transfer EXIF data to scaled version.","error"),insertionEffort.failure()},reader.readAsDataURL(originalImage),insertionEffort},_dataUriToBlob:function(dataUri){"use strict";var byteString,mimeString,arrayBuffer,intArray;return byteString=dataUri.split(",")[0].indexOf("base64")>=0?atob(dataUri.split(",")[1]):decodeURI(dataUri.split(",")[1]),mimeString=dataUri.split(",")[0].split(":")[1].split(";")[0],arrayBuffer=new ArrayBuffer(byteString.length),intArray=new Uint8Array(arrayBuffer),qq.each(byteString,function(idx,character){intArray[idx]=character.charCodeAt(0)}),this._createBlob(arrayBuffer,mimeString)},_createBlob:function(data,mime){"use strict";var BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,blobBuilder=BlobBuilder&&new BlobBuilder;return blobBuilder?(blobBuilder.append(data),blobBuilder.getBlob(mime)):new Blob([data],{type:mime})}}),qq.ExifRestorer=function(){var ExifRestorer={};return ExifRestorer.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ExifRestorer.encode64=function(input){var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0;do chr1=input[i++],chr2=input[i++],chr3=input[i++],enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+this.KEY_STR.charAt(enc1)+this.KEY_STR.charAt(enc2)+this.KEY_STR.charAt(enc3)+this.KEY_STR.charAt(enc4),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<input.length);return output},ExifRestorer.restore=function(origFileBase64,resizedFileBase64){var expectedBase64Header="data:image/jpeg;base64,";if(!origFileBase64.match(expectedBase64Header))return resizedFileBase64;var rawImage=this.decode64(origFileBase64.replace(expectedBase64Header,"")),segments=this.slice2Segments(rawImage),image=this.exifManipulation(resizedFileBase64,segments);return expectedBase64Header+this.encode64(image)},ExifRestorer.exifManipulation=function(resizedFileBase64,segments){var exifArray=this.getExifArray(segments),newImageArray=this.insertExif(resizedFileBase64,exifArray),aBuffer=new Uint8Array(newImageArray);return aBuffer},ExifRestorer.getExifArray=function(segments){for(var seg,x=0;x<segments.length;x++)if(seg=segments[x],255==seg[0]&225==seg[1])return seg;return[]},ExifRestorer.insertExif=function(resizedFileBase64,exifArray){var imageData=resizedFileBase64.replace("data:image/jpeg;base64,",""),buf=this.decode64(imageData),separatePoint=buf.indexOf(255,3),mae=buf.slice(0,separatePoint),ato=buf.slice(separatePoint),array=mae;return array=array.concat(exifArray),array=array.concat(ato)},ExifRestorer.slice2Segments=function(rawImageArray){for(var head=0,segments=[];;){if(255==rawImageArray[head]&218==rawImageArray[head+1])break;if(255==rawImageArray[head]&216==rawImageArray[head+1])head+=2;else{var length=256*rawImageArray[head+2]+rawImageArray[head+3],endPoint=head+length+2,seg=rawImageArray.slice(head,endPoint);segments.push(seg),head=endPoint}if(head>rawImageArray.length)break}return segments},ExifRestorer.decode64=function(input){var chr1,chr2,enc1,enc2,enc3,chr3="",enc4="",i=0,buf=[],base64test=/[^A-Za-z0-9\+\/\=]/g;
if(base64test.exec(input))throw new Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");do enc1=this.KEY_STR.indexOf(input.charAt(i++)),enc2=this.KEY_STR.indexOf(input.charAt(i++)),enc3=this.KEY_STR.indexOf(input.charAt(i++)),enc4=this.KEY_STR.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,buf.push(chr1),64!=enc3&&buf.push(chr2),64!=enc4&&buf.push(chr3),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<input.length);return buf},ExifRestorer}(),qq.TotalProgress=function(callback,getSize){"use strict";var perFileProgress={},totalLoaded=0,totalSize=0,lastLoadedSent=-1,lastTotalSent=-1,callbackProxy=function(loaded,total){(loaded!==lastLoadedSent||total!==lastTotalSent)&&callback(loaded,total),lastLoadedSent=loaded,lastTotalSent=total},noRetryableFiles=function(failed,retryable){var none=!0;return qq.each(failed,function(idx,failedId){return qq.indexOf(retryable,failedId)>=0?(none=!1,!1):void 0}),none},onCancel=function(id){updateTotalProgress(id,-1,-1),delete perFileProgress[id]},onAllComplete=function(successful,failed,retryable){(0===failed.length||noRetryableFiles(failed,retryable))&&(callbackProxy(totalSize,totalSize),this.reset())},onNew=function(id){var size=getSize(id);size>0&&(updateTotalProgress(id,0,size),perFileProgress[id]={loaded:0,total:size})},updateTotalProgress=function(id,newLoaded,newTotal){var oldLoaded=perFileProgress[id]?perFileProgress[id].loaded:0,oldTotal=perFileProgress[id]?perFileProgress[id].total:0;-1===newLoaded&&-1===newTotal?(totalLoaded-=oldLoaded,totalSize-=oldTotal):(newLoaded&&(totalLoaded+=newLoaded-oldLoaded),newTotal&&(totalSize+=newTotal-oldTotal)),callbackProxy(totalLoaded,totalSize)};qq.extend(this,{onAllComplete:onAllComplete,onStatusChange:function(id,oldStatus,newStatus){newStatus===qq.status.CANCELED||newStatus===qq.status.REJECTED?onCancel(id):newStatus===qq.status.SUBMITTING&&onNew(id)},onIndividualProgress:function(id,loaded,total){updateTotalProgress(id,loaded,total),perFileProgress[id]={loaded:loaded,total:total}},onNewSize:function(id){onNew(id)},reset:function(){perFileProgress={},totalLoaded=0,totalSize=0}})},qq.PasteSupport=function(o){"use strict";function isImage(item){return item.type&&0===item.type.indexOf("image/")}function registerPasteHandler(){detachPasteHandler=qq(options.targetElement).attach("paste",function(event){var clipboardData=event.clipboardData;clipboardData&&qq.each(clipboardData.items,function(idx,item){if(isImage(item)){var blob=item.getAsFile();options.callbacks.pasteReceived(blob)}})})}function unregisterPasteHandler(){detachPasteHandler&&detachPasteHandler()}var options,detachPasteHandler;options={targetElement:null,callbacks:{log:function(message,level){},pasteReceived:function(blob){}}},qq.extend(options,o),registerPasteHandler(),qq.extend(this,{reset:function(){unregisterPasteHandler()}})},qq.FormSupport=function(options,startUpload,log){"use strict";function determineNewEndpoint(formEl){formEl.getAttribute("action")&&(self.newEndpoint=formEl.getAttribute("action"))}function validateForm(formEl,nativeSubmit){return!formEl.checkValidity||formEl.checkValidity()?!0:(log("Form did not pass validation checks - will not upload.","error"),void nativeSubmit())}function maybeUploadOnSubmit(formEl){var nativeSubmit=formEl.submit;qq(formEl).attach("submit",function(event){event=event||window.event,event.preventDefault?event.preventDefault():event.returnValue=!1,validateForm(formEl,nativeSubmit)&&startUpload()}),formEl.submit=function(){validateForm(formEl,nativeSubmit)&&startUpload()}}function determineFormEl(formEl){return formEl&&(qq.isString(formEl)&&(formEl=document.getElementById(formEl)),formEl&&(log("Attaching to form element."),determineNewEndpoint(formEl),interceptSubmit&&maybeUploadOnSubmit(formEl))),formEl}var self=this,interceptSubmit=options.interceptSubmit,formEl=options.element,autoUpload=options.autoUpload;qq.extend(this,{newEndpoint:null,newAutoUpload:autoUpload,attachedToForm:!1,getFormInputsAsObject:function(){return null==formEl?null:self._form2Obj(formEl)}}),formEl=determineFormEl(formEl),this.attachedToForm=!!formEl},qq.extend(qq.FormSupport.prototype,{_form2Obj:function(form){"use strict";var obj={},notIrrelevantType=function(type){var irrelevantTypes=["button","image","reset","submit"];return qq.indexOf(irrelevantTypes,type.toLowerCase())<0},radioOrCheckbox=function(type){return qq.indexOf(["checkbox","radio"],type.toLowerCase())>=0},ignoreValue=function(el){return radioOrCheckbox(el.type)&&!el.checked?!0:el.disabled&&"hidden"!==el.type.toLowerCase()},selectValue=function(select){var value=null;return qq.each(qq(select).children(),function(idx,child){return"option"===child.tagName.toLowerCase()&&child.selected?(value=child.value,!1):void 0}),value};return qq.each(form.elements,function(idx,el){if(!qq.isInput(el,!0)&&"textarea"!==el.tagName.toLowerCase()||!notIrrelevantType(el.type)||ignoreValue(el)){if("select"===el.tagName.toLowerCase()&&!ignoreValue(el)){var value=selectValue(el);null!==value&&(obj[el.name]=value)}}else obj[el.name]=el.value}),obj}}),qq.traditional=qq.traditional||{},qq.traditional.FormUploadHandler=function(options,proxy){"use strict";function getIframeContentJson(id,iframe){var response,doc,innerHtml;try{doc=iframe.contentDocument||iframe.contentWindow.document,innerHtml=doc.body.innerHTML,log("converting iframe's innerHTML to JSON"),log("innerHTML = "+innerHtml),innerHtml&&innerHtml.match(/^<pre/i)&&(innerHtml=doc.body.firstChild.firstChild.nodeValue),response=handler._parseJsonResponse(innerHtml)}catch(error){log("Error when attempting to parse form upload response ("+error.message+")","error"),response={success:!1}}return response}function createForm(id,iframe){var params=options.paramsStore.get(id),method="get"===options.method.toLowerCase()?"GET":"POST",endpoint=options.endpointStore.get(id),name=getName(id);return params[options.uuidName]=getUuid(id),params[options.filenameParam]=name,handler._initFormForUpload({method:method,endpoint:endpoint,params:params,paramsInBody:options.paramsInBody,targetName:iframe.name})}var handler=this,getName=proxy.getName,getUuid=proxy.getUuid,log=proxy.log;this.uploadFile=function(id){var form,input=handler.getInput(id),iframe=handler._createIframe(id),promise=new qq.Promise;return form=createForm(id,iframe),form.appendChild(input),handler._attachLoadEvent(iframe,function(responseFromMessage){log("iframe loaded");var response=responseFromMessage?responseFromMessage:getIframeContentJson(id,iframe);handler._detachLoadEvent(id),options.cors.expected||qq(iframe).remove(),response.success?promise.success(response):promise.failure(response)}),log("Sending upload request for "+id),form.submit(),qq(form).remove(),promise},qq.extend(this,new qq.FormUploadHandler({options:{isCors:options.cors.expected,inputName:options.inputName},proxy:{onCancel:options.onCancel,getName:getName,getUuid:getUuid,log:log}}))},qq.traditional=qq.traditional||{},qq.traditional.XhrUploadHandler=function(spec,proxy){"use strict";var handler=this,getName=proxy.getName,getSize=proxy.getSize,getUuid=proxy.getUuid,log=proxy.log,multipart=spec.forceMultipart||spec.paramsInBody,addChunkingSpecificParams=function(id,params,chunkData){var size=getSize(id),name=getName(id);params[spec.chunking.paramNames.partIndex]=chunkData.part,params[spec.chunking.paramNames.partByteOffset]=chunkData.start,params[spec.chunking.paramNames.chunkSize]=chunkData.size,params[spec.chunking.paramNames.totalParts]=chunkData.count,params[spec.totalFileSizeName]=size,multipart&&(params[spec.filenameParam]=name)},allChunksDoneRequester=new qq.traditional.AllChunksDoneAjaxRequester({cors:spec.cors,endpoint:spec.chunking.success.endpoint,log:log}),createReadyStateChangedHandler=function(id,xhr){var promise=new qq.Promise;return xhr.onreadystatechange=function(){if(4===xhr.readyState){var result=onUploadOrChunkComplete(id,xhr);result.success?promise.success(result.response,xhr):promise.failure(result.response,xhr)}},promise},getChunksCompleteParams=function(id){var params=spec.paramsStore.get(id),name=getName(id),size=getSize(id);return params[spec.uuidName]=getUuid(id),params[spec.filenameParam]=name,params[spec.totalFileSizeName]=size,params[spec.chunking.paramNames.totalParts]=handler._getTotalChunks(id),params},isErrorUploadResponse=function(xhr,response){return qq.indexOf([200,201,202,203,204],xhr.status)<0||!response.success||response.reset},onUploadOrChunkComplete=function(id,xhr){var response;return log("xhr - server response received for "+id),log("responseText = "+xhr.responseText),response=parseResponse(!0,xhr),{success:!isErrorUploadResponse(xhr,response),response:response}},parseResponse=function(upload,xhr){var response={};try{log(qq.format("Received response status {} with body: {}",xhr.status,xhr.responseText)),response=qq.parseJson(xhr.responseText)}catch(error){upload&&log("Error when attempting to parse xhr response text ("+error.message+")","error")}return response},sendChunksCompleteRequest=function(id){var promise=new qq.Promise;return allChunksDoneRequester.complete(id,handler._createXhr(id),getChunksCompleteParams(id),spec.customHeaders.get(id)).then(function(xhr){promise.success(parseResponse(!1,xhr),xhr)},function(xhr){promise.failure(parseResponse(!1,xhr),xhr)}),promise},setParamsAndGetEntityToSend=function(params,xhr,fileOrBlob,id){var formData=new FormData,method=spec.method,endpoint=spec.endpointStore.get(id),name=getName(id),size=getSize(id);return params[spec.uuidName]=getUuid(id),params[spec.filenameParam]=name,multipart&&(params[spec.totalFileSizeName]=size),spec.paramsInBody||(multipart||(params[spec.inputName]=name),endpoint=qq.obj2url(params,endpoint)),xhr.open(method,endpoint,!0),spec.cors.expected&&spec.cors.sendCredentials&&(xhr.withCredentials=!0),multipart?(spec.paramsInBody&&qq.obj2FormData(params,formData),formData.append(spec.inputName,fileOrBlob),formData):fileOrBlob},setUploadHeaders=function(id,xhr){var extraHeaders=spec.customHeaders.get(id),fileOrBlob=handler.getFile(id);xhr.setRequestHeader("Accept","application/json"),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("Cache-Control","no-cache"),multipart||(xhr.setRequestHeader("Content-Type","application/octet-stream"),xhr.setRequestHeader("X-Mime-Type",fileOrBlob.type)),qq.each(extraHeaders,function(name,val){xhr.setRequestHeader(name,val)})};qq.extend(this,{uploadChunk:function(id,chunkIdx,resuming){var promise,toSend,params,chunkData=handler._getChunkData(id,chunkIdx),xhr=handler._createXhr(id,chunkIdx);getSize(id);return promise=createReadyStateChangedHandler(id,xhr),handler._registerProgressHandler(id,chunkIdx,chunkData.size),params=spec.paramsStore.get(id),addChunkingSpecificParams(id,params,chunkData),resuming&&(params[spec.resume.paramNames.resuming]=!0),toSend=setParamsAndGetEntityToSend(params,xhr,chunkData.blob,id),setUploadHeaders(id,xhr),xhr.send(toSend),promise},uploadFile:function(id){var promise,xhr,params,toSend,fileOrBlob=handler.getFile(id);return xhr=handler._createXhr(id),handler._registerProgressHandler(id),promise=createReadyStateChangedHandler(id,xhr),params=spec.paramsStore.get(id),toSend=setParamsAndGetEntityToSend(params,xhr,fileOrBlob,id),setUploadHeaders(id,xhr),xhr.send(toSend),promise}}),qq.extend(this,new qq.XhrUploadHandler({options:qq.extend({namespace:"traditional"},spec),proxy:qq.extend({getEndpoint:spec.endpointStore.get},proxy)})),qq.override(this,function(super_){return{finalizeChunks:function(id){return spec.chunking.success.endpoint?sendChunksCompleteRequest(id):super_.finalizeChunks(id,qq.bind(parseResponse,this,!0))}}})},qq.traditional.AllChunksDoneAjaxRequester=function(o){"use strict";var requester,method="POST",options={cors:{allowXdr:!1,expected:!1,sendCredentials:!1},endpoint:null,log:function(str,level){}},promises={},endpointHandler={get:function(id){return options.endpoint}};qq.extend(options,o),requester=qq.extend(this,new qq.AjaxRequester({acceptHeader:"application/json",validMethods:[method],method:method,endpointStore:endpointHandler,allowXRequestedWithAndCacheControl:!1,cors:options.cors,log:options.log,onComplete:function(id,xhr,isError){var promise=promises[id];delete promises[id],isError?promise.failure(xhr):promise.success(xhr)}})),qq.extend(this,{complete:function(id,xhr,params,headers){var promise=new qq.Promise;return options.log("Submitting All Chunks Done request for "+id),promises[id]=promise,requester.initTransport(id).withParams(params).withHeaders(headers).send(xhr),promise}})},qq.DragAndDrop=function(o){"use strict";function uploadDroppedFiles(files,uploadDropZone){var filesAsArray=Array.prototype.slice.call(files);options.callbacks.dropLog("Grabbed "+files.length+" dropped files."),uploadDropZone.dropDisabled(!1),options.callbacks.processingDroppedFilesComplete(filesAsArray,uploadDropZone.getElement())}function traverseFileTree(entry){var parseEntryPromise=new qq.Promise;return entry.isFile?entry.file(function(file){var name=entry.name,fullPath=entry.fullPath,indexOfNameInFullPath=fullPath.indexOf(name);fullPath=fullPath.substr(0,indexOfNameInFullPath),"/"===fullPath.charAt(0)&&(fullPath=fullPath.substr(1)),file.qqPath=fullPath,droppedFiles.push(file),parseEntryPromise.success()},function(fileError){options.callbacks.dropLog("Problem parsing '"+entry.fullPath+"'.  FileError code "+fileError.code+".","error"),parseEntryPromise.failure()}):entry.isDirectory&&getFilesInDirectory(entry).then(function(entries){var entriesLeft=entries.length;qq.each(entries,function(idx,entry){traverseFileTree(entry).done(function(){entriesLeft-=1,0===entriesLeft&&parseEntryPromise.success()})}),entries.length||parseEntryPromise.success()},function(fileError){options.callbacks.dropLog("Problem parsing '"+entry.fullPath+"'.  FileError code "+fileError.code+".","error"),parseEntryPromise.failure()}),parseEntryPromise}function getFilesInDirectory(entry,reader,accumEntries,existingPromise){var promise=existingPromise||new qq.Promise,dirReader=reader||entry.createReader();return dirReader.readEntries(function(entries){var newEntries=accumEntries?accumEntries.concat(entries):entries;entries.length?setTimeout(function(){getFilesInDirectory(entry,dirReader,newEntries,promise)},0):promise.success(newEntries)},promise.failure),promise}function handleDataTransfer(dataTransfer,uploadDropZone){var pendingFolderPromises=[],handleDataTransferPromise=new qq.Promise;return options.callbacks.processingDroppedFiles(),uploadDropZone.dropDisabled(!0),dataTransfer.files.length>1&&!options.allowMultipleItems?(options.callbacks.processingDroppedFilesComplete([]),options.callbacks.dropError("tooManyFilesError",""),uploadDropZone.dropDisabled(!1),handleDataTransferPromise.failure()):(droppedFiles=[],qq.isFolderDropSupported(dataTransfer)?qq.each(dataTransfer.items,function(idx,item){var entry=item.webkitGetAsEntry();entry&&(entry.isFile?droppedFiles.push(item.getAsFile()):pendingFolderPromises.push(traverseFileTree(entry).done(function(){pendingFolderPromises.pop(),0===pendingFolderPromises.length&&handleDataTransferPromise.success()})))}):droppedFiles=dataTransfer.files,0===pendingFolderPromises.length&&handleDataTransferPromise.success()),handleDataTransferPromise}function setupDropzone(dropArea){var dropZone=new qq.UploadDropZone({HIDE_ZONES_EVENT_NAME:HIDE_ZONES_EVENT_NAME,element:dropArea,onEnter:function(e){qq(dropArea).addClass(options.classes.dropActive),e.stopPropagation()},onLeaveNotDescendants:function(e){qq(dropArea).removeClass(options.classes.dropActive)},onDrop:function(e){handleDataTransfer(e.dataTransfer,dropZone).then(function(){uploadDroppedFiles(droppedFiles,dropZone)},function(){options.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.","error")})}});return disposeSupport.addDisposer(function(){dropZone.dispose()}),qq(dropArea).hasAttribute(HIDE_BEFORE_ENTER_ATTR)&&qq(dropArea).hide(),uploadDropZones.push(dropZone),dropZone}function isFileDrag(dragEvent){var fileDrag;return qq.each(dragEvent.dataTransfer.types,function(key,val){return"Files"===val?(fileDrag=!0,!1):void 0}),fileDrag}function leavingDocumentOut(e){return qq.safari()?e.x<0||e.y<0:0===e.x&&0===e.y}function setupDragDrop(){var dropZones=options.dropZoneElements,maybeHideDropZones=function(){setTimeout(function(){qq.each(dropZones,function(idx,dropZone){qq(dropZone).hasAttribute(HIDE_BEFORE_ENTER_ATTR)&&qq(dropZone).hide(),qq(dropZone).removeClass(options.classes.dropActive)})},10)};qq.each(dropZones,function(idx,dropZone){var uploadDropZone=setupDropzone(dropZone);dropZones.length&&qq.supportedFeatures.fileDrop&&disposeSupport.attach(document,"dragenter",function(e){!uploadDropZone.dropDisabled()&&isFileDrag(e)&&qq.each(dropZones,function(idx,dropZone){dropZone instanceof HTMLElement&&qq(dropZone).hasAttribute(HIDE_BEFORE_ENTER_ATTR)&&qq(dropZone).css({display:"block"})})})}),disposeSupport.attach(document,"dragleave",function(e){leavingDocumentOut(e)&&maybeHideDropZones()}),disposeSupport.attach(qq(document).children()[0],"mouseenter",function(e){maybeHideDropZones()}),disposeSupport.attach(document,"drop",function(e){isFileDrag(e)&&(e.preventDefault(),maybeHideDropZones())}),disposeSupport.attach(document,HIDE_ZONES_EVENT_NAME,maybeHideDropZones)}var options,HIDE_ZONES_EVENT_NAME="qq-hidezones",HIDE_BEFORE_ENTER_ATTR="qq-hide-dropzone",uploadDropZones=[],droppedFiles=[],disposeSupport=new qq.DisposeSupport;options={dropZoneElements:[],allowMultipleItems:!0,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks},qq.extend(options,o,!0),setupDragDrop(),qq.extend(this,{setupExtraDropzone:function(element){options.dropZoneElements.push(element),setupDropzone(element)},removeDropzone:function(element){var i,dzs=options.dropZoneElements;for(i in dzs)if(dzs[i]===element)return dzs.splice(i,1)},dispose:function(){disposeSupport.dispose(),qq.each(uploadDropZones,function(idx,dropZone){dropZone.dispose()})}})},qq.DragAndDrop.callbacks=function(){"use strict";return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(files,targetEl){},dropError:function(code,errorSpecifics){qq.log("Drag & drop error code '"+code+" with these specifics: '"+errorSpecifics+"'","error")},dropLog:function(message,level){qq.log(message,level)}}},qq.UploadDropZone=function(o){"use strict";function dragoverShouldBeCanceled(){return qq.safari()||qq.firefox()&&qq.windows()}function disableDropOutside(e){dropOutsideDisabled||(dragoverShouldBeCanceled?disposeSupport.attach(document,"dragover",function(e){e.preventDefault()}):disposeSupport.attach(document,"dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),dropOutsideDisabled=!0)}function isValidFileDrag(e){if(!qq.supportedFeatures.fileDrop)return!1;var effectTest,dt=e.dataTransfer,isSafari=qq.safari();return effectTest=qq.ie()&&qq.supportedFeatures.fileDrop?!0:"none"!==dt.effectAllowed,dt&&effectTest&&(dt.files&&dt.files.length||!isSafari&&dt.types.contains&&dt.types.contains("Files")||dt.types.includes&&dt.types.includes("Files"))}function isOrSetDropDisabled(isDisabled){return void 0!==isDisabled&&(preventDrop=isDisabled),preventDrop}function triggerHidezonesEvent(){function triggerUsingOldApi(){hideZonesEvent=document.createEvent("Event"),hideZonesEvent.initEvent(options.HIDE_ZONES_EVENT_NAME,!0,!0)}var hideZonesEvent;if(window.CustomEvent)try{hideZonesEvent=new CustomEvent(options.HIDE_ZONES_EVENT_NAME)}catch(err){triggerUsingOldApi()}else triggerUsingOldApi();document.dispatchEvent(hideZonesEvent)}function attachEvents(){disposeSupport.attach(element,"dragover",function(e){if(isValidFileDrag(e)){var effect=qq.ie()&&qq.supportedFeatures.fileDrop?null:e.dataTransfer.effectAllowed;"move"===effect||"linkMove"===effect?e.dataTransfer.dropEffect="move":e.dataTransfer.dropEffect="copy",e.stopPropagation(),e.preventDefault()}}),disposeSupport.attach(element,"dragenter",function(e){if(!isOrSetDropDisabled()){if(!isValidFileDrag(e))return;options.onEnter(e)}}),disposeSupport.attach(element,"dragleave",function(e){if(isValidFileDrag(e)){options.onLeave(e);var relatedTarget=document.elementFromPoint(e.clientX,e.clientY);qq(this).contains(relatedTarget)||options.onLeaveNotDescendants(e)}}),disposeSupport.attach(element,"drop",function(e){if(!isOrSetDropDisabled()){if(!isValidFileDrag(e))return;e.preventDefault(),e.stopPropagation(),options.onDrop(e),triggerHidezonesEvent()}})}var options,element,preventDrop,dropOutsideDisabled,disposeSupport=new qq.DisposeSupport;options={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}},qq.extend(options,o),element=options.element,disableDropOutside(),attachEvents(),qq.extend(this,{dropDisabled:function(isDisabled){return isOrSetDropDisabled(isDisabled)},dispose:function(){disposeSupport.dispose()},getElement:function(){return element}}),this._testing={},this._testing.isValidFileDrag=isValidFileDrag},function(){"use strict";qq.uiPublicApi={addInitialFiles:function(cannedFileList){this._parent.prototype.addInitialFiles.apply(this,arguments),this._templating.addCacheToDom()},clearStoredFiles:function(){this._parent.prototype.clearStoredFiles.apply(this,arguments),this._templating.clearFiles()},addExtraDropzone:function(element){this._dnd&&this._dnd.setupExtraDropzone(element)},removeExtraDropzone:function(element){return this._dnd?this._dnd.removeDropzone(element):void 0},getItemByFileId:function(id){return this._templating.isHiddenForever(id)?void 0:this._templating.getFileContainer(id)},reset:function(){this._parent.prototype.reset.apply(this,arguments),this._templating.reset(),!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId()),this._dnd&&(this._dnd.dispose(),this._dnd=this._setupDragAndDrop()),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0,this._setupClickAndEditEventHandlers()},setName:function(id,newName){var formattedFilename=this._options.formatFileName(newName);this._parent.prototype.setName.apply(this,arguments),this._templating.updateFilename(id,formattedFilename)},pauseUpload:function(id){var paused=this._parent.prototype.pauseUpload.apply(this,arguments);return paused&&this._templating.uploadPaused(id),paused},continueUpload:function(id){var continued=this._parent.prototype.continueUpload.apply(this,arguments);return continued&&this._templating.uploadContinued(id),continued},getId:function(fileContainerOrChildEl){return this._templating.getFileId(fileContainerOrChildEl)},getDropTarget:function(fileId){var file=this.getFile(fileId);return file.qqDropTarget}},qq.uiPrivateApi={_getButton:function(buttonId){var button=this._parent.prototype._getButton.apply(this,arguments);return button||buttonId===this._defaultButtonId&&(button=this._templating.getButton()),button},_removeFileItem:function(fileId){this._templating.removeFile(fileId)},_setupClickAndEditEventHandlers:function(){this._fileButtonsClickHandler=qq.FileButtonsClickHandler&&this._bindFileButtonsClickEvent(),this._focusinEventSupported=!qq.firefox(),this._isEditFilenameEnabled()&&(this._filenameClickHandler=this._bindFilenameClickEvent(),this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent(),this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent())},_setupDragAndDrop:function(){var self=this,dropZoneElements=this._options.dragAndDrop.extraDropzones,templating=this._templating,defaultDropZone=templating.getDropZone();return defaultDropZone&&dropZoneElements.push(defaultDropZone),new qq.DragAndDrop({dropZoneElements:dropZoneElements,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){templating.showDropProcessing()},processingDroppedFilesComplete:function(files,targetEl){templating.hideDropProcessing(),qq.each(files,function(idx,file){file.qqDropTarget=targetEl}),files.length&&self.addFiles(files,null,null)},dropError:function(code,errorData){self._itemError(code,errorData)},dropLog:function(message,level){self.log(message,level)}}})},_bindFileButtonsClickEvent:function(){var self=this;return new qq.FileButtonsClickHandler({templating:this._templating,log:function(message,lvl){self.log(message,lvl)},onDeleteFile:function(fileId){self.deleteFile(fileId)},onCancel:function(fileId){self.cancel(fileId)},onRetry:function(fileId){self.retry(fileId)},onPause:function(fileId){self.pauseUpload(fileId)},onContinue:function(fileId){self.continueUpload(fileId)},onGetName:function(fileId){return self.getName(fileId)}})},_isEditFilenameEnabled:function(){return this._templating.isEditFilenamePossible()&&!this._options.autoUpload&&qq.FilenameClickHandler&&qq.FilenameInputFocusHandler&&qq.FilenameInputFocusHandler},_filenameEditHandler:function(){var self=this,templating=this._templating;return{templating:templating,log:function(message,lvl){self.log(message,lvl)},onGetUploadStatus:function(fileId){return self.getUploads({id:fileId}).status},onGetName:function(fileId){return self.getName(fileId)},onSetName:function(id,newName){self.setName(id,newName)},onEditingStatusChange:function(id,isEditing){var qqInput=qq(templating.getEditInput(id)),qqFileContainer=qq(templating.getFileContainer(id));isEditing?(qqInput.addClass("qq-editing"),templating.hideFilename(id),templating.hideEditIcon(id)):(qqInput.removeClass("qq-editing"),templating.showFilename(id),templating.showEditIcon(id)),qqFileContainer.addClass("qq-temp").removeClass("qq-temp")}}},_onUploadStatusChange:function(id,oldStatus,newStatus){this._parent.prototype._onUploadStatusChange.apply(this,arguments),this._isEditFilenameEnabled()&&this._templating.getFileContainer(id)&&newStatus!==qq.status.SUBMITTED&&(this._templating.markFilenameEditable(id),this._templating.hideEditIcon(id)),oldStatus===qq.status.UPLOAD_RETRYING&&newStatus===qq.status.UPLOADING?(this._templating.hideRetry(id),this._templating.setStatusText(id),qq(this._templating.getFileContainer(id)).removeClass(this._classes.retrying)):newStatus===qq.status.UPLOAD_FAILED&&this._templating.hidePause(id)},_bindFilenameInputFocusInEvent:function(){var spec=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusInHandler(spec)},_bindFilenameInputFocusEvent:function(){var spec=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusHandler(spec)},_bindFilenameClickEvent:function(){var spec=qq.extend({},this._filenameEditHandler());return new qq.FilenameClickHandler(spec)},_storeForLater:function(id){this._parent.prototype._storeForLater.apply(this,arguments),this._templating.hideSpinner(id)},_onAllComplete:function(successful,failed){this._parent.prototype._onAllComplete.apply(this,arguments),this._templating.resetTotalProgress()},_onSubmit:function(id,name){var file=this.getFile(id);file&&file.qqPath&&this._options.dragAndDrop.reportDirectoryPaths&&this._paramsStore.addReadOnly(id,{qqpath:file.qqPath}),this._parent.prototype._onSubmit.apply(this,arguments),this._addToList(id,name)},_onSubmitted:function(id){this._isEditFilenameEnabled()&&(this._templating.markFilenameEditable(id),this._templating.showEditIcon(id),this._focusinEventSupported||this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(id)))},_onProgress:function(id,name,loaded,total){this._parent.prototype._onProgress.apply(this,arguments),this._templating.updateProgress(id,loaded,total),0===total||100===Math.round(loaded/total*100)?(this._templating.hideCancel(id),this._templating.hidePause(id),this._templating.hideProgress(id),this._templating.setStatusText(id,this._options.text.waitingForResponse),this._displayFileSize(id)):this._displayFileSize(id,loaded,total)},_onTotalProgress:function(loaded,total){this._parent.prototype._onTotalProgress.apply(this,arguments),this._templating.updateTotalProgress(loaded,total)},_onComplete:function(id,name,result,xhr){function completeUpload(result){fileContainer&&(templating.setStatusText(id),qq(fileContainer).removeClass(self._classes.retrying),templating.hideProgress(id),self.getUploads({id:id}).status!==qq.status.UPLOAD_FAILED&&templating.hideCancel(id),templating.hideSpinner(id),result.success?self._markFileAsSuccessful(id):(qq(fileContainer).addClass(self._classes.fail),templating.showCancel(id),templating.isRetryPossible()&&!self._preventRetries[id]&&(qq(fileContainer).addClass(self._classes.retryable),templating.showRetry(id)),self._controlFailureTextDisplay(id,result)))}var parentRetVal=this._parent.prototype._onComplete.apply(this,arguments),templating=this._templating,fileContainer=templating.getFileContainer(id),self=this;return parentRetVal instanceof qq.Promise?parentRetVal.done(function(newResult){completeUpload(newResult)}):completeUpload(result),parentRetVal},_markFileAsSuccessful:function(id){var templating=this._templating;this._isDeletePossible()&&templating.showDeleteButton(id),qq(templating.getFileContainer(id)).addClass(this._classes.success),this._maybeUpdateThumbnail(id)},_onUploadPrep:function(id){this._parent.prototype._onUploadPrep.apply(this,arguments),this._templating.showSpinner(id)},_onUpload:function(id,name){var parentRetVal=this._parent.prototype._onUpload.apply(this,arguments);return this._templating.showSpinner(id),parentRetVal},_onUploadChunk:function(id,chunkData){this._parent.prototype._onUploadChunk.apply(this,arguments),chunkData.partIndex>0&&this._handler.isResumable(id)&&this._templating.allowPause(id)},_onCancel:function(id,name){this._parent.prototype._onCancel.apply(this,arguments),this._removeFileItem(id),0===this._getNotFinished()&&this._templating.resetTotalProgress()},_onBeforeAutoRetry:function(id){var retryNumForDisplay,maxAuto,retryNote;this._parent.prototype._onBeforeAutoRetry.apply(this,arguments),this._showCancelLink(id),this._options.retry.showAutoRetryNote&&(retryNumForDisplay=this._autoRetries[id],maxAuto=this._options.retry.maxAutoAttempts,retryNote=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,retryNumForDisplay),retryNote=retryNote.replace(/\{maxAuto\}/g,maxAuto),this._templating.setStatusText(id,retryNote),qq(this._templating.getFileContainer(id)).addClass(this._classes.retrying))},_onBeforeManualRetry:function(id){return this._parent.prototype._onBeforeManualRetry.apply(this,arguments)?(this._templating.resetProgress(id),qq(this._templating.getFileContainer(id)).removeClass(this._classes.fail),this._templating.setStatusText(id),this._templating.showSpinner(id),this._showCancelLink(id),!0):(qq(this._templating.getFileContainer(id)).addClass(this._classes.retryable),this._templating.showRetry(id),!1)},_onSubmitDelete:function(id){var onSuccessCallback=qq.bind(this._onSubmitDeleteSuccess,this);this._parent.prototype._onSubmitDelete.call(this,id,onSuccessCallback)},_onSubmitDeleteSuccess:function(id,uuid,additionalMandatedParams){this._options.deleteFile.forceConfirm?this._showDeleteConfirm.apply(this,arguments):this._sendDeleteRequest.apply(this,arguments)},_onDeleteComplete:function(id,xhr,isError){this._parent.prototype._onDeleteComplete.apply(this,arguments),this._templating.hideSpinner(id),isError?(this._templating.setStatusText(id,this._options.deleteFile.deletingFailedText),this._templating.showDeleteButton(id)):this._removeFileItem(id)},_sendDeleteRequest:function(id,uuid,additionalMandatedParams){this._templating.hideDeleteButton(id),this._templating.showSpinner(id),this._templating.setStatusText(id,this._options.deleteFile.deletingStatusText),this._deleteHandler.sendDelete.apply(this,arguments)},_showDeleteConfirm:function(id,uuid,mandatedParams){var retVal,fileName=this.getName(id),confirmMessage=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,fileName),deleteRequestArgs=(this.getUuid(id),arguments),self=this;retVal=this._options.showConfirm(confirmMessage),
qq.isGenericPromise(retVal)?retVal.then(function(){self._sendDeleteRequest.apply(self,deleteRequestArgs)}):retVal!==!1&&self._sendDeleteRequest.apply(self,deleteRequestArgs)},_addToList:function(id,name,canned){var prependData,record,prependIndex=0,dontDisplay=this._handler.isProxied(id)&&this._options.scaling.hideScaled;this._options.display.prependFiles&&(this._totalFilesInBatch>1&&this._filesInBatchAddedToUi>0&&(prependIndex=this._filesInBatchAddedToUi-1),prependData={index:prependIndex}),canned||(this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading&&this._templating.disableCancel(),this._options.multiple||(record=this.getUploads({id:id}),this._handledProxyGroup=this._handledProxyGroup||record.proxyGroupId,record.proxyGroupId===this._handledProxyGroup&&record.proxyGroupId||(this._handler.cancelAll(),this._clearList(),this._handledProxyGroup=null))),canned?(this._templating.addFileToCache(id,this._options.formatFileName(name),prependData,dontDisplay),this._templating.updateThumbnail(id,this._thumbnailUrls[id],!0,this._options.thumbnails.customResizer)):(this._templating.addFile(id,this._options.formatFileName(name),prependData,dontDisplay),this._templating.generatePreview(id,this.getFile(id),this._options.thumbnails.customResizer)),this._filesInBatchAddedToUi+=1,(canned||this._options.display.fileSizeOnSubmit&&qq.supportedFeatures.ajaxUploading)&&this._displayFileSize(id)},_clearList:function(){this._templating.clearFiles(),this.clearStoredFiles()},_displayFileSize:function(id,loadedSize,totalSize){var size=this.getSize(id),sizeForDisplay=this._formatSize(size);size>=0&&(void 0!==loadedSize&&void 0!==totalSize&&(sizeForDisplay=this._formatProgress(loadedSize,totalSize)),this._templating.updateSize(id,sizeForDisplay))},_formatProgress:function(uploadedSize,totalSize){function r(name,replacement){message=message.replace(name,replacement)}var message=this._options.text.formatProgress;return r("{percent}",Math.round(uploadedSize/totalSize*100)),r("{total_size}",this._formatSize(totalSize)),message},_controlFailureTextDisplay:function(id,response){var mode,responseProperty,failureReason;mode=this._options.failedUploadTextDisplay.mode,responseProperty=this._options.failedUploadTextDisplay.responseProperty,"custom"===mode?(failureReason=response[responseProperty],failureReason||(failureReason=this._options.text.failUpload),this._templating.setStatusText(id,failureReason),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(id,failureReason)):"default"===mode?this._templating.setStatusText(id,this._options.text.failUpload):"none"!==mode&&this.log("failedUploadTextDisplay.mode value of '"+mode+"' is not valid","warn")},_showTooltip:function(id,text){this._templating.getFileContainer(id).title=text},_showCancelLink:function(id){(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading)&&this._templating.showCancel(id)},_itemError:function(code,name,item){var message=this._parent.prototype._itemError.apply(this,arguments);this._options.showMessage(message)},_batchError:function(message){this._parent.prototype._batchError.apply(this,arguments),this._options.showMessage(message)},_setupPastePrompt:function(){var self=this;this._options.callbacks.onPasteReceived=function(){var message=self._options.paste.namePromptMessage,defaultVal=self._options.paste.defaultName;return self._options.showPrompt(message,defaultVal)}},_fileOrBlobRejected:function(id,name){this._totalFilesInBatch-=1,this._parent.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(items,params,endpoint){this._totalFilesInBatch=items.length,this._filesInBatchAddedToUi=0,this._parent.prototype._prepareItemsForUpload.apply(this,arguments)},_maybeUpdateThumbnail:function(fileId){var thumbnailUrl=this._thumbnailUrls[fileId],fileStatus=this.getUploads({id:fileId}).status;fileStatus===qq.status.DELETED||!thumbnailUrl&&!this._options.thumbnails.placeholders.waitUntilResponse&&qq.supportedFeatures.imagePreviews||this._templating.updateThumbnail(fileId,thumbnailUrl,this._options.thumbnails.customResizer)},_addCannedFile:function(sessionData){var id=this._parent.prototype._addCannedFile.apply(this,arguments);return this._addToList(id,this.getName(id),!0),this._templating.hideSpinner(id),this._templating.hideCancel(id),this._markFileAsSuccessful(id),id},_setSize:function(id,newSize){this._parent.prototype._setSize.apply(this,arguments),this._templating.updateSize(id,this._formatSize(newSize))},_sessionRequestComplete:function(){this._templating.addCacheToDom(),this._parent.prototype._sessionRequestComplete.apply(this,arguments)}}}(),qq.FineUploader=function(o,namespace){"use strict";var self=this;this._parent=namespace?qq[namespace].FineUploaderBasic:qq.FineUploaderBasic,this._parent.apply(this,arguments),qq.extend(this._options,{element:null,button:null,listElement:null,dragAndDrop:{extraDropzones:[],reportDirectoryPaths:!1},text:{formatProgress:"{percent}% of {total_size}",failUpload:"Upload failed",waitingForResponse:"Processing...",paused:"Paused"},template:"qq-template",classes:{retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",success:"qq-upload-success",fail:"qq-upload-fail",editable:"qq-editable",hide:"qq-hide",dropActive:"qq-upload-drop-area-active"},failedUploadTextDisplay:{mode:"default",responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}..."},deleteFile:{forceConfirm:!1,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:!1,prependFiles:!1},paste:{promptForName:!1,namePromptMessage:"Please name this image"},thumbnails:{customResizer:null,maxCount:0,placeholders:{waitUntilResponse:!1,notAvailablePath:null,waitingPath:null},timeBetweenThumbs:750},scaling:{hideScaled:!1},showMessage:function(message){return self._templating.hasDialog("alert")?self._templating.showDialog("alert",message):void setTimeout(function(){window.alert(message)},0)},showConfirm:function(message){return self._templating.hasDialog("confirm")?self._templating.showDialog("confirm",message):window.confirm(message)},showPrompt:function(message,defaultValue){return self._templating.hasDialog("prompt")?self._templating.showDialog("prompt",message,defaultValue):window.prompt(message,defaultValue)}},!0),qq.extend(this._options,o,!0),this._templating=new qq.Templating({log:qq.bind(this.log,this),templateIdOrEl:this._options.template,containerEl:this._options.element,fileContainerEl:this._options.listElement,button:this._options.button,imageGenerator:this._imageGenerator,classes:{hide:this._options.classes.hide,editable:this._options.classes.editable},limits:{maxThumbs:this._options.thumbnails.maxCount,timeBetweenThumbs:this._options.thumbnails.timeBetweenThumbs},placeholders:{waitUntilUpdate:this._options.thumbnails.placeholders.waitUntilResponse,thumbnailNotAvailable:this._options.thumbnails.placeholders.notAvailablePath,waitingForThumbnail:this._options.thumbnails.placeholders.waitingPath},text:this._options.text}),this._options.workarounds.ios8SafariUploads&&qq.ios800()&&qq.iosSafari()?this._templating.renderFailure(this._options.messages.unsupportedBrowserIos8Safari):!qq.supportedFeatures.uploading||this._options.cors.expected&&!qq.supportedFeatures.uploadCors?this._templating.renderFailure(this._options.messages.unsupportedBrowser):(this._wrapCallbacks(),this._templating.render(),this._classes=this._options.classes,!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId()),this._setupClickAndEditEventHandlers(),qq.DragAndDrop&&qq.supportedFeatures.fileDrop&&(this._dnd=this._setupDragAndDrop()),this._options.paste.targetElement&&this._options.paste.promptForName&&(qq.PasteSupport?this._setupPastePrompt():this.log("Paste support module not found.","error")),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0)},qq.extend(qq.FineUploader.prototype,qq.basePublicApi),qq.extend(qq.FineUploader.prototype,qq.basePrivateApi),qq.extend(qq.FineUploader.prototype,qq.uiPublicApi),qq.extend(qq.FineUploader.prototype,qq.uiPrivateApi),qq.Templating=function(spec){"use strict";var log,isEditElementsExist,isRetryElementExist,templateDom,container,fileList,showThumbnails,serverScale,FILE_ID_ATTR="qq-file-id",FILE_CLASS_PREFIX="qq-file-id-",THUMBNAIL_MAX_SIZE_ATTR="qq-max-size",THUMBNAIL_SERVER_SCALE_ATTR="qq-server-scale",HIDE_DROPZONE_ATTR="qq-hide-dropzone",DROPZPONE_TEXT_ATTR="qq-drop-area-text",IN_PROGRESS_CLASS="qq-in-progress",HIDDEN_FOREVER_CLASS="qq-hidden-forever",fileBatch={content:document.createDocumentFragment(),map:{}},isCancelDisabled=!1,generatedThumbnails=0,thumbnailQueueMonitorRunning=!1,thumbGenerationQueue=[],thumbnailMaxSize=-1,options={log:null,limits:{maxThumbs:0,timeBetweenThumbs:750},templateIdOrEl:"qq-template",containerEl:null,fileContainerEl:null,button:null,imageGenerator:null,classes:{hide:"qq-hide",editable:"qq-editable"},placeholders:{waitUntilUpdate:!1,thumbnailNotAvailable:null,waitingForThumbnail:null},text:{paused:"Paused"}},selectorClasses={button:"qq-upload-button-selector",alertDialog:"qq-alert-dialog-selector",dialogCancelButton:"qq-cancel-button-selector",confirmDialog:"qq-confirm-dialog-selector",dialogMessage:"qq-dialog-message-selector",dialogOkButton:"qq-ok-button-selector",promptDialog:"qq-prompt-dialog-selector",uploader:"qq-uploader-selector",drop:"qq-upload-drop-area-selector",list:"qq-upload-list-selector",progressBarContainer:"qq-progress-bar-container-selector",progressBar:"qq-progress-bar-selector",totalProgressBarContainer:"qq-total-progress-bar-container-selector",totalProgressBar:"qq-total-progress-bar-selector",file:"qq-upload-file-selector",spinner:"qq-upload-spinner-selector",size:"qq-upload-size-selector",cancel:"qq-upload-cancel-selector",pause:"qq-upload-pause-selector",continueButton:"qq-upload-continue-selector",deleteButton:"qq-upload-delete-selector",retry:"qq-upload-retry-selector",statusText:"qq-upload-status-text-selector",editFilenameInput:"qq-edit-filename-selector",editNameIcon:"qq-edit-filename-icon-selector",dropText:"qq-upload-drop-area-text-selector",dropProcessing:"qq-drop-processing-selector",dropProcessingSpinner:"qq-drop-processing-spinner-selector",thumbnail:"qq-thumbnail-selector"},previewGeneration={},cachedThumbnailNotAvailableImg=new qq.Promise,cachedWaitingForThumbnailImg=new qq.Promise,cacheThumbnailPlaceholders=function(){var notAvailableUrl=options.placeholders.thumbnailNotAvailable,waitingUrl=options.placeholders.waitingForThumbnail,spec={maxSize:thumbnailMaxSize,scale:serverScale};showThumbnails&&(notAvailableUrl?options.imageGenerator.generate(notAvailableUrl,new Image,spec).then(function(updatedImg){cachedThumbnailNotAvailableImg.success(updatedImg)},function(){cachedThumbnailNotAvailableImg.failure(),log("Problem loading 'not available' placeholder image at "+notAvailableUrl,"error")}):cachedThumbnailNotAvailableImg.failure(),waitingUrl?options.imageGenerator.generate(waitingUrl,new Image,spec).then(function(updatedImg){cachedWaitingForThumbnailImg.success(updatedImg)},function(){cachedWaitingForThumbnailImg.failure(),log("Problem loading 'waiting for thumbnail' placeholder image at "+waitingUrl,"error")}):cachedWaitingForThumbnailImg.failure())},displayWaitingImg=function(thumbnail){var waitingImgPlacement=new qq.Promise;return cachedWaitingForThumbnailImg.then(function(img){maybeScalePlaceholderViaCss(img,thumbnail),thumbnail.src?waitingImgPlacement.success():(thumbnail.src=img.src,thumbnail.onload=function(){thumbnail.onload=null,show(thumbnail),waitingImgPlacement.success()})},function(){hide(thumbnail),waitingImgPlacement.success()}),waitingImgPlacement},generateNewPreview=function(id,blob,spec){var thumbnail=getThumbnail(id);return log("Generating new thumbnail for "+id),blob.qqThumbnailId=id,options.imageGenerator.generate(blob,thumbnail,spec).then(function(){generatedThumbnails++,show(thumbnail),previewGeneration[id].success()},function(){previewGeneration[id].failure(),options.placeholders.waitUntilUpdate||maybeSetDisplayNotAvailableImg(id,thumbnail)})},generateNextQueuedPreview=function(){if(thumbGenerationQueue.length){thumbnailQueueMonitorRunning=!0;var queuedThumbRequest=thumbGenerationQueue.shift();queuedThumbRequest.update?processUpdateQueuedPreviewRequest(queuedThumbRequest):processNewQueuedPreviewRequest(queuedThumbRequest)}else thumbnailQueueMonitorRunning=!1},getCancel=function(id){return getTemplateEl(getFile(id),selectorClasses.cancel)},getContinue=function(id){return getTemplateEl(getFile(id),selectorClasses.continueButton)},getDialog=function(type){return getTemplateEl(container,selectorClasses[type+"Dialog"])},getDelete=function(id){return getTemplateEl(getFile(id),selectorClasses.deleteButton)},getDropProcessing=function(){return getTemplateEl(container,selectorClasses.dropProcessing)},getEditIcon=function(id){return getTemplateEl(getFile(id),selectorClasses.editNameIcon)},getFile=function(id){return fileBatch.map[id]||qq(fileList).getFirstByClass(FILE_CLASS_PREFIX+id)},getFilename=function(id){return getTemplateEl(getFile(id),selectorClasses.file)},getPause=function(id){return getTemplateEl(getFile(id),selectorClasses.pause)},getProgress=function(id){return null==id?getTemplateEl(container,selectorClasses.totalProgressBarContainer)||getTemplateEl(container,selectorClasses.totalProgressBar):getTemplateEl(getFile(id),selectorClasses.progressBarContainer)||getTemplateEl(getFile(id),selectorClasses.progressBar)},getRetry=function(id){return getTemplateEl(getFile(id),selectorClasses.retry)},getSize=function(id){return getTemplateEl(getFile(id),selectorClasses.size)},getSpinner=function(id){return getTemplateEl(getFile(id),selectorClasses.spinner)},getTemplateEl=function(context,cssClass){return context&&qq(context).getFirstByClass(cssClass)},getThumbnail=function(id){return showThumbnails&&getTemplateEl(getFile(id),selectorClasses.thumbnail)},hide=function(el){el&&qq(el).addClass(options.classes.hide)},maybeScalePlaceholderViaCss=function(placeholder,thumbnail){var maxWidth=placeholder.style.maxWidth,maxHeight=placeholder.style.maxHeight;maxHeight&&maxWidth&&!thumbnail.style.maxWidth&&!thumbnail.style.maxHeight&&qq(thumbnail).css({maxWidth:maxWidth,maxHeight:maxHeight})},maybeSetDisplayNotAvailableImg=function(id,thumbnail){var previewing=previewGeneration[id]||(new qq.Promise).failure(),notAvailableImgPlacement=new qq.Promise;return cachedThumbnailNotAvailableImg.then(function(img){previewing.then(function(){notAvailableImgPlacement.success()},function(){maybeScalePlaceholderViaCss(img,thumbnail),thumbnail.onload=function(){thumbnail.onload=null,notAvailableImgPlacement.success()},thumbnail.src=img.src,show(thumbnail)})}),notAvailableImgPlacement},parseAndGetTemplate=function(){var scriptEl,scriptHtml,fileListNode,tempTemplateEl,fileListEl,defaultButton,dropArea,thumbnail,dropProcessing,dropTextEl,uploaderEl;if(log("Parsing template"),null==options.templateIdOrEl)throw new Error("You MUST specify either a template element or ID!");if(qq.isString(options.templateIdOrEl)){if(scriptEl=document.getElementById(options.templateIdOrEl),null===scriptEl)throw new Error(qq.format("Cannot find template script at ID '{}'!",options.templateIdOrEl));scriptHtml=scriptEl.innerHTML}else{if(void 0===options.templateIdOrEl.innerHTML)throw new Error("You have specified an invalid value for the template option!  It must be an ID or an Element.");scriptHtml=options.templateIdOrEl.innerHTML}if(scriptHtml=qq.trimStr(scriptHtml),tempTemplateEl=document.createElement("div"),tempTemplateEl.appendChild(qq.toElement(scriptHtml)),uploaderEl=qq(tempTemplateEl).getFirstByClass(selectorClasses.uploader),options.button&&(defaultButton=qq(tempTemplateEl).getFirstByClass(selectorClasses.button),defaultButton&&qq(defaultButton).remove()),qq.DragAndDrop&&qq.supportedFeatures.fileDrop||(dropProcessing=qq(tempTemplateEl).getFirstByClass(selectorClasses.dropProcessing),dropProcessing&&qq(dropProcessing).remove()),dropArea=qq(tempTemplateEl).getFirstByClass(selectorClasses.drop),dropArea&&!qq.DragAndDrop&&(log("DnD module unavailable.","info"),qq(dropArea).remove()),qq.supportedFeatures.fileDrop?qq(uploaderEl).hasAttribute(DROPZPONE_TEXT_ATTR)&&dropArea&&(dropTextEl=qq(dropArea).getFirstByClass(selectorClasses.dropText),dropTextEl&&qq(dropTextEl).remove()):(uploaderEl.removeAttribute(DROPZPONE_TEXT_ATTR),dropArea&&qq(dropArea).hasAttribute(HIDE_DROPZONE_ATTR)&&qq(dropArea).css({display:"none"})),thumbnail=qq(tempTemplateEl).getFirstByClass(selectorClasses.thumbnail),showThumbnails?thumbnail&&(thumbnailMaxSize=parseInt(thumbnail.getAttribute(THUMBNAIL_MAX_SIZE_ATTR)),thumbnailMaxSize=thumbnailMaxSize>0?thumbnailMaxSize:null,serverScale=qq(thumbnail).hasAttribute(THUMBNAIL_SERVER_SCALE_ATTR)):thumbnail&&qq(thumbnail).remove(),showThumbnails=showThumbnails&&thumbnail,isEditElementsExist=qq(tempTemplateEl).getByClass(selectorClasses.editFilenameInput).length>0,isRetryElementExist=qq(tempTemplateEl).getByClass(selectorClasses.retry).length>0,fileListNode=qq(tempTemplateEl).getFirstByClass(selectorClasses.list),null==fileListNode)throw new Error("Could not find the file list container in the template!");return fileListEl=fileListNode.children[0].cloneNode(!0),fileListNode.innerHTML="",tempTemplateEl.getElementsByTagName("DIALOG").length&&document.createElement("dialog"),log("Template parsing complete"),{template:tempTemplateEl,fileTemplate:fileListEl}},prependFile=function(el,index,fileList){var parentEl=fileList,beforeEl=parentEl.firstChild;index>0&&(beforeEl=qq(parentEl).children()[index].nextSibling),parentEl.insertBefore(el,beforeEl)},processNewQueuedPreviewRequest=function(queuedThumbRequest){var id=queuedThumbRequest.id,optFileOrBlob=queuedThumbRequest.optFileOrBlob,relatedThumbnailId=optFileOrBlob&&optFileOrBlob.qqThumbnailId,thumbnail=getThumbnail(id),spec={customResizeFunction:queuedThumbRequest.customResizeFunction,maxSize:thumbnailMaxSize,orient:!0,scale:!0};qq.supportedFeatures.imagePreviews?thumbnail?options.limits.maxThumbs&&options.limits.maxThumbs<=generatedThumbnails?(maybeSetDisplayNotAvailableImg(id,thumbnail),generateNextQueuedPreview()):displayWaitingImg(thumbnail).done(function(){previewGeneration[id]=new qq.Promise,previewGeneration[id].done(function(){setTimeout(generateNextQueuedPreview,options.limits.timeBetweenThumbs)}),null!=relatedThumbnailId?useCachedPreview(id,relatedThumbnailId):generateNewPreview(id,optFileOrBlob,spec)}):generateNextQueuedPreview():thumbnail&&(displayWaitingImg(thumbnail),generateNextQueuedPreview())},processUpdateQueuedPreviewRequest=function(queuedThumbRequest){var id=queuedThumbRequest.id,thumbnailUrl=queuedThumbRequest.thumbnailUrl,showWaitingImg=queuedThumbRequest.showWaitingImg,thumbnail=getThumbnail(id),spec={customResizeFunction:queuedThumbRequest.customResizeFunction,scale:serverScale,maxSize:thumbnailMaxSize};if(thumbnail)if(thumbnailUrl){if(!(options.limits.maxThumbs&&options.limits.maxThumbs<=generatedThumbnails))return showWaitingImg&&displayWaitingImg(thumbnail),options.imageGenerator.generate(thumbnailUrl,thumbnail,spec).then(function(){show(thumbnail),generatedThumbnails++,setTimeout(generateNextQueuedPreview,options.limits.timeBetweenThumbs)},function(){maybeSetDisplayNotAvailableImg(id,thumbnail),setTimeout(generateNextQueuedPreview,options.limits.timeBetweenThumbs)});maybeSetDisplayNotAvailableImg(id,thumbnail),generateNextQueuedPreview()}else maybeSetDisplayNotAvailableImg(id,thumbnail),generateNextQueuedPreview()},setProgressBarWidth=function(id,percent){var bar=getProgress(id),progressBarSelector=null==id?selectorClasses.totalProgressBar:selectorClasses.progressBar;bar&&!qq(bar).hasClass(progressBarSelector)&&(bar=qq(bar).getFirstByClass(progressBarSelector)),bar&&(qq(bar).css({width:percent+"%"}),bar.setAttribute("aria-valuenow",percent))},show=function(el){el&&qq(el).removeClass(options.classes.hide)},useCachedPreview=function(targetThumbnailId,cachedThumbnailId){var targetThumbnail=getThumbnail(targetThumbnailId),cachedThumbnail=getThumbnail(cachedThumbnailId);log(qq.format("ID {} is the same file as ID {}.  Will use generated thumbnail from ID {} instead.",targetThumbnailId,cachedThumbnailId,cachedThumbnailId)),previewGeneration[cachedThumbnailId].then(function(){generatedThumbnails++,previewGeneration[targetThumbnailId].success(),log(qq.format("Now using previously generated thumbnail created for ID {} on ID {}.",cachedThumbnailId,targetThumbnailId)),targetThumbnail.src=cachedThumbnail.src,show(targetThumbnail)},function(){previewGeneration[targetThumbnailId].failure(),options.placeholders.waitUntilUpdate||maybeSetDisplayNotAvailableImg(targetThumbnailId,targetThumbnail)})};qq.extend(options,spec),log=options.log,qq.supportedFeatures.imagePreviews||(options.limits.timeBetweenThumbs=0,options.limits.maxThumbs=0),container=options.containerEl,showThumbnails=void 0!==options.imageGenerator,templateDom=parseAndGetTemplate(),cacheThumbnailPlaceholders(),qq.extend(this,{render:function(){log("Rendering template in DOM."),generatedThumbnails=0,container.appendChild(templateDom.template.cloneNode(!0)),hide(getDropProcessing()),this.hideTotalProgress(),fileList=options.fileContainerEl||getTemplateEl(container,selectorClasses.list),log("Template rendering complete")},renderFailure:function(message){var cantRenderEl=qq.toElement(message);container.innerHTML="",container.appendChild(cantRenderEl)},reset:function(){this.render()},clearFiles:function(){fileList.innerHTML=""},disableCancel:function(){isCancelDisabled=!0},addFile:function(id,name,prependInfo,hideForever,batch){var thumb,fileEl=templateDom.fileTemplate.cloneNode(!0),fileNameEl=getTemplateEl(fileEl,selectorClasses.file),uploaderEl=getTemplateEl(container,selectorClasses.uploader),fileContainer=batch?fileBatch.content:fileList;batch&&(fileBatch.map[id]=fileEl),qq(fileEl).addClass(FILE_CLASS_PREFIX+id),uploaderEl.removeAttribute(DROPZPONE_TEXT_ATTR),fileNameEl&&(qq(fileNameEl).setText(name),fileNameEl.setAttribute("title",name)),fileEl.setAttribute(FILE_ID_ATTR,id),prependInfo?prependFile(fileEl,prependInfo.index,fileContainer):fileContainer.appendChild(fileEl),hideForever?(fileEl.style.display="none",qq(fileEl).addClass(HIDDEN_FOREVER_CLASS)):(hide(getProgress(id)),hide(getSize(id)),hide(getDelete(id)),hide(getRetry(id)),hide(getPause(id)),hide(getContinue(id)),isCancelDisabled&&this.hideCancel(id),thumb=getThumbnail(id),thumb&&!thumb.src&&cachedWaitingForThumbnailImg.then(function(waitingImg){thumb.src=waitingImg.src,waitingImg.style.maxHeight&&waitingImg.style.maxWidth&&qq(thumb).css({maxHeight:waitingImg.style.maxHeight,maxWidth:waitingImg.style.maxWidth}),show(thumb)}))},addFileToCache:function(id,name,prependInfo,hideForever){this.addFile(id,name,prependInfo,hideForever,!0)},addCacheToDom:function(){fileList.appendChild(fileBatch.content),fileBatch.content=document.createDocumentFragment(),fileBatch.map={}},removeFile:function(id){qq(getFile(id)).remove()},getFileId:function(el){var currentNode=el;if(currentNode){for(;null==currentNode.getAttribute(FILE_ID_ATTR);)currentNode=currentNode.parentNode;return parseInt(currentNode.getAttribute(FILE_ID_ATTR))}},getFileList:function(){return fileList},markFilenameEditable:function(id){var filename=getFilename(id);filename&&qq(filename).addClass(options.classes.editable)},updateFilename:function(id,name){var filenameEl=getFilename(id);filenameEl&&(qq(filenameEl).setText(name),filenameEl.setAttribute("title",name))},hideFilename:function(id){hide(getFilename(id))},showFilename:function(id){show(getFilename(id))},isFileName:function(el){return qq(el).hasClass(selectorClasses.file)},getButton:function(){return options.button||getTemplateEl(container,selectorClasses.button)},hideDropProcessing:function(){hide(getDropProcessing())},showDropProcessing:function(){show(getDropProcessing())},getDropZone:function(){return getTemplateEl(container,selectorClasses.drop)},isEditFilenamePossible:function(){return isEditElementsExist},hideRetry:function(id){hide(getRetry(id))},isRetryPossible:function(){return isRetryElementExist},showRetry:function(id){show(getRetry(id))},getFileContainer:function(id){return getFile(id)},showEditIcon:function(id){var icon=getEditIcon(id);icon&&qq(icon).addClass(options.classes.editable)},isHiddenForever:function(id){return qq(getFile(id)).hasClass(HIDDEN_FOREVER_CLASS)},hideEditIcon:function(id){var icon=getEditIcon(id);icon&&qq(icon).removeClass(options.classes.editable)},isEditIcon:function(el){return qq(el).hasClass(selectorClasses.editNameIcon,!0)},getEditInput:function(id){return getTemplateEl(getFile(id),selectorClasses.editFilenameInput)},isEditInput:function(el){return qq(el).hasClass(selectorClasses.editFilenameInput,!0)},updateProgress:function(id,loaded,total){var percent,bar=getProgress(id);bar&&total>0&&(percent=Math.round(loaded/total*100),100===percent?hide(bar):show(bar),setProgressBarWidth(id,percent))},updateTotalProgress:function(loaded,total){this.updateProgress(null,loaded,total)},hideProgress:function(id){var bar=getProgress(id);bar&&hide(bar)},hideTotalProgress:function(){this.hideProgress()},resetProgress:function(id){setProgressBarWidth(id,0),this.hideTotalProgress(id)},resetTotalProgress:function(){this.resetProgress()},showCancel:function(id){if(!isCancelDisabled){var cancel=getCancel(id);cancel&&qq(cancel).removeClass(options.classes.hide)}},hideCancel:function(id){hide(getCancel(id))},isCancel:function(el){return qq(el).hasClass(selectorClasses.cancel,!0)},allowPause:function(id){show(getPause(id)),hide(getContinue(id))},uploadPaused:function(id){this.setStatusText(id,options.text.paused),this.allowContinueButton(id),hide(getSpinner(id))},hidePause:function(id){hide(getPause(id))},isPause:function(el){return qq(el).hasClass(selectorClasses.pause,!0)},isContinueButton:function(el){return qq(el).hasClass(selectorClasses.continueButton,!0)},allowContinueButton:function(id){show(getContinue(id)),hide(getPause(id))},uploadContinued:function(id){this.setStatusText(id,""),this.allowPause(id),show(getSpinner(id))},showDeleteButton:function(id){show(getDelete(id))},hideDeleteButton:function(id){hide(getDelete(id))},isDeleteButton:function(el){return qq(el).hasClass(selectorClasses.deleteButton,!0)},isRetry:function(el){return qq(el).hasClass(selectorClasses.retry,!0)},updateSize:function(id,text){var size=getSize(id);size&&(show(size),qq(size).setText(text))},setStatusText:function(id,text){var textEl=getTemplateEl(getFile(id),selectorClasses.statusText);textEl&&(null==text?qq(textEl).clearText():qq(textEl).setText(text))},hideSpinner:function(id){qq(getFile(id)).removeClass(IN_PROGRESS_CLASS),hide(getSpinner(id))},showSpinner:function(id){qq(getFile(id)).addClass(IN_PROGRESS_CLASS),show(getSpinner(id))},generatePreview:function(id,optFileOrBlob,customResizeFunction){this.isHiddenForever(id)||(thumbGenerationQueue.push({id:id,customResizeFunction:customResizeFunction,optFileOrBlob:optFileOrBlob}),!thumbnailQueueMonitorRunning&&generateNextQueuedPreview())},updateThumbnail:function(id,thumbnailUrl,showWaitingImg,customResizeFunction){this.isHiddenForever(id)||(thumbGenerationQueue.push({customResizeFunction:customResizeFunction,update:!0,id:id,thumbnailUrl:thumbnailUrl,showWaitingImg:showWaitingImg}),!thumbnailQueueMonitorRunning&&generateNextQueuedPreview())},hasDialog:function(type){return qq.supportedFeatures.dialogElement&&!!getDialog(type)},showDialog:function(type,message,defaultValue){var dialog=getDialog(type),messageEl=getTemplateEl(dialog,selectorClasses.dialogMessage),inputEl=dialog.getElementsByTagName("INPUT")[0],cancelBtn=getTemplateEl(dialog,selectorClasses.dialogCancelButton),okBtn=getTemplateEl(dialog,selectorClasses.dialogOkButton),promise=new qq.Promise,closeHandler=function(){cancelBtn.removeEventListener("click",cancelClickHandler),okBtn&&okBtn.removeEventListener("click",okClickHandler),promise.failure()},cancelClickHandler=function(){cancelBtn.removeEventListener("click",cancelClickHandler),dialog.close()},okClickHandler=function(){dialog.removeEventListener("close",closeHandler),okBtn.removeEventListener("click",okClickHandler),dialog.close(),promise.success(inputEl&&inputEl.value)};return dialog.addEventListener("close",closeHandler),cancelBtn.addEventListener("click",cancelClickHandler),okBtn&&okBtn.addEventListener("click",okClickHandler),inputEl&&(inputEl.value=defaultValue),messageEl.textContent=message,dialog.showModal(),promise}})},qq.UiEventHandler=function(s,protectedApi){"use strict";function addHandler(element){disposer.attach(element,spec.eventType,function(event){event=event||window.event;var target=event.target||event.srcElement;spec.onHandled(target,event)})}var disposer=new qq.DisposeSupport,spec={eventType:"click",attachTo:null,onHandled:function(target,event){}};qq.extend(this,{addHandler:function(element){addHandler(element)},dispose:function(){disposer.dispose()}}),qq.extend(protectedApi,{getFileIdFromItem:function(item){return item.qqFileId},getDisposeSupport:function(){return disposer}}),qq.extend(spec,s),spec.attachTo&&addHandler(spec.attachTo)},qq.FileButtonsClickHandler=function(s){"use strict";function examineEvent(target,event){qq.each(buttonHandlers,function(buttonType,handler){var fileId,firstLetterCapButtonType=buttonType.charAt(0).toUpperCase()+buttonType.slice(1);return spec.templating["is"+firstLetterCapButtonType](target)?(fileId=spec.templating.getFileId(target),qq.preventDefault(event),spec.log(qq.format("Detected valid file button click event on file '{}', ID: {}.",spec.onGetName(fileId),fileId)),handler(fileId),!1):void 0})}var inheritedInternalApi={},spec={templating:null,log:function(message,lvl){},onDeleteFile:function(fileId){},onCancel:function(fileId){},onRetry:function(fileId){},onPause:function(fileId){},onContinue:function(fileId){},onGetName:function(fileId){}},buttonHandlers={cancel:function(id){spec.onCancel(id)},retry:function(id){spec.onRetry(id)},deleteButton:function(id){spec.onDeleteFile(id)},pause:function(id){spec.onPause(id)},continueButton:function(id){spec.onContinue(id)}};qq.extend(spec,s),spec.eventType="click",spec.onHandled=examineEvent,spec.attachTo=spec.templating.getFileList(),qq.extend(this,new qq.UiEventHandler(spec,inheritedInternalApi))},qq.FilenameClickHandler=function(s){"use strict";function examineEvent(target,event){if(spec.templating.isFileName(target)||spec.templating.isEditIcon(target)){var fileId=spec.templating.getFileId(target),status=spec.onGetUploadStatus(fileId);status===qq.status.SUBMITTED&&(spec.log(qq.format("Detected valid filename click event on file '{}', ID: {}.",spec.onGetName(fileId),fileId)),qq.preventDefault(event),inheritedInternalApi.handleFilenameEdit(fileId,target,!0))}}var inheritedInternalApi={},spec={templating:null,log:function(message,lvl){},classes:{file:"qq-upload-file",editNameIcon:"qq-edit-filename-icon"},onGetUploadStatus:function(fileId){},onGetName:function(fileId){}};qq.extend(spec,s),spec.eventType="click",spec.onHandled=examineEvent,qq.extend(this,new qq.FilenameEditHandler(spec,inheritedInternalApi))},qq.FilenameInputFocusInHandler=function(s,inheritedInternalApi){"use strict";function handleInputFocus(target,event){if(spec.templating.isEditInput(target)){var fileId=spec.templating.getFileId(target),status=spec.onGetUploadStatus(fileId);status===qq.status.SUBMITTED&&(spec.log(qq.format("Detected valid filename input focus event on file '{}', ID: {}.",spec.onGetName(fileId),fileId)),inheritedInternalApi.handleFilenameEdit(fileId,target))}}var spec={templating:null,onGetUploadStatus:function(fileId){},log:function(message,lvl){}
};inheritedInternalApi||(inheritedInternalApi={}),spec.eventType="focusin",spec.onHandled=handleInputFocus,qq.extend(spec,s),qq.extend(this,new qq.FilenameEditHandler(spec,inheritedInternalApi))},qq.FilenameInputFocusHandler=function(spec){"use strict";spec.eventType="focus",spec.attachTo=null,qq.extend(this,new qq.FilenameInputFocusInHandler(spec,{}))},qq.FilenameEditHandler=function(s,inheritedInternalApi){"use strict";function getFilenameSansExtension(fileId){var filenameSansExt=spec.onGetName(fileId),extIdx=filenameSansExt.lastIndexOf(".");return extIdx>0&&(filenameSansExt=filenameSansExt.substr(0,extIdx)),filenameSansExt}function getOriginalExtension(fileId){var origName=spec.onGetName(fileId);return qq.getExtension(origName)}function handleNameUpdate(newFilenameInputEl,fileId){var origExtension,newName=newFilenameInputEl.value;void 0!==newName&&qq.trimStr(newName).length>0&&(origExtension=getOriginalExtension(fileId),void 0!==origExtension&&(newName=newName+"."+origExtension),spec.onSetName(fileId,newName)),spec.onEditingStatusChange(fileId,!1)}function registerInputBlurHandler(inputEl,fileId){inheritedInternalApi.getDisposeSupport().attach(inputEl,"blur",function(){handleNameUpdate(inputEl,fileId)})}function registerInputEnterKeyHandler(inputEl,fileId){inheritedInternalApi.getDisposeSupport().attach(inputEl,"keyup",function(event){var code=event.keyCode||event.which;13===code&&handleNameUpdate(inputEl,fileId)})}var spec={templating:null,log:function(message,lvl){},onGetUploadStatus:function(fileId){},onGetName:function(fileId){},onSetName:function(fileId,newName){},onEditingStatusChange:function(fileId,isEditing){}};qq.extend(spec,s),spec.attachTo=spec.templating.getFileList(),qq.extend(this,new qq.UiEventHandler(spec,inheritedInternalApi)),qq.extend(inheritedInternalApi,{handleFilenameEdit:function(id,target,focusInput){var newFilenameInputEl=spec.templating.getEditInput(id);spec.onEditingStatusChange(id,!0),newFilenameInputEl.value=getFilenameSansExtension(id),focusInput&&newFilenameInputEl.focus(),registerInputBlurHandler(newFilenameInputEl,id),registerInputEnterKeyHandler(newFilenameInputEl,id)}})}}(window),function(){define("directives/fineUpload",["base","fineuploader"],function(App,qq){return App.directive("fineUpload",function($timeout){return{scope:{multiple:"=",endpoint:"@",templateId:"@",allowedExtensions:"=",onCompleteCallback:"=",onUploadCallback:"=",onValidateBatch:"=",onErrorCallback:"=",onSubmitCallback:"=",onCancelCallback:"=",autoUpload:"=",params:"=",control:"="},link:function(scope,element,attrs){var autoUpload,endpoint,maxConnections,multiple,onCancel,onComplete,onError,onSubmit,onUpload,onValidateBatch,params,q,ref,templateId,validation;return multiple=scope.multiple||!1,endpoint=scope.endpoint,templateId=scope.templateId,validation=null!=scope.allowedExtensions?{allowedExtensions:scope.allowedExtensions}:{},maxConnections=scope.maxConnections||1,onComplete=scope.onCompleteCallback||function(){},onUpload=scope.onUploadCallback||function(){},onError=scope.onErrorCallback||function(){},onValidateBatch=scope.onValidateBatch||function(){},onSubmit=scope.onSubmitCallback||function(){},onCancel=scope.onCancelCallback||function(){},autoUpload=null==scope.autoUpload?!0:scope.autoUpload,params=scope.params||{},params._csrf=window.csrfToken,q=new qq.FineUploader({element:element[0],multiple:multiple,autoUpload:autoUpload,disabledCancelForFormUploads:!0,validation:validation,maxConnections:maxConnections,request:{endpoint:endpoint,forceMultipart:!0,params:params,paramsInBody:!1},callbacks:{onComplete:onComplete,onUpload:onUpload,onValidateBatch:onValidateBatch,onError:onError,onSubmit:onSubmit,onCancel:onCancel},template:templateId}),window.q=q,null!=(ref=scope.control)&&(ref.q=q),q}}})})}.call(this),function(){define("directives/scroll",["base"],function(App){return App.directive("updateScrollBottomOn",function($timeout){return{restrict:"A",link:function(scope,element,attrs,ctrls){var scrollBottom;return scrollBottom=0,element.on("scroll",function(e){return scrollBottom=element[0].scrollHeight-element[0].scrollTop-element[0].clientHeight}),scope.$on(attrs.updateScrollBottomOn,function(){return $timeout(function(){return element.scrollTop(element[0].scrollHeight-element[0].clientHeight-scrollBottom)},0)})}}})})}.call(this),function(){define("directives/onEnter",["base"],function(App){return App.directive("onEnter",function(){return function(scope,element,attrs){return element.bind("keydown keypress",function(event){return 13===event.which?(scope.$apply(function(){return scope.$eval(attrs.onEnter,{event:event})}),event.preventDefault()):void 0})}})})}.call(this),function(){define("directives/stopPropagation",["base"],function(App){return App.directive("stopPropagation",function($http){return{restrict:"A",link:function(scope,element,attrs){return element.bind(attrs.stopPropagation,function(e){return e.stopPropagation()})}}}),App.directive("preventDefault",function($http){return{restrict:"A",link:function(scope,element,attrs){return element.bind(attrs.preventDefault,function(e){return e.preventDefault()})}}})})}.call(this),function(){define("directives/rightClick",["base"],function(App){return App.directive("rightClick",function(){return{restrict:"A",link:function(scope,element,attrs){return element.bind("contextmenu",function(e){return e.preventDefault(),e.stopPropagation(),scope.$eval(attrs.rightClick)})}}})})}.call(this),function(){define("directives/expandableTextArea",["base"],function(App){return App.directive("expandableTextArea",function(){return{restrict:"A",link:function(scope,el){var resetHeight;return resetHeight=function(){var curHeight,fitHeight;return curHeight=el.outerHeight(),fitHeight=el.prop("scrollHeight"),fitHeight>curHeight&&""!==el.val()?(scope.$emit("expandable-text-area:resize"),el.css("height",fitHeight)):void 0},scope.$watch(function(){return el.val()},resetHeight)}}})})}.call(this),function(){define("directives/videoPlayState",["base"],function(App){return App.directive("videoPlayState",function($parse){return{restrict:"A",link:function(scope,element,attrs){var videoDOMEl;return videoDOMEl=element[0],scope.$watch(function(){return $parse(attrs.videoPlayState)(scope)},function(shouldPlay){return shouldPlay?(videoDOMEl.currentTime=0,videoDOMEl.play()):videoDOMEl.pause()})}}})})}.call(this),function(){var slice=[].slice;define("services/queued-http",["base"],function(App){return App.factory("queuedHttp",function($http,$q){var inflight,pendingRequests,processPendingRequests,queuedHttp;return pendingRequests=[],inflight=!1,processPendingRequests=function(){var doRequest;if(!inflight)return doRequest=pendingRequests.shift(),null!=doRequest?(inflight=!0,doRequest().then(function(){return inflight=!1,processPendingRequests()})["catch"](function(){return inflight=!1,processPendingRequests()})):void 0},queuedHttp=function(){var args,doRequest,errorCallbacks,promise,successCallbacks;return args=1<=arguments.length?slice.call(arguments,0):[],promise={},successCallbacks=[],errorCallbacks=[],promise.then=function(callback,errCallback){return successCallbacks.push(callback),null!=errCallback&&errorCallbacks.push(errCallback),promise},promise["catch"]=function(callback){return errorCallbacks.push(callback),promise},doRequest=function(){return $http.apply(null,args).then(function(){var args,cb,i,len,results;for(args=1<=arguments.length?slice.call(arguments,0):[],results=[],i=0,len=successCallbacks.length;len>i;i++)cb=successCallbacks[i],results.push(cb.apply(null,args));return results})["catch"](function(){var args,cb,i,len,results;for(args=1<=arguments.length?slice.call(arguments,0):[],results=[],i=0,len=errorCallbacks.length;len>i;i++)cb=errorCallbacks[i],results.push(cb.apply(null,args));return results})},pendingRequests.push(doRequest),processPendingRequests(),promise},queuedHttp.post=function(url,data){return queuedHttp({method:"POST",url:url,data:data})},queuedHttp})})}.call(this),function(){define("services/validateCaptcha",["base"],function(App){return App.factory("validateCaptcha",function(){var _recaptchaCallbacks,onRecaptchaSubmit,recaptchaId,validateCaptcha;return _recaptchaCallbacks=[],onRecaptchaSubmit=function(token){var cb,i,len;for(i=0,len=_recaptchaCallbacks.length;len>i;i++)(cb=_recaptchaCallbacks[i])(token);return _recaptchaCallbacks=[]},recaptchaId=null,validateCaptcha=function(_this){return function(callback){var el,reset;return null==callback&&(callback=function(response){}),"undefined"==typeof grecaptcha||null===grecaptcha?callback():(reset=function(){return grecaptcha.reset()},_recaptchaCallbacks.push(callback),_recaptchaCallbacks.push(reset),null==recaptchaId&&(el=$("#recaptcha")[0],recaptchaId=grecaptcha.render(el,{callback:onRecaptchaSubmit})),grecaptcha.execute(recaptchaId))}}(this)})})}.call(this),function(){define("services/wait-for",["base"],function(App){return App.factory("waitFor",function($q){var waitFor;return waitFor=function(testFunction,timeout,pollInterval){var iterationLimit,iterations;return null==pollInterval&&(pollInterval=500),iterationLimit=Math.floor(timeout/pollInterval),iterations=0,$q(function(resolve,reject){var tryIteration;return(tryIteration=function(){var result;return iterations>iterationLimit?reject(new Error("waiting too long, "+JSON.stringify({timeout:timeout,pollInterval:pollInterval}))):(iterations+=1,result=testFunction(),null!=result?resolve(result):setTimeout(tryIteration,pollInterval))})()})}})})}.call(this),function(){define("filters/formatDate",["base","moment"],function(App,moment){return moment.locale("en",{calendar:{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",lastWeek:"ddd, Do MMM YY",nextWeek:"ddd, Do MMM YY",sameElse:"ddd, Do MMM YY"}}),App.filter("formatDate",function(){return function(date,format){return null==format&&(format="Do MMM YYYY, h:mm a"),moment(date).format(format)}}),App.filter("relativeDate",function(){return function(date){return moment(date).calendar()}}),App.filter("fromNowDate",function(){return function(date){return moment(date).fromNow()}})})}.call(this),function(){define("main/event",["moment","base","modules/localStorage"],function(moment,App){var CACHE_KEY,heartbeatsSent,nextHeartbeat,send;return CACHE_KEY="mbEvents",heartbeatsSent=0,nextHeartbeat=new Date,send=function(category,action,attributes){var event_name;return null==attributes&&(attributes={}),ga("send","event",category,action),event_name=action+"-"+category,"function"==typeof Intercom?Intercom("trackEvent",event_name,attributes):void 0},App.factory("event_tracking",function($http,localStorage){var _addEventToCache,_eventInCache,_getEventCache,_sendEditingSessionHeartbeat;return _getEventCache=function(){var eventCache;return eventCache=localStorage(CACHE_KEY),null==eventCache&&(eventCache={},localStorage(CACHE_KEY,eventCache)),eventCache},_eventInCache=function(key){var curCache;return curCache=_getEventCache(),curCache[key]||!1},_addEventToCache=function(key){var curCache;return curCache=_getEventCache(),curCache[key]=!0,localStorage(CACHE_KEY,curCache)},_sendEditingSessionHeartbeat=function(){return $http({url:"/editingSession/"+window.project_id,method:"PUT",headers:{"X-CSRF-Token":window.csrfToken}})},{send:function(category,action,label,value){return ga("send","event",category,action,label,value)},sendGAOnce:function(category,action,label,value){return _eventInCache(action)?void 0:(_addEventToCache(action),this.send(category,action,label,value))},editingSessionHeartbeat:function(){var backoffSecs;if(nextHeartbeat<=new Date)return _sendEditingSessionHeartbeat(),heartbeatsSent++,backoffSecs=2>=heartbeatsSent?30:6>=heartbeatsSent?60*(heartbeatsSent-2):300,nextHeartbeat=moment().add(backoffSecs,"seconds").toDate()},sendMB:function(key,segmentation){return null==segmentation&&(segmentation={}),$http({url:"/event/"+key,method:"POST",data:segmentation,headers:{"X-CSRF-Token":window.csrfToken}})},sendMBSampled:function(key,segmentation){return Math.random()<.01?this.sendMB(key,segmentation):void 0},sendMBOnce:function(key,segmentation){return _eventInCache(key)?void 0:(_addEventToCache(key),this.sendMB(key,segmentation))},eventInCache:function(key){return _eventInCache(key)}}}),$(".navbar a").on("click",function(e){var href;return href=$(e.target).attr("href"),null!=href?ga("send","event","navigation","top menu bar",href):void 0})})}.call(this),function(){define("main/account-upgrade",["base"],function(App){return App.controller("FreeTrialModalController",function($scope,abTestManager,sixpack,event_tracking){return $scope.buttonClass="btn-primary",$scope.startFreeTrial=function(source,couponCode){var go,plan,w;return plan="collaborator_free_trial_7_days",w=window.open(),(go=function(){var url;return"function"==typeof ga&&ga("send","event","subscription-funnel","upgraded-free-trial",source),window.useV2TrialUrl?url="/user/trial":(url="/user/subscription/new?planCode="+plan+"&ssp=true",null!=couponCode&&(url=url+"&cc="+couponCode)),$scope.startedFreeTrial=!0,event_tracking.sendMB("subscription-start-trial",{source:source,plan:plan}),w.location=url})()}})})}.call(this),function(){var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};define("ide",["base","ide/file-tree/FileTreeManager","ide/connection/ConnectionManager","ide/editor/EditorManager","ide/online-users/OnlineUsersManager","ide/history/HistoryManager","ide/history/HistoryV2Manager","ide/permissions/PermissionsManager","ide/pdf/PdfManager","ide/binary-files/BinaryFilesManager","ide/references/ReferencesManager","ide/metadata/MetadataManager","ide/review-panel/ReviewPanelManager","ide/SafariScrollPatcher","ide/settings/index","ide/share/index","ide/chat/index","ide/clone/index","ide/hotkeys/index","ide/test-controls/index","ide/wordcount/index","ide/directives/layout","ide/directives/validFile","ide/services/ide","ide/tpr-webmodule/index","ide/templates/index","ide/rich-text/index","ide/references-search/index","ide/publish-modal/index","ide/github-sync/index","ide/dropbox/index","analytics/AbTestingManager","directives/focus","directives/fineUpload","directives/scroll","directives/onEnter","directives/stopPropagation","directives/rightClick","directives/expandableTextArea","directives/videoPlayState","services/queued-http","services/validateCaptcha","services/wait-for","filters/formatDate","main/event","main/account-upgrade"],function(App,FileTreeManager,ConnectionManager,EditorManager,OnlineUsersManager,HistoryManager,HistoryV2Manager,PermissionsManager,PdfManager,BinaryFilesManager,ReferencesManager,MetadataManager,ReviewPanelManager,SafariScrollPatcher){return App.controller("IdeController",function($scope,$timeout,ide,localStorage,sixpack,event_tracking,metadata,$q){var DARK_THEMES,_loaded,browserIsChrome61or62,chromeVersion,err,inited,pdfLayout,ref,ref1,userAgent;$scope.$originalApply=$scope.$apply,$scope.$apply=function(fn){var phase;return null==fn&&(fn=function(){}),phase=this.$root.$$phase,"$apply"===phase||"$digest"===phase?fn():this.$originalApply(fn)},$scope.state={loading:!0,load_progress:40,error:null},$scope.ui={leftMenuShown:!1,view:"editor",chatOpen:!1,pdfLayout:"sideBySide",pdfHidden:!1,pdfWidth:0,reviewPanelOpen:localStorage("ui.reviewPanelOpen."+window.project_id),miniReviewPanelVisible:!1,chatResizerSizeOpen:window.uiConfig.chatResizerSizeOpen,chatResizerSizeClosed:window.uiConfig.chatResizerSizeClosed,defaultFontFamily:window.uiConfig.defaultFontFamily,defaultLineHeight:window.uiConfig.defaultLineHeight},$scope.user=window.user,$scope.settings=window.userSettings,$scope.anonymous=window.anonymous,$scope.isTokenMember=window.isTokenMember,$scope.chat={},ide.toggleReviewPanel=$scope.toggleReviewPanel=function(){return $scope.project.features.trackChangesVisible?($scope.ui.reviewPanelOpen=!$scope.ui.reviewPanelOpen,event_tracking.sendMB("rp-toggle-panel",{value:$scope.ui.reviewPanelOpen})):void 0},$scope.$watch("ui.reviewPanelOpen",function(value){return null!=value?localStorage("ui.reviewPanelOpen."+window.project_id,value):void 0}),$scope.$on("layout:pdf:resize",function(_,layoutState){return $scope.ui.pdfHidden=layoutState.east.initClosed,$scope.ui.pdfWidth=layoutState.east.size}),$scope.$watch("ui.view",function(newView,oldView){return null!=newView&&"editor"!==newView&&"pdf"!==newView?event_tracking.sendMBOnce("ide-open-view-"+newView+"-once"):void 0}),$scope.$watch("ui.chatOpen",function(isOpen){return isOpen?event_tracking.sendMBOnce("ide-open-chat-once"):void 0}),$scope.$watch("ui.leftMenuShown",function(isOpen){return isOpen?event_tracking.sendMBOnce("ide-open-left-menu-once"):void 0}),$scope.trackHover=function(feature){return event_tracking.sendMBOnce("ide-hover-"+feature+"-once")},window._ide=ide,ide.validFileRegex="^[^*/]*$",ide.project_id=$scope.project_id=window.project_id,ide.$scope=$scope,ide.referencesSearchManager=new ReferencesManager(ide,$scope),ide.connectionManager=new ConnectionManager(ide,$scope),ide.fileTreeManager=new FileTreeManager(ide,$scope),ide.editorManager=new EditorManager(ide,$scope,localStorage),ide.onlineUsersManager=new OnlineUsersManager(ide,$scope),window.data.useV2History?ide.historyManager=new HistoryV2Manager(ide,$scope):ide.historyManager=new HistoryManager(ide,$scope),ide.pdfManager=new PdfManager(ide,$scope),ide.permissionsManager=new PermissionsManager(ide,$scope),ide.binaryFilesManager=new BinaryFilesManager(ide,$scope),ide.metadataManager=new MetadataManager(ide,$scope,metadata),inited=!1,$scope.$on("project:joined",function(){var ref;if(!inited)return inited=!0,(null!=$scope&&null!=(ref=$scope.project)?ref.deletedByExternalDataSource:void 0)&&ide.showGenericMessageModal("Project Renamed or Deleted","This project has either been renamed or deleted by an external data source such as Dropbox.\nWe don't want to delete your data on ShareLaTeX, so this project still contains your history and collaborators.\nIf the project has been renamed please look in your project list for a new project under the new name."),$timeout(function(){var _labelsInitialLoadDone;return $scope.permissions.write?(ide.metadataManager.loadProjectMetaFromServer(),_labelsInitialLoadDone=!0):void 0},200)}),_loaded=!1,$scope.$on("doc:opened",function(){return _loaded?void 0:($scope.$broadcast("ide:loaded"),_loaded=!0)}),$scope.$on("cursor:editor:update",event_tracking.editingSessionHeartbeat),DARK_THEMES=["ambiance","chaos","clouds_midnight","cobalt","idle_fingers","merbivore","merbivore_soft","mono_industrial","monokai","pastel_on_dark","solarized_dark","terminal","tomorrow_night","tomorrow_night_blue","tomorrow_night_bright","tomorrow_night_eighties","twilight","vibrant_ink"],$scope.darkTheme=!1,$scope.$watch("settings.editorTheme",function(theme){return indexOf.call(DARK_THEMES,theme)>=0?$scope.darkTheme=!0:$scope.darkTheme=!1}),ide.localStorage=localStorage,ide.browserIsSafari=!1,$scope.switchToFlatLayout=function(view){return $scope.ui.pdfLayout="flat",$scope.ui.view=view,ide.localStorage("pdf.layout","flat")},$scope.switchToSideBySideLayout=function(view){return $scope.ui.pdfLayout="sideBySide",$scope.ui.view=view,localStorage("pdf.layout","split")},(pdfLayout=localStorage("pdf.layout"))?("split"===pdfLayout&&$scope.switchToSideBySideLayout(),"flat"===pdfLayout&&$scope.switchToFlatLayout()):$scope.switchToSideBySideLayout();try{userAgent=navigator.userAgent,ide.browserIsSafari=userAgent&&/.*Safari\/.*/.test(userAgent)&&!/.*Chrome\/.*/.test(userAgent)&&!/.*Chromium\/.*/.test(userAgent)}catch(error){err=error,console.error(err)}ide.browserIsSafari&&(ide.safariScrollPatcher=new SafariScrollPatcher($scope)),browserIsChrome61or62=!1;try{chromeVersion=parseFloat(navigator.userAgent.split(" Chrome/")[1])||null,browserIsChrome61or62=null!=chromeVersion,browserIsChrome61or62&&document.styleSheets[0].insertRule(".ace_editor.ace_autocomplete .ace_completion-highlight { text-shadow: none !important; font-weight: bold; }",1)}catch(error){err=error,console.error(err)}return ide.featureToggle="undefined"!=typeof location&&null!==location&&null!=(ref=location.search)&&null!=(ref1=ref.match(/^\?ft=(\w+)$/))?ref1[1]:void 0,ide.socket.on("project:publicAccessLevel:changed",function(_this){return function(data){return null!=data.newAccessLevel?(ide.$scope.project.publicAccesLevel=data.newAccessLevel,$scope.$digest()):void 0}}(this))}),angular.bootstrap(document.body,["SharelatexApp"])})}.call(this);
//# sourceMappingURL=ide.js.map
//ide.js is complete - used for automated testing